<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">





























  
  
  
  

  

  

  

  

  

  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.6.0',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: 'FRAAR0AUP0',
      apiKey: '459ace1d7f5aabfa15b4f89baba340b3',
      indexName: 'blog.butonly.com',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="keywords" content="Blog,Technology,Skill,Program,Coding,Javascript,Node.js,Docker,Kubernetes">
<meta property="og:type" content="website">
<meta property="og:title" content="lyj&#39;s blog">
<meta property="og:url" content="/index.html">
<meta property="og:site_name" content="lyj&#39;s blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="lyj&#39;s blog">



  <link rel="alternate" href="/atom.xml" title="lyj's blog" type="application/atom+xml">




  <link rel="canonical" href="/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>lyj's blog</title>
  




  <script async src="https://www.googletagmanager.com/gtag/js?id=014348069229275019795:-z92dm0sjiy"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '014348069229275019795:-z92dm0sjiy');
  </script>



  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?4cd57e104d0d9f5862dd91d0acdb9eee";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">lyj's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">5</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">4</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">6</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

    <a href="https://github.com/liuyanjie" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="/posts/Git学习资料整理/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lyj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyj's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/posts/Git学习资料整理/" class="post-title-link" itemprop="url">Git学习资料整理</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-28 08:00:00" itemprop="dateCreated datePublished" datetime="2018-12-28T08:00:00+08:00">2018-12-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-29 00:24:16" itemprop="dateModified" datetime="2018-12-29T00:24:16+08:00">2018-12-29</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/GIT/" itemprop="url" rel="index"><span itemprop="name">GIT</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/GIT/VCS/" itemprop="url" rel="index"><span itemprop="name">VCS</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/Git学习资料整理/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/Git学习资料整理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">1.1k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">1 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>日常整理的 Git 相关的学习资料及文档</p>
<h2 id="docs"><a href="#docs" class="headerlink" title="docs"></a>docs</h2><ul>
<li><a href="https://git-scm.com/docs" target="_blank" rel="noopener">Reference</a></li>
<li><a href="https://git-scm.com/book/zh/v2" target="_blank" rel="noopener">ProGitV2</a></li>
</ul>
<h2 id="整理内容"><a href="#整理内容" class="headerlink" title="整理内容"></a>整理内容</h2><ul>
<li><a href="./git-object-model.md">GIT对象模型</a></li>
<li><a href="./git-working-mechanism.md">Git工作机制</a></li>
</ul>
<h2 id="Git学习"><a href="#Git学习" class="headerlink" title="Git学习"></a>Git学习</h2><ul>
<li><a href="http://learngitbranching.js.org/" target="_blank" rel="noopener">learngitbranching</a></li>
<li><a href="http://ndpsoftware.com/git-cheatsheet.html" target="_blank" rel="noopener">git-cheatsheet</a></li>
<li><a href="http://marklodato.github.io/visual-git-guide/index-en.html" target="_blank" rel="noopener">A Visual Git Reference</a></li>
</ul>
<h2 id="Books"><a href="#Books" class="headerlink" title="Books"></a>Books</h2><ul>
<li><a href="http://www.kancloud.cn/thinkphp/pro-git" target="_blank" rel="noopener">ProGit第一版（中文版）</a></li>
<li><a href="https://github.com/geeeeeeeeek/git-recipes/wiki" target="_blank" rel="noopener">git-recipes</a></li>
<li><a href="http://gitbook.liuhui998.com/index.html" target="_blank" rel="noopener">Git Community Book 中文版</a></li>
<li><a href="http://think-like-a-git.net/" target="_blank" rel="noopener">Think Like (a) Git</a></li>
<li><a href="http://www.worldhello.net/gotgithub/" target="_blank" rel="noopener">GotGitHub</a></li>
</ul>
<h2 id="Github-Repo"><a href="#Github-Repo" class="headerlink" title="Github-Repo"></a>Github-Repo</h2><ul>
<li><a href="https://github.com/nvie/gitflow" target="_blank" rel="noopener">gitflow</a></li>
<li><a href="https://github.com/danielkummer/git-flow-cheatsheet" target="_blank" rel="noopener">git-flow-cheatsheet</a></li>
<li><a href="https://github.com/xirong/my-git" target="_blank" rel="noopener">my-git</a></li>
</ul>
<h2 id="Git-Flow"><a href="#Git-Flow" class="headerlink" title="Git-Flow"></a>Git-Flow</h2><ul>
<li><a href="http://nvie.com/posts/a-successful-git-branching-model/" target="_blank" rel="noopener">a-successful-git-branching-model</a></li>
<li><a href="http://danielkummer.github.io/git-flow-cheatsheet/" target="_blank" rel="noopener">git-flow-cheatsheet</a></li>
<li><a href="https://hackernoon.com/a-branching-and-releasing-strategy-that-fits-github-flow-be1b6c48eca2" target="_blank" rel="noopener">A Branching and Releasing Strategy That Fits GitHub Flow</a></li>
</ul>
<h2 id="Git-Skills"><a href="#Git-Skills" class="headerlink" title="Git-Skills"></a>Git-Skills</h2><ul>
<li><a href="http://blog.dm4.tw/blog/2015/04/19/modify-git-commit-time/" target="_blank" rel="noopener">更改GitCommit時間</a></li>
<li><a href="http://qa.helplib.com/93646" target="_blank" rel="noopener">在Git，怎么能更改一个旧的提交时间戳？</a></li>
<li><a href="http://www.jianshu.com/p/884ff6252be5" target="_blank" rel="noopener">Git 清理无效的远程追踪分支</a></li>
<li><a href="http://bbs.bugcode.cn/t/701" target="_blank" rel="noopener">如何删除已合并的所有git分支？</a></li>
</ul>
<h2 id="StackOverflow"><a href="#StackOverflow" class="headerlink" title="StackOverflow"></a>StackOverflow</h2><ul>
<li><a href="http://stackoverflow.com/questions/462974/what-are-the-differences-between-double-dot-and-triple-dot-in-git-com#answer-24186641" target="_blank" rel="noopener">what-are-the-differences-between-double-dot-and-triple-dot-in-git-com</a></li>
<li><a href="https://softwareengineering.stackexchange.com/questions/165725/git-branching-and-tagging-best-practices" target="_blank" rel="noopener">git-branching-and-tagging-best-practices</a></li>
<li><a href="https://stackoverflow.com/questions/9810050/why-should-i-use-tags-vs-release-beta-branches-for-versioning" target="_blank" rel="noopener">why-should-i-use-tags-vs-release-beta-branches-for-versioning</a></li>
<li><a href="https://stackoverflow.com/questions/26005031/what-does-git-push-do-exactly" target="_blank" rel="noopener">what-does-git-push-do-exactly</a></li>
<li><a href="https://stackoverflow.com/questions/23303549/what-are-commit-ish-and-tree-ish-in-git" target="_blank" rel="noopener">What are commit-ish and tree-ish in Git?</a></li>
<li><a href="https://stackoverflow.com/questions/6127328/how-can-i-delete-all-git-branches-which-have-been-merged" target="_blank" rel="noopener">how-can-i-delete-all-git-branches-which-have-been-merged</a></li>
<li><a href="https://stackoverflow.com/questions/38034866/cant-push-to-remote-branch-cannot-be-resolved-to-branch" target="_blank" rel="noopener">cant-push-to-remote-branch-cannot-be-resolved-to-branch</a></li>
</ul>
<h2 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h2><ul>
<li><a href="http://justinhileman.info/article/git-pretty/git-pretty.png" target="_blank" rel="noopener">git-pretty</a></li>
<li><a href="http://www.bootcss.com/p/git-guide/" target="_blank" rel="noopener">git-简易指南</a></li>
<li><a href="https://blog.coding.net/blog/principle-of-Git" target="_blank" rel="noopener">principle-of-Git</a></li>
<li><a href="http://cs-cjl.com" target="_blank" rel="noopener">跟我一起学Git</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html" target="_blank" rel="noopener">常用Git命令清单</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2015/08/git-use-process.html" target="_blank" rel="noopener">Git使用规范流程</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2012/07/git.html" target="_blank" rel="noopener">Git分支管理策略</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2015/12/git-workflow.html" target="_blank" rel="noopener">Git 工作流程</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2017/08/issue.html" target="_blank" rel="noopener">如何使用 Issue 管理软件项目？</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html" target="_blank" rel="noopener">Commit message 和 Change log 编写指南</a></li>
<li><a href="http://insights.thoughtworkers.org/gitflow-consider-harmful/" target="_blank" rel="noopener">Gitflow有害论</a></li>
<li><a href="https://ruby-china.org/topics/29263" target="_blank" rel="noopener">GIT 之我见 - 反驳 TW 洞见《GITFLOW 有害论》</a></li>
</ul>
<p>源文件地址：<a href="https://github.com/liuyanjie/knowledge/tree/master/vcs/git/README.md" target="_blank" rel="noopener">https://github.com/liuyanjie/knowledge/tree/master/vcs/git/README.md</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="/posts/Git深入理解-命令工作机制/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lyj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyj's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/posts/Git深入理解-命令工作机制/" class="post-title-link" itemprop="url">Git深入理解-命令工作机制</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-05-07 08:00:00" itemprop="dateCreated datePublished" datetime="2018-05-07T08:00:00+08:00">2018-05-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-29 00:24:16" itemprop="dateModified" datetime="2018-12-29T00:24:16+08:00">2018-12-29</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/GIT/" itemprop="url" rel="index"><span itemprop="name">GIT</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/GIT/VCS/" itemprop="url" rel="index"><span itemprop="name">VCS</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/Git深入理解-命令工作机制/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/Git深入理解-命令工作机制/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">40k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">37 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="仓库创建"><a href="#仓库创建" class="headerlink" title="仓库创建"></a>仓库创建</h2><p>Git是一个分布式的版本控制系统，这意味着在Git中版本库有 <code>本地版本库</code> 和 <code>远程版本库</code> 之分。</p>
<p>每个远程仓库可以有多个本地仓库，同时一个本地版本库可以同时对应多个远程版本库，多个远程版本库是从一个最原始的版本库 <code>Fork</code>（实际上也是<code>clone</code>）产生的，<code>Fork</code> 出来的版本库和本地 <code>Clone</code> 的仓库是类似的，他们有一个相同的 <code>上游仓库</code>（即原始仓库），这些版本库直接可以通过 <code>PullRequest</code> 或 <code>MergeRequest</code> 操作进行仓库的交互。</p>
<p>本地仓库对应的远程仓库记录在 <code>.git/config</code> 文件中。本地仓库可以与多个的远程仓库 <code>pull/push</code> 代码。</p>
<h3 id="Init"><a href="#Init" class="headerlink" title="Init"></a><a href="https://git-scm.com/docs/git-init" target="_blank" rel="noopener">Init</a></h3><blockquote>
<p>创建一个空的 Git 仓库，或者重新初始化一个已经存在的 Git 仓库。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">  [-q | --quiet]</span><br><span class="line">  [--bare]</span><br><span class="line">  [--template=&lt;template_directory&gt;]</span><br><span class="line">  [--separate-git-dir &lt;git dir&gt;]</span><br><span class="line">  [--shared[=&lt;permissions&gt;]]</span><br><span class="line">  [directory]</span><br></pre></td></tr></table></figure>
<p>常规方式创建一个仓库：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">$ git init workspace</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /Users/liuyanjie/git-learn/workspace/.git/</span><br><span class="line"></span><br><span class="line">$ tree -ar</span><br><span class="line">.</span><br><span class="line">└── workspace</span><br><span class="line">    └── .git</span><br><span class="line">        ├── refs</span><br><span class="line">        │   ├── tags</span><br><span class="line">        │   └── heads</span><br><span class="line">        ├── objects</span><br><span class="line">        │   ├── pack</span><br><span class="line">        │   └── info</span><br><span class="line">        ├── info</span><br><span class="line">        │   └── exclude</span><br><span class="line">        ├── hooks</span><br><span class="line">        │   ├── update.sample</span><br><span class="line">        │   ├── prepare-commit-msg.sample</span><br><span class="line">        │   ├── pre-receive.sample</span><br><span class="line">        │   ├── pre-rebase.sample</span><br><span class="line">        │   ├── pre-push.sample</span><br><span class="line">        │   ├── pre-commit.sample</span><br><span class="line">        │   ├── pre-applypatch.sample</span><br><span class="line">        │   ├── post-update.sample</span><br><span class="line">        │   ├── fsmonitor-watchman.sample</span><br><span class="line">        │   ├── commit-msg.sample</span><br><span class="line">        │   └── applypatch-msg.sample</span><br><span class="line">        ├── description</span><br><span class="line">        ├── config</span><br><span class="line">        └── HEAD</span><br><span class="line"></span><br><span class="line">10 directories, 15 files</span><br></pre></td></tr></table></figure>
<p>以上创建的仓库，仓库文件 存放在 工作区目录 <code>workspace</code> 的子目录 <code>.git</code> 下。</p>
<p>分离的方式创建一个仓库：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ git init --separate-git-dir=.tig workspace</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /Users/liuyanjie/git-learn/.tig/</span><br><span class="line"></span><br><span class="line">$ tree -ar</span><br><span class="line">.</span><br><span class="line">├── workspace</span><br><span class="line">│   └── .git</span><br><span class="line">└── .tig</span><br><span class="line">    ├── refs</span><br><span class="line">    │   ├── tags</span><br><span class="line">    │   └── heads</span><br><span class="line">    ├── objects</span><br><span class="line">    │   ├── pack</span><br><span class="line">    │   └── info</span><br><span class="line">    ├── info</span><br><span class="line">    │   └── exclude</span><br><span class="line">    ├── hooks</span><br><span class="line">    │   ├── update.sample</span><br><span class="line">    │   ├── prepare-commit-msg.sample</span><br><span class="line">    │   ├── pre-receive.sample</span><br><span class="line">    │   ├── pre-rebase.sample</span><br><span class="line">    │   ├── pre-push.sample</span><br><span class="line">    │   ├── pre-commit.sample</span><br><span class="line">    │   ├── pre-applypatch.sample</span><br><span class="line">    │   ├── post-update.sample</span><br><span class="line">    │   ├── fsmonitor-watchman.sample</span><br><span class="line">    │   ├── commit-msg.sample</span><br><span class="line">    │   └── applypatch-msg.sample</span><br><span class="line">    ├── description</span><br><span class="line">    ├── config</span><br><span class="line">    └── HEAD</span><br><span class="line"></span><br><span class="line">10 directories, 16 files</span><br><span class="line"></span><br><span class="line">$ cat workspace/.git</span><br><span class="line">gitdir: /Users/liuyanjie/git-learn/.tig</span><br></pre></td></tr></table></figure>
<p>相比常规方式创建仓库，可以看到</p>
<ol>
<li>分离方式创建仓库 可以将 <code>仓库(.git)</code> 和 <code>工作区目录(workspace)</code> 分离，常规方式创建的仓库，<code>仓库(.git)</code> 就在 <code>工作区目录(workspace)</code> 下。</li>
<li>分离方式创建的仓库，在 <code>工作区目录(workspace)</code> 下 <code>.git</code> 文件不再是仓库目录，而是包含指向仓库路径的一个文件。利用这一特性，可以创建多个工作区共享同一仓库。</li>
<li>仓库文件的目录可以是除了 <code>.git</code> 之外的其他的合法的目录名称。</li>
</ol>
<p>参考在创建的过程中，拷贝了一些的模版文件到 <code>仓库(.git)</code> 下，可以在运行的时候通过 <code>--template=</code> 或 <code>GIT_TEMPLATE_DIR</code> 环境变量 指定模版路径位置，模版示例如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ tree /usr/<span class="built_in">local</span>/Cellar/git/2.18.0/share/git-core/templates</span><br><span class="line">/usr/<span class="built_in">local</span>/Cellar/git/2.18.0/share/git-core/templates</span><br><span class="line">├── description</span><br><span class="line">├── hooks</span><br><span class="line">│   ├── applypatch-msg.sample</span><br><span class="line">│   ├── commit-msg.sample</span><br><span class="line">│   ├── fsmonitor-watchman.sample</span><br><span class="line">│   ├── post-update.sample</span><br><span class="line">│   ├── pre-applypatch.sample</span><br><span class="line">│   ├── pre-commit.sample</span><br><span class="line">│   ├── pre-push.sample</span><br><span class="line">│   ├── pre-rebase.sample</span><br><span class="line">│   ├── pre-receive.sample</span><br><span class="line">│   ├── prepare-commit-msg.sample</span><br><span class="line">│   └── update.sample</span><br><span class="line">└── info</span><br><span class="line">    └── exclude</span><br><span class="line"></span><br><span class="line">2 directories, 13 files</span><br></pre></td></tr></table></figure>
<p>基于这一点，我们可以已一个参考作为模版，创建另一个仓库，Git 会把模板路径下的文件的复制到新的仓库下。</p>
<p>运行命令时，也可通过以下设置以下环境变量：</p>
<ul>
<li><code>GIT_DIR=.git</code> GIT仓库路径</li>
<li><code>GIT_OBJECT_DIRECTORY=$GIT_DIR/objects</code> GIT对象存储路径</li>
<li><code>GIT_TEMPLATE_DIR=path/to/git-core/templates</code> 模版路径，命令行参数：<code>--template</code>，配置：<code>init.templateDir</code></li>
</ul>
<p>在一个已经存在的仓库目录中运行 <code>init</code> 命令是安全的，它不会覆盖原来已经存在的东西。重新运行 <code>init</code> 的主要原因是挑选新添加的模版，或者移动仓库到其他的地方，如果 <code>--separate-git-dir</code> 指定的话。</p>
<p>初始化仓库是Git工作流中的第一步，一般情况下，需要两个仓库，一个本地仓库，一个远程仓库。</p>
<p>Init后的 Git 配置：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[core]</span></span><br><span class="line">	repositoryformatversion = 0</span><br><span class="line">	filemode = true</span><br><span class="line">	bare = false</span><br><span class="line">	logallrefupdates = true</span><br><span class="line">	ignorecase = true</span><br><span class="line">	precomposeunicode = true</span><br></pre></td></tr></table></figure>
<p>只有 <code>core</code> 相关的几个配置项</p>
<h3 id="Clone"><a href="#Clone" class="headerlink" title="Clone"></a><a href="https://git-scm.com/docs/git-clone" target="_blank" rel="noopener">Clone</a></h3><blockquote>
<p>克隆仓库到一个新的目录，为每一个被克隆仓库中的分支创建对应的远程追踪分支。然后从克隆仓库的当前活动分支创建并检出初始分支到工作区目录。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span></span><br><span class="line">  [-q] [--quiet]</span><br><span class="line">  [-v] [--verbose]</span><br><span class="line">  [--progress]</span><br><span class="line">  </span><br><span class="line">  [-l] [-s] [--no-hardlinks]</span><br><span class="line">  [-n] [--no-checkout]</span><br><span class="line">  </span><br><span class="line">  [--template=&lt;template_directory&gt;]</span><br><span class="line">  [--separate-git-dir &lt;git-dir&gt;]</span><br><span class="line">  [--bare]</span><br><span class="line">  [--mirror]</span><br><span class="line"></span><br><span class="line">  [-c &lt;key&gt;=&lt;value&gt;] [--config &lt;key&gt;=&lt;value&gt;]</span><br><span class="line"></span><br><span class="line">  [-o &lt;origin-name&gt;] [--origin &lt;origin-name&gt;]</span><br><span class="line">  [-b &lt;branch-name&gt;] [--branch &lt;branch-name&gt;]</span><br><span class="line">  [--no-tags]</span><br><span class="line">  [-u &lt;upload-pack&gt;]</span><br><span class="line"></span><br><span class="line">  [--depth &lt;depth&gt;]</span><br><span class="line">  [--shallow-since=&lt;date&gt;]</span><br><span class="line">  [--shallow-exclude=&lt;revision&gt;]</span><br><span class="line"></span><br><span class="line">  [--[no-]single-branch]</span><br><span class="line"></span><br><span class="line">  [--reference &lt;repository&gt;]</span><br><span class="line">  [--dissociate]</span><br><span class="line">  </span><br><span class="line">  [--recurse-submodules[=&lt;pathspec&gt;]]</span><br><span class="line">  [--[no-]shallow-submodules]</span><br><span class="line">  [-j &lt;n&gt;] [--<span class="built_in">jobs</span> &lt;n&gt;]</span><br><span class="line">  [--] &lt;repository&gt; [&lt;directory&gt;]</span><br></pre></td></tr></table></figure>
<p>克隆一个远程仓库需要存在一个远程仓库，并且有一个可以访问的远程仓库的地址，对应 <code>&lt;repository&gt;</code> 参数，Git支持多种访问协议，最常见的如 <code>git://</code>。详见：<a href="https://git-scm.com/docs/git-clone#_git_urls_a_id_urls_a" target="_blank" rel="noopener">GIT-URLS</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@github.com:liuyanjie/spec.git</span><br><span class="line">Cloning into <span class="string">'spec'</span>...</span><br><span class="line">remote: Counting objects: 49, <span class="keyword">done</span>.</span><br><span class="line">remote: Total 49 (delta 0), reused 0 (delta 0), pack-reused 49</span><br><span class="line">Receiving objects: 100% (49/49), 49.83 KiB | 25.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (15/15), <span class="keyword">done</span>.</span><br><span class="line"></span><br><span class="line">$ cat spec/.git/config</span><br><span class="line">[remote <span class="string">"origin"</span>]</span><br><span class="line">	url = git@github.com:liuyanjie/spec.git</span><br><span class="line">	fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">[branch <span class="string">"master"</span>]</span><br><span class="line">	remote = origin</span><br><span class="line">	merge = refs/heads/master</span><br></pre></td></tr></table></figure>
<p>相比 <code>git init</code>，<code>git clone</code> 之后的仓库配置文件中，增加了以上内容，配置 <code>本地分支</code> 和 <code>远程分支</code> 间的追踪关系，该配置为 Git 默认配置，一般不需要修改。</p>
<p><code>git clone</code> 工作流程（猜测）：</p>
<p><code>INIT</code> -&gt; <code>REMOTE-TRACKING</code> -&gt; <code>FETCH</code> -&gt; <code>CHECKOUT HEAD</code></p>
<p><code>git init</code> -&gt; <code>git remote set-url origin git://...</code> -&gt; <code>git fetch</code> -&gt; [<code>git merge</code>] -&gt; <code>git checkout HEAD</code></p>
<p>Clone过程可以进行哪些控制：</p>
<ol>
<li><code>--bare</code>：同 <code>Init</code> 相同，可以 <code>Clone</code> 一个 <code>Bare</code> 仓库到本地。</li>
<li><code>--mirror</code>：可以进行镜像 <code>Clone</code>，制作镜像仓库。</li>
<li><code>--template=</code>：同 <code>Init</code> 相同，可以指定模版。</li>
<li><code>--separate-git-dir=&lt;git dir&gt;</code>：分离仓库和工作区目录。</li>
<li><code>--reference[-if-able] &lt;repository&gt;</code>：可以通过该参数指定一个已存在的仓库进行加速，通常用在频繁的完整的 <code>Clone</code> 上。</li>
<li><code>--depth</code>：可以指定克隆的 Commit 数量。</li>
</ol>
<p>克隆本地仓库</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> path/to/<span class="built_in">local</span>/git/repository</span><br></pre></td></tr></table></figure>
<p>克隆远程仓库</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@github.com:liuyanjie/knowledge.git --depth=1</span><br><span class="line">Cloning into <span class="string">'knowledge'</span>...</span><br><span class="line">remote: Counting objects: 300, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (247/247), <span class="keyword">done</span>.</span><br><span class="line"></span><br><span class="line">$ git <span class="built_in">clone</span> git@github.com:liuyanjie/knowledge.git</span><br><span class="line">Cloning into <span class="string">'knowledge'</span>...</span><br><span class="line">remote: Counting objects: 495, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (141/141), <span class="keyword">done</span>.</span><br><span class="line"></span><br><span class="line">$ git <span class="built_in">clone</span> \</span><br><span class="line">  --depth=1 \</span><br><span class="line">  --reference-if-able=/Volumes/Data/Data/ws/knowledge \</span><br><span class="line">  git@github.com:liuyanjie/knowledge.git</span><br><span class="line">Cloning into <span class="string">'knowledge'</span>...</span><br><span class="line">remote: Total 0 (delta 0), reused 0 (delta 0), pack-reused 0</span><br></pre></td></tr></table></figure>
<p>在 <code>Clone</code> 的过程中，通过一些参数可以有效的减少 <code>Clone</code> 的等待时间，如在 CI 的构建流程中，可以提高构建时间。</p>
<h2 id="仓库维护"><a href="#仓库维护" class="headerlink" title="仓库维护"></a>仓库维护</h2><p>仓库维护包括维护 <code>本地仓库</code> 和 <code>远程仓库</code>，在 Git 中，很多时候，同一个 <code>远程仓库</code> 可以同时存在多个 <code>本地仓库</code>，偶尔，同一个 <code>本地仓库</code> 可以同时对应多个 <code>远程仓库</code>。</p>
<p>一旦 建立了 <code>本地仓库</code> 和 <code>远程仓库</code> 的对应关系，就需要频繁进行 <code>远程仓库</code> 和 <code>本地仓库</code> 之间的分支、标签等数据同步，对应操作有 <code>push、fetch、pull</code> 等。</p>
<p>同步的内容主要有：</p>
<ul>
<li>分支同步：分支的 <code>创建、修改、删除</code>，本地向远程同步，远程向本地同步</li>
<li>标签同步：标签的 <code>创建、修改、删除</code>，本地向远程同步，远程向本地同步</li>
<li>数据同步</li>
</ul>
<p>同步数据的基础在于 <code>本地仓库</code> 和 <code>远程仓库</code> 间存在的对应关系，这一关系 使用 <code>RefSpec</code> 进行描述。</p>
<h3 id="RefSpec"><a href="#RefSpec" class="headerlink" title="RefSpec"></a><a href="https://git-scm.com/book/zh/v1/Git-内部原理-The-Refspec" target="_blank" rel="noopener">RefSpec</a></h3><p><a href="https://git-scm.com/book/zh/v1/Git-内部原理-The-Refspec" target="_blank" rel="noopener">Git 内部原理 - The Refspec</a></p>
<p>下面示例中 <code>+refs/heads/*:refs/remotes/origin/*</code> 即为 <code>RefSpec</code>。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/config</span><br><span class="line">[core]</span><br><span class="line">        ...</span><br><span class="line">[remote <span class="string">"origin"</span>]</span><br><span class="line">        url = git@github.com:liuyanjie/knowledge.git</span><br><span class="line">        fetch = +refs/heads/*:refs/remotes/origin/*</span><br></pre></td></tr></table></figure>
<p>RefSpec 示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+refs/heads/*:refs/remotes/origin/*</span><br><span class="line">+refs/heads/master:master</span><br><span class="line">+master:refs/remotes/origin/master</span><br><span class="line">master:master</span><br><span class="line">:master</span><br><span class="line">master:</span><br></pre></td></tr></table></figure>
<p><code>RefSpec</code> 主要用来表示 <code>本地版本库</code> 和 <code>远程版本库</code> 之间的 <code>分支</code>、<code>标签</code> 等数据的对应关系。</p>
<p>指定获取哪些 <code>remote-refs</code> 更新 <code>local-refs</code>，当没有在命令行显示指明 <code>RefSpec</code>，会按照下面的默认策略执行。</p>
<p><code>RefSpec</code> 的格式是一个可选的 <code>+</code> 号，接着是 <code>&lt;src&gt;:&lt;dst&gt;</code> 的格式，这里 <code>&lt;src&gt;</code> 是远端上的引用格式，<code>&lt;dst&gt;</code> 是将要记录在本地的引用格式。可选的 <code>+</code> 号告诉 Git 在即使不能快速演进的情况下，也去强制更新它。</p>
<p>所以上面示例中的 <code>RefSpec</code>，远程仓库中所有分支 <code>refs/heads/*</code>，对应到本地仓库下所有分支 <code>refs/remotes/origin/*</code>，分支名称不变。如果需要改变分支名称，则需要配置特定的 <code>RefSpec</code>。</p>
<p>从远程获取指定数据到本地，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">branch master &lt;==&gt; +refs/heads/master:+refs/remotes/origin/master</span><br><span class="line">branch    A:a &lt;==&gt; +refs/heads/A:+refs/remotes/origin/a</span><br><span class="line">tag     &lt;tag&gt; &lt;==&gt; +refs/tags/&lt;tag&gt;:refs/tags/&lt;tag&gt;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/config</span><br><span class="line">[core]</span><br><span class="line">        ...</span><br><span class="line">[remote <span class="string">"origin"</span>]</span><br><span class="line">        url = git@github.com:liuyanjie/knowledge.git</span><br><span class="line">        fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line"></span><br><span class="line">$ tree .git/refs</span><br><span class="line">.git/refs</span><br><span class="line">├── heads</span><br><span class="line">│   ├── feature</span><br><span class="line">│   │   └── travis-ci</span><br><span class="line">│   └── master</span><br><span class="line">├── remotes</span><br><span class="line">│   └── origin</span><br><span class="line">│       ├── feature</span><br><span class="line">│       │   └── travis-ci</span><br><span class="line">│       └── master</span><br><span class="line">└── tags</span><br><span class="line">    └── v0.0.0</span><br></pre></td></tr></table></figure>
<p>以上对应关系：</p>
<table>
<thead>
<tr>
<th>head@local</th>
<th>remote@local</th>
<th>remote@remote</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>master</code></td>
<td><code>origin/master</code></td>
<td><code>master</code></td>
</tr>
<tr>
<td><code>feature/travis-ci</code></td>
<td><code>origin/feature/travis-ci</code></td>
<td><code>feature/travis-ci</code></td>
</tr>
<tr>
<td><code>refs/heads/feature/travis-ci</code></td>
<td><code>refs/remotes/origin/feature/travis-ci</code></td>
<td><code>refs/heads/feature/travis-ci</code></td>
</tr>
</tbody>
</table>
<p>注意：<code>RefSpec</code> 描述了 <code>remote@local</code> 和 <code>remote@remote</code> 之间的对应关系，但是不包含 <code>head@local</code> 和 <code>remote@local</code> 之间的关系，它们之间的存在的追踪关系在其他配置项中描述。</p>
<p><code>head@local</code> 下的 分支，是在本地存在的分支，可能从远程某个分支 <code>checkout</code>，也可能是本地新建的。</p>
<p><code>RefSpec</code> 一般不会出现在命令行中，而是由命令自动写在配置文件中，但是可以在命令行中直接使用。</p>
<p>例如：<code>git remote add remote-name</code>，Git 会获取远端上 <code>refs/heads/</code> 下面的所有引用，并将它写入到本地的 <code>refs/remotes/remote-name</code>。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git remote add liuyanjie git@github.com:liuyanjie/knowledge.git</span><br><span class="line"></span><br><span class="line">$ cat .git/config</span><br><span class="line">[remote <span class="string">"origin"</span>]</span><br><span class="line">        url = git@github.com:liuyanjie/knowledge.git</span><br><span class="line">        fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line"></span><br><span class="line">[remote <span class="string">"liuyanjie"</span>]</span><br><span class="line">        url = git@github.com:liuyanjie/knowledge.git</span><br><span class="line">        fetch = +refs/heads/*:refs/remotes/liuyanjie/*</span><br></pre></td></tr></table></figure>
<p>以下几种方式是等价的：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> master</span><br><span class="line">git <span class="built_in">log</span> heads/master</span><br><span class="line">git <span class="built_in">log</span> refs/heads/master</span><br><span class="line"></span><br><span class="line">git <span class="built_in">log</span> origin/master</span><br><span class="line">git <span class="built_in">log</span> remotes/origin/master</span><br><span class="line">git <span class="built_in">log</span> refs/remotes/origin/master</span><br></pre></td></tr></table></figure>
<p>通常都是使用省略 <code>refs/heads/</code> 和 <code>refs/remotes/</code> 的形式。</p>
<p>以上示例中 <code>RefSpec</code> 中包含 <code>*</code> 会使 Git 拉取所有远程分支到本地，如果想让Git只拉取固定的分支，可以将 <code>*</code> 修改为指定的分支名。</p>
<p>也可以在命令行上指定多个 <code>RefSpec</code>，如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch origin master:refs/remotes/origin/master topic:refs/remotes/origin/topic</span><br></pre></td></tr></table></figure>
<p>同样，也可以将以上命令行中的 <code>RefSpec</code> 写入配置中：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[remote "origin"]</span></span><br><span class="line">       url = git@github.com:liuyanjie/knowledge.git</span><br><span class="line">       fetch = +refs/heads/master:refs/remotes/origin/master</span><br><span class="line">       fetch = +refs/heads/develop:refs/remotes/origin/develop</span><br><span class="line">       fetch = +refs/heads/feature/*:refs/remotes/origin/feature/*</span><br></pre></td></tr></table></figure>
<p>以上，<code>feature</code> 可以看做是命名空间，划分不同的分支类型。</p>
<p>上面描述都是拉取时 <code>RefSpec</code> 的作用，同样推送是也需要 <code>RefSpec</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master:refs/heads/qa/master</span><br></pre></td></tr></table></figure>
<p>推送一个空分支可以删除远程分支</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin :refs/heads/qa/master</span><br></pre></td></tr></table></figure>
<p><code>RefSpec</code> 描述了本地仓库分支和远程仓库分支的对应关系。很多时候可以省略，因为 Git 包含了很多默认行为。</p>
<p>远程仓库 <code>refs/heads/*</code> 中 的分支大都是 其他 <code>本地仓库</code> 同步到远程的。</p>
<p>远程仓库 <code>refs/heads/*</code> 中 <code>创建</code> 的新分支，在同步数据的时候默认会被拉到本地，<code>删除</code> 的分支默认不会在本地进行同步删除，<code>修改</code> 的分支会被更新，并与本地追踪的开发分支进行合并。</p>
<p>以上，通过 <code>RefSpec</code> 描述的 本地仓库 和 远程仓库 中 分支 是如何对应的，了解了 本地仓库 和 远程仓库 之间的对应关系。</p>
<h3 id="git-remote"><a href="#git-remote" class="headerlink" title="git remote"></a><a href="https://git-scm.com/docs/git-remote" target="_blank" rel="noopener">git remote</a></h3><blockquote>
<p>管理本地仓库对应的一组远程仓库，包括 查看、更新、添加、删除、重命名、设置 等一系列操作</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">git remote [-v | --verbose]</span><br><span class="line">git remote [-v | --verbose] show [-n] &lt;name&gt;…​</span><br><span class="line">git remote [-v | --verbose] update [-p | --prune] [(&lt;group&gt; | &lt;remote&gt;)…​]</span><br><span class="line"></span><br><span class="line">git remote add [-t &lt;branch&gt;] [-m &lt;master&gt;] [-f] [--[no-]tags] [--mirror=&lt;fetch|push&gt;] &lt;name&gt; &lt;url&gt;</span><br><span class="line">git remote remove   &lt;name&gt;</span><br><span class="line">git remote rename &lt;old&gt; &lt;new&gt;</span><br><span class="line"></span><br><span class="line">git remote <span class="built_in">set</span>-head &lt;name&gt; (-a | --auto | -d | --delete | &lt;branch&gt;)</span><br><span class="line">git remote <span class="built_in">set</span>-branches  [--add] &lt;name&gt; &lt;branch&gt;…​</span><br><span class="line"></span><br><span class="line">git remote get-url       [--push] [--all] &lt;name&gt;</span><br><span class="line">git remote <span class="built_in">set</span>-url       [--push] &lt;name&gt; &lt;new-url&gt; [&lt;old-url&gt;]</span><br><span class="line">git remote <span class="built_in">set</span>-url --add [--push] &lt;name&gt; &lt;new-url&gt;</span><br><span class="line">git remote <span class="built_in">set</span>-url --delete [--push] &lt;name&gt; &lt;url&gt;</span><br><span class="line"></span><br><span class="line">git remote [-v | --verbose] show [-n] &lt;name&gt;…​</span><br><span class="line"></span><br><span class="line">git remote prune [-n | --dry-run] &lt;name&gt;…​</span><br><span class="line"></span><br><span class="line">git remote [-v | --verbose] update [-p | --prune] [(&lt;group&gt; | &lt;remote&gt;)…​]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">git remote                                                  <span class="comment"># 列出已经存在的远程分支</span></span><br><span class="line">git remote -v                                               <span class="comment"># 查看远程主机的地址</span></span><br><span class="line">git remote show   remote_name                               <span class="comment"># 查看该远程主机的详细信息</span></span><br><span class="line">git remote add    remote_name remote_url                    <span class="comment"># 添加远程主机</span></span><br><span class="line">git remote remove remote_name                               <span class="comment"># 删除远程主机</span></span><br><span class="line">git remote rename remote_name new_remote_name               <span class="comment"># 重命名远程主机</span></span><br><span class="line"></span><br><span class="line">git remote <span class="built_in">set</span>-head remote_name branch_name --auto          <span class="comment"># 查询远程获得默认分支</span></span><br><span class="line">git remote <span class="built_in">set</span>-head remote_name branch_name --delete        <span class="comment"># 删除默认分支</span></span><br><span class="line"></span><br><span class="line">git remote <span class="built_in">set</span>-branches [--add] remote_name branch_name     <span class="comment"># 设置 RefSpec， [remote "remote_name"].fetch</span></span><br><span class="line"></span><br><span class="line">git remote get-url remote_name                              <span class="comment"># 查看远程主机地址 [remote "remote_name"].url</span></span><br><span class="line">git remote <span class="built_in">set</span>-url remote_name git://new.url.here           <span class="comment"># 设置远程主机地址</span></span><br><span class="line">git remote <span class="built_in">set</span>-url remote_name --push   git://new.url.here  <span class="comment"># 修改远程主机地址</span></span><br><span class="line">git remote <span class="built_in">set</span>-url remote_name --add    git://new.url.here  <span class="comment"># 修改远程主机地址</span></span><br><span class="line">git remote <span class="built_in">set</span>-url remote_name --delete git://new.url.here  <span class="comment"># 删除远程主机地址</span></span><br><span class="line"></span><br><span class="line">git remote prune [-n | --dry-run] &lt;remote_name&gt;…​            <span class="comment"># 删除某个远程名下过期（即不存在）的分支</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># see http://stackoverflow.com/questions/1856499/differences-between-git-remote-update-and-fetch</span></span><br><span class="line">git remote [-v | --verbose] update [-p | --prune] [(&lt;group&gt; | &lt;remote&gt;)…​]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ git remote show origin</span><br><span class="line">* remote origin</span><br><span class="line">  Fetch URL: git@github.com:liuyanjie/knowledge.git</span><br><span class="line">  Push  URL: git@github.com:liuyanjie/knowledge.git</span><br><span class="line">  HEAD branch: master</span><br><span class="line">  Remote branches:</span><br><span class="line">    feature/travis-ci tracked</span><br><span class="line">    master            tracked</span><br><span class="line">  Local branches configured <span class="keyword">for</span> <span class="string">'git pull'</span>:</span><br><span class="line">    feature/travis-ci merges with remote feature/travis-ci</span><br><span class="line">    master            merges with remote master</span><br><span class="line">  Local refs configured <span class="keyword">for</span> <span class="string">'git push'</span>:</span><br><span class="line">    feature/travis-ci pushes to feature/travis-ci (up to date)</span><br><span class="line">    master            pushes to master            (up to date)</span><br></pre></td></tr></table></figure>
<h3 id="git-fetch"><a href="#git-fetch" class="headerlink" title="git fetch"></a><a href="https://git-scm.com/docs/git-fetch" target="_blank" rel="noopener">git fetch</a></h3><blockquote>
<p>下载 Refs 从另外一个仓库，以及完成他们的变更历史所需要的 Objects。追踪的远程分支将会被更新。</p>
</blockquote>
<p><code>git fetch</code> 的主要工作就是和远程同步 <code>Refs</code>，而 <code>Refs</code> 可以 被 <code>创建、修改、删除</code>，所以 <code>fetch</code> 操作必然应该能够同步这些变化。</p>
<ul>
<li><a href="https://git-scm.com/docs/git-fetch#_remotes_a_id_remotes_a" target="_blank" rel="noopener">REMOTES</a></li>
<li><a href="https://git-scm.com/docs/git-fetch#_configured_remote_tracking_branches_a_id_crtb_a" target="_blank" rel="noopener">CONFIGURED REMOTE-TRACKING BRANCHES</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git fetch [&lt;options&gt;] [&lt;repository&gt; [&lt;refspec&gt;…​]]</span><br><span class="line">git fetch [&lt;options&gt;] &lt;group&gt;</span><br><span class="line">git fetch --multiple [&lt;options&gt;] [(&lt;repository&gt; | &lt;group&gt;)…​]</span><br><span class="line">git fetch --all [&lt;options&gt;]</span><br></pre></td></tr></table></figure>
<p><code>.git/FETCH_HEAD</code>：是一个版本链接，记录在本地的一个文件中，指向着目前已经从远程仓库取下来的分支的末端版本。</p>
<p>执行过 <code>fetch</code> 操作的项目都会存在一个 <code>FETCH_HEAD</code> 列表，其中每一行对应于远程服务器的一个分支。</p>
<p>当前分支指向的 <code>FETCH_HEAD</code>，就是这个文件第一行对应的那个分支。</p>
<p>从本质上来说，唯一能从服务器下拉取数据的只有 <code>fetch</code>，其他命令的下拉数据的操作都是基于 <code>fetch</code> 的，所以 <code>fetch</code> 必然需要能够尽可能处理所有下拉数据时可能出现的情况。</p>
<p>Options:</p>
<ul>
<li><p>[shallow] 限制下拉指定的提交数：</p>
<ul>
<li><code>--depth=&lt;depth&gt;</code></li>
<li><code>--deepen=&lt;depth&gt;</code></li>
</ul>
</li>
<li><p>[shallow]限制下拉指定的提交时间：</p>
<ul>
<li><code>--shallow-since=&lt;date&gt;</code></li>
<li><code>--shallow-exclude=&lt;revision&gt;</code></li>
</ul>
</li>
<li><p>[deep]</p>
<ul>
<li><code>--unshallow</code>，<code>deep clone</code></li>
<li><code>--update-shallow</code></li>
</ul>
</li>
<li><p>[prune] 剪枝操作</p>
<p>远程仓库可能对已有的分支标签进行删除，而本地仓库并未删除，需要同步删除操作</p>
<ul>
<li><code>-p</code> <code>--prune</code></li>
<li><code>-p</code> <code>--prune-tags</code></li>
</ul>
</li>
<li><p>[tags] 默认情况下，<code>git fetch</code> 会下拉 <code>tag</code></p>
<ul>
<li><code>-t</code> <code>--tags</code> 【默认】下拉标签</li>
<li><code>-n</code> <code>--no-tags</code> 不下拉标签</li>
</ul>
</li>
<li><p>子模块</p>
<ul>
<li><code>--recurse-submodules-default=[yes|on-demand]</code></li>
<li><code>--recurse-submodules[=yes|on-demand|no]</code></li>
<li><code>--no-recurse-submodules</code></li>
<li><code>--submodule-prefix=&lt;path&gt;</code></li>
</ul>
</li>
</ul>
<p>再看对应关系：</p>
<table>
<thead>
<tr>
<th>head@local</th>
<th>remote@local</th>
<th>remote@remote</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>master</code></td>
<td><code>origin/master</code></td>
<td><code>master</code></td>
</tr>
<tr>
<td><code>feature/travis-ci</code></td>
<td><code>origin/feature/travis-ci</code></td>
<td><code>feature/travis-ci</code></td>
</tr>
<tr>
<td><code>refs/heads/feature/travis-ci</code></td>
<td><code>refs/remotes/origin/feature/travis-ci</code></td>
<td><code>refs/heads/feature/travis-ci</code></td>
</tr>
</tbody>
</table>
<p><code>git fetch</code> 将 <code>remote@remote</code> fetch <code>remote@local</code>，而 <code>RefSpec（+refs/heads/*:refs/remotes/origin/*）</code> 前面的 <code>+</code> 使 Git 在不能快速前进的情况下也强制更新，所以不会出现 <code>remote@remote --merge--&gt; remote@local</code> 的情况，实际上合并是不合理的行为，因为本地的 <code>refs/remotes/origin/*</code> 就是与远程保持同步的，如果合并了，就不同步了，更重要的是，远程分支可能修改了分支历史，如果合并，修改前的内容又合并进版本库了，有可能还需要解决冲突，而之后的 <code>remote@local --merge--&gt; head@local</code> 又会有可能合并。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git fetch                                         <span class="comment"># 获取 所有远程仓库 上的所有分支，将其记录到 .git/FETCH_HEAD 文件中</span></span><br><span class="line">git fetch -all                                    <span class="comment"># 获取 所有远程仓库 上的所有分支</span></span><br><span class="line">git fetch remote                                  <span class="comment"># 获取 remote 上的所有分支</span></span><br><span class="line">git fetch remote branch-name                      <span class="comment"># 获取 remote 上的分支：branch-name</span></span><br><span class="line">git fetch remote branch-name:<span class="built_in">local</span>-branch-name    <span class="comment"># 获取 remote 上的分支：branch-name，并在本地创建对应分支</span></span><br><span class="line">git fetch remote branch-name:<span class="built_in">local</span>-branch-name -f <span class="comment"># 获取 remote 上的分支：branch-name，并在本地创建对应分支，[强制]</span></span><br><span class="line">git fetch -f | --force                            <span class="comment"># 当使用 refspec(&lt;branch&gt;:&lt;branch&gt;) 时，跳过亲子关系检查，强制更新本地分支</span></span><br><span class="line">git fetch -p | --prune                            <span class="comment"># 获取所有远程分支并清除服务器上已删掉的分支</span></span><br><span class="line">git fetch -t | --tags                             <span class="comment"># 从远程获取数据时获取tags</span></span><br><span class="line">git fetch -n | --no-tags                          <span class="comment"># 从远程获取数据时去除tags</span></span><br><span class="line">git fetch --progress --verbose                    <span class="comment"># 显示进度及冗长日志</span></span><br><span class="line">git fetch --dry-run                               <span class="comment"># 显示做了什么，但是并不实际修改</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git fetch --depth=3 --no-tags --progress origin +refs/heads/master:refs/remotes/origin/master  +refs/heads/release/*:refs/remotes/origin/release/*</span><br><span class="line">git fetch --depth=3 --no-tags --progress git@github.com:liuyanjie/knowledge.git +refs/heads/master:refs/remotes/origin/master  +refs/heads/release/*:refs/remotes/origin/release/*</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch --prune --progress --verbose --dry-run</span><br><span class="line">From github.com:remote-name/branch-name</span><br><span class="line"> - [deleted]             (none)     -&gt; origin/feature/abcd</span><br><span class="line"> - [deleted]             (none)     -&gt; origin/feature/efg</span><br><span class="line">remote: Counting objects: 34, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (18/18), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 34 (delta 18), reused 24 (delta 16), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (34/34), <span class="keyword">done</span>.</span><br><span class="line">   f4e75b13a..6a338066c  master              -&gt; origin/master</span><br><span class="line"> + c29324269...641076244 develop             -&gt; origin/develop  (forced update)</span><br><span class="line"> = [up to date]          release/1.0.0       -&gt; origin/release/1.0.0</span><br><span class="line"> * [new branch]          release/1.1.0       -&gt; origin/release/1.1.0</span><br><span class="line"> * [new tag]             v1.1.0              -&gt; v1.1.0</span><br></pre></td></tr></table></figure>
<p><code>--prune</code> 只能清理 <code>.git/refs/remotes/remote-name</code> 目录下的远程追踪分支，而不会删除 <code>.git/refs/heads</code> 下的本地分支，即使这些分支已经合并，这些分支的清理需要特定的命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch --merged | egrep -v <span class="string">"(^\*|master|develop|release)"</span> <span class="comment"># 查看确认</span></span><br><span class="line">git branch --merged | egrep -v <span class="string">"(^\*|master|develop|release)"</span> | xargs git branch -d</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git branch --merged | egrep -v <span class="string">"(^\*|master|develop|release)"</span> | xargs git branch -d</span><br><span class="line">Deleted branch feature/auto-tag-ci (was 98147f0e3).</span><br><span class="line">Deleted branch feature/build-optimize (was d359f4179).</span><br><span class="line">Deleted branch feature/contract (was c0c4bdaa8).</span><br><span class="line">Deleted branch feature/cross-domain (was 2e9b25c82).</span><br><span class="line">Deleted branch feature/deploy (was 3650db271).</span><br><span class="line">Deleted branch feature/nvmrc (was 1d174fcd8).</span><br><span class="line">Deleted branch feature/winston-logstash (was f13700c66).</span><br></pre></td></tr></table></figure>
<p>同样远程仓库也有一些已经合并了，但是未删除的分支需要删除：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -r --merged | egrep -v <span class="string">"(^\*|master|develop|release)"</span> | sed <span class="string">'s/origin\//:/'</span> <span class="comment"># 查看确认</span></span><br><span class="line">git branch -r --merged | egrep -v <span class="string">"(^\*|master|develop|release)"</span> | sed <span class="string">'s/origin\//:/'</span> | xargs -n 1 git push origin</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -r --merged | egrep -v <span class="string">"(^\*|master|develop|release)"</span> | sed <span class="string">'s/origin\//:/'</span> | xargs -n 1 git push origin</span><br><span class="line">To github.com:liuyanjie/knowledge.git</span><br><span class="line"> - [deleted]             feature/xxxx</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin master:refs/remotes/origin/master topic:refs/remotes/origin/topic</span><br><span class="line">From git@github.com:schacon/simple</span><br><span class="line"> ! [rejected]        master     -&gt; origin/master  (non fast forward)</span><br><span class="line"> * [new branch]      topic      -&gt; origin/topic</span><br></pre></td></tr></table></figure>
<p>在上面这个例子中， <code>master</code> 分支因为不是一个可以 <code>快速演进</code> 的引用而拉取操作被拒绝。你可以在 <code>RefSpec</code> 之前使用一个 <code>+</code> 号来重载这种行为。</p>
<p>输出格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;flag&gt; &lt;summary&gt; &lt;from&gt; -&gt; &lt;to&gt; [&lt;reason&gt;]</span><br></pre></td></tr></table></figure>
<p>输出格式详细介绍见：<a href="https://git-scm.com/docs/git-fetch#_output" target="_blank" rel="noopener">OUTPUT</a></p>
<p><code>fetch</code> 负责将 远程仓库 更新到 远程仓库在本地的对应部分，其他工作又其他 命令 负责。</p>
<p>在实际使用中，大多数时候都是使用 <code>pull</code> 间接的使用 <code>fetch</code>。</p>
<h3 id="git-pull"><a href="#git-pull" class="headerlink" title="git pull"></a><a href="https://git-scm.com/docs/git-pull" target="_blank" rel="noopener">git pull</a></h3><blockquote>
<p>将来自远程存储库的更改合并到当前分支中</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull [options] [&lt;repository&gt; [&lt;refspec&gt;…​]]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master  <span class="comment"># 获取远程分支 master 并 merge 到当前分支</span></span><br></pre></td></tr></table></figure>
<p>默认模式下，<code>git pull</code> 等价于以下两步:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git fetch</span><br><span class="line">git merge FETCH_HEAD</span><br></pre></td></tr></table></figure>
<p>特例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git fetch</span><br><span class="line">git checkout master</span><br><span class="line">git merge origin/master</span><br></pre></td></tr></table></figure>
<p>更确切的说，<code>git pull</code> 已指定的参数运行 <code>git fetch</code>，然后 调用 <code>git merge</code> 合并 检索到的分支头到当前分支，通过 <code>--rebase</code> 参数，<code>git merge</code> 也可以被替换成 <code>git rebase</code>。</p>
<p>假定有如下的历史，并且当前分支是 <code>master</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">              master on origin</span><br><span class="line">              ↓</span><br><span class="line">      A---B---C</span><br><span class="line">     /</span><br><span class="line">D---E---F---G ← master</span><br><span class="line">    ↑</span><br><span class="line">    origin/master in your repository</span><br></pre></td></tr></table></figure>
<p>调用 <code>git pull</code> 时，首先需要 <code>fetch</code> 变更从远处分支，下拉之后的仓库状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">              master on origin</span><br><span class="line">              ↓</span><br><span class="line">      A---B---C ← origin/master in your repository</span><br><span class="line">     /</span><br><span class="line">D---E---F---G ← master</span><br></pre></td></tr></table></figure>
<p>因为 远程分支 master (C) 已经和 本地分支 master (G) 已经处于分离状态，此时，<code>git merge</code> 合并 <code>origin/master</code> 到 <code>master</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">              master on origin</span><br><span class="line">              ↓</span><br><span class="line">      A---B---C ← origin/master</span><br><span class="line">     /         \</span><br><span class="line">D---E---F---G---H ← master</span><br></pre></td></tr></table></figure>
<p>以上过程发生了一次 <code>远程</code> 合并到 <code>本地</code> 的情形，git 会自动生成类似下面的 <code>commit message</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Merge branch &apos;master&apos; of github.com:liuyanjie/knowledge into master</span><br></pre></td></tr></table></figure>
<p>出现 <code>远程</code> 合并到 <code>本地</code> 的情形 在 Git 中是一种不良好的实践，应该极力避免甚至是禁止出现，这种情形在多个人同时在同一个分支上开发的时候非常容易出现。</p>
<p>记住一点：一般来书，<code>分支</code>是要合并到远程服务器上的分支，而不是远程服务分支合并到本地分支的。</p>
<p>在实际开发过程中，所有的合并操作都应该发生在远程服务器上，保持所有的分支有清晰的历史。同样，也应该避免不必要的合并，甚至是禁止合并。</p>
<blockquote>
<p>一般情况下，创建了分支必然需要通过合并来将分支上的内容整合到分支的基上，但是也有不合并的其他方法</p>
</blockquote>
<p>合并产生的 <code>Commit</code> 并未给版本库带来新的改变，但是却使版本历史不够清晰了。</p>
<p>合并使分支历史从单向链表变成了有向图，一堆线杂乱无章交错，分支历史难以理解。</p>
<p>合并产生的 <code>Commit</code> 有两个或多个父 <code>Commit</code>， <code>Reset</code> 难以进行。</p>
<p>如何避免 本地合并？</p>
<ol>
<li>在 <code>commit</code> 之前先 <code>pull</code>，避免分叉。</li>
<li>在 <code>commit</code> 之后立即 <code>push</code>，使其他人的本地仓库能及时获取到最新的 <code>commit</code>。</li>
</ol>
<p>知道一定会 发生本地 合并时如何处理？</p>
<ol>
<li><code>git pull --ff-only</code> or <code>git fetch</code></li>
<li><code>git rebase origin/master</code></li>
</ol>
<p>已经出现 本地合并 如何解决？</p>
<ol>
<li><code>git reset C</code> 重置当前分支到 <code>C</code>，<code>F</code> <code>G</code> 会重新回到暂存区。</li>
<li><code>git commit -am &quot;commit message&quot;</code> 重新提交。</li>
<li><code>git push</code></li>
</ol>
<p>解决之后的分支图：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">              master on origin</span><br><span class="line">              ↓</span><br><span class="line">              origin/master</span><br><span class="line">              ↓</span><br><span class="line">      A---B---C---F---G ← master</span><br><span class="line">     /</span><br><span class="line">D---E</span><br></pre></td></tr></table></figure>
<p>假设版本库当前的状态如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">              master on origin</span><br><span class="line">              ↓</span><br><span class="line">      A---B---C</span><br><span class="line">     /</span><br><span class="line">D---E ← master</span><br><span class="line">    ↑</span><br><span class="line">    origin/master in your repository</span><br></pre></td></tr></table></figure>
<p>以上版本库库满足快速前进的条件，可以进行快速前进 <code>--ff</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">              master on origin</span><br><span class="line">              ↓</span><br><span class="line">      A---B---C ← master</span><br><span class="line">     /        ↑</span><br><span class="line">D---E         origin/master in your repository</span><br></pre></td></tr></table></figure>
<p>以上版本库满足快速前进的条件，可以进行快速前进 <code>--ff</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">              master on origin</span><br><span class="line">              ↓</span><br><span class="line">      A---B---C</span><br><span class="line">     /</span><br><span class="line">D---E ← master</span><br><span class="line">    ↑</span><br><span class="line">    origin/master in your repository</span><br></pre></td></tr></table></figure>
<p>快速前进不产生新的 <code>Commit</code>，效果上只移动分支头即可，默认情况下进行就是快速前进</p>
<p>在能够进行快速前进的情况下，也可以强制进行合并，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">              master on origin</span><br><span class="line">              ↓</span><br><span class="line">      A---B---C ← origin/master</span><br><span class="line">     /         \</span><br><span class="line">D---E-----------H ← master</span><br></pre></td></tr></table></figure>
<p>所以 <code>git pull</code> 的参数主要由 <code>git fetch</code> 和 <code>git merge</code> 的参数组成。</p>
<p><code>git pull</code> 的运行过程：</p>
<ol>
<li>首先，基于本地的 <code>FETCH_HEAD</code> 记录，比对本地的 <code>FETCH_HEAD</code> 记录与远程仓库的版本号</li>
<li>然后通过 <code>git fetch</code> 获得当前指向的远程分支的后续版本的数据</li>
<li>最后通过 <code>git merge</code> 将其与本地的当前分支合并</li>
</ol>
<p>若有多个 remote，git pull remote_name 所做的事情是：</p>
<ul>
<li>获取 <code>[remote_name]</code> 下的所有分支</li>
<li>寻找本地分支有没有 <code>tracking</code> 这些分支的，若有则 <code>merge</code> 这些分支，若没有则 <code>merge</code> 当前分支</li>
</ul>
<p>另外，若只有一个 remote，假设叫 origin，那么 git pull 等价于 git pull origin；平时养成好习惯，没谱的时候都把【来源】带上。</p>
<p>怎么知道 <code>tracking</code> 了没有？</p>
<ul>
<li>如果你曾经这么推过：<code>git push -u origin master</code>，那么你执行这条命令时所在的分支就已经 <code>tracking to origin/master</code> 了</li>
<li>如果你记不清了：<code>cat .git/config</code>，由此可见，<code>tracking</code> 的本质就是指明 <code>pull</code> 的 <code>merge</code> 动作来源</li>
</ul>
<p>总结:</p>
<ul>
<li><code>git pull = git fetch + git merge</code></li>
<li><code>git fetch</code> 拿到了远程所有分支的更新，<code>cat .git/FETCH_HEAD</code> 可以看到其状态，若是 <code>not-for-merge</code> 则不会有接下来的 <code>merge</code> 动作</li>
<li><code>merge</code> 动作的默认目标是当前分支，若要切换目标，可以直接切换分支</li>
<li><code>merge</code> 动作的来源则取决于你是否有 <code>tracking</code>，若有则读取配置自动完成，若无则请指明【来源】</li>
</ul>
<p><code>pull</code> 时还可能存在远程分支不存在的情况</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b <span class="built_in">test</span></span><br><span class="line">$ git pull</span><br><span class="line">There is no tracking information <span class="keyword">for</span> the current branch.</span><br><span class="line">Please specify <span class="built_in">which</span> branch you want to merge with.</span><br><span class="line">See git-pull(1) <span class="keyword">for</span> details.</span><br><span class="line"></span><br><span class="line">    git pull &lt;remote&gt; &lt;branch&gt;</span><br><span class="line"></span><br><span class="line">If you wish to <span class="built_in">set</span> tracking information <span class="keyword">for</span> this branch you can <span class="keyword">do</span> so with:</span><br><span class="line"></span><br><span class="line">    git branch --<span class="built_in">set</span>-upstream-to=origin/&lt;branch&gt; <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">$ git branch --<span class="built_in">set</span>-upstream-to=origin/<span class="built_in">test</span> <span class="built_in">test</span></span><br><span class="line">error: the requested upstream branch <span class="string">'origin/test'</span> does not exist</span><br><span class="line">hint:</span><br><span class="line">hint: If you are planning on basing your work on an upstream</span><br><span class="line">hint: branch that already exists at the remote, you may need to</span><br><span class="line">hint: run <span class="string">"git fetch"</span> to retrieve it.</span><br><span class="line">hint:</span><br><span class="line">hint: If you are planning to push out a new <span class="built_in">local</span> branch that</span><br><span class="line">hint: will track its remote counterpart, you may want to use</span><br><span class="line">hint: <span class="string">"git push -u"</span> to <span class="built_in">set</span> the upstream config as you push.</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git pull</span><br><span class="line">remote: Counting objects: 81, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (29/29), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 81 (delta 42), reused 81 (delta 42), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (81/81), <span class="keyword">done</span>.</span><br><span class="line">From github.com:liuyanjie/knowledge</span><br><span class="line">   2f977e2..be00fff  feature/x -&gt; origin/feature/x</span><br><span class="line">Your configuration specifies to merge with the ref <span class="string">'refs/heads/feature/abc'</span></span><br><span class="line">from the remote, but no such ref was fetched.</span><br></pre></td></tr></table></figure>
<p>需要提及的一点是：</p>
<p><code>pull</code> 操作，不应该涉及 <code>合并</code> 或 <code>变基</code> 操作，即 <code>pull</code> 应该总是 快速前进 的。</p>
<p>再看对应关系：</p>
<table>
<thead>
<tr>
<th>head@local</th>
<th>remote@local</th>
<th>remote@remote</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>master</code></td>
<td><code>origin/master</code></td>
<td><code>master</code></td>
</tr>
<tr>
<td><code>feature/travis-ci</code></td>
<td><code>origin/feature/travis-ci</code></td>
<td><code>feature/travis-ci</code></td>
</tr>
<tr>
<td><code>refs/heads/feature/travis-ci</code></td>
<td><code>refs/remotes/origin/feature/travis-ci</code></td>
<td><code>refs/heads/feature/travis-ci</code></td>
</tr>
</tbody>
</table>
<p><code>git pull</code> 在 <code>git fetch</code> 的基础之上增加了 <code>git merge</code>，将 <code>远程分支对应的本地分支</code> 合并到 <code>追踪的本地开发分支</code></p>
<h3 id="git-push"><a href="#git-push" class="headerlink" title="git push"></a><a href="https://git-scm.com/docs/git-push" target="_blank" rel="noopener">git push</a></h3><blockquote>
<p>使用本地引用更新远程引用，同时发送完成给定引用所必需的对象。</p>
</blockquote>
<p><code>git push</code> 是与 <code>git pull</code> 相对应的推送操作，同样需要能够推送本地的多种情形的变更到远程仓库。git 向远程仓库推送的操作只有 <code>push</code>。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">git push</span><br><span class="line">     [--all | --mirror | --tags]</span><br><span class="line">     [--follow-tags]</span><br><span class="line">     [--atomic]</span><br><span class="line">     [-n | --dry-run]</span><br><span class="line">     [--receive-pack=&lt;git-receive-pack&gt;]</span><br><span class="line">     [--repo=&lt;repository&gt;]</span><br><span class="line">     [-f | --force]</span><br><span class="line">     [-d | --delete]</span><br><span class="line">     [--prune]</span><br><span class="line">     [-v | --verbose]</span><br><span class="line">     [-u | --<span class="built_in">set</span>-upstream]</span><br><span class="line">     [--push-option=&lt;string&gt;]</span><br><span class="line">     [--[no-]signed|--sign=(<span class="literal">true</span>|<span class="literal">false</span>|<span class="keyword">if</span>-asked)]</span><br><span class="line">     [--force-with-lease[=&lt;ref-name&gt;[:&lt;expect&gt;]]]</span><br><span class="line">     [--no-verify]</span><br><span class="line">     [&lt;repository&gt; [&lt;refspec&gt;…​]]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">git push                                 <span class="comment"># 如果当前分支只有一个追踪分支，那么主机名都可以省略</span></span><br><span class="line">git push origin HEAD                     <span class="comment"># 将 当前 分支 推送 到远程 master 分支</span></span><br><span class="line">git push origin master                   <span class="comment"># 将 master 分支 推送 到远程 master 分支</span></span><br><span class="line">git push origin master -u                <span class="comment"># 将 master 分支 推送 到远程 master 分支，并建立追踪关系</span></span><br><span class="line">git push origin master --<span class="built_in">set</span>-upstream    <span class="comment"># 同上</span></span><br><span class="line">git push origin --all                    <span class="comment"># 将所有本地分支都推送到origin主机</span></span><br><span class="line">git push origin --force                  <span class="comment"># 强制推送更新远程分支</span></span><br><span class="line"></span><br><span class="line">git push origin :hotfix/xxxx             <span class="comment"># 删除远程仓库的 hotfix/xxxx 分支</span></span><br><span class="line">git push origin :master                  <span class="comment"># 删除远程仓库的 master 分支</span></span><br><span class="line">git push origin --delete master          <span class="comment"># 删除远程仓库的 master 分支</span></span><br><span class="line"></span><br><span class="line">git push origin --prune                  <span class="comment"># 删除在本地没有对应分支的远程分支</span></span><br><span class="line"></span><br><span class="line">git push --tags                          <span class="comment"># 把所有tag推送到远程仓库</span></span><br></pre></td></tr></table></figure>
<p>推送模式：</p>
<ul>
<li>simple  模式: 不带任何参数的git push，默认只推送当前分支。2.0以上版本，默认此方式。</li>
<li>matching模式: 会推送所有有对应的远程分支的本地分支。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global push.default matching</span><br><span class="line">git config --global push.default simple</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git push</span><br><span class="line">Enumerating objects: 9, <span class="keyword">done</span>.</span><br><span class="line">Counting objects: 100% (9/9), <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (6/6), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (6/6), 1.25 KiB | 1.25 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Total 6 (delta 2), reused 0 (delta 0)</span><br><span class="line">remote: Resolving deltas: 100% (2/2), completed with 2 <span class="built_in">local</span> objects.</span><br><span class="line">To github.com:liuyanjie/knowledge.git</span><br><span class="line">   d26f671..e081fb3  master -&gt; master</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --delete ref...</span><br></pre></td></tr></table></figure>
<p>推送代码到服务器与拉取代码到本地其实是相同的，所以服务代码推送到服务全之后，同样有可能出现需要合并的情况，如推送者本地仓库在没有 <code>pull</code> 后进行 <code>commit</code> 后 <code>push</code>，导致本地代码和远程服务器代码分叉，此时服务端也要面临合并问题，合并就有可能产生冲突，但是服务端没有解决冲突的能力，所以实质上服务端是禁止发生合并的，只能进行快速前进。当不能快速前进，服务端会返回错误给客户端，错误会提示先 <code>pull</code> 再 <code>push</code>。此时，<code>pull</code> 操作是一定会进行 <code>merge</code> 的，可能需要处理 <code>merge</code>，此时就需要处理前面提到的处理本地合并的问题了。</p>
<h3 id="git-submodule"><a href="#git-submodule" class="headerlink" title="git submodule"></a><a href="https://git-scm.com/docs/git-submodule" target="_blank" rel="noopener">git submodule</a></h3><blockquote>
<p>初始化、更新或检查子模块</p>
</blockquote>
<p><a href="https://git-scm.com/docs/gitsubmodules" target="_blank" rel="noopener">gitsubmodules</a>  - mounting one repository inside another</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git submodule [--quiet] add [-b &lt;branch&gt;] [-f|--force] [--name &lt;name&gt;]</span><br><span class="line">        [--reference &lt;repository&gt;] [--depth &lt;depth&gt;] [--] &lt;repository&gt; [&lt;path&gt;]</span><br><span class="line">git submodule [--quiet] status [--cached] [--recursive] [--] [&lt;path&gt;…​]</span><br><span class="line">git submodule [--quiet] init [--] [&lt;path&gt;…​]</span><br><span class="line">git submodule [--quiet] deinit [-f|--force] (--all|[--] &lt;path&gt;…​)</span><br><span class="line">git submodule [--quiet] update [--init] [--remote] [-N|--no-fetch]</span><br><span class="line">        [--[no-]recommend-shallow] [-f|--force] [--rebase|--merge]</span><br><span class="line">        [--reference &lt;repository&gt;] [--depth &lt;depth&gt;] [--recursive]</span><br><span class="line">        [--<span class="built_in">jobs</span> &lt;n&gt;] [--] [&lt;path&gt;…​]</span><br><span class="line">git submodule [--quiet] summary [--cached|--files] [(-n|--summary-limit) &lt;n&gt;]</span><br><span class="line">        [commit] [--] [&lt;path&gt;…​]</span><br><span class="line">git submodule [--quiet] foreach [--recursive] &lt;<span class="built_in">command</span>&gt;</span><br><span class="line">git submodule [--quiet] sync [--recursive] [--] [&lt;path&gt;…​]</span><br></pre></td></tr></table></figure>
<p>添加</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule add -b master --name knowledge --reference=/Volumes/Data/Data/ws/knowledge -- git@github.com:liuyanjie/knowledge.git ./third_parts/knowledge</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is ahead of <span class="string">'origin/master'</span> by 1 commit.</span><br><span class="line">  (use <span class="string">"git push"</span> to publish your <span class="built_in">local</span> commits)</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">	new file:   .gitmodules</span><br><span class="line">	new file:   third_parts</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m <span class="string">"..."</span></span><br><span class="line">[master 83506db] ...</span><br><span class="line"> 2 files changed, 5 insertions(+)</span><br><span class="line"> create mode 100644 .gitmodules</span><br><span class="line"> create mode 160000 third_parts</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git push</span><br><span class="line">Enumerating objects: 7, <span class="keyword">done</span>.</span><br><span class="line">Counting objects: 100% (7/7), <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (6/6), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (6/6), 5.31 KiB | 5.31 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Total 6 (delta 1), reused 0 (delta 0)</span><br><span class="line">remote: Resolving deltas: 100% (1/1), <span class="keyword">done</span>.</span><br><span class="line">To github.com:liuyanjie/about.git</span><br><span class="line">   53abb09..83506db  master -&gt; master</span><br></pre></td></tr></table></figure>
<h2 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h2><p>Git 是一个分布式的结构，有本地版本库和远程版本库，便有了本地分支和远程分支的区别了。</p>
<p>本地分支和远程分支在 <code>git push</code> 的时候可以随意指定，交错对应，只要不出现版本从图即可。</p>
<h3 id="git-branch"><a href="#git-branch" class="headerlink" title="git-branch"></a><a href="https://git-scm.com/docs/git-branch" target="_blank" rel="noopener">git-branch</a></h3><blockquote>
<p>创建、修改、删除、查看、重命名、复制分支</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建分支</span></span><br><span class="line">git branch (-t | --[no-]track) (-l | --[no-]create-reflog) [-f | --force] &lt;branch-name&gt; [&lt;start-point&gt;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置/修改上游分支</span></span><br><span class="line">git branch [-u | --<span class="built_in">set</span>-upstream-to=] &lt;upstream&gt; [&lt;branch-name&gt;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看分支</span></span><br><span class="line">git branch -a --all</span><br><span class="line">git branch -r</span><br><span class="line">git branch --list &lt;pattern&gt;...</span><br><span class="line">git branch --list --[no-]contains [&lt;commit&gt;]</span><br><span class="line">git branch --list --[no-]merged</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置分支</span></span><br><span class="line">git branch (-f --force) &lt;branch-name&gt; &lt;start-point&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重命名分支</span></span><br><span class="line">git branch (-m --move | -M) [&lt;old-branch&gt;] &lt;new-branch&gt;</span><br><span class="line">git branch (-m --move) --force [&lt;old-branch&gt;] &lt;new-branch&gt;</span><br><span class="line">git branch -M [&lt;old-branch&gt;] &lt;new-branch&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制分支</span></span><br><span class="line">git branch (-c --copy) [&lt;old-branch&gt;] &lt;new-branch&gt;</span><br><span class="line">git branch (-c --copy) --force [&lt;old-branch&gt;] &lt;new-branch&gt;</span><br><span class="line">git branch -C [&lt;old-branch&gt;] &lt;new-branch&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除分支</span></span><br><span class="line"><span class="comment"># -r 可以同时删除远程追踪分支，但是只有在远程分支删除的情况下才有意义，否则会fetch回来</span></span><br><span class="line">git branch (-d --delete) [-r] &lt;branchname&gt;…​</span><br><span class="line">git branch (-d --delete)  --force [-r] &lt;branchname&gt;…​</span><br><span class="line">git branch -D [-r] &lt;branchname&gt;…​</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑分支描述</span></span><br><span class="line">git branch --edit-description [&lt;branchname&gt;]</span><br></pre></td></tr></table></figure>
<p><code>git branch</code> 只能操作本地仓库，无法直接操作远程仓库，操作远程仓库必须通过 <code>git push</code>。</p>
<p><code>remotes/origin/*</code> 下的分支删除：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git push --delete &lt;branch-name&gt;</span><br><span class="line">git push :&lt;branch-name&gt;</span><br></pre></td></tr></table></figure>
<p>以上命令在删除远程仓库的分支的同时，同步删除 <code>remotes/origin/*</code> 下的分支</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -d &lt;remote-name&gt;/&lt;branch-name&gt;</span><br></pre></td></tr></table></figure>
<p>以上命令删除 <code>remotes/origin/*</code> 下的分支，但是远程分支并未删除，在 <code>git fetch</code> 后还会拉下来，所以这种删除无意义。</p>
<p>分支类型：</p>
<ul>
<li>远程分支（remote-branch），远程服务器上的分支，<code>refs/heads/*</code>@remote，是<code>远程追踪分支</code>的<code>上游分支</code>。</li>
<li>远程追踪分支（remote-tracking branch），远程服务器对应在本地的分支，与<code>远程分支</code>存在<code>追踪</code>关系，可能是<code>本地分支</code>的<code>上游分支</code>。</li>
<li>本地分支（local branch），<code>refs/heads/*</code>@local，可能与<code>远程追踪分支</code>存在<code>追踪</code>关系。</li>
</ul>
<p>分支关系：</p>
<ul>
<li>追踪分支（tracking branch），能够主动追踪其他分支，自动跟随其他分支变化更新的分支。</li>
<li>上游分支（upstream branch），被追踪的分支。</li>
</ul>
<blockquote>
<p>Checking out a <code>local branch</code> from a <code>remote-tracking branch</code> automatically creates what is called a <code>“tracking branch”</code> (and the branch it tracks is called an <code>“upstream branch”</code>).</p>
</blockquote>
<p>只有把概念定义清楚，才能够进行准确的描述，要不然都可能带来理解上的偏差。</p>
<h3 id="git-tag"><a href="#git-tag" class="headerlink" title="git-tag"></a><a href="https://git-scm.com/docs/git-tag" target="_blank" rel="noopener">git-tag</a></h3><blockquote>
<p>创建、删除、查看、校验标签</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git tag [-a | -s | -u &lt;keyid&gt;] [-f] [-m &lt;msg&gt; | -F &lt;file&gt;] [-e] &lt;tagname&gt; [&lt;commit&gt; | &lt;object&gt;]</span><br><span class="line">git tag -d &lt;tagname&gt;…​</span><br><span class="line">git tag [-n[&lt;num&gt;]] -l [--contains &lt;commit&gt;] [--no-contains &lt;commit&gt;]</span><br><span class="line">  [--points-at &lt;object&gt;] [--column[=&lt;options&gt;] | --no-column]</span><br><span class="line">  [--create-reflog] [--sort=&lt;key&gt;] [--format=&lt;format&gt;]</span><br><span class="line">  [--[no-]merged [&lt;commit&gt;]] [&lt;pattern&gt;…​]</span><br><span class="line">git tag -v [--format=&lt;format&gt;] &lt;tagname&gt;…​</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看分支</span></span><br><span class="line">git tag</span><br><span class="line">git tag -l --list <span class="string">"v*"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建分支</span></span><br><span class="line">git tag -a v1.0.0 -m <span class="string">"tagging version 1.0.0"</span></span><br><span class="line">git tag -a --force v1.0.0 -m <span class="string">"tagging version 1.0.0"</span></span><br><span class="line">git tag -a v1.0.0 --file=&lt;file&gt;</span><br><span class="line">git tag -a v1.0.0 &lt;commit-id&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除分支</span></span><br><span class="line">git tag -d v1.0.0</span><br></pre></td></tr></table></figure>
<p>与分支不同，<code>git push</code> 默认不推送标签到远程，所以需要主动推送标签：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --tags</span><br></pre></td></tr></table></figure>
<p>同样，<code>git tag</code> 只能操作本地仓库，无法直接操作远程仓库，操作远程仓库必须通过 <code>git push</code>，通常也不会直接操作远程仓库。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git push --delete &lt;tag-name&gt;</span><br><span class="line">git push --delete v1.0.0</span><br></pre></td></tr></table></figure>
<p>清理 远程不能存在本地存在 的标签：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -l | xargs git tag -d ; git fetch --tags</span><br></pre></td></tr></table></figure>
<p>标签并不像分支那样，存在远程标签/本地标签等区分，所以也不存在本地标签与远程标签之间的对应关系，自然也就不需要维护对应关系。</p>
<h3 id="git-checkout"><a href="#git-checkout" class="headerlink" title="git-checkout"></a><a href="https://git-scm.com/docs/git-checkout" target="_blank" rel="noopener">git-checkout</a></h3><ul>
<li>切换分支并检出内容到工作区，也可创建分支</li>
</ul>
<p>检出已存在的分支</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout    &lt;branch&gt;</span><br><span class="line">git checkout -b &lt;branch&gt; --track &lt;remote&gt;/&lt;branch&gt;</span><br></pre></td></tr></table></figure>
<p>创建并检出分支</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b|-B &lt;new_branch&gt; [&lt;start-point&gt;]</span><br></pre></td></tr></table></figure>
<p>检出<code>tree-ish</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout [&lt;tree-ish&gt;] [--] &lt;pathspec&gt;…​</span><br></pre></td></tr></table></figure>
<p>检出内容到本地的时候会发生什么？</p>
<ol>
<li>本地是干净的，无任何修改</li>
<li>本地存在新增加的文件</li>
<li>本地存在修改后未提交的文件</li>
</ol>
<p>Ref：<a href="https://git-scm.com/docs/git-checkout#_detached_head" target="_blank" rel="noopener">DETACHED HEAD</a></p>
<p>HEAD 通常指向某一个分支，这一分支即是当前工作的分支。当 HEAD 不再指向分支的时候，仓库即处于 <code>DETACHED HEAD</code> 状态。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout ccdd28a</span><br><span class="line">Note: checking out <span class="string">'ccdd28a'</span>.</span><br><span class="line"></span><br><span class="line">You are <span class="keyword">in</span> <span class="string">'detached HEAD'</span> state. You can look around, make experimental</span><br><span class="line">changes and commit them, and you can discard any commits you make <span class="keyword">in</span> this</span><br><span class="line">state without impacting any branches by performing another checkout.</span><br><span class="line"></span><br><span class="line">If you want to create a new branch to retain commits you create, you may</span><br><span class="line"><span class="keyword">do</span> so (now or later) by using -b with the checkout <span class="built_in">command</span> again. Example:</span><br><span class="line"></span><br><span class="line">  git checkout -b &lt;new-branch-name&gt;</span><br><span class="line"></span><br><span class="line">HEAD is now at ccdd28a git update</span><br><span class="line"></span><br><span class="line">$ git status</span><br><span class="line">HEAD detached at ccdd28a</span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure>
<p>处于这种状态下的仓库，如果进行修改并且提交，就会很危险，因为没有任何分支指向新的提交，当 <code>HEAD</code> 切换到其他位置的时候，当前的修改就不容易找不到了。</p>
<p>如果需要基于此节点进行修改，需要先基于此节点创建分支。</p>
<h3 id="git-merge"><a href="#git-merge" class="headerlink" title="git-merge"></a><a href="https://git-scm.com/docs/git-merge" target="_blank" rel="noopener">git-merge</a></h3><blockquote>
<p>将两个或多个分支历史合并在一起</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">git merge</span><br><span class="line">  [-q --quiet]</span><br><span class="line">  [-v --verbose]</span><br><span class="line">  [--[no-]progress]</span><br><span class="line">  [--commit] [--no-commit]</span><br><span class="line">  [-e | --edit] [--no-edit]</span><br><span class="line">  [-ff] [--no-ff] [--ff-only]</span><br><span class="line">  [--<span class="built_in">log</span>[=&lt;n&gt;]] [--no-log]</span><br><span class="line">  [-n] [--<span class="built_in">stat</span>] [--no-stat]</span><br><span class="line">  [--[no-]squash]</span><br><span class="line">  [--[no-]signoff]</span><br><span class="line">  [-s &lt;strategy&gt;] [--strategy=&lt;strategy&gt;]</span><br><span class="line">  [-X &lt;strategy-option&gt;] [--strategy-option=&lt;option&gt;]</span><br><span class="line">  [-S[&lt;keyid&gt;]] --gpg-sign[=&lt;keyid&gt;]</span><br><span class="line">  [--[no-]verify-signatures]</span><br><span class="line">  [--[no-]summary]</span><br><span class="line">  [--[no-]allow-unrelated-histories]</span><br><span class="line">  [--[no-]rerere-autoupdate]</span><br><span class="line">  [-m &lt;msg&gt;]</span><br><span class="line">  [&lt;commit&gt;…​]</span><br><span class="line"></span><br><span class="line">https://stackoverflow.com/questions/11646107/you-have-not-concluded-your-merge-merge-head-exists</span><br><span class="line"></span><br><span class="line"><span class="comment"># git merge --abort is equivalent to git reset --merge when MERGE_HEAD is present.</span></span><br><span class="line"><span class="comment"># 中断 merge，当发生冲突时，可以通过中断合并回到合并前的状态</span></span><br><span class="line">git merge --abort</span><br><span class="line"></span><br><span class="line"><span class="comment"># 继续 merge，当发生冲突时，需要解决冲突，解决冲突后，继续执行合并</span></span><br><span class="line">git merge --<span class="built_in">continue</span></span><br></pre></td></tr></table></figure>
<p>有如下版本库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">      A---B---C topic</span><br><span class="line">     /</span><br><span class="line">D---E---F---G master</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge topic</span><br></pre></td></tr></table></figure>
<p>合并后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">      A---B---C topic</span><br><span class="line">     /         \</span><br><span class="line">D---E---F---G---H master</span><br></pre></td></tr></table></figure>
<p>squash mode</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git merge --squash topic</span><br><span class="line">git commit -m <span class="string">"message"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">      A---B---C topic</span><br><span class="line">     /</span><br><span class="line">D---E---F---G---(ABC) master</span><br></pre></td></tr></table></figure>
<p><code>--squash</code> 效果相当于将 topic 分支上的多个 commit A-B-C 合并成一个 ABC，放在当前分支上，原来的 commit 历史则没有拿过来。</p>
<p>判断是否使用 <code>--squash</code> 选项最根本的标准是，待合并分支上的历史是否有意义。版本历史记录的应该是代码的发展，而不是开发者在编码时的活动。</p>
<p>只有在开发分支上每个 commit 都有其独自存在的意义，并且能够编译通过的情况下，才应该选择缺省的合并方式来保留 commit 历史。</p>
<p>fast forward mode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">              A---B---C topic</span><br><span class="line">             /</span><br><span class="line">D---E---F---G master</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge --ff topic</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">              A---B---C topic master</span><br><span class="line">             /</span><br><span class="line">D---E---F---G</span><br></pre></td></tr></table></figure>
<p>合并的前提是：准备合并的两个 <code>commit</code> 不在一条直线上，在一条直线上可以进行快速前进，也可以使用 <code>--no-ff</code> 强制合并（无意义）。</p>
<p>合并的过程中需要处理可能得冲突，未冲突的文件将会进行自动合并，在新版本的<code>tree</code>中产生一个新版本的<code>blob</code>，所以Git能够完整检出不需要依赖历史中的<code>commit</code>，只需要当前的<code>commit</code>。</p>
<p>合并的结果是：产生一个新的 <code>commit</code>，实际上，<code>squash mode</code> <code>fast forward mode</code> 并不是真正意义上的合并。</p>
<p>冲突：</p>
<p>冲突有两种类型，一种是树冲突，修改/删除同一文件，另一种是文件冲突，修改了同一文件中的相同内容。</p>
<p>冲突是如何判断的？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">      A---B---C topic</span><br><span class="line">     /</span><br><span class="line">D---E---F---G master</span><br></pre></td></tr></table></figure>
<p>假如有文件 <code>README.md</code> 在 <code>E</code>，且 <code>topic</code> 和 <code>master</code> 都有修改此文件，合并 <code>topic</code> 到 <code>master</code> 时，冲突检查的依据不是对比 <code>README.md@topic</code> 和 <code>README.md@master</code> 是否相同，而是对比 <code>README.md@topic</code> 和 <code>README.md@master</code> 相对于 <code>E</code> 的变化。即使是 <code>README.md</code> 文件在被修改后的内容是相同的，也会产生冲突。而冲突产生的文件，就是将 相对于 <code>E</code>，都合并到同一个文件中，并交由用户解决。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; yours:sample.txt</span><br><span class="line">Git makes conflict resolution easy.</span><br><span class="line">=======</span><br><span class="line">Git makes conflict resolution easy.</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; theirs:sample.txt</span><br></pre></td></tr></table></figure>
<p>最佳实践：</p>
<ol>
<li>尽量避免在本地使用 <code>merge</code>，也尽量避免在本地发生 <code>Merge</code>。</li>
<li><code>merge</code> 时，本地不要有未提交的更改，这些修改可能会在中断合并时丢失。</li>
</ol>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><h3 id="git-add"><a href="#git-add" class="headerlink" title="git add"></a>git add</h3><blockquote>
<p>添加文件到索引中，为下一次提交准备内容。</p>
</blockquote>
<p>将工作区的修改添加到暂存区中，此命令使用在工作树中找到的最新内容更新索引，以准备为下次提交暂存内容。</p>
<p>典型的情况下，将整个文件添加到暂存区中，通过特定的选项，也可以将工作区修改的部分内容加到暂存区中。</p>
<p>暂存区保存工作树内容的快照，并将此快照作为下一次提交的内容。因此，在对工作树进行任何更改之后，在运行commit命令之前，必须使用add命令将任何新的或修改的文件添加到索引中。</p>
<p>默认情况下，<code>git add</code> 不会添加忽略的文件，<code>git add -f</code> 会进行强制添加。</p>
<h3 id="git-rm"><a href="#git-rm" class="headerlink" title="git rm"></a>git rm</h3><blockquote>
<p>从工作区和暂存区移除文件</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm [-f | --force] [-n] [-r] [--cached] [--ignore-unmatch] [--quiet] [--] &lt;file&gt;…​</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm *.txt</span><br></pre></td></tr></table></figure>
<p>等价于：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm *.txt</span><br><span class="line">git add *.txt</span><br></pre></td></tr></table></figure>
<p>仅从暂存区删除内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm --cached *.txt</span><br></pre></td></tr></table></figure>
<h3 id="git-mv"><a href="#git-mv" class="headerlink" title="git mv"></a>git mv</h3><blockquote>
<p>重命名或移动文件，同步更新暂存区</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git mv &lt;options&gt;…​ &lt;args&gt;…​</span><br><span class="line">git mv [-v] [-f] [-n] [-k] &lt;<span class="built_in">source</span>&gt; &lt;destination&gt;</span><br><span class="line">git mv [-v] [-f] [-n] [-k] &lt;<span class="built_in">source</span>&gt; ... &lt;destination directory&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git mv old_name new_name            <span class="comment"># 重命名</span></span><br><span class="line">git mv -f old_name new_name         <span class="comment"># 强制重命名，即时目标名称已经存在</span></span><br><span class="line">git mv -k old_name new_name         <span class="comment"># 跳过会导致错误的动作</span></span><br><span class="line">git mv -v old_name new_name         <span class="comment"># 报告被移动文件</span></span><br><span class="line">git mv --dry-run old_name new_name  <span class="comment"># 只显示将会发生什么</span></span><br></pre></td></tr></table></figure>
<h3 id="git-diff"><a href="#git-diff" class="headerlink" title="git diff"></a>git diff</h3><blockquote>
<p>Show changes between commits, commit and working tree, etc</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git diff [options] [&lt;commit&gt;] [--] [&lt;path&gt;…​]</span><br><span class="line">git diff [options] --cached [&lt;commit&gt;] [--] [&lt;path&gt;…​]</span><br><span class="line">git diff [options] &lt;commit&gt; &lt;commit&gt; [--] [&lt;path&gt;…​]</span><br><span class="line">git diff [options] &lt;blob&gt; &lt;blob&gt;</span><br><span class="line">git diff [options] [--no-index] [--] &lt;path&gt; &lt;path&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git diff                <span class="comment"># 查看尚未暂存的文件更新了哪些部分，不加参数直接输入。</span></span><br><span class="line">git diff --cached       <span class="comment"># 查看已经暂存起来的文件(staged)和上次提交时的快照之间(HEAD)的差异</span></span><br><span class="line">git diff --staged       <span class="comment"># 显示的是下一次 commit 时会提交到HEAD的内容(不带-a情况下)</span></span><br><span class="line">git diff HEAD           <span class="comment"># 显示工作版本(Working tree)和HEAD的差别</span></span><br><span class="line">git diff topic master   <span class="comment"># 直接将两个分支上最新的提交做diff</span></span><br><span class="line">git diff topic...master <span class="comment"># 输出自 topic 和 master 分别开发以来，master 分支上的 changed。</span></span><br><span class="line">git diff --<span class="built_in">stat</span>         <span class="comment"># 查看简单的diff结果，可以加上--stat参数</span></span><br><span class="line">git diff <span class="built_in">test</span>           <span class="comment"># 查看当前目录和另外一个分支的差别 显示当前目录和另一个叫 test 分支的差别</span></span><br><span class="line">git diff HEAD -- ./lib  <span class="comment"># 显示当前目录下的lib目录和上次提交之间的差别（更准确的说是在当前分支下）</span></span><br><span class="line">git diff HEAD^ HEAD     <span class="comment"># 比较上次提交commit和上上次提交</span></span><br><span class="line">git diff SHA1 SHA2      <span class="comment"># 比较两个历史版本之间的差异</span></span><br></pre></td></tr></table></figure>
<p><a href="https://en.wikipedia.org/wiki/Diff_utility" target="_blank" rel="noopener">Diff_utility</a></p>
<h3 id="git-commit"><a href="#git-commit" class="headerlink" title="git commit"></a>git commit</h3><blockquote>
<p>Record changes to the repository</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git commit                          <span class="comment"># 提交的是暂存区里面的内容，也就是 Changes to be committed 中的文件。</span></span><br><span class="line">git commit -a                       <span class="comment"># 除了将暂存区里的文件提交外，还提交 Changes bu not updated 中的文件。</span></span><br><span class="line">git commit -a -m <span class="string">'commit info'</span>      <span class="comment"># 注释，如果没有 -m，会默认会使用vi编辑注释。</span></span><br><span class="line">git commit -am <span class="string">"This is a commit"</span>   <span class="comment"># 同上，合并提交，将 add 和 commit 合为一步</span></span><br><span class="line">git commit --amend                  <span class="comment"># 对上一次提交进行修改，合并上一次提交（用于反复修改）</span></span><br><span class="line">git commit --amend -a               <span class="comment"># 提交时忘记使用 -a 选项，导致 Changes bu not updated 中的内容没有被提交</span></span><br><span class="line">git commit --author=&lt;author&gt;        <span class="comment"># 设置作者，与提交者分开</span></span><br><span class="line">git commit --file=&lt;file&gt;            <span class="comment"># 注释从文件中读取</span></span><br></pre></td></tr></table></figure>
<p>对于 commit 来说，最重要的是，每一次 commit 都应该是一个完整的提交，而且应该有个规范清晰的注释。</p>
<p><a href="http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html" target="_blank" rel="noopener">Commit message 和 Change log 编写指南</a></p>
<h3 id="git-status"><a href="#git-status" class="headerlink" title="git status"></a>git status</h3><blockquote>
<p>显示工作树状态</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status [&lt;options&gt;…​] [--] [&lt;pathspec&gt;…​]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git status     <span class="comment"># 显示状态</span></span><br><span class="line">git status -s  <span class="comment"># 显示简短信息</span></span><br><span class="line">git status -b  <span class="comment"># 显示分支状态</span></span><br></pre></td></tr></table></figure>
<h3 id="git-reset"><a href="#git-reset" class="headerlink" title="git reset"></a>git reset</h3><blockquote>
<p>重置工作区，将当前分支回退到某一节点</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git reset [-q] [&lt;tree-ish&gt;] [--] &lt;paths&gt;…​</span><br><span class="line">git reset (--patch | -p) [&lt;tree-ish&gt;] [--] [&lt;paths&gt;…​]</span><br><span class="line">git reset [--soft | --mixed [-N] | --hard | --merge | --keep] [-q] [&lt;commit&gt;]</span><br></pre></td></tr></table></figure>
<p><code>git reset</code> 会修改当前分支头从某一个 <code>&lt;commit-id&gt;</code> 移动到另外的一个指定的 <code>&lt;commit-id&gt;</code></p>
<p>如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">              HEAD</span><br><span class="line">              ↓</span><br><span class="line">              topic</span><br><span class="line">              ↓</span><br><span class="line">      A---B---C</span><br><span class="line">     /</span><br><span class="line">D---E---F---G master</span><br></pre></td></tr></table></figure>
<p>当前活跃的分支是 <code>topic</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset A</span><br></pre></td></tr></table></figure>
<p>执行以上操作后：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">      HEAD</span><br><span class="line">      ↓</span><br><span class="line">      topic</span><br><span class="line">      ↓</span><br><span class="line">      A---B---C</span><br><span class="line">     /</span><br><span class="line">D---E---F---G master</span><br></pre></td></tr></table></figure>
<p>此时，<code>HEAD -&gt; topic -&gt; A</code>，B、C 此时处于悬挂状态，如同普通的对象一样，没有任何引用后，会被 Git GC 回收。</p>
<p>执行此操作后，B、C 两点虽然依然存在于仓库中，但是它们已经逻辑上脱离了Git。</p>
<p>此时，B、C 两点提交的内容怎么办？是不是就丢失了呢？</p>
<p>Git 给了我们多种选择：</p>
<ul>
<li>–soft，B、C 提交的内容不会回到工作区和暂存区。因为当前工作区内容是基于 C 修改的，所以实际上并无内容丢失。</li>
<li>–mixed，B、C 提交的内容回到暂存区，但是工作区内容不变，也就是某些文件处于 <code>修改未提交状态</code>。同上，也无内容丢失。</li>
<li>–hard，B、C 提交的内容不会回到工作区和暂存区，同时暂存区和工作区回到A点状态，B、C 提交的内容以及工作区后续的修改全部丢失。</li>
</ul>
<p>如果 <code>reset</code> 误操作操作怎么办？</p>
<ol>
<li><p>如果存在上游分支，可以通过上游分支恢复</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reset master^2</span><br><span class="line">git reset origin/master</span><br></pre></td></tr></table></figure>
</li>
<li><p>可以通过 <code>reflog</code> 恢复</p>
<p> <code>reflog</code> 记录 HEAD 的变化，所以可以通过 <code>reflog</code> 找到 <code>reset</code> 之前的 <code>HEAD</code> 的位置，但是前提是后续节点未被垃圾回收。</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git reflog</span><br><span class="line">58c1d5d (HEAD -&gt; master, origin/master) HEAD@&#123;0&#125;: commit: update git</span><br><span class="line">ccdd28a (test2, test1, <span class="built_in">test</span>) HEAD@&#123;1&#125;: checkout: moving from <span class="built_in">test</span> to master</span><br><span class="line">ccdd28a (test2, test1, <span class="built_in">test</span>) HEAD@&#123;2&#125;: checkout: moving from master to <span class="built_in">test</span></span><br><span class="line">ccdd28a (test2, test1, <span class="built_in">test</span>) HEAD@&#123;3&#125;: commit: git update</span><br><span class="line">e081fb3 HEAD@&#123;4&#125;: commit: update python</span><br><span class="line">d26f671 HEAD@&#123;5&#125;: commit: update</span><br><span class="line">33db13f HEAD@&#123;6&#125;: commit (amend): update and format</span><br><span class="line">5c41033 HEAD@&#123;7&#125;: commit: update and format</span><br><span class="line">e56ec4e HEAD@&#123;8&#125;: commit: 移除乱码字符</span><br><span class="line">6595b95 HEAD@&#123;9&#125;: commit: feat(): add hexo.yaml</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>未提交的内容是很难就行恢复的，所有在进行 <code>reset</code> 操作时，要将工作区的内容提交。</p>
<p>reset 除了将工作区回退到某个节点之外，常用的应用就是将后续的多个提交合并为一个提交，因为后续提交的内容可以回到暂存区或工作区中。</p>
<p>在某些Git工作流中，要求将多个提交合并成一个之后才能合并到上游分支。</p>
<h3 id="git-revert"><a href="#git-revert" class="headerlink" title="git revert"></a>git revert</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git revert [--[no-]edit] [-n] [-m parent-number] [-s] [-S[&lt;keyid&gt;]] &lt;commit&gt;…​</span><br><span class="line">git revert --<span class="built_in">continue</span></span><br><span class="line">git revert --quit</span><br><span class="line">git revert --abort</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git revert HEAD~3</span><br><span class="line">git revert -n master~5..master~2</span><br></pre></td></tr></table></figure>
<p><code>git revert</code> 用于撤销一个或多个提交，并建立一个新的提交。<code>commit</code> 中所做的修改都会被移除掉，相当于 <code>commit</code> 反向操作。</p>
<p><code>git revert</code> 通常用户快速回滚。</p>
<p>示例如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">            HEAD</span><br><span class="line">            ↓</span><br><span class="line">            master</span><br><span class="line">            ↓</span><br><span class="line">A---B---C---D</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert C</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">                HEAD</span><br><span class="line">                ↓</span><br><span class="line">                master</span><br><span class="line">                ↓</span><br><span class="line">A---B---C---D---C<span class="string">'</span></span><br></pre></td></tr></table></figure>
<p><code>C&#39;</code> 是一个全新的 <code>Commit</code> 与 <code>C</code> 是不同的，但是这种情况下，<code>C&#39;</code> 与 <code>C</code> 中的 <code>tree</code> 是相同的。</p>
<h3 id="git-rebase"><a href="#git-rebase" class="headerlink" title="git rebase"></a>git rebase</h3><blockquote>
<p>变基操作，基指的是起始提交，即参数中常见的 <start-point></start-point></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git rebase [-i | --interactive] [&lt;options&gt;] [--<span class="built_in">exec</span> &lt;cmd&gt;] [--onto &lt;newbase&gt;] [&lt;upstream&gt; [&lt;branch&gt;]]</span><br><span class="line">git rebase [-i | --interactive] [&lt;options&gt;] [--<span class="built_in">exec</span> &lt;cmd&gt;] [--onto &lt;newbase&gt;] --root [&lt;branch&gt;]</span><br><span class="line">git rebase --<span class="built_in">continue</span> | --skip | --abort | --quit | --edit-todo | --show-current-patch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解决冲突之后继续 rebase</span></span><br><span class="line">git rebase --<span class="built_in">continue</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 跳过</span></span><br><span class="line">git rebase --skip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 中断 rebase</span></span><br><span class="line">git rebase --abort</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">      A---B---C ← topic</span><br><span class="line">     /</span><br><span class="line">D---E---F---G ← master</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase master</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">              A&apos;--B&apos;--C&apos; ← topic</span><br><span class="line">             /</span><br><span class="line">D---E---F---G ← master</span><br></pre></td></tr></table></figure>
<p>以上，通过变基操作，将topic分支的 <start-point> 从 <code>E</code> 调整到了 <code>G</code>。</start-point></p>
<p>变基操作的原理：将 A B C 基于 G 重新提交，提交的过程可能与 F G 存在冲突，需要解决冲突。</p>
<p>变基操作的应用：</p>
<ol>
<li>保持与上游分支同步，同步上游分支的最新版本</li>
<li>合并时存在冲突，通过变基操作解决冲突</li>
</ol>
<h3 id="git-cherry-pick"><a href="#git-cherry-pick" class="headerlink" title="git cherry-pick"></a>git cherry-pick</h3><p>源文件地址：<a href="https://github.com/liuyanjie/knowledge/tree/master/vcs/git/git-working-mechanism.md" target="_blank" rel="noopener">https://github.com/liuyanjie/knowledge/tree/master/vcs/git/git-working-mechanism.md</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="/posts/Git深入理解-对象模型/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lyj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyj's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/posts/Git深入理解-对象模型/" class="post-title-link" itemprop="url">Git深入理解-对象模型</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-05-06 08:00:00" itemprop="dateCreated datePublished" datetime="2018-05-06T08:00:00+08:00">2018-05-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-29 00:24:16" itemprop="dateModified" datetime="2018-12-29T00:24:16+08:00">2018-12-29</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/GIT/" itemprop="url" rel="index"><span itemprop="name">GIT</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/GIT/VCS/" itemprop="url" rel="index"><span itemprop="name">VCS</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/Git深入理解-对象模型/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/Git深入理解-对象模型/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">28k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">25 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="GIT对象模型"><a href="#GIT对象模型" class="headerlink" title="GIT对象模型"></a>GIT对象模型</h2><h3 id="SHA"><a href="#SHA" class="headerlink" title="SHA"></a>SHA</h3><p>所有用来表示项目历史信息的文件，都是通过一个40个字符的（40-digit）“对象名”来索引的，对象名看起来像这样:</p>
<blockquote>
<p>6ff87c4664981e4397625791c8ea3bbb5f2279a3</p>
</blockquote>
<p>在后边使用对象名时，只使用前面几个字符即可，但是最少需要4个。</p>
<p>你会在Git里到处看到这种“40个字符”字符串。每一个“对象名”都是对“对象”内容做SHA1哈希计算得来的。这样就意味着两个不同内容的对象几乎不可能（理论上是可能发生碰撞的）有相同的“对象名”。</p>
<p>这样做会有几个好处：</p>
<ul>
<li><p>只要比较对象名，就可以很快的判断两个对象是否相同。</p>
<p>因为在每个仓库（repository）的“对象名”的计算方法都完全一样，如果同样的内容存在两个不同的仓库中，就会存在相同的“对象名”下。</p>
</li>
<li><p>还可以通过检查对象内容的SHA1的哈希值和“对象名”是否相同，来判断对象内容是否正确。</p>
</li>
</ul>
<h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><p>每个对象(object) 包括三个部分：类型、大小和内容。大小就是指内容的大小，内容取决于对象的类型。</p>
<p>有四种类型的对象：<code>&quot;blob&quot;</code>、<code>&quot;tree&quot;</code>、<code>&quot;commit&quot;</code> 和 <code>&quot;tag&quot;</code>。</p>
<p>几乎所有的Git功能都是使用这四个简单的对象类型来完成的。它就像是在你本机的文件系统之上构建一个小的文件系统。</p>
<h4 id="blob-文件-对象"><a href="#blob-文件-对象" class="headerlink" title="blob (文件) 对象"></a>blob (文件) 对象</h4><p><code>blob</code> 用来存储文件数据，通常是一个文件。</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/vcs/git/images/object-blob.png" alt="blob"></p>
<h4 id="tree-目录-对象"><a href="#tree-目录-对象" class="headerlink" title="tree (目录) 对象"></a>tree (目录) 对象</h4><p><code>tree</code> 像一个目录，管理 <code>tree（子目录）</code> 或 <code>blob（文件）</code></p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/vcs/git/images/object-tree.png" alt="tree"></p>
<h4 id="commit-提交-对象"><a href="#commit-提交-对象" class="headerlink" title="commit (提交) 对象"></a>commit (提交) 对象</h4><p>一个 <code>commit</code> 只指向一个 <code>tree</code>，它用来标记项目某一个特定时间点的状态。<code>commit</code> 保存了树根的 <code>对象名</code>。</p>
<p>它包括一些关于时间点的元数据，如 <code>时间戳</code>、<code>最近一次提交的作者</code>、<code>指向上次提交（commits）的指针</code> 等等。</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/vcs/git/images/object-commit.png" alt="tree"></p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p <span class="number">830</span>f<span class="number">4857e9</span>f<span class="number">579818</span><span class="keyword">c</span><span class="number">5e69104</span>d<span class="number">3e2</span><span class="keyword">cc</span><span class="number">30</span>f<span class="number">1</span>f<span class="number">0</span>d<span class="number">0</span>d</span><br><span class="line">tree f<span class="number">25061</span>fa<span class="number">4</span>f<span class="number">8</span>b<span class="number">3</span>bffbf<span class="number">8</span>ebcc<span class="number">3</span>ab<span class="number">2351</span>efdad<span class="number">2</span>f<span class="number">605</span></span><br><span class="line">parent <span class="number">06e13701</span>ac<span class="number">86</span>eb<span class="number">09</span><span class="keyword">c</span><span class="number">2035329</span>a<span class="number">5e1</span><span class="keyword">c</span><span class="number">18</span>f<span class="number">95898</span>cf<span class="number">2</span></span><br><span class="line">author liuyanjie &lt;<span class="keyword">x</span><span class="title">@gmail.com</span>&gt; <span class="number">1526828841</span> +<span class="number">0800</span></span><br><span class="line">committer liuyanjie &lt;<span class="keyword">x</span><span class="title">@gmail.com</span>&gt; <span class="number">1526828841</span> +<span class="number">0800</span></span><br><span class="line"></span><br><span class="line">commit message</span><br></pre></td></tr></table></figure>
<h4 id="tag-标签-对象"><a href="#tag-标签-对象" class="headerlink" title="tag (标签) 对象"></a>tag (标签) 对象</h4><p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/vcs/git/images/object-tag.png" alt="tag"></p>
<p>一个 <code>tag</code> 是来标记某一个 <code>commit</code> 的方法。</p>
<p>实际上 <code>tag</code> 本身是文件名，内容是 <code>commit</code> 的对象名。<code>tag</code> 是 <code>commit</code> 的别名，类似于域名和ip地址的关系。</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/refs/tags/v0<span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="number">830</span>f4857e9f579818c5e69104d3e2cc30f1f0d0d</span><br></pre></td></tr></table></figure>
<h4 id="commit-gt-tree-gt-blob"><a href="#commit-gt-tree-gt-blob" class="headerlink" title="commit -&gt; tree -&gt; blob"></a>commit -&gt; tree -&gt; blob</h4><p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/vcs/git/images/object-c-t-b.png" alt="object-c-t-b"></p>
<p>从图上可以看出：一个 <code>commit</code> 指向了一棵由 <code>tree</code> 和 <code>blob</code> 构成的 Git 对象树。</p>
<h3 id="与其他版本控制系统的区别"><a href="#与其他版本控制系统的区别" class="headerlink" title="与其他版本控制系统的区别"></a>与其他版本控制系统的区别</h3><p>Git与你熟悉的大部分版本控制系统的差别是很大的。</p>
<p>也许你熟悉 <code>Subversion</code>、<code>CVS</code>、<code>Perforce</code>、<code>Mercurial</code> 等等，他们使用 “增量文件系统” （Delta Storage systems）, 就是说它们存储每次提交(commit)之间的差异。</p>
<p>Git正好与之相反，它会把你的每次提交的文件的全部内容（snapshot）都会记录下来。</p>
<p>这会是在使用Git时的一个很重要的理念。</p>
<p>综上，Git对象模型非常简单，与普通的文件系统非常的相似。</p>
<h2 id="一步一步了解Git在做什么"><a href="#一步一步了解Git在做什么" class="headerlink" title="一步一步了解Git在做什么"></a>一步一步了解Git在做什么</h2><h3 id="初始化仓库"><a href="#初始化仓库" class="headerlink" title="初始化仓库"></a>初始化仓库</h3><p>初始化目录并创建一个Git仓库</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> git-obj-model</span><br><span class="line"></span><br><span class="line">$ git init</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /Users/liuyanjie/git-obj-model/.git/</span><br></pre></td></tr></table></figure>
<p>看一下初始化的git仓库中到底有些什么内容。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ tree .git</span><br><span class="line">.git</span><br><span class="line">├── HEAD</span><br><span class="line">├── config</span><br><span class="line">├── description</span><br><span class="line">├── hooks</span><br><span class="line">│   ├── applypatch-msg.sample</span><br><span class="line">│   ├── commit-msg.sample</span><br><span class="line">│   ├── fsmonitor-watchman.sample</span><br><span class="line">│   ├── post-update.sample</span><br><span class="line">│   ├── pre-applypatch.sample</span><br><span class="line">│   ├── pre-commit.sample</span><br><span class="line">│   ├── pre-push.sample</span><br><span class="line">│   ├── pre-rebase.sample</span><br><span class="line">│   ├── pre-receive.sample</span><br><span class="line">│   ├── prepare-commit-msg.sample</span><br><span class="line">│   └── update.sample</span><br><span class="line">├── info</span><br><span class="line">│   └── exclude</span><br><span class="line">├── objects</span><br><span class="line">│   ├── info</span><br><span class="line">│   └── pack</span><br><span class="line">└── refs</span><br><span class="line">    ├── heads</span><br><span class="line">    └── tags</span><br><span class="line"></span><br><span class="line">8 directories, 15 files</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/config</span><br><span class="line">[core]</span><br><span class="line">	repositoryformatversion = 0</span><br><span class="line">	filemode = <span class="literal">true</span></span><br><span class="line">	bare = <span class="literal">false</span></span><br><span class="line">	logallrefupdates = <span class="literal">true</span></span><br><span class="line">	ignorecase = <span class="literal">true</span></span><br><span class="line">	precomposeunicode = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/HEAD</span><br><span class="line">ref: refs/heads/master</span><br></pre></td></tr></table></figure>
<p>查看仓库状态</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">No commits yet</span><br><span class="line"></span><br><span class="line">nothing to commit (create/copy files and use <span class="string">"git add"</span> to track)</span><br></pre></td></tr></table></figure>
<p>后面忽略 <code>.git/hooks/</code> 下的文件。</p>
<h3 id="增加一个文件README-md"><a href="#增加一个文件README-md" class="headerlink" title="增加一个文件README.md"></a>增加一个文件README.md</h3><p>现在创建一个 <code>README.md</code>，查看 <code>.git</code> 目录，发现没有什么变化。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"# Readme"</span> &gt; README.md</span><br><span class="line"></span><br><span class="line">$ tree .git</span><br><span class="line">.git</span><br><span class="line">├── HEAD</span><br><span class="line">├── config</span><br><span class="line">├── description</span><br><span class="line">├── info</span><br><span class="line">│   └── exclude</span><br><span class="line">├── objects</span><br><span class="line">│   ├── info</span><br><span class="line">│   └── pack</span><br><span class="line">└── refs</span><br><span class="line">    ├── heads</span><br><span class="line">    └── tags</span><br><span class="line"></span><br><span class="line">8 directories, 15 files</span><br></pre></td></tr></table></figure>
<p>查看当前状态，可以看到，此时有一个未追踪的 <code>README.md</code> 文件，此文件存在于 <code>工作区</code> 中。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">No commits yet</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line"></span><br><span class="line">	README.md</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use <span class="string">"git add"</span> to track)</span><br></pre></td></tr></table></figure>
<p>执行 <code>git add</code> 命令后，可以看到增加了两个文件：</p>
<ul>
<li>.git/index</li>
<li>.git/objects/f3/954314c1026028e77ea3a765aadefa67b45195</li>
</ul>
<blockquote>
<p>git add 把文件暂存到索引中为下一次提交做准备，git commit 创建新的提交。</p>
</blockquote>
<p>应该知道，这应该是一个 <code>blob</code> 类型的文件，里面存储文件内容。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ git add README.md</span><br><span class="line"></span><br><span class="line">$ tree .git</span><br><span class="line">.git</span><br><span class="line">├── HEAD</span><br><span class="line">├── config</span><br><span class="line">├── description</span><br><span class="line">├── index</span><br><span class="line">├── info</span><br><span class="line">│   └── exclude</span><br><span class="line">├── objects</span><br><span class="line">│   ├── f3</span><br><span class="line">│   │   └── 954314c1026028e77ea3a765aadefa67b45195</span><br><span class="line">│   ├── info</span><br><span class="line">│   └── pack</span><br><span class="line">└── refs</span><br><span class="line">    ├── heads</span><br><span class="line">    └── tags</span><br><span class="line"></span><br><span class="line">9 directories, 17 files</span><br></pre></td></tr></table></figure>
<p>查看当前状态</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">No commits yet</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git rm --cached &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">	new file:   README.md</span><br></pre></td></tr></table></figure>
<p>查看对象内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p f39543</span><br><span class="line"><span class="comment"># Readme</span></span><br></pre></td></tr></table></figure>
<p>查看暂存区</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git ls-files --stage</span><br><span class="line">100644 f3954314c1026028e77ea3a765aadefa67b45195 0	README.md</span><br></pre></td></tr></table></figure>
<p>.git/index 是 Git索引文件，是一个在 <code>工作区</code> 和 <code>仓库</code> 间的 <code>暂存区域(staging area)</code>。</p>
<p>索引是一个二进制格式的文件，里面存放了与当前暂存内容相关的信息，包括暂存的<code>文件名</code>、<code>文件内容的SHA1哈希串值</code> 和 <code>文件访问权限</code>，整个索引文件的内容以暂存的文件名进行排git ls-files –stage序保存的。</p>
<p>因为这个文件记录了将要提交的文件, 所以我们才能够多次修改一起提交(commit)。</p>
<p>所以创建了一个新的提交(commit)，提交的一般是暂存区里的内容, 而不是工作目录中的内容。</p>
<p>一个Git项目中文件的状态大概分成下面的两大类，而第二大类又分为三小类：</p>
<ol>
<li>未被跟踪的文件（Untracked files）</li>
<li>已被跟踪的文件（Tracked files）<ol>
<li>被修改 未暂存 的文件（Changed but not updated 或 Modified）</li>
<li>被修改 已暂存 可以 被提交 的文件（Changes to be committed 或 Staged）</li>
<li>未修改 的文件（自上次提交以来）(Clean 或 Unmodified)</li>
</ol>
</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Changes to be committed:</span><br><span class="line">  (no files)</span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (no files)</span><br><span class="line">Untracked files:</span><br><span class="line">? .gitignore</span><br></pre></td></tr></table></figure>
<p>执行 <code>git commit</code> 命令，发现路径下又增加了两个文件：</p>
<ul>
<li>.git/objects/9d/978d59f2f22062c0382c859f4c3ef929026303</li>
<li>.git/objects/c1/067ba0a7ba51f937518c9bc051ea744ca748fe</li>
</ul>
<p>从上面的结构图，可以想到：</p>
<p>提交可定会产生一个提交对象，提交对象指向一个树对象，树对象包含上一步添加的<code>blob</code>对象。</p>
<p>下面将通过查看文件内容验证这一点。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m <span class="string">"First Commmit"</span> README.md</span><br><span class="line"></span><br><span class="line">[master (root-commit) 033fa1a] First Commmit</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 README.md</span><br><span class="line"></span><br><span class="line">$ tree .git</span><br><span class="line">.git</span><br><span class="line">├── COMMIT_EDITMSG</span><br><span class="line">├── HEAD</span><br><span class="line">├── config</span><br><span class="line">├── description</span><br><span class="line">├── index</span><br><span class="line">├── info</span><br><span class="line">│   └── exclude</span><br><span class="line">├── logs</span><br><span class="line">│   ├── HEAD</span><br><span class="line">│   └── refs</span><br><span class="line">│       └── heads</span><br><span class="line">│           └── master</span><br><span class="line">├── objects</span><br><span class="line">│   ├── 03</span><br><span class="line">│   │   └── 3fa1ab71f0d54f348f07a3a0ffcefd52804df5 +</span><br><span class="line">│   ├── c1</span><br><span class="line">│   │   └── 067ba0a7ba51f937518c9bc051ea744ca748fe +</span><br><span class="line">│   ├── f3</span><br><span class="line">│   │   └── 954314c1026028e77ea3a765aadefa67b45195</span><br><span class="line">│   ├── info</span><br><span class="line">│   └── pack</span><br><span class="line">└── refs</span><br><span class="line">    ├── heads</span><br><span class="line">    │   └── master</span><br><span class="line">    └── tags</span><br><span class="line"></span><br><span class="line">14 directories, 23 files</span><br></pre></td></tr></table></figure>
<p>查看 <code>033f</code> 对象内容，此时不知道这个文件类型及内容是什么</p>
<p>此时，<code>commit</code> 对象为初始提交，所以并无 <code>parent</code> 引用。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 033f</span><br><span class="line">tree c1067ba0a7ba51f937518c9bc051ea744ca748fe</span><br><span class="line">author liuyanjie &lt;x@gmail.com&gt; 1527521894 +0800</span><br><span class="line">committer liuyanjie &lt;x@gmail.com&gt; 1527521894 +0800</span><br><span class="line"></span><br><span class="line">First Commmit</span><br></pre></td></tr></table></figure>
<p>查看 <code>c106</code> 对象内容，通过上一步，已知此对象是一个 <code>tree</code> 类型的对象，通过内容可以看到，树类型的对象实际就是存储每行一条数据的列表。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p c106</span><br><span class="line">100644 blob f3954314c1026028e77ea3a765aadefa67b45195	README.md</span><br></pre></td></tr></table></figure>
<p>再看 <code>.git/refs/heads/master</code> 文件内容</p>
<p>文件内容只有一行，内容是 <code>033f</code> 对象。<code>master</code> 即是 <code>master</code> 分支的物理表示。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/refs/heads/master</span><br><span class="line">033fa1ab71f0d54f348f07a3a0ffcefd52804df5</span><br></pre></td></tr></table></figure>
<p>同时，还可看到，新增了 <code>.git/logs</code> 目录及内容</p>
<p>该目录下保存了各个分支的提交记录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/logs/refs/heads/master</span><br><span class="line">0000000000000000000000000000000000000000 033fa1ab71f0d54f348f07a3a0ffcefd52804df5 liuyanjie &lt;x@gmail.com&gt; 1527521894 +0800	commit (initial): First Commmit</span><br><span class="line"></span><br><span class="line">$ cat .git/logs/HEAD</span><br><span class="line">0000000000000000000000000000000000000000 033fa1ab71f0d54f348f07a3a0ffcefd52804df5 liuyanjie &lt;x@gmail.com&gt; 1527521894 +0800	commit (initial): First Commmit</span><br></pre></td></tr></table></figure>
<p>Tag</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag v0.0.1 -m <span class="string">'tag v0.0.1'</span></span><br></pre></td></tr></table></figure>
<p>查看目录文件变化</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">$ tree .git</span><br><span class="line">.git</span><br><span class="line">├── COMMIT_EDITMSG</span><br><span class="line">├── HEAD</span><br><span class="line">├── config</span><br><span class="line">├── description</span><br><span class="line">├── index</span><br><span class="line">├── info</span><br><span class="line">│   └── exclude</span><br><span class="line">├── logs</span><br><span class="line">│   ├── HEAD</span><br><span class="line">│   └── refs</span><br><span class="line">│       └── heads</span><br><span class="line">│           └── master</span><br><span class="line">├── objects</span><br><span class="line">│   ├── 03</span><br><span class="line">│   │   └── 3fa1ab71f0d54f348f07a3a0ffcefd52804df5</span><br><span class="line">│   ├── c1</span><br><span class="line">│   │   └── 067ba0a7ba51f937518c9bc051ea744ca748fe</span><br><span class="line">│   ├── cc</span><br><span class="line">│   │   └── f88a6f1649213499841c33f9bb36d1d8756fb7</span><br><span class="line">│   ├── f3</span><br><span class="line">│   │   └── 954314c1026028e77ea3a765aadefa67b45195</span><br><span class="line">│   ├── info</span><br><span class="line">│   └── pack</span><br><span class="line">└── refs</span><br><span class="line">    ├── heads</span><br><span class="line">    │   └── master</span><br><span class="line">    └── tags</span><br><span class="line">        └── v0.0.1</span><br><span class="line"></span><br><span class="line">15 directories, 25 files</span><br></pre></td></tr></table></figure>
<p>查看 <code>.git/refs/tags/v0.0.1</code> 文件内容，可以看到内容恰好是新增的 objects <code>对象名</code>，所以可想而知 <code>ccf8</code> 是一个 <code>tag</code> 类型的对象</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/refs/tags/v0.0.1</span><br><span class="line">ccf88a6f1649213499841c33f9bb36d1d8756fb7</span><br></pre></td></tr></table></figure>
<p>查看新增的 <code>ccf8</code> 文件内容，文件指向了 <code>commit</code> 对象 <code>033f</code></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p ccf8</span><br><span class="line">object 033fa1ab71f0d54f348f07a3a0ffcefd52804df5</span><br><span class="line">type commit</span><br><span class="line">tag v0.0.1</span><br><span class="line">tagger liuyanjie &lt;x@gmail.com&gt; 1527523284 +0800</span><br><span class="line"></span><br><span class="line">tag v0.0.1</span><br></pre></td></tr></table></figure>
<p>通过以上查看 <code>.git</code> 目录的变化过程，可以大致分析出Git是如何存储这些文件内容的。</p>
<p>上面只执行了 <code>git add</code> 和 <code>git commit</code> 两条操作。</p>
<h3 id="继续添加文件"><a href="#继续添加文件" class="headerlink" title="继续添加文件"></a>继续添加文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"# CHANGELOG"</span> &gt; CHANGELOG.md</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"# CONTRIBUTING"</span> &gt; CONTRIBUTING.md</span><br><span class="line"></span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line"></span><br><span class="line">	CHANGELOG.md</span><br><span class="line">	CONTRIBUTING.md</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use <span class="string">"git add"</span> to track)</span><br><span class="line"></span><br><span class="line">$ git add CHANGELOG.md CONTRIBUTING.md</span><br><span class="line"></span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">	new file:   CHANGELOG.md</span><br><span class="line">	new file:   CONTRIBUTING.md</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ tree .git</span><br><span class="line">.git</span><br><span class="line">├── COMMIT_EDITMSG</span><br><span class="line">├── HEAD</span><br><span class="line">├── config</span><br><span class="line">├── description</span><br><span class="line">├── index</span><br><span class="line">├── info</span><br><span class="line">│   └── exclude</span><br><span class="line">├── logs</span><br><span class="line">│   ├── HEAD</span><br><span class="line">│   └── refs</span><br><span class="line">│       └── heads</span><br><span class="line">│           └── master</span><br><span class="line">├── objects</span><br><span class="line">│   ├── 03</span><br><span class="line">│   │   └── 3fa1ab71f0d54f348f07a3a0ffcefd52804df5</span><br><span class="line">│   ├── a0</span><br><span class="line">│   │   └── cf709bc0991b5340080f944d02894dc1596d46</span><br><span class="line">│   ├── c1</span><br><span class="line">│   │   └── 067ba0a7ba51f937518c9bc051ea744ca748fe</span><br><span class="line">│   ├── c6</span><br><span class="line">│   │   └── b9e95b39b8cd8ead8bbf4b118104741017de1b</span><br><span class="line">│   ├── cc</span><br><span class="line">│   │   └── f88a6f1649213499841c33f9bb36d1d8756fb7</span><br><span class="line">│   ├── f3</span><br><span class="line">│   │   └── 954314c1026028e77ea3a765aadefa67b45195</span><br><span class="line">│   ├── info</span><br><span class="line">│   └── pack</span><br><span class="line">└── refs</span><br><span class="line">    ├── heads</span><br><span class="line">    │   └── master</span><br><span class="line">    └── tags</span><br><span class="line">        └── v0.0.1</span><br><span class="line"></span><br><span class="line">17 directories, 27 files</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git ls-files --stage</span><br><span class="line">100644 a0cf709bc0991b5340080f944d02894dc1596d46 0	CHANGELOG.md</span><br><span class="line">100644 c6b9e95b39b8cd8ead8bbf4b118104741017de1b 0	CONTRIBUTING.md</span><br><span class="line">100644 f3954314c1026028e77ea3a765aadefa67b45195 0	README.md</span><br></pre></td></tr></table></figure>
<p>分别查看一下各个文件的内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p a0cf</span><br><span class="line"><span class="comment"># CHANGELOG</span></span><br><span class="line"></span><br><span class="line">$ git cat-file -p c6b9</span><br><span class="line"><span class="comment"># CONTRIBUTING</span></span><br><span class="line"></span><br><span class="line">$ git cat-file -p f395</span><br><span class="line"><span class="comment"># Readme</span></span><br></pre></td></tr></table></figure>
<p>再查看一下树对象的内容，然而并没有任何变化</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p c106</span><br><span class="line">100644 blob f3954314c1026028e77ea3a765aadefa67b45195	README.md</span><br></pre></td></tr></table></figure>
<p>下面提交这两个文件，可以通过日志方便的查看信息。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git commit --all -m <span class="string">"add CHANGELOG.md and CONTRIBUTING.md files"</span></span><br><span class="line">[master 28baf4f] add CHANGELOG.md and CONTRIBUTING.md files</span><br><span class="line"> 2 files changed, 2 insertions(+)</span><br><span class="line"> create mode 100644 CHANGELOG.md</span><br><span class="line"> create mode 100644 CONTRIBUTING.md</span><br></pre></td></tr></table></figure>
<p>同样再看一下<code>.git</code>目录下的内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">$ tree .git</span><br><span class="line">.git</span><br><span class="line">├── COMMIT_EDITMSG</span><br><span class="line">├── HEAD</span><br><span class="line">├── config</span><br><span class="line">├── description</span><br><span class="line">├── index</span><br><span class="line">├── info</span><br><span class="line">│   └── exclude</span><br><span class="line">├── logs</span><br><span class="line">│   ├── HEAD</span><br><span class="line">│   └── refs</span><br><span class="line">│       └── heads</span><br><span class="line">│           └── master</span><br><span class="line">├── objects</span><br><span class="line">│   ├── 03</span><br><span class="line">│   │   └── 3fa1ab71f0d54f348f07a3a0ffcefd52804df5</span><br><span class="line">│   ├── 28</span><br><span class="line">│   │   └── baf4f77fb49abf99c18bc1c12363d898f3ced7</span><br><span class="line">│   ├── 2c</span><br><span class="line">│   │   └── affd90cd736e58f516e3988e3af84f5fa42b4f</span><br><span class="line">│   ├── a0</span><br><span class="line">│   │   └── cf709bc0991b5340080f944d02894dc1596d46</span><br><span class="line">│   ├── c1</span><br><span class="line">│   │   └── 067ba0a7ba51f937518c9bc051ea744ca748fe</span><br><span class="line">│   ├── c6</span><br><span class="line">│   │   └── b9e95b39b8cd8ead8bbf4b118104741017de1b</span><br><span class="line">│   ├── cc</span><br><span class="line">│   │   └── f88a6f1649213499841c33f9bb36d1d8756fb7</span><br><span class="line">│   ├── f3</span><br><span class="line">│   │   └── 954314c1026028e77ea3a765aadefa67b45195</span><br><span class="line">│   ├── info</span><br><span class="line">│   └── pack</span><br><span class="line">└── refs</span><br><span class="line">    ├── heads</span><br><span class="line">    │   └── master</span><br><span class="line">    └── tags</span><br><span class="line">        └── v0.0.1</span><br><span class="line"></span><br><span class="line">19 directories, 29 files</span><br></pre></td></tr></table></figure>
<p>查看一下master上的提交日志，刚刚提交内容在新的一行，与首次提交稍微有点差别，首次提交是commit (initial)。</p>
<p>还可以发现第二次提交的第一列和第一次提交的第二列一样，可以猜到，第一列指向上一次的提交对象。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/logs/refs/heads/master</span><br><span class="line">0000000000000000000000000000000000000000 033fa1ab71f0d54f348f07a3a0ffcefd52804df5 liuyanjie &lt;x@gmail.com&gt; 1527521894 +0800	commit (initial): First Commmit</span><br><span class="line">033fa1ab71f0d54f348f07a3a0ffcefd52804df5 28baf4f77fb49abf99c18bc1c12363d898f3ced7 liuyanjie &lt;x@gmail.com&gt; 1527524452 +0800	commit: add CHANGELOG.md and CONTRIBUTING.md files</span><br></pre></td></tr></table></figure>
<p>查看 <code>28ba</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 28ba</span><br><span class="line">tree 2caffd90cd736e58f516e3988e3af84f5fa42b4f</span><br><span class="line">parent 033fa1ab71f0d54f348f07a3a0ffcefd52804df5</span><br><span class="line">author liuyanjie &lt;x@gmail.com&gt; 1527524452 +0800</span><br><span class="line">committer liuyanjie &lt;x@gmail.com&gt; 1527524452 +0800</span><br><span class="line"></span><br><span class="line">add CHANGELOG.md and CONTRIBUTING.md files</span><br></pre></td></tr></table></figure>
<p>相比 <code>033f</code>，<code>28ba</code> 多了 parent 字段 且 parent 字段值是 <code>033f</code></p>
<p>同时 <code>master</code> 也指向了新的提交对象。</p>
<p>第一次产生的提交对象同样存在于目录当中。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/refs/heads/master</span><br><span class="line">28baf4f77fb49abf99c18bc1c12363d898f3ced7</span><br></pre></td></tr></table></figure>
<p>在看树对象<code>2caf</code>，发现相比之前，多了两行，分别指向新增加的文件。</p>
<p><code>README.md</code> 文件出现在了 <code>2caf</code> 对象中，实际上，它同时还存在于 <code>c106</code> 对象中。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 2caf</span><br><span class="line">100644 blob a0cf709bc0991b5340080f944d02894dc1596d46	CHANGELOG.md</span><br><span class="line">100644 blob c6b9e95b39b8cd8ead8bbf4b118104741017de1b	CONTRIBUTING.md</span><br><span class="line">100644 blob f3954314c1026028e77ea3a765aadefa67b45195	README.md</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p c106</span><br><span class="line">100644 blob f3954314c1026028e77ea3a765aadefa67b45195	README.md</span><br></pre></td></tr></table></figure>
<p>到现在为止，整个目录下有3个文件，而 <code>.git</code> 目录下已经有多个文件，为了跟踪记录版本。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">CHANGELOG.md CONTRIBUTING.md README.md</span><br></pre></td></tr></table></figure>
<p>通过以上 <code>.git</code> 目录变化，可以发现：</p>
<p>每次提交都会产出一 <code>commit</code> 对象，这些 <code>commit</code> 通过 <code>parent</code>，形成一个由高版本到低版本的链表，追溯这个链表，可以回溯到任意版本。</p>
<p><code>commit</code> 对象保存一个 <code>tree</code> 的根节点，根节点下面再包含 <code>blob</code> 或 <code>tree</code>，类似普通文件系统结构，和上面的图一致，从根节点开始，可以找到某一般版本下的所有文件。</p>
<p>在每一颗树下，因为都是使用类似指针的结构，所以每次修改都是将变化的文件，重新创建一个blob文件，并修改相应指针。</p>
<p>目录中的 <code>.git/refs/heads/master</code> 指向某一次提交，当由另外一个分支的时候，会有 <code>.git/refs/heads/branch-xxx</code> 文件指向另外一次提交，而初始时与父分支指向相同。</p>
<h3 id="再添加一个带有目录文件"><a href="#再添加一个带有目录文件" class="headerlink" title="再添加一个带有目录文件"></a>再添加一个带有目录文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir lib</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"// Author: liuyanjie"</span> &gt; ./lib/index.js</span><br><span class="line"></span><br><span class="line">$ git add lib/index.js</span><br><span class="line"></span><br><span class="line">$ git commit -m <span class="string">"add lib/index.js"</span> lib/index.js</span><br><span class="line">[master 2b9fc85] add lib/index.js</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 lib/index.js</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 2b9fc85</span><br><span class="line">tree 9609811e44367d44f2915435f4454716e1e535fd</span><br><span class="line">parent 28baf4f77fb49abf99c18bc1c12363d898f3ced7</span><br><span class="line">author liuyanjie &lt;x@gmail.com&gt; 1527556745 +0800</span><br><span class="line">committer liuyanjie &lt;x@gmail.com&gt; 1527556745 +0800</span><br><span class="line"></span><br><span class="line">add lib/index.js</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 9609</span><br><span class="line">100644 blob a0cf709bc0991b5340080f944d02894dc1596d46	CHANGELOG.md</span><br><span class="line">100644 blob c6b9e95b39b8cd8ead8bbf4b118104741017de1b	CONTRIBUTING.md</span><br><span class="line">100644 blob f3954314c1026028e77ea3a765aadefa67b45195	README.md</span><br><span class="line">040000 tree 2fb9045bb558889ea2bd8cc5d8fe45e7247706da	lib</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 2fb9</span><br><span class="line">100644 blob 39a204af28de9b4f0411735e597e0da7416ca35a	index.js</span><br></pre></td></tr></table></figure>
<p>上面连续几步和之前的效果一样，但是可以看到，在树对象 <code>9609</code> 中，包含了另一个树对象 <code>2fb9</code> ，这个对象的内容指向<code>index.js</code>文件。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/logs/refs/heads/master</span><br><span class="line">0000000000000000000000000000000000000000 033fa1ab71f0d54f348f07a3a0ffcefd52804df5 liuyanjie &lt;x@gmail.com&gt; 1527521894 +0800	commit (initial): First Commmit</span><br><span class="line">033fa1ab71f0d54f348f07a3a0ffcefd52804df5 28baf4f77fb49abf99c18bc1c12363d898f3ced7 liuyanjie &lt;x@gmail.com&gt; 1527524452 +0800	commit: add CHANGELOG.md and CONTRIBUTING.md files</span><br><span class="line">28baf4f77fb49abf99c18bc1c12363d898f3ced7 2b9fc8524bac21d5d5c2f988b5793315ce93abc6 liuyanjie &lt;x@gmail.com&gt; 1527556745 +0800	commit: add lib/index.js</span><br></pre></td></tr></table></figure>
<p>git log</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">commit 2b9fc8524bac21d5d5c2f988b5793315ce93abc6 (HEAD -&gt; master)</span><br><span class="line">Author: liuyanjie &lt;x@gmail.com&gt;</span><br><span class="line">Date:   Tue May 29 09:19:05 2018 +0800</span><br><span class="line"></span><br><span class="line">    add lib/index.js</span><br><span class="line"></span><br><span class="line">commit 28baf4f77fb49abf99c18bc1c12363d898f3ced7</span><br><span class="line">Author: liuyanjie &lt;x@gmail.com&gt;</span><br><span class="line">Date:   Tue May 29 00:20:52 2018 +0800</span><br><span class="line"></span><br><span class="line">    add CHANGELOG.md and CONTRIBUTING.md files</span><br><span class="line"></span><br><span class="line">commit 033fa1ab71f0d54f348f07a3a0ffcefd52804df5 (tag: v0.0.1)</span><br><span class="line">Author: liuyanjie &lt;x@gmail.com&gt;</span><br><span class="line">Date:   Mon May 28 23:38:14 2018 +0800</span><br><span class="line"></span><br><span class="line">    First Commmit</span><br></pre></td></tr></table></figure>
<h3 id="开始创建分支"><a href="#开始创建分支" class="headerlink" title="开始创建分支"></a>开始创建分支</h3><p>创建并切换到分支 <code>feature-a</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -v</span><br><span class="line"></span><br><span class="line">* master 2b9fc85 add lib/index.js</span><br><span class="line"></span><br><span class="line">$ git checkout -b feature<span class="_">-a</span></span><br><span class="line">Switched to a new branch <span class="string">'feature-a'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># liuyanjie @ bmw in ~/git-obj-model on git:feature-a o [9:25:01]</span></span><br><span class="line">$ git branch -v</span><br><span class="line"></span><br><span class="line">* feature<span class="_">-a</span> 2b9fc85 add lib/index.js</span><br><span class="line">  master    2b9fc85 add lib/index.js</span><br><span class="line"></span><br><span class="line">$ git status</span><br><span class="line">On branch feature<span class="_">-a</span></span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">$ tree .git</span><br><span class="line">.git</span><br><span class="line">├── COMMIT_EDITMSG</span><br><span class="line">├── HEAD</span><br><span class="line">├── config</span><br><span class="line">├── description</span><br><span class="line">├── index</span><br><span class="line">├── info</span><br><span class="line">│   └── exclude</span><br><span class="line">├── logs</span><br><span class="line">│   ├── HEAD</span><br><span class="line">│   └── refs</span><br><span class="line">│       └── heads</span><br><span class="line">│           ├── feature<span class="_">-a</span></span><br><span class="line">│           └── master</span><br><span class="line">├── objects</span><br><span class="line">│   ├── 03</span><br><span class="line">│   │   └── 3fa1ab71f0d54f348f07a3a0ffcefd52804df5</span><br><span class="line">│   ├── 28</span><br><span class="line">│   │   └── baf4f77fb49abf99c18bc1c12363d898f3ced7</span><br><span class="line">│   ├── 2b</span><br><span class="line">│   │   └── 9fc8524bac21d5d5c2f988b5793315ce93abc6</span><br><span class="line">│   ├── 2c</span><br><span class="line">│   │   └── affd90cd736e58f516e3988e3af84f5fa42b4f</span><br><span class="line">│   ├── 2f</span><br><span class="line">│   │   └── b9045bb558889ea2bd8cc5d8fe45e7247706da</span><br><span class="line">│   ├── 39</span><br><span class="line">│   │   └── a204af28de9b4f0411735e597e0da7416ca35a</span><br><span class="line">│   ├── 96</span><br><span class="line">│   │   └── 09811e44367d44f2915435f4454716e1e535fd</span><br><span class="line">│   ├── a0</span><br><span class="line">│   │   └── cf709bc0991b5340080f944d02894dc1596d46</span><br><span class="line">│   ├── c1</span><br><span class="line">│   │   └── 067ba0a7ba51f937518c9bc051ea744ca748fe</span><br><span class="line">│   ├── c6</span><br><span class="line">│   │   └── b9e95b39b8cd8ead8bbf4b118104741017de1b</span><br><span class="line">│   ├── cc</span><br><span class="line">│   │   └── f88a6f1649213499841c33f9bb36d1d8756fb7</span><br><span class="line">│   ├── f3</span><br><span class="line">│   │   └── 954314c1026028e77ea3a765aadefa67b45195</span><br><span class="line">│   ├── info</span><br><span class="line">│   └── pack</span><br><span class="line">└── refs</span><br><span class="line">    ├── heads</span><br><span class="line">    │   ├── feature<span class="_">-a</span></span><br><span class="line">    │   └── master</span><br><span class="line">    └── tags</span><br><span class="line">        └── v0.0.1</span><br><span class="line"></span><br><span class="line">23 directories, 35 files</span><br></pre></td></tr></table></figure>
<p>看一下<code>.git</code>文件内容，可以看到<code>.git/refs/heads</code>目录下多了个<code>feature-a</code></p>
<p>查看一下 <code>feature-a</code> 的相关内容，指向的提交对象和 <code>master</code> 一样，并指明 <code>Created from HEAD</code>。</p>
<p>从内容中可以看出，两个分支指向同一个提交对象 <code>1ad0e5</code>，但是两个分支的日志不同。</p>
<p>日志记录了分支的历史，而提交对象记录了分支的数据内容和所有分支的历史。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/refs/heads/feature<span class="_">-a</span></span><br><span class="line">2b9fc8524bac21d5d5c2f988b5793315ce93abc6</span><br><span class="line"></span><br><span class="line">$ cat .git/refs/heads/master</span><br><span class="line">2b9fc8524bac21d5d5c2f988b5793315ce93abc6</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/logs/refs/heads/feature<span class="_">-a</span></span><br><span class="line">0000000000000000000000000000000000000000 2b9fc8524bac21d5d5c2f988b5793315ce93abc6 liuyanjie &lt;x@gmail.com&gt; 1527557101 +0800	branch: Created from HEAD</span><br><span class="line"></span><br><span class="line">$ cat .git/logs/refs/heads/master</span><br><span class="line">0000000000000000000000000000000000000000 033fa1ab71f0d54f348f07a3a0ffcefd52804df5 liuyanjie &lt;x@gmail.com&gt; 1527521894 +0800	commit (initial): First Commmit</span><br><span class="line">033fa1ab71f0d54f348f07a3a0ffcefd52804df5 28baf4f77fb49abf99c18bc1c12363d898f3ced7 liuyanjie &lt;x@gmail.com&gt; 1527524452 +0800	commit: add CHANGELOG.md and CONTRIBUTING.md files</span><br><span class="line">28baf4f77fb49abf99c18bc1c12363d898f3ced7 2b9fc8524bac21d5d5c2f988b5793315ce93abc6 liuyanjie &lt;x@gmail.com&gt; 1527556745 +0800	commit: add lib/index.js</span><br></pre></td></tr></table></figure>
<p>初始化<code>package.json</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm init</span><br><span class="line">Is this ok? (yes)</span><br></pre></td></tr></table></figure>
<p>安装 <code>bluebird</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ npm install bluebird --save</span><br><span class="line">npm notice created a lockfile as package-lock.json. You should commit this file.</span><br><span class="line">npm WARN git-obj-model@1.0.0 No description</span><br><span class="line">npm WARN git-obj-model@1.0.0 No repository field.</span><br><span class="line"></span><br><span class="line">+ bluebird@3.5.1</span><br><span class="line">added 1 package <span class="keyword">in</span> 1.999s</span><br></pre></td></tr></table></figure>
<p>添加文件到版本库，并查看变化。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git add package.json</span><br><span class="line"></span><br><span class="line">$ cat .git/refs/heads/feature<span class="_">-a</span></span><br><span class="line">2b9fc8524bac21d5d5c2f988b5793315ce93abc6</span><br><span class="line"></span><br><span class="line">$ cat .git/refs/heads/master</span><br><span class="line">2b9fc8524bac21d5d5c2f988b5793315ce93abc6</span><br></pre></td></tr></table></figure>
<p>提交文件到版本库，并查看变化，提交指针已经指向新的提交对象，分支的版本超前于master，因为parent指向<code>1ad0e5</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ git commit package.json -m <span class="string">'add package.json'</span></span><br><span class="line">[feature<span class="_">-a</span> 74ce192] add package.json</span><br><span class="line"> 1 file changed, 17 insertions(+)</span><br><span class="line"> create mode 100644 package.json</span><br><span class="line"></span><br><span class="line">$ cat .git/refs/heads/master</span><br><span class="line">2b9fc8524bac21d5d5c2f988b5793315ce93abc6</span><br><span class="line"></span><br><span class="line">$ cat .git/refs/heads/feature<span class="_">-a</span></span><br><span class="line">74ce19245be785772b33e1193df0d2c6a940ed10</span><br><span class="line"></span><br><span class="line">$ git cat-file -p 74ce</span><br><span class="line">tree 9d23f8ad2ecc9f8e49d78174bcc6e4668ca7f031</span><br><span class="line">parent 2b9fc8524bac21d5d5c2f988b5793315ce93abc6</span><br><span class="line">author liuyanjie &lt;x@gmail.com&gt; 1527557656 +0800</span><br><span class="line">committer liuyanjie &lt;x@gmail.com&gt; 1527557656 +0800</span><br><span class="line"></span><br><span class="line">add package.json</span><br><span class="line"></span><br><span class="line">$ git cat-file -p 9d23</span><br><span class="line">100644 blob a0cf709bc0991b5340080f944d02894dc1596d46	CHANGELOG.md</span><br><span class="line">100644 blob c6b9e95b39b8cd8ead8bbf4b118104741017de1b	CONTRIBUTING.md</span><br><span class="line">100644 blob f3954314c1026028e77ea3a765aadefa67b45195	README.md</span><br><span class="line">040000 tree 2fb9045bb558889ea2bd8cc5d8fe45e7247706da	lib</span><br><span class="line">100644 blob 5ee275ce022007c38d187c58aef13f8d9e04b553	package.json</span><br></pre></td></tr></table></figure>
<p>合并分支 <code>feature-a</code> 到 <code>master</code> 分支，可以看到 <code>master</code> 分支跟上了 <code>feature-a</code>，只改指针既可，非常快。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">Switched to branch <span class="string">'master'</span></span><br><span class="line"></span><br><span class="line">$ git merge feature<span class="_">-a</span> --no-ff</span><br><span class="line">Merge made by the <span class="string">'recursive'</span> strategy.</span><br><span class="line"> package.json | 17 +++++++++++++++++</span><br><span class="line"> 1 file changed, 17 insertions(+)</span><br><span class="line"> create mode 100644 package.json</span><br><span class="line"></span><br><span class="line">$ cat .git/refs/heads/master</span><br><span class="line">b98c36254dba6e169429c2be57b1bbeccb6e1f28</span><br><span class="line"></span><br><span class="line">$ cat .git/refs/heads/feature<span class="_">-a</span></span><br><span class="line">74ce19245be785772b33e1193df0d2c6a940ed10</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tig</span><br><span class="line"></span><br><span class="line">2018-05-29 09:37 liuyanjie M─┐ [master] Merge branch <span class="string">'feature-a'</span></span><br><span class="line">2018-05-29 09:34 liuyanjie │ o [feature<span class="_">-a</span>] add package.json</span><br><span class="line">2018-05-29 09:19 liuyanjie o─┘ add lib/index.js</span><br><span class="line">2018-05-29 00:20 liuyanjie o add CHANGELOG.md and CONTRIBUTING.md files</span><br><span class="line">2018-05-28 23:38 liuyanjie I &lt;v0.0.1&gt; First Commmit</span><br></pre></td></tr></table></figure>
<p>修改 <code>master</code> 分支，编辑文件并提交</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">Already on <span class="string">'master'</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> -e <span class="string">"\n\n# About"</span> &gt;&gt; README.md</span><br><span class="line"></span><br><span class="line">$ git commit README.md -m <span class="string">"add About Me"</span></span><br><span class="line">[master cc52745] add About Me</span><br><span class="line"> 1 file changed, 4 insertions(+)</span><br><span class="line"></span><br><span class="line">$ cat README.md</span><br><span class="line"><span class="comment"># Readme</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># About</span></span><br></pre></td></tr></table></figure>
<p>修改 <code>feature-a</code> 分支</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout feature<span class="_">-a</span></span><br><span class="line">Switched to branch <span class="string">'feature-a'</span></span><br><span class="line"></span><br><span class="line">$ cat README.md</span><br><span class="line"><span class="comment"># Readme</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> -e <span class="string">"\n\n# About"</span> &gt;&gt; README.md</span><br><span class="line"></span><br><span class="line">$ cat README.md</span><br><span class="line"><span class="comment"># Readme</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># About</span></span><br><span class="line"></span><br><span class="line">$ git add README.md</span><br><span class="line"></span><br><span class="line">$ git commit README.md -m <span class="string">"add About Me"</span></span><br><span class="line">[feature<span class="_">-a</span> fd885cf] add About Me</span><br><span class="line"> 1 file changed, 3 insertions(+)</span><br></pre></td></tr></table></figure>
<p>查看分支头和历史记录，可以看到分支头指向不同的提交对象，而提交对象，又来源于同一个提交对象<code>0cb214741c044af3fb4677fe72e3ae175f3e0358</code>，两个分支之间存在交叉。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/refs/heads/feature<span class="_">-a</span></span><br><span class="line">74ce19245be785772b33e1193df0d2c6a940ed10</span><br><span class="line"></span><br><span class="line">$ cat .git/refs/heads/master</span><br><span class="line">cc52745b13b00c672c7ac9b1dc42336953293b7a</span><br><span class="line"></span><br><span class="line">$ cat .git/logs/refs/heads/feature<span class="_">-a</span></span><br><span class="line">0000000000000000000000000000000000000000 2b9fc8524bac21d5d5c2f988b5793315ce93abc6 liuyanjie &lt;x@gmail.com&gt; 1527557101 +0800	branch: Created from HEAD</span><br><span class="line">2b9fc8524bac21d5d5c2f988b5793315ce93abc6 74ce19245be785772b33e1193df0d2c6a940ed10 liuyanjie &lt;x@gmail.com&gt; 1527557656 +0800	commit: add package.json</span><br><span class="line">74ce19245be785772b33e1193df0d2c6a940ed10 fd885cfcd548a24fabb2f5b49ea60beadc8c5912 liuyanjie &lt;x@gmail.com&gt; 1527558668 +0800	commit: add About Me</span><br><span class="line"></span><br><span class="line">$ cat .git/logs/refs/heads/master</span><br><span class="line">0000000000000000000000000000000000000000 033fa1ab71f0d54f348f07a3a0ffcefd52804df5 liuyanjie &lt;x@gmail.com&gt; 1527521894 +0800	commit (initial): First Commmit</span><br><span class="line">033fa1ab71f0d54f348f07a3a0ffcefd52804df5 28baf4f77fb49abf99c18bc1c12363d898f3ced7 liuyanjie &lt;x@gmail.com&gt; 1527524452 +0800	commit: add CHANGELOG.md and CONTRIBUTING.md files</span><br><span class="line">28baf4f77fb49abf99c18bc1c12363d898f3ced7 2b9fc8524bac21d5d5c2f988b5793315ce93abc6 liuyanjie &lt;x@gmail.com&gt; 1527556745 +0800	commit: add lib/index.js</span><br><span class="line">2b9fc8524bac21d5d5c2f988b5793315ce93abc6 b98c36254dba6e169429c2be57b1bbeccb6e1f28 liuyanjie &lt;x@gmail.com&gt; 1527557853 +0800	merge feature<span class="_">-a</span>: Merge made by the <span class="string">'recursive'</span> strategy.</span><br><span class="line">b98c36254dba6e169429c2be57b1bbeccb6e1f28 cc52745b13b00c672c7ac9b1dc42336953293b7a liuyanjie &lt;x@gmail.com&gt; 1527558514 +0800	commit: add About Me</span><br></pre></td></tr></table></figure>
<p>切换到 <code>master</code> 分支，再次合并 <code>feature-a</code> 到 <code>master</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">Switched to branch <span class="string">'master'</span></span><br><span class="line"></span><br><span class="line">$ git merge feature<span class="_">-a</span></span><br><span class="line">Auto-merging README.md</span><br><span class="line">CONFLICT (content): Merge conflict <span class="keyword">in</span> README.md</span><br><span class="line">Automatic merge failed; fix conflicts and <span class="keyword">then</span> commit the result.</span><br><span class="line"></span><br><span class="line">$ cat README.md</span><br><span class="line"><span class="comment"># Readme</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line"><span class="comment">## About</span></span><br><span class="line"></span><br><span class="line">=======</span><br><span class="line"><span class="comment">## About</span></span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; feature<span class="_">-a</span></span><br></pre></td></tr></table></figure>
<p>解决冲突之后的文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat README.md</span><br><span class="line"><span class="comment"># Readme</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## About</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">You have unmerged paths.</span><br><span class="line">  (fix conflicts and run <span class="string">"git commit"</span>)</span><br><span class="line">  (use <span class="string">"git merge --abort"</span> to abort the merge)</span><br><span class="line"></span><br><span class="line">Unmerged paths:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to mark resolution)</span><br><span class="line"></span><br><span class="line">	both modified:   README.md</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git commit README.md -m <span class="string">'fix conflict'</span></span><br><span class="line">fatal: cannot <span class="keyword">do</span> a partial commit during a merge.</span><br><span class="line"></span><br><span class="line">$ git commit -a</span><br><span class="line">[master 5a68c74] Merge branch <span class="string">'feature-a'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/refs/heads/feature<span class="_">-a</span></span><br><span class="line">fd885cfcd548a24fabb2f5b49ea60beadc8c5912</span><br><span class="line"></span><br><span class="line">$ cat .git/refs/heads/master</span><br><span class="line">5a68c7402c30ae44fd82dadba2d8f148efb75541</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/logs/refs/heads/master</span><br><span class="line">0000000000000000000000000000000000000000 033fa1ab71f0d54f348f07a3a0ffcefd52804df5 liuyanjie &lt;x@gmail.com&gt; 1527521894 +0800	commit (initial): First Commmit</span><br><span class="line">033fa1ab71f0d54f348f07a3a0ffcefd52804df5 28baf4f77fb49abf99c18bc1c12363d898f3ced7 liuyanjie &lt;x@gmail.com&gt; 1527524452 +0800	commit: add CHANGELOG.md and CONTRIBUTING.md files</span><br><span class="line">28baf4f77fb49abf99c18bc1c12363d898f3ced7 2b9fc8524bac21d5d5c2f988b5793315ce93abc6 liuyanjie &lt;x@gmail.com&gt; 1527556745 +0800	commit: add lib/index.js</span><br><span class="line">2b9fc8524bac21d5d5c2f988b5793315ce93abc6 b98c36254dba6e169429c2be57b1bbeccb6e1f28 liuyanjie &lt;x@gmail.com&gt; 1527557853 +0800	merge feature<span class="_">-a</span>: Merge made by the <span class="string">'recursive'</span> strategy.</span><br><span class="line">b98c36254dba6e169429c2be57b1bbeccb6e1f28 cc52745b13b00c672c7ac9b1dc42336953293b7a liuyanjie &lt;x@gmail.com&gt; 1527558514 +0800	commit: add About Me</span><br><span class="line">cc52745b13b00c672c7ac9b1dc42336953293b7a 5a68c7402c30ae44fd82dadba2d8f148efb75541 liuyanjie &lt;x@gmail.com&gt; 1527559277 +0800	commit (merge): Merge branch <span class="string">'feature-a'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ git merge --<span class="built_in">stat</span> feature<span class="_">-a</span></span><br><span class="line">Already up to date.</span><br><span class="line"></span><br><span class="line">$ git branch -d feature<span class="_">-a</span></span><br><span class="line">Deleted branch feature<span class="_">-a</span> (was fd885cf).</span><br><span class="line"></span><br><span class="line">$ git branch</span><br><span class="line"></span><br><span class="line">$ git cat-file -p fd88</span><br><span class="line">tree 82e47e13f87031cab7c47b455744bc4ed3fdba3c</span><br><span class="line">parent 74ce19245be785772b33e1193df0d2c6a940ed10</span><br><span class="line">author liuyanjie &lt;x@gmail.com&gt; 1527558668 +0800</span><br><span class="line">committer liuyanjie &lt;x@gmail.com&gt; 1527558668 +0800</span><br><span class="line"></span><br><span class="line">add About Me</span><br><span class="line"></span><br><span class="line">$ git cat-file -p 5a68</span><br><span class="line">tree 42564bab966d59e3501a1903c1cb2066adc2bd2d</span><br><span class="line">parent cc52745b13b00c672c7ac9b1dc42336953293b7a</span><br><span class="line">parent fd885cfcd548a24fabb2f5b49ea60beadc8c5912</span><br><span class="line">author liuyanjie &lt;x@gmail.com&gt; 1527559277 +0800</span><br><span class="line">committer liuyanjie &lt;x@gmail.com&gt; 1527559277 +0800</span><br><span class="line"></span><br><span class="line">Merge branch <span class="string">'feature-a'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --graph --all --pretty=format:<span class="string">'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset'</span> --abbrev-commit --date=relative</span><br><span class="line">*   5a68c74 - (HEAD -&gt; master) Merge branch <span class="string">'feature-a'</span> (7 minutes ago) &lt;liuyanjie&gt;</span><br><span class="line">|\</span><br><span class="line">| * fd885cf - add About Me (17 minutes ago) &lt;liuyanjie&gt;</span><br><span class="line">* | cc52745 - add About Me (20 minutes ago) &lt;liuyanjie&gt;</span><br><span class="line">* |   b98c362 - Merge branch <span class="string">'feature-a'</span> (31 minutes ago) &lt;liuyanjie&gt;</span><br><span class="line">|\ \</span><br><span class="line">| |/</span><br><span class="line">| * 74ce192 - add package.json (34 minutes ago) &lt;liuyanjie&gt;</span><br><span class="line">|/</span><br><span class="line">* 2b9fc85 - add lib/index.js (49 minutes ago) &lt;liuyanjie&gt;</span><br><span class="line">* 28baf4f - add CHANGELOG.md and CONTRIBUTING.md files (10 hours ago) &lt;liuyanjie&gt;</span><br><span class="line">* 033fa1a - (tag: v0.0.1) First Commmit (11 hours ago) &lt;liuyanjie&gt;</span><br></pre></td></tr></table></figure>
<p>配置命令别名</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global alias.lg <span class="string">"log --graph --all --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit --date=relative"</span></span><br><span class="line">git lg</span><br></pre></td></tr></table></figure>
<h3 id="打标签"><a href="#打标签" class="headerlink" title="打标签"></a>打标签</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -a v0.0.2 -m <span class="string">"v0.0.2"</span></span><br><span class="line">v0.0.1</span><br><span class="line">v0.0.2</span><br><span class="line"></span><br><span class="line">$ cat .git/refs/tags/v0.0.2</span><br><span class="line">174c530154ab3b4d4d322bcbd66cdde18882eb00</span><br><span class="line"></span><br><span class="line">$ git cat-file -p 174c</span><br><span class="line">object 5a68c7402c30ae44fd82dadba2d8f148efb75541</span><br><span class="line"><span class="built_in">type</span> commit</span><br><span class="line">tag v0.0.2</span><br><span class="line">tagger liuyanjie &lt;x@gmail.com&gt; 1527559851 +0800</span><br><span class="line"></span><br><span class="line">v0.0.2</span><br><span class="line"></span><br><span class="line">$ git cat-file -p 5a68</span><br><span class="line">tree 42564bab966d59e3501a1903c1cb2066adc2bd2d</span><br><span class="line">parent cc52745b13b00c672c7ac9b1dc42336953293b7a</span><br><span class="line">parent fd885cfcd548a24fabb2f5b49ea60beadc8c5912</span><br><span class="line">author liuyanjie &lt;x@gmail.com&gt; 1527559277 +0800</span><br><span class="line">committer liuyanjie &lt;x@gmail.com&gt; 1527559277 +0800</span><br><span class="line"></span><br><span class="line">Merge branch <span class="string">'feature-a'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">$ tree .git</span><br><span class="line">.git</span><br><span class="line">├── COMMIT_EDITMSG</span><br><span class="line">├── HEAD</span><br><span class="line">├── ORIG_HEAD</span><br><span class="line">├── co.gitup.mac</span><br><span class="line">│   ├── cache.db</span><br><span class="line">│   ├── info.plist</span><br><span class="line">│   └── snapshots.data</span><br><span class="line">├── config</span><br><span class="line">├── description</span><br><span class="line">├── hooks</span><br><span class="line">│   ├── applypatch-msg.sample</span><br><span class="line">│   ├── commit-msg.sample</span><br><span class="line">│   ├── fsmonitor-watchman.sample</span><br><span class="line">│   ├── post-update.sample</span><br><span class="line">│   ├── pre-applypatch.sample</span><br><span class="line">│   ├── pre-commit.sample</span><br><span class="line">│   ├── pre-push.sample</span><br><span class="line">│   ├── pre-rebase.sample</span><br><span class="line">│   ├── pre-receive.sample</span><br><span class="line">│   ├── prepare-commit-msg.sample</span><br><span class="line">│   └── update.sample</span><br><span class="line">├── index</span><br><span class="line">├── info</span><br><span class="line">│   └── exclude</span><br><span class="line">├── logs</span><br><span class="line">│   ├── HEAD</span><br><span class="line">│   └── refs</span><br><span class="line">│       └── heads</span><br><span class="line">│           └── master</span><br><span class="line">├── objects</span><br><span class="line">│   ├── 03</span><br><span class="line">│   │   └── 3fa1ab71f0d54f348f07a3a0ffcefd52804df5</span><br><span class="line">│   ├── 17</span><br><span class="line">│   │   └── 4c530154ab3b4d4d322bcbd66cdde18882eb00</span><br><span class="line">│   ├── 28</span><br><span class="line">│   │   └── baf4f77fb49abf99c18bc1c12363d898f3ced7</span><br><span class="line">│   ├── 2b</span><br><span class="line">│   │   └── 9fc8524bac21d5d5c2f988b5793315ce93abc6</span><br><span class="line">│   ├── 2c</span><br><span class="line">│   │   └── affd90cd736e58f516e3988e3af84f5fa42b4f</span><br><span class="line">│   ├── 2f</span><br><span class="line">│   │   └── b9045bb558889ea2bd8cc5d8fe45e7247706da</span><br><span class="line">│   ├── 30</span><br><span class="line">│   │   └── be8054b61a4a124e4cd8a1201de8474cb45e12</span><br><span class="line">│   ├── 39</span><br><span class="line">│   │   └── a204af28de9b4f0411735e597e0da7416ca35a</span><br><span class="line">│   ├── 42</span><br><span class="line">│   │   └── 564bab966d59e3501a1903c1cb2066adc2bd2d</span><br><span class="line">│   ├── 44</span><br><span class="line">│   │   └── 2b821b9b4acb5b0e632042542b3b29e2cf721e</span><br><span class="line">│   ├── 48</span><br><span class="line">│   │   └── 1cab7467cdb697bf7affdba0f2a5673a03366d</span><br><span class="line">│   ├── 5a</span><br><span class="line">│   │   └── 68c7402c30ae44fd82dadba2d8f148efb75541</span><br><span class="line">│   ├── 5e</span><br><span class="line">│   │   └── e275ce022007c38d187c58aef13f8d9e04b553</span><br><span class="line">│   ├── 74</span><br><span class="line">│   │   └── ce19245be785772b33e1193df0d2c6a940ed10</span><br><span class="line">│   ├── 82</span><br><span class="line">│   │   └── e47e13f87031cab7c47b455744bc4ed3fdba3c</span><br><span class="line">│   ├── 96</span><br><span class="line">│   │   └── 09811e44367d44f2915435f4454716e1e535fd</span><br><span class="line">│   ├── 9d</span><br><span class="line">│   │   └── 23f8ad2ecc9f8e49d78174bcc6e4668ca7f031</span><br><span class="line">│   ├── a0</span><br><span class="line">│   │   └── cf709bc0991b5340080f944d02894dc1596d46</span><br><span class="line">│   ├── b9</span><br><span class="line">│   │   └── 8c36254dba6e169429c2be57b1bbeccb6e1f28</span><br><span class="line">│   ├── c1</span><br><span class="line">│   │   └── 067ba0a7ba51f937518c9bc051ea744ca748fe</span><br><span class="line">│   ├── c6</span><br><span class="line">│   │   └── b9e95b39b8cd8ead8bbf4b118104741017de1b</span><br><span class="line">│   ├── cc</span><br><span class="line">│   │   ├── 52745b13b00c672c7ac9b1dc42336953293b7a</span><br><span class="line">│   │   └── f88a6f1649213499841c33f9bb36d1d8756fb7</span><br><span class="line">│   ├── f3</span><br><span class="line">│   │   └── 954314c1026028e77ea3a765aadefa67b45195</span><br><span class="line">│   ├── fd</span><br><span class="line">│   │   └── 885cfcd548a24fabb2f5b49ea60beadc8c5912</span><br><span class="line">│   ├── info</span><br><span class="line">│   └── pack</span><br><span class="line">└── refs</span><br><span class="line">    ├── heads</span><br><span class="line">    │   └── master</span><br><span class="line">    └── tags</span><br><span class="line">        ├── v0.0.1</span><br><span class="line">        └── v0.0.2</span><br><span class="line"></span><br><span class="line">36 directories, 51 files</span><br></pre></td></tr></table></figure>
<p><a href="https://stackoverflow.com/questions/964876/head-and-orig-head-in-git" target="_blank" rel="noopener">https://stackoverflow.com/questions/964876/head-and-orig-head-in-git</a></p>
<p>.git/HEAD 指明了当前活跃分支是哪个分支</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/HEAD</span><br><span class="line">ref: refs/heads/master</span><br></pre></td></tr></table></figure>
<p><a href="images/git-obj-model.svg">svg版</a></p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/vcs/git/images/git-obj-model.png" alt="git-obj-model"></p>
<p>源文件地址：<a href="https://github.com/liuyanjie/knowledge/tree/master/vcs/git/git-object-model.md" target="_blank" rel="noopener">https://github.com/liuyanjie/knowledge/tree/master/vcs/git/git-object-model.md</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="/posts/JavaScript深入理解-执行上下文/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lyj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyj's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/posts/JavaScript深入理解-执行上下文/" class="post-title-link" itemprop="url">JavaScript深入理解-执行上下文</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-05-02 08:00:00" itemprop="dateCreated datePublished" datetime="2018-05-02T08:00:00+08:00">2018-05-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-29 00:24:16" itemprop="dateModified" datetime="2018-12-29T00:24:16+08:00">2018-12-29</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Language/" itemprop="url" rel="index"><span itemprop="name">Language</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Language/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/JavaScript深入理解-执行上下文/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/JavaScript深入理解-执行上下文/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">17k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">15 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Focus on concepts，not syntax.</p>
<p>关注概念的理解，而不是语法。</p>
<h2 id="执行上下文堆栈"><a href="#执行上下文堆栈" class="headerlink" title="执行上下文堆栈"></a>执行上下文堆栈</h2><ul>
<li>EC(执行环境或者执行上下文，Execution Context)</li>
<li>ECS(执行环境堆栈或者执行上下文堆栈，Execution Context Stack)</li>
<li>VO(变量对象，Variable Object)</li>
<li>AO(活动对象，Active Object)</li>
<li>ScopeChain(作用域链)和 <code>[[scope]]</code> 属性</li>
</ul>
<p>有三种类型的ECMAScript代码：</p>
<p><code>全局代码</code>、<code>函数代码</code>、<code>eval代码</code></p>
<ul>
<li>每个代码是在其执行上下文（EC）中被求值的。</li>
<li>全局上下文只有一个，可能有多个函数执行上下文以及 <code>eval</code> 执行上下文。</li>
<li>对一个函数的每次调用，会进入到函数执行上下文中，并对函数代码类型进行求值。</li>
<li>每次对 <code>eval</code> 函数进行调用，会进入 <code>eval</code> 执行上下文并对其代码进行求值。</li>
</ul>
<blockquote>
<p>注意，一个函数可能会创建无数的上下文，因为对函数的每次调用（即使这个函数递归的调用自己）都会生成一个具有新状态的上下文：</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">bar</span>) </span>&#123;&#125;</span><br><span class="line"><span class="comment">// call the same function,</span></span><br><span class="line"><span class="comment">// generate three different contexts in each call,</span></span><br><span class="line"><span class="comment">// with different context state (e.g. value of the "bar" argument)</span></span><br><span class="line">foo(<span class="number">10</span>);</span><br><span class="line">foo(<span class="number">20</span>);</span><br><span class="line">foo(<span class="number">30</span>);</span><br></pre></td></tr></table></figure>
<p>一个 <code>执行上下文(EC)</code> 可能会触发另一个 <code>执行上下文(EC)</code>，如，一个函数调用另一个函数。从逻辑上来说，这是以栈的形式实现的，它叫作 <code>执行上下文栈(ECS)</code>。</p>
<p>一个触发其他上下文的上下文叫作 <code>caller</code>，被触发的上下文叫作 <code>callee</code>，<code>callee</code> 在同一时间可能是一些其他 <code>callee</code> 的 <code>caller</code>。</p>
<p>当一个 <code>caller</code> 触发（调用）了一个 <code>callee</code> ，这个 <code>caller</code> 会暂缓自身的执行，然后把控制权传递给 <code>callee</code>，控制权转移。</p>
<p>这个 <code>callee</code> 被push到 <code>执行上下文栈(ECS)</code> 中，并成为一个 <code>活动的</code> <code>执行上下文</code>，在 <code>callee</code> 的上下文结束后（<code>callee</code> 可能简单的返回或者由于异常而退出，一个抛出的但没有被捕获的异常可能退出一个或者多个上下文），它会把控制权返回给 <code>caller</code>，然后 <code>caller</code> 的上下文继续执行直到它结束，以此类推。</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/caller" target="_blank" rel="noopener">Caller</a></p>
<blockquote>
<p>function.caller[Non-standard]<br>The function.caller property returns the function that invoked the specified function.<br>If the function f was invoked by the top level code, the value of f.caller is null, otherwise it’s the function that called f.<br>This property replaces the obsolete arguments.caller property of the arguments object.<br>The special property <code>__caller__</code>, which returned the activation object of the caller thus allowing to reconstruct the stack, was removed for security reasons.</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>) </span>&#123; g(n - <span class="number">1</span>); &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params">n</span>) </span>&#123; <span class="keyword">if</span> (n &gt; <span class="number">0</span>) &#123; f(n); &#125; <span class="keyword">else</span> &#123; stop(); &#125; &#125;</span><br><span class="line">f(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// f(2) -&gt; g(1) -&gt; f(1) -&gt; g(0) -&gt; stop()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// stop.caller === g &amp;&amp; f.caller === g &amp;&amp; g.caller === f</span></span><br></pre></td></tr></table></figure>
<p>Example:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trace</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> f = trace, stack = <span class="string">'Stack trace:'</span>;</span><br><span class="line">  <span class="keyword">while</span> (f) &#123;</span><br><span class="line">    stack += <span class="string">'\n'</span> + f.name;</span><br><span class="line">    f = f.caller;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> stack;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> trace(); &#125;</span><br><span class="line"><span class="keyword">var</span> stacks = myFunc();</span><br><span class="line"><span class="built_in">console</span>.log(stacks);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> myFunc(); &#125;</span><br><span class="line"><span class="keyword">var</span> stacks = f();</span><br><span class="line"><span class="built_in">console</span>.log(stacks);</span><br></pre></td></tr></table></figure>
<p>下图是上面代码的函数调用链，对应于 <code>执行上下文(EC)</code>，在引擎层面，函数只是 <code>执行上下文</code> 的一个属性。</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/caller-chain.png" alt="caller-chain"></p>
<p>所有ECMAScript程序的运行时可以用 <code>执行上下文栈（ECS）</code> 来表示，栈顶是当前 <code>活动的执行上下文</code>：</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/ec-stack.png" alt="ec-stack"></p>
<p>当程序开始的时候它会进入 <code>全局执行上下文</code>，此上下文位于栈顶并且是栈中的第一个元素。然后全局代码进行一些 <code>初始化</code>。</p>
<p>当初始化完成之后，运行时系统就会等待一些事件，这些事件将会触发一些函数，从而进入新的执行上下文中。</p>
<p>在下个图中，拥有一个 <code>函数上下文 EC1</code> 和 <code>全局上下文 GlobalEC</code>，当 <code>EC1</code> 进入和退出全局上下文的时候下面的栈将会发生变化：</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/ec-stack-changes.png" alt="ec-stack-changes"></p>
<p>这就是 ECMAScript 的运行时系统如何真正地管理代码执行的。</p>
<p>栈中的每个 <code>执行上下文</code> 都可以用一个对象来表示。</p>
<p>让我们来看看它的结构以及一个上下文到底需要什么状态（属性）来执行它的代码。</p>
<h3 id="执行上下文"><a href="#执行上下文" class="headerlink" title="执行上下文"></a>执行上下文</h3><p>一个执行上下文可以抽象的表示为一个简单的对象。每一个执行上下文拥有一些属性（可以叫作上下文状态）用来跟踪或表示和它相关的代码的执行过程。</p>
<p>在下图中展示了一个上下文的结构：</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/execution-context.png" alt="execution-context"></p>
<p>除了这三个必需的属性 <code>变量/活动对象</code>、<code>作用域链</code>、<code>this</code> 之外，<code>执行上下文</code> 可以拥有其他状态，这取决于实现。</p>
<p>让我们详细看看上下文中的这些重要的属性。</p>
<h3 id="变量对象（variable-object）"><a href="#变量对象（variable-object）" class="headerlink" title="变量对象（variable object）"></a>变量对象（variable object）</h3><p><code>变量对象</code> 是与 <code>执行上下文</code> 相关的 <code>数据作用域</code>，所以也可以叫做 <code>作用域对象</code>。</p>
<p>它是一个与上下文相关的特殊对象，其中存储了在上下文中定义的 <code>变量</code> 和 <code>函数</code>。</p>
<blockquote>
<p>函数表达式（与函数声明相对）不包含在变量对象之中。</p>
</blockquote>
<p>变量对象是一个抽象概念。对于不同的上下文类型，在物理上，是使用不同的对象。</p>
<p>在全局上下文中变量对象就是全局对象本身，这就是为什么我们可以通过 <code>全局对象的属性名</code> 来关联 <code>“全局变量”</code>。</p>
<p>全局变量：</p>
<p>JavaScript中并不存在 <code>全局变量</code>，所谓的全局变量，不过是 <code>Global对象的一个属性</code>，叫 <code>全局属性</code> 还差不多，或者叫 <code>全局变量对象</code>，变量和属性虽然都是数据的引用方式，但是却有很大差别。</p>
<p>Example:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> global = global || <span class="built_in">window</span>;</span><br><span class="line">global.env = <span class="string">'production'</span>;</span><br><span class="line">NODE_ENV = <span class="string">'production'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(env);</span><br><span class="line"><span class="built_in">console</span>.log(global.NODE_ENV);</span><br><span class="line"><span class="comment">// 访问 全局属性 直接通过属性名就可以了。</span></span><br><span class="line"><span class="comment">// 这也是为什么被误称为 全局对象 的原因之一。</span></span><br></pre></td></tr></table></figure>
<p>让我们在全局执行上下文中考虑下面这个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;&#125;       <span class="comment">// function declaration, FD</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>) </span>&#123;&#125;);    <span class="comment">// function expression, FE</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>.foo == foo, <span class="built_in">window</span>.bar == bar);  <span class="comment">// true // true</span></span><br><span class="line"><span class="built_in">console</span>.log(baz);       <span class="comment">// ReferenceError, "baz" is not defined</span></span><br></pre></td></tr></table></figure>
<p>之后，全局上下文的 <code>变量对象</code> 将会拥有如下属性：</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/variable-object.png" alt="variable-object"></p>
<p>函数 <code>baz</code> 是一个函数表达式，没有被包含在变量对象之中。这就是为什么当我们想要在函数自身之外访问它的时候会出现 <code>ReferenceError</code>。</p>
<p>注意，与其他语言（比如C/C++）相比，在ECMAScript中只有函数可以创建一个新的作用域。在函数作用域中所定义的变量和内部函数在函数外边是不能直接访问到的，而且并不会污染全局变量对象。</p>
<p>使用 <code>eval</code> 我们也会进入一个新的执行上下文。无论如何，<code>eval</code> 使用全局的变量对象或者使用 <code>caller</code>（比如eval被调用时所在的函数）的变量对象。</p>
<p>那么函数和它的变量对象是怎么样的？</p>
<p>在函数上下文中，<code>变量对象</code> 是以 <code>活动对象</code> 来表示的。</p>
<p>为什么全局上下文中不需要 <code>活动对象</code>，而 <code>变量对象</code> 就是 <code>全局对象本身</code>？</p>
<p>因为 <code>全局上下文</code> 只有一个，用 <code>全局对象</code> 即可作为 <code>变量对象</code> 提供名字查找，而同一函数可能 会同时存在多个 <code>函数上下文</code>，每个上下文各不相同，且 <code>函数上下文</code> 与 <code>全局上下文</code> 又有不同，所以引入了 <code>活动对象</code> 来表示 <code>变量对象</code>。</p>
<h3 id="活动对象（activation-object）"><a href="#活动对象（activation-object）" class="headerlink" title="活动对象（activation object）"></a>活动对象（activation object）</h3><p>当一个函数被 <code>caller</code> 调用，一个特殊的对象，叫作 <code>活动对象</code>（activation object）将会被创建。</p>
<p>这个对象中包含 <code>形参</code> 和 <code>arguments</code> 对象（是对形参的一个映射，但是值是通过索引来获取）。</p>
<p><code>活动对象</code> 之后会做为函数上下文的 <code>变量对象</code> 来使用。</p>
<p>换句话说，函数的 <code>活动对象</code> 就是一个同样简单的 <code>变量对象</code>，但是除了 <code>变量</code> 和 <code>函数声明</code> 之外，它还存储了 <code>形参</code> 和 <code>arguments</code> 对象，并叫作 <code>活动对象</code>。</p>
<p>即：<code>活动对象</code> &lt;=&gt; <code>变量对象</code> + <code>形参</code> + <code>arguments</code> + <code>变量声明</code> + <code>函数声明</code></p>
<p>全局上下文中并没有 <code>形参</code>，更没有 <code>arguments</code>，所以和函数上下文不同，这是全局上下文和函数上下文的不同之一。</p>
<p>考虑如下例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> z = <span class="number">30</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;&#125;     <span class="comment">// FD</span></span><br><span class="line">  (<span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>) </span>&#123;&#125;);  <span class="comment">// FE</span></span><br><span class="line">&#125;</span><br><span class="line">foo(<span class="number">10</span>, <span class="number">20</span>);</span><br></pre></td></tr></table></figure>
<p>我们看下函数foo的上下文中的活动对象：</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/activation-object.png" alt="activation-object"></p>
<p>函数表达式baz还是没有被包含在 <code>变量/活动对象</code> 中。</p>
<p>在ES5中 <code>变量对象</code> 和 <code>活动对象</code> 被并入了 <code>词法环境模型</code>（lexical environments model）。</p>
<p>众所周知，在 ECMAScript 中我们可以使用内部函数，然后在这些内部函数中可以引用父函数的变量或者全局上下文中的变量。</p>
<p>当我们把 <code>变量对象</code> 命名为 执行上下文的 <code>作用域对象</code>，与上面讨论的原型链相似，作用域对象 可以 形成一条链，叫作 <code>作用域链</code>。</p>
<h3 id="作用域链-scope-chain"><a href="#作用域链-scope-chain" class="headerlink" title="作用域链(scope chain)"></a>作用域链(scope chain)</h3><p><code>作用域链</code> 是一个 <code>作用域对象</code>（即：<code>变量/活动对象</code>） 列表，代码中出现的标识符在这个列表中进行查找。</p>
<p>这个规则还是与原型链同样简单：</p>
<p>如果一个变量在函数自身的 <code>作用域对象</code>中没有找到，那么将会查找它父函数（外层函数）的 <code>作用域对象</code>，以此类推。</p>
<p>就上下文而言，标识符指的是：<code>变量名称、函数声明、形参</code> 等。</p>
<p>自由变量(free variables)：</p>
<p>当一个函数在其代码中引用一个不是 <code>局部变量</code>（或者局部函数或者一个形参）的标识符，那么这个标识符就叫作 <code>自由变量</code>，搜索这些 <code>自由变量</code> 正好就要用到 <code>作用域链</code>。</p>
<p>在通常情况下，<code>作用域链</code> 是一个包含所有 <code>caller的变量/活动对象</code> 加上（在作用域链头部的）<code>callee（自身）变量/活动对象</code> 的一个列表。</p>
<p>这个 <code>作用域链</code> 也可以包含任何其他对象，比如，在上下文执行过程中动态加入到作用域链中的对象－像 <code>with对象</code> 或者特殊的 <code>catch从句（catch-clauses）对象</code>。</p>
<p>当解析一个标识符的时候，会从作用域链中的 <code>变量对象</code> 开始查找，然后（如果这个标识符在函数自身的活动对象中没有被查找到）向作用域链的上一层查找－重复这个过程，就和原型链查找一样。</p>
<p>综上：<code>作用域链</code> 可以看作是 <code>变量对象链</code>。</p>
<p>我们可以假设通过隐式的 <code>__parent__</code> 属性 来和 <code>作用域链对象</code> 进行交互，这个属性指向作用域链中的下一个对象。</p>
<p>这个方案可能在真实的 Rhino 代码中经过了测试，并且这个技术很明确得被用于ES5的词法环境中（在那里被叫作outer连接）。</p>
<p>作用域链的另一个表现方式可以是一个简单的数组。利用 <code>__parent__</code> 概念，我们可以用下面的图来表现上面的例子（并且父变量对象存储在函数的 <code>[[Scope]]</code> 属性中）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">10</span>;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> y = <span class="number">20</span>;</span><br><span class="line">  (<span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> z = <span class="number">30</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(x + y + z);</span><br><span class="line">  &#125;)();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/scope-chain.png" alt="scope-chain"></p>
<p>在代码执行过程中，作用域链可以通过使用 <code>with语句</code> 和 <code>catch从句对象</code> 来增强。并且由于这些对象是简单的对象，它们可以拥有原型（和原型链）。</p>
<p>这个事实导致作用域链查找变为两个维度：</p>
<ol>
<li>首先是作用域链连接，然后</li>
<li>在每个作用域链连接上－深入作用域链连接的原型链（如果此连接拥有原型）。</li>
</ol>
<p>对于这个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.x = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> w = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">var</span> y = <span class="number">30</span>;</span><br><span class="line"><span class="comment">// in SpiderMonkey global object i.e. variable object of the global context inherits from "Object.prototype",</span></span><br><span class="line"><span class="comment">// 全局对象(global|window) 依然是 Object 对象的实例，所以会从 Object.prototype 继承 属性和方法</span></span><br><span class="line"><span class="comment">// so we may refer "not defined global variable x", which is found in the prototype chain</span></span><br><span class="line"><span class="built_in">console</span>.log(x); <span class="comment">// 10</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// "foo" local variables</span></span><br><span class="line">  <span class="keyword">var</span> w = <span class="number">40</span>;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">100</span>;</span><br><span class="line">  <span class="comment">// "x" is found in the "Object.prototype", because &#123;z: 50&#125; inherits from it</span></span><br><span class="line">  <span class="keyword">with</span> (&#123;<span class="attr">z</span>: <span class="number">50</span>&#125;) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(w, x, y, z); <span class="comment">// 40, 10, 30, 50 // 关键在这里</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// after "with" object is removed from the scope chain,</span></span><br><span class="line">  <span class="comment">// "x" is again found in the AO of "foo" context;</span></span><br><span class="line">  <span class="comment">// variable "w" is also local</span></span><br><span class="line">  <span class="built_in">console</span>.log(x, w); <span class="comment">// 100, 40</span></span><br><span class="line">  <span class="comment">// and that's how we may refer shadowed global "w" variable in the browser host environment</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">window</span>.w); <span class="comment">// 20</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>我们可以给出如下的结构：</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/scope-chain-with.png" alt="scope-chain-with"></p>
<blockquote>
<p>在 <code>GlobalVO</code> 向上查找时，会同时存在 <code>__parent__</code> 和 <code>__proto__</code>，即 <code>作用域链</code> 和 <code>原型链</code> 在引擎内部的表示对象上有了交点，在查找 <code>__parent__</code> 之前，首先查找 <code>__proto__</code> 链，此时，<code>作用域链</code> 已到达终点，也不需要继续查找。只在 <code>GlobalVO</code> <code>作用域链</code> 和 <code>原型链</code> 才会有交点。</p>
</blockquote>
<blockquote>
<p>注意，不是在所有的实现中 <code>全局对象</code> 都是继承自 <code>Object.prototype</code>，但是通常 是这样的。</p>
</blockquote>
<p>由于所有 <code>父变量对象</code> 都存在，所以在内部函数中获取父函数中的数据没有什么特别－就是遍历作用域链去搜寻需要的变量。</p>
<p>就像上边提及的，在一个上下文结束之后，它所有的状态和它自身都会被销毁，这个上下文（函数）可能会返回另一个函数，这个返回的函数之后可能在另一个上下文中被调用。<br>如果 <code>自由变量</code> 的上下文已经「消失」了，将会出现问题，有一个方式可以帮助我们解决这个问题，叫作 <code>闭包</code>，其在ECMAScript 中就是和 <code>作用域链</code> 的概念紧密相关的。</p>
<p>父函数上下文被销毁之后，为了满足子函数查找 <code>自由变量</code> 的需求，子函数在创建的时候，需要保存父函数的 <code>执行上下文</code>，保存的字段 叫 <code>[[Scope]]</code>，这一方式被称为 <code>闭包</code>。</p>
<h4 id="闭包（closure）"><a href="#闭包（closure）" class="headerlink" title="闭包（closure）"></a>闭包（closure）</h4><p>在 ECMAScript 中，函数是一级（<code>first-class</code>）对象。这意味着函数可以做为参数传递给其他函数 <code>「函数类型参数」（funargs）</code>。</p>
<p>接收 <code>「函数类型参数」</code> 的函数叫作 <code>高阶函数</code>。或者，贴近数学一些，叫作 <code>高阶操作符</code>。同样函数也可以返回一个函数，<code>「函数类型值」（funvals）</code>。</p>
<p>这有两个在概念上与 <code>「函数类型参数」</code> 和 <code>「函数类型值」</code> 相关的问题。</p>
<p>并且这两个子问题在 <code>Funarg problem</code> 中很普遍。为了解决整个 <code>Funarg problem</code>，<code>闭包</code> 的概念被创造了出来。</p>
<p><code>Funarg problem</code> 的第一个子问题是 <code>「向上funarg问题」</code>。它会在当一个函数从另一个函数中返回并且使用上面所提到的 <code>自由变量</code> 的时候出现。</p>
<p>为了在即使 <code>父函数上下文销毁</code> 的情况下也能访问其中的变量，内部函数在被创建的时候会在它的 <code>[[Scope]]</code> 属性中保存 <code>父函数的作用域链</code>。</p>
<p>所以当函数被调用的时候，它上下文的作用域链会被格式化成 <code>活动对象</code> 与 <code>[[Scope]]</code> 属性的和：</p>
<p><code>Scope chain = AO + [[Scope]]</code>。</p>
<p>函数在创建时会保存父函数的 <code>作用域链</code>，这个保存下来的 <code>作用域链</code> 将会在未来的函数调用时用来 <code>查找变量</code>。</p>
<p>如果从对象引用层面来理解，<code>[[Scope]]</code> 被另外一个对象（函数）引用，引擎不会回收这些资源，所以闭包容易带来内存泄漏的隐患。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// "foo" returns a function and this returned function uses free variable "x"</span></span><br><span class="line"><span class="keyword">var</span> returnedFunction = foo();</span><br><span class="line"><span class="comment">// global variable "x"</span></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">20</span>;</span><br><span class="line"><span class="comment">// execution of the returned function</span></span><br><span class="line">returnedFunction(); <span class="comment">// 10, but not 20</span></span><br></pre></td></tr></table></figure>
<p>这个类型的作用域叫作 <code>静态（或者词法）作用域</code>。我们看到 <code>变量x</code> 在返回的bar函数的 <code>[[Scope]]</code> 属性中被找到。</p>
<p>通常来说，也存在动态作用域，那么上面例子中的 <code>变量x</code> 将会被解析成 <code>20</code>，而不是 <code>10</code>。但是，动态作用域在 ECMAScript 中没有被使用。</p>
<p><code>Funarg problem</code> 的第二个子问题是 <code>「向下funarg问题」</code>。它会在当一个函数作为另一个函数的参数并且使用上面所提到的 <code>自由变量</code> 的时候出现。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// global "x"</span></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">10</span>;</span><br><span class="line"><span class="comment">// global function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">funArg</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// local "x"</span></span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">20</span>;</span><br><span class="line">  <span class="comment">// there is no ambiguity, because we use global "x", </span></span><br><span class="line">  <span class="comment">// which was statically saved in [[Scope]] of the "foo" function,</span></span><br><span class="line">  <span class="comment">// but not the "x" of the caller's scope, which activates the "funArg"</span></span><br><span class="line">  funArg(); <span class="comment">// 10, but not 20</span></span><br><span class="line">&#125;)(foo); <span class="comment">// pass "down" foo as a "funarg"</span></span><br></pre></td></tr></table></figure>
<p><code>词法作用域/静态作用域</code>：变量的作用域是在 <code>定义时</code> 决定而不是 <code>运行时</code> 决定，也就是说 <code>词法作用域</code> 取决于源码，通过静态分析就能确定，因此词法作用域也叫做静态作用域。<code>with</code> 和 <code>eval</code> 除外，所以只能说JS的作用域机制非常接近 <code>词法作用域（Lexical scope）</code>。</p>
<p>我们可以断定 <code>静态作用域</code> 是一门语言拥有 <code>闭包</code> 的必需条件。但是，一些语言可能会同时提供动态和静态作用域，允许程序员做选择－什么应该 <code>包含</code> 在内和什么不应包含在内。</p>
<p>由于在 ECMAScript 中只使用了 <code>静态作用域</code>，所以：ECMAScript 完全支持闭包，技术上是通过函数的 <code>[[Scope]]</code> 属性实现的。</p>
<p>现在我们可以给闭包下一个准确的定义：<a href="https://zh.wikipedia.org/wiki/闭包_(计算机科学" target="_blank" rel="noopener">闭包</a> )</p>
<p>在计算机科学中，闭包（英语：Closure），又称词法闭包（Lexical Closure）或函数闭包（function closures），是引用了自由变量的函数。<br>这个被引用的自由变量将和这个函数一同存在，即使已经离开了创造它的环境也不例外。<br>所以，有另一种说法认为闭包是由函数和与其相关的引用环境组合而成的实体。<br>闭包在运行时可以有多个实例，不同的引用环境和相同的函数组合可以产生不同的实例。</p>
<p>闭包是一个代码块（在ECMAScript是一个函数）和以 <code>静态方式</code>/<code>词法方式</code> 进行存储的所有父作用域的一个集合体。所以，通过这些存储的作用域，函数可以很容易的找到 <code>自由变量</code>。</p>
<p>闭包使得一个函数能够通过作用域链查找到另一个函数作用域中的变量。</p>
<p>闭包影响了作用域链，尤其是那些被销毁的上下文。</p>
<p>注意，由于每个（标准的）函数都在创建的时候保存了 <code>[[Scope]]</code>，所以理论上来讲，ECMAScript 中的所有函数都是闭包。</p>
<p>另一个需要注意的重要事情是，多个函数可能拥有相同的父作用域，比如当我们拥有两个内部/全局函数的时候。</p>
<p>在这种情况下，<code>[[Scope]]</code> 属性中存储的变量是在拥有相同父作用域链的所有函数之间共享的。</p>
<p>一个闭包对变量进行的修改会体现在另一个闭包对这些变量的读取上：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    foo: <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> ++x; &#125;,</span><br><span class="line">    bar: <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> --x; &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> closures = baz();</span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  closures.foo(), <span class="comment">// 2</span></span><br><span class="line">  closures.bar()  <span class="comment">// 1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/shared-scope.png" alt="shared-scope"></p>
<p>确切来说这个特性在循环中创建多个函数的时候会使人非常困惑。在创建的函数中使用循环计数器的时候，一些程序员经常会得到非预期的结果，所有函数中的计数器都是同样的值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; <span class="number">3</span>; k++) &#123;</span><br><span class="line">  data[k] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(k);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">data[<span class="number">0</span>](); <span class="comment">// 3, but not 0</span></span><br><span class="line">data[<span class="number">1</span>](); <span class="comment">// 3, but not 1</span></span><br><span class="line">data[<span class="number">2</span>](); <span class="comment">// 3, but not 2</span></span><br><span class="line"><span class="comment">// 这里有几种技术可以解决这个问题。</span></span><br><span class="line"><span class="comment">// 其中一种是在作用域链中提供一个额外的对象－比如，使用额外函数：</span></span><br><span class="line"><span class="keyword">var</span> data = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; <span class="number">3</span>; k++) &#123;</span><br><span class="line">  data[k] = (<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(x);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;)(k); <span class="comment">// pass "k" value</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// now it is correct</span></span><br><span class="line">data[<span class="number">0</span>](); <span class="comment">// 0</span></span><br><span class="line">data[<span class="number">1</span>](); <span class="comment">// 1</span></span><br><span class="line">data[<span class="number">2</span>](); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>因为所有这些函数拥有同一个 <code>[[Scope]]</code>，这个属性中的循环计数器的值是最后一次所赋的值。</p>
<p>建议了解一下其他语言闭包的支持情况。</p>
<p>然后我们移动到下个部分，考虑一下执行上下文的最后一个属性，关于 this 值的概念。</p>
<h3 id="This"><a href="#This" class="headerlink" title="This"></a>This</h3><p><code>this</code> 是一个与执行上下文相关的特殊对象。因此，它可以叫作 <code>上下文对象</code>，也就是用来指明执行上下文是在对象上触发的。</p>
<p>任何对象都可以做为上下文中的 <code>this</code> 的值。在一些对 ECMAScript 执行上下文和部分 <code>this</code> 的描述中的所产生误解，<code>this</code> 经常被错误的描述成是变量对象的一个属性。</p>
<p>正确的是：<code>this是执行上下文的一个属性，而不是变量对象的一个属性</code>。这个特性非常重要，因为如果 <code>this</code> 是变量对象的属性，<code>this</code> 会参与标识符解析过程，然而，<code>this</code> 从不会参与到标识符解析过程。</p>
<p>换句话说，在代码中当访问 <code>this</code> 的时候，它的值是直接从 <code>执行上下文</code> 中获取的，并不需要任何作用域链查找。<code>this</code> 的值只在进入上下文的时候进行一次确定。</p>
<p>顺便说一下，与 ECMAScript 相反，Python 的方法都会拥有一个被当作简单变量的 <code>self</code> 参数，这个变量的值在各个方法中是相同的的并且在执行过程中可以被更改成其他值。<br>在 ECMAScript 中，给 <code>this</code> 赋一个新值是不可能的，因为，它不是一个变量并且不存在于变量对象中。</p>
<p>在全局上下文中，<code>this</code> 就等于 <code>全局对象</code> 本身，这也意味着 <code>this</code> 就是 <code>全局变量对象</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(x, <span class="keyword">this</span>.x, <span class="built_in">window</span>.x);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line">f(); <span class="comment">// 输出了全局对象</span></span><br></pre></td></tr></table></figure>
<p>在函数上下文的情况下，对函数的每次调用，其中的 <code>this</code> 值可能是不同的。这个 <code>this</code> 值是通过函数调用表达式（也就是函数被调用的方式）的形式由 <code>caller</code> 所提供的。</p>
<p>让我们通过例子看一下，对于一个代码相同的函数，<code>this</code> 值是如何在不同的调用中（函数触发的不同方式），由 <code>caller</code> 给出不同的结果的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="keyword">this</span>); &#125;</span><br><span class="line"></span><br><span class="line">foo(); <span class="comment">// global object</span></span><br><span class="line">foo.prototype.constructor(); <span class="comment">// foo.prototype</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = &#123; <span class="attr">baz</span>: foo &#125;;</span><br><span class="line">bar.baz(); <span class="comment">// bar</span></span><br><span class="line"></span><br><span class="line">(bar.baz)();            <span class="comment">// also bar</span></span><br><span class="line">(bar.baz = bar.baz)();  <span class="comment">// but here is global object</span></span><br><span class="line">(bar.baz, bar.baz)();   <span class="comment">// also global object</span></span><br><span class="line">(<span class="literal">false</span> || bar.baz)();   <span class="comment">// also global object</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> otherFoo = bar.baz;</span><br><span class="line">otherFoo();             <span class="comment">// again global object</span></span><br></pre></td></tr></table></figure>
<h4 id="bind、call、apply"><a href="#bind、call、apply" class="headerlink" title="bind、call、apply"></a><code>bind</code>、<code>call</code>、<code>apply</code></h4><p><code>call apply</code> 给了代码在控制 <code>this</code> 的能力。</p>
<p><code>bind</code> 是基于 <code>call apply</code> 实现的高阶函数。</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" target="_blank" rel="noopener">bind Polyfill</a>：fun.bind(thisArg[, arg1[, arg2[, …]]])<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// console.log(Function.prototype.apply.bind.call === Function.prototype.call);</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">Function</span>.prototype.bind) &#123;</span><br><span class="line">  <span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span>(<span class="params">oThis</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span> !== <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="comment">// closest thing possible to the ECMAScript 5</span></span><br><span class="line">      <span class="comment">// internal IsCallable function</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Function.prototype.bind - what is trying to be bound is not callable'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> aArgs   = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>),</span><br><span class="line">        fToBind = <span class="keyword">this</span>,</span><br><span class="line">        fNOP    = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">        fBound  = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> fToBind.apply(<span class="keyword">this</span> <span class="keyword">instanceof</span> fNOP ? <span class="keyword">this</span> : oThis, aArgs.concat(<span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>)));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造函数拥有 prototype</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.prototype) &#123;</span><br><span class="line">      <span class="comment">// native functions don't have a prototype</span></span><br><span class="line">      fNOP.prototype = <span class="keyword">this</span>.prototype;</span><br><span class="line">    &#125;</span><br><span class="line">    fBound.prototype = <span class="keyword">new</span> fNOP();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果 this 是构造函数，fBound 继承相关属性</span></span><br><span class="line">    <span class="keyword">return</span> fBound;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>关于 <code>this</code> 绑定</p>
<p>在 JavaScript 中，<code>this</code> 和 <code>函数</code> 之间的绑定时松散的，体现在我们可以轻易的通过 <code>call</code>、<code>apply</code> <code>指定</code> 或 <code>修改</code> <code>this</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#id'</span>).foreach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  $(<span class="keyword">this</span>).click();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="执行上下文总结"><a href="#执行上下文总结" class="headerlink" title="执行上下文总结"></a>执行上下文总结</h3><ul>
<li><code>变量/活动对象</code>：记录运行时所需要的数据，变量、函数、形参、实参等。</li>
<li><code>作用域链</code>：即 <code>变量/活动对象链</code>，为引擎进行变量查找提供基础。</li>
<li><code>this</code>：指明了当前执行的函数作用在哪个对象身上，方法的作用对象是谁。</li>
</ul>
<p>全局上下文 和 函数上下文比较：</p>
<p>在全局上下文中，<code>this=全局对象本身=变量对象</code>。</p>
<p>在函数上下文中，<code>this</code> 是 <code>执行上下文</code> 的一个属性。</p>
<p>所以这也解释了一些现象，<code>全局作用域</code> 下的 <code>变量或函数</code> 成为了 <code>全局对象的属性</code>了，如上面示例的代码。</p>
<h2 id="执行过程"><a href="#执行过程" class="headerlink" title="执行过程"></a>执行过程</h2><p><a href="https://www.nosuchfield.com/2017/07/16/Talk-about-compilation-principles-1/" target="_blank" rel="noopener">聊聊编译原理（一） - 词法分析</a><br><a href="https://www.nosuchfield.com/2017/07/30/Talk-about-compilation-principles-2/" target="_blank" rel="noopener">聊聊编译原理（二） - 语法分析</a></p>
<h3 id="执行顺序"><a href="#执行顺序" class="headerlink" title="执行顺序"></a>执行顺序</h3><ul>
<li>编译型语言，编译步骤分为：<code>词法分析</code>、<code>语法分析</code>、<code>语义检查</code>、<code>代码优化</code> 和 <code>字节生成</code>。</li>
<li>解释型语言，通过 <code>词法分析</code> 和 <code>语法分析</code> 得到 <code>语法分析树</code> 后，就可以开始 <code>解释执行</code> 了。</li>
</ul>
<p>这里是一个简单原始的关于解析过程的原理，仅作为参考，详细的解析过程还需要更深一步的研究。</p>
<p>JavaScript 执行过程，如果一个 <code>文档流</code> 中包含多个 <code>script代码段</code>（用script标签分隔的js代码或引入的js文件），它们的运行顺序是：</p>
<ul>
<li>阶段一：解析<ul>
<li>步骤1. 载入第一个代码段（js执行引擎并非一行一行地执行程序，而是一段一段地分析执行的）。</li>
<li>步骤2. 做 <code>词法分析</code> -&gt; <code>[词法作用域]</code> 和 <code>语法分析</code> -&gt; <code>[语法分析树]</code>，如果有错则报语法错误(<code>Syntax Error</code>)（<code>解析时错误</code>，比如括号不匹配等），并跳转到步骤5。</li>
<li>步骤3. 对 <code>var</code> 变量 和 <code>function</code> 定义 做 <code>预解析</code>（永远不会报错的，因为只解析正确的声明）。</li>
</ul>
</li>
<li>阶段二：执行<ul>
<li>步骤4. 执行代码段，有错则报错（<code>运行时错误</code>，比如变量未定义）。</li>
<li>步骤5. 如果还有下一个代码段，则读入下一个代码段，重复步骤2。</li>
<li>步骤6. 结束</li>
</ul>
</li>
</ul>
<h3 id="关键步骤"><a href="#关键步骤" class="headerlink" title="关键步骤"></a>关键步骤</h3><ul>
<li>解析(2,3)：通过 <code>词法分析</code>、<code>语法分析</code> 和 <code>预解析</code> 构造的 <code>语法分析树</code>。</li>
<li>执行( 4 )：执行具体的某个函数，JS引擎在执行每个函数实例时，会创建一个 <code>执行上下文</code>。</li>
</ul>
<h3 id="关键概念"><a href="#关键概念" class="headerlink" title="关键概念"></a>关键概念</h3><ul>
<li>词法分析 -&gt; 词法作用域<ul>
<li>变量的作用域是在定义时决定而不是执行时决定，也就是说词法作用域取决于源码，通过静态分析就能确定，因此词法作用域也叫做静态作用域。</li>
<li><code>with</code> 和 <code>eval</code> 除外，所以只能说JS的作用域机制非常接近 <code>词法作用域</code>（Lexical scope）。</li>
<li><code>词法分析</code>（英语：lexical analysis）是计算机科学中将 <code>字符序列</code> 转换为 <code>标记（token）序列</code> 的过程。</li>
<li><code>词法分析器（扫描器）</code> 的功能输入源程序，按照构词规则分解成一系列单词符号。如：<code>关键字</code>、<code>标识符</code>、<code>常数</code>、<code>运算符</code>、<code>分界符</code> 等。</li>
</ul>
</li>
</ul>
<p>实际上，<code>运行时的作用域链</code> 并不是 <code>词法分析</code> 阶段 得到的，而是运行时得到的，但是在 <code>词法分析阶段</code> 能够确定作用域是一定，要不然写代码的人无法确定作用域，代码无法编写和理解。<br>在相同规则下，人和解释器对代码的理解是一致的。<br>某些情况下，静态分析也无法分析出完整的作用域链，比如递归的情况，这个阶段根本无法预知递归深度，无法得出实际的作用域链。</p>
<ul>
<li>语法分析树（SyntaxTree）<ul>
<li>可以直观地表示出这段代码的相关信息，具体的实现就是JS引擎创建了一些表。</li>
<li>用来记录每个方法的 <em>内部变量集（variables）</em>、<em>内嵌函数集（functions）</em> 和 <em>作用域（scope）</em> 等。</li>
</ul>
</li>
</ul>
<ul>
<li>执行环境/执行上下文（ExecutionContext）<ul>
<li>可理解为记录当前执行的方法 <em>外部描述信息</em> 的对象。</li>
<li>记录所执行函数的 <em>活动对象（activeObject）</em>、<em>作用域链（scope-chain）</em>、<em>this</em>。</li>
</ul>
</li>
</ul>
<ul>
<li>活动对象（activeObject）<ul>
<li>可理解为记录当前执行的方法 <em>内部执行信息</em> 的对象。</li>
<li>记录 <em>内部变量集（variables）</em>、<em>内嵌函数集（functions）</em>、<em>实参（arguments）</em>、<em>作用域链（scopeChain）</em> 等执行所需信息。</li>
<li>直接 <em>内部变量集（variables）</em>、<em>内嵌函数集（functions）</em> 是直接 <em>语法分析树</em> 复制过来的。</li>
<li>执行时，活动对象里的内部变量集全部被设置为 <code>undefined</code>, 创建<em>形参（parameters</em>）和<em>实参（arguments）</em>对象, 执行方法内的赋值语句，这才会对变量集中的变量进行赋值。</li>
<li>作用域链 闭包。</li>
</ul>
</li>
</ul>
<ul>
<li>作用域链<ul>
<li>简单的理解为 <em>变量对象链</em>，解释器可见的。</li>
<li>词法作用域 的实现机制就是 作用域链（scopeChain），作用域链 是一套按名称查找（Name Lookup）的机制。</li>
</ul>
</li>
</ul>
<ul>
<li>闭包<ul>
<li>闭包 是一个拥有许多变量和绑定了这些变量的环境的表达式（通常是一个函数），因而这些变量也是该表达式的一部分。</li>
<li>保护函数内的变量安全，实现 <em>私有属性</em> 和 <em>私有方法</em>（不能被外部访问）。</li>
<li>闭包就是将 <em>函数内部和函数外部</em> 连接起来的一座桥梁，让外部环境有途径访问内部变量。</li>
<li>闭包函数可以访问所保持的作用域链上的外部环境。</li>
</ul>
</li>
</ul>
<h3 id="词法分析"><a href="#词法分析" class="headerlink" title="词法分析"></a>词法分析</h3><p>lexical-analyzer Lexer Tokenizer</p>
<p>词法分析主要分为3步：</p>
<ul>
<li>第1步：分析 <code>形参</code></li>
<li>第2步：分析 <code>变量声明</code></li>
<li>第3步：分析 <code>函数声明</code></li>
</ul>
<p>在词法分析阶段，<code>变量声明</code> 和 <code>函数声明</code> 被提升</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'global'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(str);   <span class="comment">// undefined</span></span><br><span class="line">  <span class="keyword">var</span> str = <span class="string">'local'</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(str);   <span class="comment">// local</span></span><br><span class="line">  <span class="keyword">var</span> str;</span><br><span class="line">  <span class="built_in">console</span>.log(str);   <span class="comment">// local</span></span><br><span class="line">  str = <span class="string">'local'</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo();</span><br></pre></td></tr></table></figure>
<p><code>var str = &#39;local&#39;; &lt;==&gt; var str; str = &#39;local&#39;;</code></p>
<p>函数表达式中，变量声明部分被提升，但是知道执行到这一句时，变量才被赋值为一个函数，所以函数表达式需要在使用之前赋值，而函数声明这不需要。</p>
<h3 id="模拟解析"><a href="#模拟解析" class="headerlink" title="模拟解析"></a>模拟解析</h3><p>模拟代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> escope = <span class="built_in">require</span>(<span class="string">'escope'</span>);</span><br><span class="line"><span class="keyword">var</span> esprima = <span class="built_in">require</span>(<span class="string">'esprima'</span>);</span><br><span class="line"><span class="keyword">var</span> estraverse = <span class="built_in">require</span>(<span class="string">'estraverse'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">var i = 1, j = 2, k = 3;</span></span><br><span class="line"><span class="string">function a(o, p, x, q) &#123;</span></span><br><span class="line"><span class="string">  var x = 4;</span></span><br><span class="line"><span class="string">  console.log(i);</span></span><br><span class="line"><span class="string">  function b(r, s) &#123;</span></span><br><span class="line"><span class="string">    var i = 11, y = 5;</span></span><br><span class="line"><span class="string">    console.log(i);</span></span><br><span class="line"><span class="string">    function c(t) &#123;</span></span><br><span class="line"><span class="string">      var z = 6;</span></span><br><span class="line"><span class="string">      console.log(i);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    //函数表达式</span></span><br><span class="line"><span class="string">    var d = function () &#123;</span></span><br><span class="line"><span class="string">      console.log(y);</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">    c(60);</span></span><br><span class="line"><span class="string">    d();</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  b(40, 50);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">a(10, 20, 30);</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ast = esprima.parse(code);</span><br><span class="line"><span class="keyword">var</span> scopeManager = escope.analyze(ast);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> currentScope = scopeManager.acquire(ast);   <span class="comment">// global scope</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// console.dir(ast, &#123;depth: null&#125;);</span></span><br><span class="line"><span class="built_in">console</span>.dir(scopeManager, &#123;<span class="attr">depth</span>: <span class="literal">null</span>&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/estree.png" alt="ESTree"></p>
<p>上面的模拟代码生成了JS解析过程所产生的用于在执行阶段使用的信息，但是并不代表解释器和这个一样的。</p>
<p>这些分析工具有很多，他们大都用于 <code>代码压缩</code>、<code>代码混淆</code>、<code>代码转换（ES6-&gt;ES5，babel，ts-&gt;js）</code>、<code>代码优化</code>、<code>学习研究</code> 等。</p>
<p>源文件地址：<a href="https://github.com/liuyanjie/knowledge/tree/master/langs/ecmascript/javascript-deep.md" target="_blank" rel="noopener">https://github.com/liuyanjie/knowledge/tree/master/langs/ecmascript/javascript-deep.md</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="/posts/JavaScript基础知识整理/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lyj">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyj's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/posts/JavaScript基础知识整理/" class="post-title-link" itemprop="url">JavaScript基础知识整理</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-04-11 08:00:00" itemprop="dateCreated datePublished" datetime="2018-04-11T08:00:00+08:00">2018-04-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-12-29 00:24:16" itemprop="dateModified" datetime="2018-12-29T00:24:16+08:00">2018-12-29</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Language/" itemprop="url" rel="index"><span itemprop="name">Language</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Language/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/posts/JavaScript基础知识整理/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/JavaScript基础知识整理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">31k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">28 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>JavaScript 基础知识整理</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="基本类型-Primitive"><a href="#基本类型-Primitive" class="headerlink" title="基本类型 Primitive"></a>基本类型 <a href="https://developer.mozilla.org/en-US/docs/Glossary/Primitive" target="_blank" rel="noopener">Primitive</a></h3><p><code>Undefined、Null、Boolean、Number、String、Symbol(ES2015)</code></p>
<p>原始类型 和 原始值</p>
<p>基本类型的值 是不可变的，我们无法给它们添加属性。</p>
<p>基本类型的值 不是一个对象，也没有方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'~~~~~'</span>;</span><br><span class="line">str.prop = <span class="string">'!!!!!'</span>;</span><br><span class="line">str.prop; <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">10</span>;</span><br><span class="line">num.prop = <span class="number">11</span>;</span><br><span class="line">num.prop; <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bool = <span class="literal">true</span>;</span><br><span class="line">bool.prop = <span class="string">''</span>;</span><br><span class="line">bool.prop <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="string">'---'</span>.charAt === <span class="built_in">String</span>.prototype.charAt</span><br><span class="line">(<span class="number">12345</span>).toString(); <span class="comment">// 使用数字调用方法时需要用用括号括起来</span></span><br></pre></td></tr></table></figure>
<h4 id="Boolean、Number、String、Symbol"><a href="#Boolean、Number、String、Symbol" class="headerlink" title="Boolean、Number、String、Symbol"></a><code>Boolean</code>、<code>Number</code>、<code>String</code>、<code>Symbol</code></h4><ul>
<li>这三种基本类型分别存在 <code>Boolean()</code>、<code>Number()</code>、<code>String()</code> 内建函数</li>
<li>平时使用的时候大都使用的是字面量形式，字面量并不是对象</li>
<li><p>当需要的时候，它们也会被转换成对象，也就是会被转换成 <strong>基本类型的包装类型</strong></p>
<p><code>valueOf()</code> 方法返回 原始值</p>
</li>
</ul>
<h4 id="Undefined、Null"><a href="#Undefined、Null" class="headerlink" title="Undefined、Null"></a><code>Undefined</code>、<code>Null</code></h4><ul>
<li>并不存在 <code>Undefined()</code> 和 <code>Null()</code> 内建函数，只存在 <code>Undefined</code> 和 <code>Null</code> 类型的内建对象 <code>undefined</code> 和 <code>null</code></li>
<li>ECMAScript 认为 <code>undefined</code> 是从 <code>null</code> 派生出来的，所以把它们定义为 <strong>值</strong> 相等的，但是类型不等，相同的地方是都可以视为布尔值的 <code>false</code></li>
<li>这两个类型无 <strong>包装类型</strong></li>
</ul>
<p><code>undefined</code> 与 <code>null</code> 的区别：</p>
<ol>
<li><p><code>null</code> 表示 <strong>没有对象</strong>，即该处不应该有值</p>
<ul>
<li>作为函数的参数，表示该函数的参数不是对象</li>
<li>作为对象原型链的终点</li>
</ul>
</li>
<li><p><code>undefined</code> 表示 <strong>缺少值</strong>，即应该有一个值但是 <strong>未定义/未赋值</strong></p>
<ul>
<li>变量被声明了，但没有赋值时，该变量 <code>undefined</code></li>
<li>调用函数时，参数没有提供，该参数 <code>undefined</code></li>
<li>对象没有赋值的属性，该属性 <code>undefined</code></li>
<li>函数没有返回值时，返回 <code>undefined</code></li>
</ul>
</li>
</ol>
<h3 id="引用类型"><a href="#引用类型" class="headerlink" title="引用类型"></a>引用类型</h3><p><code>Object、Function、String、Number、Error、Regexp、Map、Set</code> …</p>
<p>JavaScript 中一切都可以被当做对象！但是只有引用类型才是真正的对象，基本类型除了 <code>null</code> 和 <code>undefined</code> 之外，都可以像对象一样使用，因为他们有包装类型。</p>
<h4 id="Object-对象"><a href="#Object-对象" class="headerlink" title="Object{} - 对象"></a>Object{} - 对象</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> boolObj = <span class="keyword">new</span> <span class="built_in">Object</span>(&#123;&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(obj <span class="keyword">instanceof</span> <span class="built_in">Object</span>);         <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(boolObj <span class="keyword">instanceof</span> <span class="built_in">Object</span>);     <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(obj === boolObj);               <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> obj);                    <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> boolObj);                <span class="comment">// object</span></span><br></pre></td></tr></table></figure>
<h4 id="Function-函数对象"><a href="#Function-函数对象" class="headerlink" title="Function - 函数对象"></a>Function - 函数对象</h4><p>Function 是一个构造函数，用于创建一个函数对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="keyword">new</span> <span class="built_in">Function</span> ([arg1[, arg2[, ...argN]],] functionBody)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="keyword">new</span> <span class="built_in">Function</span> () &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>function 是一个关键字可以声明一个函数对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数表达式</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每一个函数对象都继承 Function 构造函数的原型对象。</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.foo = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">bar.foo <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<h4 id="Array-复合类型-（引用，指针）"><a href="#Array-复合类型-（引用，指针）" class="headerlink" title="Array[] - 复合类型 （引用，指针）"></a>Array[] - 复合类型 （引用，指针）</h4><p>数组是对象，能够添加属性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">arr.i = <span class="number">4</span>;</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// [1, 2, 3, i: 4]</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> a <span class="keyword">in</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, arr[a]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0 1</span></span><br><span class="line"><span class="comment">// 1 2</span></span><br><span class="line"><span class="comment">// 2 3</span></span><br><span class="line"><span class="comment">// i 4</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line">foo.length = <span class="number">3</span>;</span><br><span class="line">foo; <span class="comment">// [1, 2, 3]</span></span><br><span class="line"></span><br><span class="line">foo.length = <span class="number">6</span>;</span><br><span class="line">foo.push(<span class="number">4</span>);</span><br><span class="line">foo; <span class="comment">// [1, 2, 3, undefined, undefined, undefined, 4]</span></span><br></pre></td></tr></table></figure>
<h4 id="类数组对象"><a href="#类数组对象" class="headerlink" title="类数组对象"></a>类数组对象</h4><p>一个JS数组是特殊的, 因为：</p>
<ol>
<li>它的 <code>length</code> 属性有些特殊行为：<ol>
<li>当新的元素添加到列表中，其值自动更新；</li>
<li>设置这一属性可以扩展或截断数组。</li>
</ol>
</li>
<li>数组是 <code>Array</code> 的实例，可以调用不同的 <code>Array</code> 方法。</li>
</ol>
<p>以上都是JS数组的独特特性，但它们不是一个数组的最基本的特性。</p>
<p>把任何具有一个 <code>length属性</code> 及相应的 <code>非负整数属性</code> 的 <code>对象</code> 作为一种数组, 称之为 <code>&quot;类数组&quot;</code>。</p>
<p>这种 <code>类数组</code> 的对象出现频率不高，而且也不能在它们之上 调用数组方法 或者通过 <code>length</code> 属性期待特殊的行为1)2), 但仍然可以用遍历一个真正数组的代码来遍历它们。</p>
<p>事实上很多数组算法对于类似数组的对象和真正的数组对象都是适用的, 只要不尝试对数组添加元素或者改变 <code>length属性</code>, 就可以把类似数组的对象当作真正的数组来对待。</p>
<p>特别地，函数中的 <code>Arguments</code> 对象就是一个 <code>类数组</code> 的对象; 而 <code>getElementsByTagName()</code> 返回的DOM结点列表也是类似数组的对象。</p>
<p>如下创建一个类似数组，然后遍历该类似数组:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 不小心就引进了一个小bug</span></span><br><span class="line"><span class="keyword">while</span>(i++ &lt; 10) &#123; a[i] = i * i; &#125;</span><br><span class="line">while(i &lt; 10) &#123; a[i] = i * i; i++; &#125;</span><br><span class="line"></span><br><span class="line">a.length = i;</span><br><span class="line"></span><br><span class="line">var total = 0;</span><br><span class="line">for(var j = 0, len = a.length; j &lt; len; j++) &#123;</span><br><span class="line">  total += a[j];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="类型识别"><a href="#类型识别" class="headerlink" title="类型识别"></a>类型识别</h3><h4 id="识别方法"><a href="#识别方法" class="headerlink" title="识别方法"></a>识别方法</h4><ul>
<li><p><code>typeof</code> (typeof x)（只能用于除<code>null</code>以外的原始类型）</p>
<p>返回值：首字母小写的字符串形式</p>
<ul>
<li>可以识别 <code>基本类型</code>，<code>null</code> 除外</li>
<li>不能识别 <code>内置对象类型</code> (<code>Function</code> 除外)</li>
<li>不能识别 <code>自定义类型</code></li>
<li>可以识别 <code>undefined</code></li>
<li>不能识别 <code>null</code>，因为 <code>null</code> 被识别为 <code>object</code></li>
</ul>
</li>
</ul>
<ul>
<li><p><code>instanceof</code> (<code>x instanceof X</code>)，（不能用于原始类型）</p>
<p>返回值：<code>true</code> 或 <code>false</code></p>
<ul>
<li>不能识别 <code>基本类型</code>，会返回 <code>false</code>。 <code>(true instanceof Boolean) -&gt; false</code></li>
<li>可以识别 <code>内置对象类型</code></li>
<li>可以识别 <code>自定义类型</code> 及其 <code>父类型</code></li>
<li>不能识别 <code>undefined</code>、<code>null</code>，因为无 <code>Undefined</code>、<code>Null</code> 包装类型</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>Object.prototype.toString</code> （自定义类型需要实现 <code>toString</code> 方法方可识别）</p>
<p>eq.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">type</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj).slice(<span class="number">8</span>, <span class="number">-1</span>).toLowerCase();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回值：<code>[object TypeX]</code> 的字符串形式</p>
<ul>
<li>可以识别 <code>基本类型</code></li>
<li>可以识别 <code>内置对象类型</code></li>
<li>可以识别 <code>自定义类型</code>，但是需要重载 <code>toString</code> 方法</li>
<li>可以识别 <code>undefined</code>、<code>null</code></li>
</ul>
</li>
</ul>
<ul>
<li><p><code>.prototype.constructor</code> （不能用于 <code>null</code> 和 <code>undefined</code> ）</p>
<p>eq.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.prototype.constructor.name</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">type</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> obj.__proto__.constructor.toString().replace(<span class="regexp">/^function (\w+)\(\).+$/</span>, <span class="string">'$1'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回值：<code>function TypeX(){[native code]}</code> 或者 <code>function TypeX(){}</code></p>
<ul>
<li>可以识别 <code>基本类型</code></li>
<li>可以识别 <code>内置对象类型</code></li>
<li>可以识别 <code>自定义类型</code></li>
<li>不能识别 <code>undefined</code>、<code>null</code>，会报错，因为 不存在方法</li>
</ul>
</li>
</ul>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><ul>
<li>Number</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> numObj = <span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> num);                    <span class="comment">// number</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> numObj);                 <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(num <span class="keyword">instanceof</span> <span class="built_in">Object</span>);         <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(num <span class="keyword">instanceof</span> <span class="built_in">Number</span>);         <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(numObj <span class="keyword">instanceof</span> <span class="built_in">Object</span>);      <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(numObj <span class="keyword">instanceof</span> <span class="built_in">Number</span>);      <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(num === numObj);                <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<ul>
<li>String</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">var</span> strObj = <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">''</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> str);                    <span class="comment">// string</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> strObj);                 <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(str <span class="keyword">instanceof</span> <span class="built_in">Object</span>);         <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(str <span class="keyword">instanceof</span> <span class="built_in">String</span>);         <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(strObj <span class="keyword">instanceof</span> <span class="built_in">Object</span>);      <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(strObj <span class="keyword">instanceof</span> <span class="built_in">String</span>);      <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(str === strObj);                <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Boolean</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bool = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">var</span> boolObj = <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> bool);                   <span class="comment">// boolean</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> boolObj);                <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(bool <span class="keyword">instanceof</span> <span class="built_in">Object</span>);        <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(bool <span class="keyword">instanceof</span> <span class="built_in">Boolean</span>);       <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(boolObj <span class="keyword">instanceof</span> <span class="built_in">Object</span>);     <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(boolObj <span class="keyword">instanceof</span> <span class="built_in">Boolean</span>);    <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(bool === boolObj);              <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Undefined Null</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="literal">undefined</span>);              <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">undefined</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>);   <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="literal">null</span>);                   <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">null</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>);        <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">undefined</span> === <span class="literal">null</span>);            <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">undefined</span> == <span class="literal">null</span>);             <span class="comment">// true</span></span><br><span class="line"><span class="keyword">var</span> <span class="literal">undefined</span> = <span class="string">'foo'</span>;                      <span class="comment">// 可以重新赋值</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">undefined</span>, <span class="keyword">typeof</span> <span class="literal">undefined</span>);   <span class="comment">// foo 'string'</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">void</span>(<span class="number">0</span>) === <span class="literal">undefined</span>);         <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Function</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> objPrototype = <span class="built_in">Object</span>.prototype;</span><br><span class="line"><span class="built_in">console</span>.log(objPrototype);                          <span class="comment">// &#123;&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(objPrototype.__proto__);                <span class="comment">// null</span></span><br><span class="line"><span class="built_in">console</span>.log(objPrototype.toString());               <span class="comment">// [object Object]</span></span><br><span class="line"><span class="built_in">console</span>.log(objPrototype.valueOf());                <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> objPrototype);                   <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype <span class="keyword">instanceof</span> <span class="built_in">Object</span>);    <span class="comment">// false !</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="built_in">Object</span>);                         <span class="comment">// function</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>);                                <span class="comment">// [Function: Object]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>);              <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span> <span class="keyword">instanceof</span> <span class="built_in">Function</span>);            <span class="comment">// true !</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="built_in">Function</span>);                       <span class="comment">// function</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span>);                              <span class="comment">// [Function: Function]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>);            <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span> <span class="keyword">instanceof</span> <span class="built_in">Function</span>);          <span class="comment">// true ！</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.__proto__ === <span class="built_in">Function</span>.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span>.__proto__ === <span class="built_in">Function</span>.prototype);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span>.prototype.__proto__ === <span class="built_in">Object</span>.prototype);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.__proto__.__proto__ === <span class="built_in">Object</span>.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span>.__proto__.__proto__ === <span class="built_in">Object</span>.prototype);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.__proto__);</span><br></pre></td></tr></table></figure>
<h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><h4 id="显式转换"><a href="#显式转换" class="headerlink" title="显式转换"></a>显式转换</h4><p>JavaScript 提供了以下转型函数：</p>
<ul>
<li>转为数值类型：<code>Number(mix)、parseInt(string,radix)、parseFloat(string)</code></li>
<li>转为字符串类型：<code>toString(radix)、String(mix)</code></li>
<li>转为布尔类型：<code>Boolean(mix)</code></li>
</ul>
<ul>
<li><code>Number(mix)</code> 函数，可以将任意类型的参数mix转换为数值类型。其规则为：</li>
</ul>
<table>
<thead>
<tr>
<th>Type</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Boolean</td>
<td>Number(true)-&gt;1 Number(false)-&gt;0</td>
</tr>
<tr>
<td>Number</td>
<td>Number(num)-&gt;num</td>
</tr>
<tr>
<td>Null</td>
<td>Number(null)-&gt;0</td>
</tr>
<tr>
<td>Undefined</td>
<td>Number(undefined)-&gt;NaN</td>
</tr>
<tr>
<td>String</td>
<td>Number(‘012345’)-&gt;12345 Number(‘012345.6789’)-&gt;12345.6789 Number(‘’)-&gt;0 Number(‘A-Z’)-&gt;NaN</td>
</tr>
<tr>
<td>Object</td>
<td>调用对象的valueOf()方法，依据前面的规则转换返回的值。如果转换的结果是NaN，则调用对象的toString()方法，再依据前面的规则转换返回的值。</td>
</tr>
</tbody>
</table>
<p>下表列出了对象的 <code>valueOf()</code> 的返回值：</p>
<table>
<thead>
<tr>
<th>Type</th>
<th><code>valueOf()</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Array</code></td>
<td>数组的元素被转换为字符串，这些字符串由逗号分隔，连接在一起，其操作与 Array.toString 和 Array.join 方法相同。</td>
</tr>
<tr>
<td><code>Boolean</code></td>
<td>Boolean 值是</td>
</tr>
<tr>
<td><code>Date</code></td>
<td>存储的时间是从 1970 年 1 月 1 日午夜开始计的毫秒数 UTC</td>
</tr>
<tr>
<td><code>Function</code></td>
<td>函数本身</td>
</tr>
<tr>
<td><code>Object</code></td>
<td>对象本身</td>
</tr>
<tr>
<td><code>String</code></td>
<td>字符串值</td>
</tr>
<tr>
<td><code>Number</code></td>
<td>数字值</td>
</tr>
</tbody>
</table>
<p>Example：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Array</span>().valueOf());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Array</span>().toString());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Array</span>());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]).valueOf());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]).toString());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]));</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>).valueOf());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>).toString());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>));</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Date</span>().valueOf());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Date</span>().toString());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Function</span>());</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>parseInt(string, radix)</code> 将字符串转换为整数类型。</p>
<p>它也有一定的规则：</p>
<ul>
<li>忽略字符串前面的空格，直至找到第一个非空字符。</li>
<li>如果第一个字符不是数字符号或者负号，返回 <code>NaN</code>。</li>
<li>如果第一个字符是数字，则继续解析直至字符串解析完毕或者遇到一个非数字符号为止。</li>
<li>如果上步解析的结果以 <code>0</code> 开头，则将其当作八进制来解析；如果以 <code>0x</code> 开头，则将其当作十六进制来解析。</li>
<li>如果指定 <code>radix</code> 参数，则以 <code>radix</code> 为基数进行解析。</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>parseFloat(string)</code> 将字符串转换为浮点数类型。</p>
<p>它的规则与 <code>parseInt</code> 基本相同，但也有点区别：字符串中第一个小数点符号是有效的，另外 <code>parseFloat</code> 会忽略所有前导 <code>0</code>，如果字符串包含一个可解析为整数的数，则返回整数值而不是浮点数值。</p>
</li>
</ul>
<ul>
<li><p><code>toString(radix)</code> 方法。</p>
<p>除 <code>undefined</code> 和 <code>null</code> 之外的所有类型的值都具有 <code>toString()</code> 方法，转换成字符串表示。</p>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].toString())       <span class="comment">// 1, 2, 3</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">true</span>.toString())            <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>().toString(<span class="number">10</span>))    <span class="comment">// Wed Aug 17 2016 13:52:21 GMT+0800 (中国标准时间)</span></span><br><span class="line"><span class="built_in">console</span>.log(&#123;&#125;.toString())              <span class="comment">// [object Object]</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>String(mix)</code> 将任何类型的值转换为字符串：</p>
<ul>
<li><code>null</code> -&gt; “null”</li>
<li><code>undefined</code> -&gt; “undefined”</li>
<li>调用 <code>toString()</code> 方法，返回结果，如果没有 <code>toString()</code>，则报异常，无法转换。</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>Boolean(mix)</code> 函数，将任何类型的值转换为布尔值。</p>
<ul>
<li><code>false</code>：<code>false、&#39;&#39;、0、NaN、null、undefined</code></li>
<li><code>true</code> : 除了以上转换问 <code>false</code> 的</li>
</ul>
</li>
</ul>
<h4 id="隐式转换"><a href="#隐式转换" class="headerlink" title="隐式转换"></a>隐式转换</h4><p>在某些情况下，即使我们不提供显示转换，JavaScript 也会进行自动类型转换，主要情况有：</p>
<ul>
<li><p>用于检测是否为非数值的函数：<code>isNaN(mix)</code></p>
<p><code>isNaN()</code> 函数，经测试发现，该函数会尝试将参数值用 <code>Number()</code> 进行转换，如果结果为 <code>“非数值”</code> 则返回 <code>true</code>，否则返回 <code>false</code>。</p>
</li>
</ul>
<ul>
<li><p>递增递减操作符（包括前置和后置）、一元正负符号操作符，其规则与 <code>Number()</code> 规则基本相同</p>
<ul>
<li>如果是包含有效数字字符的字符串，先将其转换为数字值（转换规则同 <code>Number()</code>），在执行加减1的操作，字符串变量变为数值变量。</li>
<li>如果是不包含有效数字字符的字符串，将变量的值设置为 <code>NaN</code>，字符串变量变成数值变量。</li>
<li>如果是布尔值 <code>false</code>，先将其转换为 <code>0</code> 再执行加减 <code>1</code> 的操作，布尔值变量编程数值变量。</li>
<li>如果是布尔值 <code>true</code>，先将其转换为 <code>1</code> 再执行加减 <code>1</code> 的操作，布尔值变量变成数值变量。</li>
<li>如果是浮点数值，执行加减 <code>1</code> 的操作。</li>
<li>如果是对象，先调用对象的 <code>valueOf()</code> 方法，然后对该返回值应用前面的规则。如果结果是 <code>NaN</code>，则调用 <code>toString()</code> 方法后再应用前面的规则。对象变量变成数值变量。</li>
</ul>
</li>
</ul>
<ul>
<li><p>加减乘除运算符、取模运算符</p>
<ul>
<li>如果一个操作数为 <code>NaN</code>，则结果为 <code>NaN</code></li>
<li><code>Infinity+Infinity -&gt; Infinity</code></li>
<li><code>-Infinity+(-Infinity) -&gt; -Infinity</code></li>
<li><code>Infinity+(-Infinity) -&gt; NaN</code></li>
<li><code>+0+(+0) -&gt; +0</code></li>
<li><code>(-0)+(-0) -&gt; -0</code></li>
<li><code>(+0)+(-0) -&gt; +0</code></li>
</ul>
<p>加号运算操作符在 JavaScript 也用于字符串连接符，所以加号操作符处理字符串是有所不同：</p>
<ul>
<li>如果两个操作值都是字符串，则将它们拼接起来</li>
<li>如果只有一个操作值为字符串，则将另外操作值转换为字符串，然后拼接起来</li>
<li>如果一个操作数是对象、数值或者布尔值，则调用 <code>toString()</code> 方法取得字符串值，然后再应用前面的字符串规则。对于 <code>undefined</code> 和 <code>null</code>，分别调用 <code>String()</code> 显式转换为字符串。</li>
<li>可以看出，加法运算中，如果有一个操作值为字符串类型，则将另一个操作值转换为字符串，最后连接起来。</li>
</ul>
</li>
</ul>
<ul>
<li><p>逻辑操作符（!、&amp;&amp;、||）</p>
<ul>
<li>逻辑非 <code>!</code> 操作符首先通过 <code>Boolean()</code> 函数将它的操作值转换为布尔值，然后求反。</li>
<li>逻辑与 <code>&amp;&amp;</code> 操作符，如果一个操作值不是布尔值时，遵循以下规则进行转换：<ul>
<li>如果第一个操作数经 <code>Boolean()</code> 转换后为 <code>true</code>，则返回第二个操作值，否则返回第一个值（不是Boolean()转换后的值）</li>
<li>如果有一个操作值为 <code>null</code>，返回 <code>null</code></li>
<li>如果有一个操作值为 <code>NaN</code>，返回 <code>NaN</code></li>
<li>如果有一个操作值为 <code>undefined</code>，返回 <code>undefined</code></li>
</ul>
</li>
<li>逻辑或（||）操作符，如果一个操作值不是布尔值，遵循以下规则：<ul>
<li>如果第一个操作值经 <code>Boolean()</code> 转换后为 <code>false</code>，则返回第二个操作值，否则返回第一个操作值（不是 <code>Boolean()</code> 转换后的值）</li>
<li>对于 <code>undefined</code>、<code>null</code> 和 <code>NaN</code> 的处理规则与逻辑与（&amp;&amp;）相同</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>关系操作符（&lt;, &gt;, &lt;=, &gt;=）</p>
<ul>
<li>如果两个操作值都是数值，则进行数值比较</li>
<li>如果两个操作值都是字符串，则比较字符串对应的字符编码值</li>
<li>如果只有一个操作值是数值，则将另一个操作值转换为数值，进行数值比较</li>
<li>如果一个操作数是对象，则调用 <code>valueOf()</code> 方法（如果对象没有 <code>valueOf()</code> 方法则调用 <code>toString()</code> 方法），得到的结果按照前面的规则执行比较</li>
<li>如果一个操作值是布尔值，则将其转换为数值，再进行比较</li>
<li>注：<code>NaN</code> 是非常特殊的值，它不和任何类型的值相等，包括它自己，同时它与任何类型的值比较大小时都返回 <code>false</code>。</li>
</ul>
</li>
</ul>
<ul>
<li><p>相等操作符（==）</p>
<ul>
<li>如果一个操作值为布尔值，则在比较之前先将其转换为数值</li>
<li>如果一个操作值为字符串，另一个操作值为数值，则通过 <code>Number()</code> 函数将字符串转换为数值</li>
<li>如果一个操作值是对象，另一个不是，则调用对象的 <code>valueOf()</code> 方法，得到的结果按照前面的规则进行比较</li>
<li><code>null</code> 与 <code>undefined</code> 是相等的</li>
<li>如果一个操作值为 <code>NaN</code>，则相等比较返回 <code>false</code></li>
<li>如果两个操作值都是对象，则比较它们是不是指向同一个对象</li>
</ul>
</li>
</ul>
<h2 id="void"><a href="#void" class="headerlink" title="void"></a>void</h2><ul>
<li><p><code>void UnaryExpression</code> 按如下流程解释:</p>
<ul>
<li>令 <code>expr</code> 为解释执行 <code>UnaryExpression</code> 的结果</li>
<li>调用 <code>GetValue(expr)</code></li>
<li>返回 <code>undefined</code></li>
</ul>
</li>
<li><p>注意：<code>GetValue</code> 一定会被调用，即使它的值不会被用到，但是这个表达式可能会有副作用(side-effects)。</p>
</li>
<li><p>为什么要用 <code>void</code>？<code>undefined</code> 不是保留字，可以重新赋值。采用 <code>void</code> 方式获取 <code>undefined</code> 便成了通用准则。</p>
</li>
</ul>
<p><a href="https://segmentfault.com/a/1190000000474941" target="_blank" rel="noopener">谈谈JavaScript中的void操作符</a></p>
<h2 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h2><p>运算符优先级</p>
<h2 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h2><p>ECMAScript 做为一个高度抽象的面向对象语言，是通过对象来交互的。<br>一个对象就是属性集合，并拥有一个独立的 <code>原型对象</code>，这个 <code>原型对象</code> 可以是一个 <code>对象</code> 或者 <code>null</code>。<br>一个对象的 <code>原型对象</code> 是以对象内部的 <code>[[Prototype]]</code> 属性来引用的。</p>
<p>在示意图里边我们将会使用 <code>__&lt;internal-property&gt;__</code> 下划线标记来替代两个括号，对于 <code>prototype</code> 对象来说是：<code>__proto__</code>。</p>
<p>让我们看一个关于对象的基本例子。</p>
<p>对于以下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">  x: <span class="number">10</span>,</span><br><span class="line">  y: <span class="number">20</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>我们拥有一个这样的结构，两个显式的属性和一个隐藏的 <code>__proto__</code> 属性，这个属性是对 <code>Object.prototype</code> 的引用。</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/basic-object.png" alt="basic-object"></p>
<p>这些 <code>prototype</code> 有什么用？</p>
<p>让我们以 <code>原型链</code> 的概念来回答这个问题。</p>
<h2 id="原型链（prototype-chain）"><a href="#原型链（prototype-chain）" class="headerlink" title="原型链（prototype-chain）"></a>原型链（prototype-chain）</h2><ul>
<li><code>原型对象</code> 也是简单的对象，所以他可以拥有自己的原型，如果一个原型对象的 <code>原型</code> 是一个非 <code>null</code> 的引用，延续下去，原型对象连成的链，就形成了 <code>原型链</code>。</li>
<li><code>原型链</code> 是一个用来实现 <code>继承</code> 和 <code>共享</code> 属性的有限长度的 <code>对象链</code>。</li>
<li><code>原型链</code> 是为了实现代码重用而设计的，在基于类的系统中，这个代码重用风格叫作 <code>继承</code>。</li>
</ul>
<p>ECMAScript 中没有类的概念，但是代码重用的风格并没有太多不同，ECMAScript 通过原型链来实现，即 <strong>原型继承(prototype based inheritance)</strong>，这种继承方式叫作 <strong>委托继承(delegation based inheritance)</strong>。</p>
<p>ES5标准化了一个实现原型继承的新的可选方法，使用 <code>Object.create</code> 函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;<span class="attr">k</span>: <span class="string">'v'</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> b = <span class="built_in">Object</span>.create(a, &#123;<span class="attr">y</span>: &#123;<span class="attr">value</span>: <span class="number">20</span>&#125;&#125;);</span><br><span class="line"><span class="keyword">var</span> c = <span class="built_in">Object</span>.create(a, &#123;<span class="attr">y</span>: &#123;<span class="attr">value</span>: <span class="number">30</span>&#125;&#125;);</span><br></pre></td></tr></table></figure>
<p>ES6标准化了 <code>__proto__</code> 属性，并且可以在对象初始化的时候使用它，如下面的用法。<br><code>b</code> 和 <code>c</code> 可以访问到 <code>a</code> 对象中定义的 <code>calculate()</code> 方法，是通过原型链 <code>lookup</code> 实现的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  x: <span class="number">10</span>,</span><br><span class="line">  calculate: <span class="function"><span class="keyword">function</span> (<span class="params">z</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.x + <span class="keyword">this</span>.y + z</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> b = &#123;<span class="attr">y</span>: <span class="number">20</span>, <span class="attr">__proto__</span>: a&#125;;</span><br><span class="line"><span class="comment">// 等价于 var b = Object.create(a, &#123;y: &#123;value: 20&#125;&#125;);</span></span><br><span class="line"><span class="keyword">var</span> c = &#123;<span class="attr">y</span>: <span class="number">30</span>, <span class="attr">__proto__</span>: a&#125;;</span><br><span class="line"><span class="comment">// 等价于 var c = Object.create(a, &#123;y: &#123;value: 30&#125;&#125;);</span></span><br><span class="line">b.calculate(<span class="number">30</span>); <span class="comment">// 60</span></span><br><span class="line">c.calculate(<span class="number">40</span>); <span class="comment">// 80</span></span><br></pre></td></tr></table></figure>
<h3 id="原型链-lookup-规则："><a href="#原型链-lookup-规则：" class="headerlink" title="原型链 lookup 规则："></a>原型链 <code>lookup</code> 规则：</h3><p>如果一个 <code>属性</code>/<code>方法</code> 在对象自身中无法找到，JS引擎会尝试遍历整个原型链，寻找这个 <code>属性</code>/<code>方法</code>，第一个被查找到的同名 <code>属性</code>/<code>方法</code> 会被使用。如果在遍历了整个原型链之后还是没有查找到这个属性的话，返回 <code>undefined</code> 值。</p>
<p>下一张图展示了对象 <code>a</code>，<code>b</code>，<code>c</code> 之间的继承关系：</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/prototype-chain.png" alt="prototype-chain"></p>
<p>所以 <code>__proto__</code> 主要是给JS引擎用的，但是暴露给了我们，并且可以对其修改。</p>
<p>与此类似的还有 <code>作用域链</code> 及其 <code>lookup规则</code>，<code>原型链</code> 和 <code>作用域链</code> 的用途都是用来名字查找，给JS引擎用的。</p>
<p>区别是：原型链是属性上的名字查找，对象自身上查找，这条链可以运行时被修改，作用域链是上下文中的名字查找，这条链由代码决定。</p>
<h3 id="proto"><a href="#proto" class="headerlink" title="__proto__"></a><code>__proto__</code></h3><ul>
<li>如果没有明确为一个对象指定原型，那么它将会使用 <code>__proto__</code> 的默认值 <code>Object.prototype</code>。</li>
<li><code>Object.prototype</code> 对象自身也有一个 <code>__proto__</code> 属性，值为 <code>null</code>，这是原型链的终点。 即：<code>Object.prototype.__proto__ === null</code></li>
<li>The <code>__proto__</code> property of <code>Object.prototype</code> is an <code>accessor property</code> (a getter function and a setter function) that exposes the internal <code>[[Prototype]]</code> (either an object or null) of the object through which it is accessed.</li>
</ul>
<p>项目中建议不要直接使用 <code>__proto__</code> 读写原型，而是使用 <code>Object.getPrototypeOf()、Object.create()</code> 读写原型。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Shape = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;;</span><br><span class="line"><span class="keyword">var</span> proto = &#123;</span><br><span class="line">  say: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">'hello world!'</span>); &#125;</span><br><span class="line">&#125;;</span><br><span class="line">Shape.prototype = proto;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.prototype.getPrototype = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.getPrototypeOf(<span class="keyword">this</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> circle = <span class="keyword">new</span> Shape();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'circle:'</span>, circle.__proto__ === Shape.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'circle:'</span>, <span class="built_in">Object</span>.getPrototypeOf(circle) === Shape.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'circle:'</span>, <span class="keyword">typeof</span> circle);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'circle:'</span>, circle <span class="keyword">instanceof</span> Shape);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'circle:'</span>, circle <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rectangle = <span class="built_in">Object</span>.create(proto);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'ractangle:'</span>, rectangle.__proto__ === Shape.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'ractangle:'</span>, <span class="built_in">Object</span>.getPrototypeOf(rectangle) === Shape.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'ractangle:'</span>, <span class="keyword">typeof</span> rectangle);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'ractangle:'</span>, rectangle <span class="keyword">instanceof</span> Shape);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'ractangle:'</span>, rectangle <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> objPrototype = <span class="built_in">Object</span>.prototype;</span><br><span class="line"><span class="built_in">console</span>.log(objPrototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> objPrototype);</span><br><span class="line"><span class="built_in">console</span>.log(objPrototype.__proto__);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'__proto__:'</span>, <span class="string">'xxx'</span>.__proto__);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">String</span>.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">console</span>.log([] <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">console</span>.log(&#123;&#125; <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br></pre></td></tr></table></figure>
<p><code>typeof</code> 和 <code>instanceof</code> 都是检测变量的类型，区别在于:</p>
<ul>
<li><code>typeof</code>: 可以用来区分原始值和对象。<code>typeof</code> 还可以让检查一个变量是否已声明，而不会抛出异常，没有任何一个函数可以实现此功能。</li>
<li><code>instanceof</code>: 可以用来区分对象，<code>instanceof</code> 对于所有的原始值都返回 false。</li>
</ul>
<p>typeof 在操作 <code>null</code> 时会返回 <code>&quot;object&quot;</code>，这是 JavaScript 语言本身的 bug。<br>不幸的是，这个 bug 永远不可能被修复了，因为太多已有的代码已经依赖了这样的表现。<br>这并不意味着，<code>null</code> 实际上是一个对象。</p>
<h3 id="属性类型"><a href="#属性类型" class="headerlink" title="属性类型"></a>属性类型</h3><h4 id="数据属性"><a href="#数据属性" class="headerlink" title="数据属性"></a>数据属性</h4><table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>[[Configurable]]</code></td>
<td>表示能否通过 <code>delete</code> 删除属性从而重新定义属性，能否改变属性的特性，或者能否改变把属性改为访问器属性。<code>true</code></td>
<td></td>
</tr>
<tr>
<td><code>[[Enumerable]]</code></td>
<td>表示能否通过 <code>for-in</code> 循环返回属性。<code>true</code></td>
<td></td>
</tr>
<tr>
<td><code>[[Writable]]</code></td>
<td>表示能否修改属性值。<code>ture</code></td>
<td></td>
</tr>
<tr>
<td><code>[[Value]]</code></td>
<td>包含实际值。<code>undefined</code></td>
<td></td>
</tr>
</tbody>
</table>
<p>严格模式下不合法的操作会抛出异常，非严格模式会忽略相关操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, <span class="string">'name'</span>, &#123;</span><br><span class="line">  configurable: <span class="literal">false</span>,</span><br><span class="line">  enumerable: <span class="literal">true</span>,</span><br><span class="line">  writable: <span class="literal">false</span>,</span><br><span class="line">  value: <span class="string">'liuyanjie'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, <span class="string">'sax'</span>, &#123;</span><br><span class="line">  configurable: <span class="literal">false</span>,</span><br><span class="line">  enumerable: <span class="literal">false</span>,</span><br><span class="line">  writable: <span class="literal">false</span>,</span><br><span class="line">  value: <span class="string">'M'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(person);            <span class="comment">// &#123; name: 'liuyanjie' &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(person.sax);        <span class="comment">// M</span></span><br></pre></td></tr></table></figure>
<h4 id="访问器属性-getter-setter"><a href="#访问器属性-getter-setter" class="headerlink" title="访问器属性: getter setter"></a>访问器属性: <code>getter</code> <code>setter</code></h4><table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>[[Configurable]]</code></td>
<td>表示能否通过 <code>delete</code> 删除属性从而重新定义属性，能否改变属性的特性，或者能否改变把属性改为访问器属性。<code>true</code></td>
</tr>
<tr>
<td><code>[[Enumerable]]</code></td>
<td>表示能否通过 <code>for-in</code> 循环返回属性。<code>true</code></td>
</tr>
<tr>
<td><code>[[Getter]]</code></td>
<td>取值函数。<code>undefined</code></td>
</tr>
<tr>
<td><code>[[Setter]]</code></td>
<td>赋值函数。<code>undefined</code></td>
</tr>
</tbody>
</table>
<ul>
<li><code>getter</code> 和 <code>setter</code> 不一定要成对出现</li>
<li>只有 <code>getter</code> 函数证明该属性只读，尝试写入在非严格模式下会被忽略，严格模式会抛出错误</li>
<li>只有 <code>setter</code> 函数证明该属性只写，尝试读取在非严格模式下返回 <code>undefined</code>，严格模式则抛出错误</li>
<li>对象的 <code>数据属性</code>、<code>访问器属性</code> 都包含 <code>[[configurable]]</code> 和 <code>[[enumerable]]</code>，但不能同时有 <code>[[writeable]]</code>/<code>[[value]]</code> 和 <code>[[get]]</code>/<code>[[set]]</code>，数据属性也可以函数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> book1 = &#123; <span class="attr">_year</span>: <span class="number">2014</span>, <span class="attr">edition</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(book1, <span class="string">'year'</span>, &#123;</span><br><span class="line">  configurable: <span class="literal">false</span>,</span><br><span class="line">  enumerable: <span class="literal">true</span>,</span><br><span class="line">  get: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._year;</span><br><span class="line">  &#125;,</span><br><span class="line">  set: <span class="function"><span class="keyword">function</span> (<span class="params">year</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (year &gt; <span class="number">2014</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>._year = year;</span><br><span class="line">      <span class="keyword">this</span>.edition += year - <span class="number">2014</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(book1);      <span class="comment">// &#123; _year: 2014, edition: 1, year: [Getter/Setter] &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(book1.year);  <span class="comment">// 2014</span></span><br><span class="line">book.year = <span class="number">2016</span>;</span><br><span class="line"><span class="built_in">console</span>.log(book1);      <span class="comment">// &#123; _year: 2016, edition: 3, year: [Getter/Setter] &#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给 对象 设置 多个 `数据属性` 和 `访问器属性`</span></span><br><span class="line"><span class="keyword">var</span> book2 = &#123; <span class="attr">_year</span>: <span class="number">2014</span>, <span class="attr">edition</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperties(book2, &#123;</span><br><span class="line">  _year: &#123;</span><br><span class="line">    value: <span class="number">2014</span></span><br><span class="line">  &#125;,</span><br><span class="line">  edition: &#123;</span><br><span class="line">    value: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  year: &#123;</span><br><span class="line">    configurable: <span class="literal">false</span>,</span><br><span class="line">    enumerable: <span class="literal">false</span>,</span><br><span class="line">    get: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;,</span><br><span class="line">    set: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getContents: &#123;</span><br><span class="line">    value: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'contents'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 属性 信息</span></span><br><span class="line"><span class="keyword">var</span> desc1 = <span class="built_in">Object</span>.getOwnPropertyDescriptor(book2, <span class="string">'year'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(desc1);</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   get: [Function],</span></span><br><span class="line"><span class="comment">//   set: [Function],</span></span><br><span class="line"><span class="comment">//   enumerable: false,</span></span><br><span class="line"><span class="comment">//   configurable: false</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="keyword">var</span> desc2 = <span class="built_in">Object</span>.getOwnPropertyDescriptor(book2, <span class="string">'getContents'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(desc2);</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   value: [Function],</span></span><br><span class="line"><span class="comment">//   writable: false,</span></span><br><span class="line"><span class="comment">//   enumerable: false,</span></span><br><span class="line"><span class="comment">//   configurable: false</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="应用："><a href="#应用：" class="headerlink" title="应用："></a>应用：</h4><ul>
<li>[观察者模式]例子<a href="http://hcysun.me/2016/04/28/JavaScript%E5%AE%9E%E7%8E%B0MVVM%E4%B9%8B%E6%88%91%E5%B0%B1%E6%98%AF%E6%83%B3%E7%9B%91%E6%B5%8B%E4%B8%80%E4%B8%AA%E6%99%AE%E9%80%9A%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%8F%98%E5%8C%96/" target="_blank" rel="noopener">JavaScript实现MVVM监测一个普通对象的变化</a></li>
</ul>
<h3 id="ECMAScript5-对象保护功能"><a href="#ECMAScript5-对象保护功能" class="headerlink" title="ECMAScript5 对象保护功能"></a>ECMAScript5 对象保护功能</h3><p>在 JavaScript 里，默认情况下，你可修改任何你可以访问到的对象，你可以自由的删除对象的属性或覆盖对象的方法。<br>这在多人协作开发的项目中，会造成很大问题，因为你不知道你的修改会对别人造成什么样的影响。<br>如果你是一个模块或代码库的作者，你可能想锁定一些核心库的某些部分，保证任何人不能有意或无意的修改它们。<br>严格模式下抛出异常，普通模式下安静的失败；</p>
<ul>
<li>禁止添加属性：禁止扩展。即：禁止为对象添加属性和方法，但已存在的属性和方法是可以被修改和删除的。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person1 = &#123; <span class="attr">name</span>: <span class="string">'liuht'</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.preventExtensions(person1);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isFrozen:'</span>, <span class="built_in">Object</span>.isFrozen(person1));             <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isSealed:'</span>, <span class="built_in">Object</span>.isSealed(person1));             <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isExtensible:'</span>, <span class="built_in">Object</span>.isExtensible(person1));     <span class="comment">// -&gt; false</span></span><br><span class="line">person1.sex = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(person1);</span><br><span class="line"><span class="built_in">console</span>.log(person1.sex);</span><br></pre></td></tr></table></figure>
<ul>
<li>禁止删除属性：密封。即：禁止删除对象已存在的属性和方法。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person2 = &#123; <span class="attr">name</span>: <span class="string">'liuht'</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.seal(person2);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isFrozen:'</span>, <span class="built_in">Object</span>.isFrozen(person2));             <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isSealed:'</span>, <span class="built_in">Object</span>.isSealed(person2));             <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isExtensible:'</span>, <span class="built_in">Object</span>.isExtensible(person2));     <span class="comment">// -&gt; false</span></span><br><span class="line"><span class="keyword">delete</span> person2.name;</span><br><span class="line">person2.age = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(person2);</span><br></pre></td></tr></table></figure>
<ul>
<li>禁止添加或删除属性：冻结。即：禁止修改对象已存在的属性和方法，所有字段都是只读的。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> persion3 = &#123; <span class="attr">name</span>: <span class="string">'liuht'</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.freeze(persion3);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isFrozen:'</span>, <span class="built_in">Object</span>.isFrozen(persion3));            <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isSealed:'</span>, <span class="built_in">Object</span>.isSealed(persion3));            <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isExtensible:'</span>, <span class="built_in">Object</span>.isExtensible(persion3));    <span class="comment">// -&gt; false</span></span><br><span class="line"><span class="keyword">delete</span> persion3.name;</span><br><span class="line">persion3.age = <span class="number">10</span>;</span><br><span class="line">persion3.name = <span class="string">'new name'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(persion3);</span><br></pre></td></tr></table></figure>
<p><strong>访问器属性</strong> 和 <strong>对象保护功能</strong> 都是针对 <strong>对象属性</strong> ，而不是 <strong>变量</strong></p>
<p>通常情况下对象拥有相同或者相似的状态结构（也就是相同的属性集合），赋以不同的状态值，在这个情况下我们可能需要使用 <code>构造函数</code>，其以指定的模式来创造对象。</p>
<h2 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h2><ul>
<li>以指定的模式来创造对象</li>
<li>自动地为新创建的对象设置一个原型对象，这个原型对象存储在 <code>ConstructorFunction.prototype</code> 属性中。</li>
</ul>
<p>我们可以使用构造函数来重写上一个拥有对象 <code>b</code> 和对象 <code>c</code> 的例子。因此，对象 <code>a</code> 的角色由 <code>Foo.prototype</code> 来扮演：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params">y</span>) </span>&#123; <span class="keyword">this</span>.y = y; &#125;</span><br><span class="line">Foo.prototype.x = <span class="number">10</span>;</span><br><span class="line">Foo.prototype.calculate = <span class="function"><span class="keyword">function</span> (<span class="params">z</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.x + <span class="keyword">this</span>.y + z;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> Foo(<span class="number">20</span>);</span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> Foo(<span class="number">30</span>);</span><br><span class="line">b.calculate(<span class="number">30</span>);</span><br><span class="line">c.calculate(<span class="number">40</span>);</span><br><span class="line"><span class="built_in">console</span>.log(b.__proto__ === Foo.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(c.__proto__ === Foo.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(b.constructor === Foo);</span><br><span class="line"><span class="built_in">console</span>.log(c.constructor === Foo);</span><br><span class="line"><span class="built_in">console</span>.log(Foo.prototype.constructor === Foo);</span><br><span class="line"><span class="built_in">console</span>.log(b.calculate === b.__proto__.calculate);</span><br><span class="line"><span class="built_in">console</span>.log(b.__proto__.calculate === Foo.prototype.calculate);</span><br></pre></td></tr></table></figure>
<p>这个代码可以表示为如下关系：</p>
<p>可以看到，构造函数 <code>Foo</code> 也有自己的 <code>__proto__</code>，即 <code>Function.prototype</code>，<code>Function.prototype</code> 通过其 <code>__proto__</code> 属性关联到 <code>Object.prototype</code>。</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/constructor-proto-chain.png" alt="constructor-proto-chain"></p>
<p>想一下类的概念，构造函数和原型对象合在一起可以当作一个「类」了。</p>
<p>例如：Python的 <code>First-Class、Dynamic-Classes</code> 显然是以同样的 <code>属性/方法</code> 处理方案来实现的。从这个角度来说，Python 中的类可以看作 ECMAScript 使用的委托继承的一个语法糖。</p>
<p>在ES6中「类」的概念被标准化了，并且实际上以一种构建在构造函数上面的语法糖来实现，就像上面描述的一样。</p>
<p>用类的方式实现如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">this</span>._name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  getName() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span> <span class="keyword">extends</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">  getName() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.getName() + <span class="string">' Doe'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bar = <span class="keyword">new</span> Bar(<span class="string">'John'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(bar.getName()); <span class="comment">// John Doe</span></span><br></pre></td></tr></table></figure>
<p><code>new</code> 操作符 都做了什么？</p>
<ol>
<li>创建一个新对象</li>
<li>将构造函数作用域赋给新对象，即 <code>this</code> 指向了新对象</li>
<li>执行构造函数中的代码，初始化新对象（即 <code>this</code>）</li>
<li>返回新对象的引用 <code>this</code>，没显示返回或返回 <code>this</code>，也可返回其他对象。</li>
</ol>
<p>只要用 <code>new</code> 操作符来调用函数就是构造函数，否则，就是普通函数。</p>
<p>Example：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NewDate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> NewDate();</span><br><span class="line"><span class="built_in">console</span>.log(date <span class="keyword">instanceof</span> NewDate); <span class="comment">// ?</span></span><br><span class="line"><span class="built_in">console</span>.log(date <span class="keyword">instanceof</span> <span class="built_in">Date</span>);    <span class="comment">// ?</span></span><br></pre></td></tr></table></figure>
<h2 id="对象构造"><a href="#对象构造" class="headerlink" title="对象构造"></a>对象构造</h2><h3 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h3><ul>
<li>按指定模式创建对象的，但是对象类型无法标识，且每个方法在每个对象上都要重新创建一次。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createObject</span>(<span class="params">arg1, arg2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">  o.property1 = arg1;</span><br><span class="line">  o.property2 = arg2;</span><br><span class="line">  o.func = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.property1);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.property2);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o1 = createObject(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> o2 = createObject(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="built_in">console</span>.log(o1.property1);</span><br></pre></td></tr></table></figure>
<h3 id="构造函数模式"><a href="#构造函数模式" class="headerlink" title="构造函数模式"></a>构造函数模式</h3><ul>
<li>构造函数名字用来标志一个 <code>特定类型</code>，同样每个方法在每个对象上都要重新创建一次。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NewObject</span>(<span class="params">arg1, arg2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.property1 = arg1;</span><br><span class="line">  <span class="keyword">this</span>.property2 = arg2;</span><br><span class="line">  <span class="keyword">this</span>.func = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.property1);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> no1 = <span class="keyword">new</span> NewObject(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> no2 = <span class="keyword">new</span> NewObject(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="comment">// 构造函数属性 constructor 标志对象类型</span></span><br><span class="line"><span class="built_in">console</span>.log(no1.constructor == NewObject);</span><br><span class="line"><span class="built_in">console</span>.log(no1.constructor == <span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">console</span>.log(no2.constructor == NewObject);</span><br><span class="line"><span class="built_in">console</span>.log(no2.constructor == <span class="built_in">Object</span>);</span><br><span class="line"><span class="comment">// 检测对象　更可靠</span></span><br><span class="line"><span class="built_in">console</span>.log(no1 <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">console</span>.log(no1 <span class="keyword">instanceof</span> NewObject);</span><br><span class="line"><span class="built_in">console</span>.log(no2 <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">console</span>.log(no2 <span class="keyword">instanceof</span> NewObject);</span><br></pre></td></tr></table></figure>
<h3 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h3><ul>
<li>每个函数都有一个 <code>prototype</code> 属性，引用另一个对象，这个对象可以实现属性的共享。</li>
<li><code>prototype</code> 是构造函数的一个属性，<code>prototype</code> 指向的 <code>原型对象</code> 拥有一个<code>constructor</code> 属性指向构造函数。</li>
<li>通过构造函数创建的 <code>对象实例</code> 可以通过 <code>__proto__</code> 访问 <code>原型对象</code>，但是不能重写，重名的属性将屏蔽原型中的同名属性。</li>
<li>在原型中修改属性，会立刻在 <code>对象实例</code> 中反映出来。但是如果重写整个原型对象，那么实例对象将找不到原型中定义的属性。</li>
<li><code>prototype</code> 和 <code>constructor</code> 构成了双向链表。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PrototypeObject</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">PrototypeObject.prototype.name = <span class="string">'PrototypeObject'</span>; <span class="comment">// name 是多实例共享的</span></span><br><span class="line">PrototypeObject.prototype.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> po1 = <span class="keyword">new</span> PrototypeObject();</span><br><span class="line">po1.sayName();</span><br><span class="line"><span class="keyword">var</span> po2 = <span class="keyword">new</span> PrototypeObject();</span><br><span class="line">po2.sayName();</span><br><span class="line"><span class="built_in">console</span>.log(po1.sayName === po2.sayName);       <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(po1.sayName() === po2.sayName());   <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(PrototypeObject.prototype.constructor === PrototypeObject); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 每个实例　拥有一个[[Prototype]]属性指向原型对象，但是JS代码无法访问此属性。</span></span><br><span class="line"><span class="built_in">console</span>.log(PrototypeObject.prototype.isPrototypeOf(po1));              <span class="comment">// true  // 判断po1.[[Prototype]] ===</span></span><br><span class="line"><span class="built_in">console</span>.log(PrototypeObject.prototype.isPrototypeOf(po2));              <span class="comment">// true  // 判断po2.[[Prototype]] ===</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getPrototypeOf(po1) === PrototypeObject.prototype);  <span class="comment">// 返回原型对象</span></span><br><span class="line"><span class="built_in">console</span>.log(po1.hasOwnProperty(<span class="string">'sayName'</span>));                             <span class="comment">// 判断是否是对象属性  检测属性存在于对象中还是原型对象中</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hasPrototypeProperty</span>(<span class="params">object, name</span>) </span>&#123;               <span class="comment">// 判断是否是原型属性</span></span><br><span class="line">  <span class="keyword">return</span> !object.hasOwnProperty(name) &amp;&amp; (name <span class="keyword">in</span> object);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Object.keys();                    // 返回所有可枚举的实例属性</span></span><br><span class="line"><span class="comment">// Object.getOwnPropertyNames();     // 返回所有实例属性</span></span><br><span class="line"><span class="comment">// 原型同样可以这样定义：原型对象 = 字面量，prototype的constructor不再等于PrototypeObject，但是instanceof()仍能继续工作。</span></span><br><span class="line">PrototypeObject.prototype = &#123; <span class="comment">// 这样把整个原型改了</span></span><br><span class="line">    <span class="keyword">constructor</span>: Person // 默认的<span class="keyword">constructor</span>被覆盖掉了 [[Enumerable]]会变成true</span><br><span class="line">&#125;</span><br><span class="line">Object.defineProperty(PrototypeObject.prototype, '<span class="keyword">constructor</span>', &#123;</span><br><span class="line">  enumerable: <span class="literal">false</span>,</span><br><span class="line">  value: Persion</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="组合构造函数和原型模式-默认模式"><a href="#组合构造函数和原型模式-默认模式" class="headerlink" title="组合构造函数和原型模式 - [默认模式]"></a>组合构造函数和原型模式 - [默认模式]</h3><ul>
<li>实例属性在构造函数中定义 共享属性在原型中定义</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ConstructPrototypeObject</span>(<span class="params">name, desc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.desc = desc;</span><br><span class="line">&#125;</span><br><span class="line">ConstructPrototypeObject.prototype.display = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.desc);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="动态原型模式"><a href="#动态原型模式" class="headerlink" title="动态原型模式"></a>动态原型模式</h3><ul>
<li>只在第一次调用构造函数时 实例化原型，好像没这个问题。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ConstructPrototypeObject</span>(<span class="params">name, desc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.desc = desc;</span><br><span class="line">  <span class="keyword">if</span> (!ConstructPrototypeObject.prototypeInstantiated) &#123;</span><br><span class="line">      <span class="comment">//只在第一次调用构造函数时 实例化原型</span></span><br><span class="line">    ConstructPrototypeObject.prototype.prototypeInstantiated = <span class="literal">true</span>;</span><br><span class="line">    ConstructPrototypeObject.prototype.display = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.desc);</span><br><span class="line">    &#125;;</span><br><span class="line">    ConstructPrototypeObject.prototype.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// ... ...</span></span><br><span class="line">    ConstructPrototypeObject.prototypeInstantiated = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="扩展模式-（寄生模式）"><a href="#扩展模式-（寄生模式）" class="headerlink" title="扩展模式 （寄生模式）"></a>扩展模式 （寄生模式）</h3><ul>
<li>这种方式，可以用来扩展原生对象，在不修改原生对象的前提下，扩展方法，并不影响类型识别。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SpecialArray</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> values = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">  values.push.apply(values, <span class="built_in">arguments</span>);</span><br><span class="line">  values.toPipedString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.join(<span class="string">'|'</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> values;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> colors = <span class="keyword">new</span> SpecialArray(<span class="string">'red'</span>, <span class="string">'blue'</span>, <span class="string">'green'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(colors.toPipedString());</span><br><span class="line"><span class="built_in">console</span>.log(colors <span class="keyword">instanceof</span> SpecialArray);  <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(colors <span class="keyword">instanceof</span> <span class="built_in">Array</span>);         <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="稳妥构造函数模式"><a href="#稳妥构造函数模式" class="headerlink" title="稳妥构造函数模式"></a>稳妥构造函数模式</h3><ul>
<li>数据成员位于 <code>作用域链</code> 中，不存在 <code>原型链</code> 或 <code>对象的属性</code>，可实现 <code>私有属性</code>，防止数据被其他程序改动时使用，适合用于一些安全环境，这些环境禁止使用 <code>this</code> 和 <code>new</code>。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, job</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">  <span class="keyword">var</span> name = name;</span><br><span class="line">  o.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> friend = Person(<span class="string">'liuyanjie'</span>, <span class="number">22</span>, <span class="string">'Software Engineer'</span>);</span><br><span class="line">friend.sayName();</span><br><span class="line"><span class="built_in">console</span>.log(friend.name); <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, job</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = name;</span><br><span class="line">  <span class="keyword">this</span>.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> friend = <span class="keyword">new</span> Person(<span class="string">'liuyanjie'</span>, <span class="number">22</span>, <span class="string">'Software Engineer'</span>);</span><br><span class="line">friend.sayName();</span><br><span class="line"><span class="built_in">console</span>.log(friend.name); <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 这里可以定义闭包变量</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, job</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name = name;</span><br><span class="line">    <span class="keyword">this</span>.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> friend = <span class="keyword">new</span> Person(<span class="string">'liuyanjie'</span>, <span class="number">22</span>, <span class="string">'Software Engineer'</span>);</span><br><span class="line">friend.sayName();</span><br><span class="line"><span class="built_in">console</span>.log(friend.name); <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
<h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><h3 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h3><ul>
<li>原型属性会被所有实例共享</li>
<li>无法向超类传递参数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.supProperty = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">SuperType.prototype.getSuperValue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.supProperty;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.subProperty = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">SubType.prototype = <span class="keyword">new</span> SuperType();</span><br><span class="line">SubType.prototype.getSubValue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.subProperty;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> SubType();</span><br><span class="line"><span class="built_in">console</span>.log(instance.getSuperValue());</span><br><span class="line"><span class="comment">// 借用构造函数    在子类型的内部调用父类型的构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SupType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.colors = [<span class="string">'red'</span>, <span class="string">'blue'</span>, <span class="string">'green'</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// this 指 SubType 普通函数调用 把函数当作一个模板 同时可以传递参数</span></span><br><span class="line">  SupType.call(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> SubType();</span><br><span class="line">instance.colors.push(<span class="string">'black'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(instance);</span><br></pre></td></tr></table></figure>
<h3 id="组合继承"><a href="#组合继承" class="headerlink" title="组合继承"></a>组合继承</h3><ul>
<li>原型链继承原型</li>
<li>借用构造函数继承实例属性</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.colors = [<span class="string">'red'</span>, <span class="string">'blue'</span>, <span class="string">'green'</span>];</span><br><span class="line">&#125;</span><br><span class="line">SuperType.prototype.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  SuperType.call(<span class="keyword">this</span>, name);           <span class="comment">// 普通函数</span></span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line">SubType.prototype = <span class="keyword">new</span> SuperType();    <span class="comment">// 构造函数</span></span><br><span class="line">SubType.prototype.constructor = SubType;</span><br><span class="line">SubType.prototype.sayAge = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.age);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> SubType(<span class="string">'liuyanjie'</span>, <span class="number">22</span>);</span><br><span class="line">instance.colors.push(<span class="string">'black'</span>);</span><br><span class="line">instance.sayName();</span><br><span class="line">instance.sayAge();</span><br></pre></td></tr></table></figure>
<h3 id="原型式继承"><a href="#原型式继承" class="headerlink" title="原型式继承"></a>原型式继承</h3><ul>
<li>此方式必须有一个对象作为基础，作为原型。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">object</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123; &#125; <span class="comment">// 临时性构造函数</span></span><br><span class="line">  F.prototype = o;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Object</span>.create();    <span class="comment">//此方法即为原型式继承</span></span><br></pre></td></tr></table></figure>
<h3 id="寄生式继承"><a href="#寄生式继承" class="headerlink" title="寄生式继承"></a>寄生式继承</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createAnother</span>(<span class="params">original</span>) </span>&#123;          <span class="comment">// 工厂</span></span><br><span class="line">  <span class="keyword">var</span> clone = <span class="built_in">Object</span>.create(original);      <span class="comment">// 封装了原型式继承</span></span><br><span class="line">  clone.sayHi = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hi'</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> clone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="寄生组合式继承"><a href="#寄生组合式继承" class="headerlink" title="寄生组合式继承"></a>寄生组合式继承</h3><ul>
<li>借用构造函数继承属性</li>
<li>原型链的混成形式继承方法</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inheritPrototype</span>(<span class="params">subType, supType</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> prototype = <span class="built_in">Object</span>.create(supType.prototype);</span><br><span class="line">  prototype.constructor = subType;</span><br><span class="line">  subType.prototype = prototype;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Node.js原生实现的继承函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">exports.inherits = <span class="function"><span class="keyword">function</span>(<span class="params">ctor, superCtor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (ctor === <span class="literal">undefined</span> || ctor === <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'The constructor to `inherits` must not be '</span> +</span><br><span class="line">                        <span class="string">'null or undefined.'</span>);</span><br><span class="line">  <span class="keyword">if</span> (superCtor === <span class="literal">undefined</span> || superCtor === <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'The super constructor to `inherits` must not '</span> +</span><br><span class="line">                        <span class="string">'be null or undefined.'</span>);</span><br><span class="line">  <span class="keyword">if</span> (superCtor.prototype === <span class="literal">undefined</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'The super constructor to `inherits` must '</span> +</span><br><span class="line">                        <span class="string">'have a prototype.'</span>);</span><br><span class="line">  ctor.super_ = superCtor;</span><br><span class="line">  ctor.prototype = <span class="built_in">Object</span>.create(superCtor.prototype, &#123;</span><br><span class="line">    <span class="keyword">constructor</span>: &#123;value: ctor, <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="attr">writable</span>: <span class="literal">true</span>, <span class="attr">configurable</span>: <span class="literal">true</span>&#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="对象构造和原型链总结"><a href="#对象构造和原型链总结" class="headerlink" title="对象构造和原型链总结"></a>对象构造和原型链总结</h2><p>上面不论是有多少对象构造模式和原型继承模式，只要理解其本质，就容易根据自己的需要实现想要的效果，上面的各种方式都是别人用惯的套路。</p>
<p>构造函数为了构造对象，实现不同功能，第一要先有一个对象（不论怎么来的），然后控制 <code>原型链</code> 和 <code>作用域链</code>。</p>
<p>下图是一个JavaScript Prototype Chain关系图：<a href="images/javascript-prototype.png">查看原图</a></p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/javascript-prototype.png" alt="JavaScript Prototype Chain"></p>
<p>上面的内容都是静态的内容，主要是想把 原型链 讲清楚。</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="函数声明和函数表达式"><a href="#函数声明和函数表达式" class="headerlink" title="函数声明和函数表达式"></a>函数声明和函数表达式</h3><p>函数声明： <code>function 函数名称 (参数){ 函数体 }</code>。</p>
<p>函数表达式： <code>[var f = ] function [函数名称](参数){ 函数体 }</code>，如果有函数名，就是命名函数表达式。</p>
<p>所以，可以看出，如果不声明函数名称，它肯定是表达式，可如果声明了函数名称的话，如何判断是函数声明还是函数表达式呢？</p>
<p>ECMAScript 是通过上下文来区分的，如果 <code>function foo(){}</code> 是作为赋值表达式的一部分的话，那它就是一个函数表达式，如果 <code>function foo(){}</code> 被包含在一个函数体内，或者位于程序的最顶部的话，那它就是一个函数声明。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;&#125;              <span class="comment">// 声明，因为它是程序的一部分</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;&#125;;   <span class="comment">// 表达式，因为它是赋值表达式的一部分</span></span><br><span class="line"><span class="keyword">new</span> <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;&#125;;         <span class="comment">// 表达式，因为它是new表达式</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;&#125;            <span class="comment">// 声明，因为它是函数体的一部分</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>还有一种函数表达式不太常见，就是被括号括住的 <code>(function foo(){})</code>，他是表达式的原因是因为括号， <code>()</code> 是一个分组操作符，它的内部只能包含表达式，我们来看几个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;&#125;      <span class="comment">// 函数声明</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;&#125;);   <span class="comment">// 函数表达式：包含在分组操作符内</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  (<span class="keyword">var</span> x = <span class="number">5</span>);        <span class="comment">// 分组操作符，只能包含表达式而不能包含语句：这里的var就是语句</span></span><br><span class="line">&#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">  <span class="comment">// SyntaxError</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在使用 <code>eval</code> 对JSON进行执行的时候，JSON字符串通常被包含在一个圆括号里： <code>eval(&#39;(&#39; + json + &#39;)&#39;)</code>，这样做的原因就是因为分组操作符，也就是这对括号，会让解析器强制将JSON的花括号解析成表达式而不是代码块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  &#123; <span class="string">"x"</span>: <span class="number">5</span> &#125;; <span class="comment">// "&#123;" 和 "&#125;" 做解析成代码块</span></span><br><span class="line">&#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">  <span class="comment">// SyntaxError</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(&#123; <span class="string">"x"</span>: <span class="number">5</span> &#125;); <span class="comment">// 分组操作符强制将"&#123;" 和 "&#125;"作为对象字面量来解析</span></span><br></pre></td></tr></table></figure>
<p>匿名函数的好几种写法，一般情况下写匿名函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;)();</span><br></pre></td></tr></table></figure>
<p>但下面几种写法也是可以的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">!<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;();</span><br><span class="line">+<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;();</span><br><span class="line">-<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;();</span><br><span class="line">~<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;();</span><br><span class="line">~(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;)();</span><br><span class="line"><span class="keyword">void</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;();</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;());</span><br></pre></td></tr></table></figure>
<p>现在，在我们知道了对象的基础之后，让我们看看运行时程序的执行 <code>runtime program execution</code> 在ECMAScript中是如何实现的。</p>
<p>源文件地址：<a href="https://github.com/liuyanjie/knowledge/tree/master/langs/ecmascript/javascript-base.md" target="_blank" rel="noopener">https://github.com/liuyanjie/knowledge/tree/master/langs/ecmascript/javascript-base.md</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/avatar.png" alt="lyj">
            
              <p class="site-author-name" itemprop="name">lyj</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/liuyanjie" title="GitHub &rarr; https://github.com/liuyanjie" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="/liuyj619@gmail.com" title="E-Mail &rarr; liuyj619@gmail.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heartbeat"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lyj</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">116k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">1:46</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v6.6.0</div>



  <div class="footer-custom">Hosted by <a href="https://github.com/liuyanjie/liuyanjie.github.io" class="theme-link" rel="noopener" target="_blank">GitHub Pages</a></div>


        








        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
























  



  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/reading_progress/reading_progress.js"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.6.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  

  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  

  
    <script id="dsq-count-scr" src="https://liuyanjie.disqus.com/count.js" async></script>
  

  













  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=6.6.0"></script>



  

  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
  

  


  

  

  

  
  <script src="/js/src/js.cookie.js?v=6.6.0"></script>
  <script src="/js/src/scroll-cookie.js?v=6.6.0"></script>


  

  
  
  
  <script src="/lib/bookmark/bookmark.min.js?v=1.0"></script>
  <script>
  
    bookmark.loadBookmark();
  
  </script>


  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
  

  


</body>
</html>
