<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    

    <!--Author-->
    
        <meta name="author" content="Liu Yanjie">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Liuyanjie&#39;s Blog"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Liuyanjie&#39;s Blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>Liuyanjie&#39;s Blog</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">Liuyanjie's Blog</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/posts/GIT对象模型/">
                GIT对象模型
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-05-07</span>
            
            
                <a href="/posts/GIT对象模型/#disqus_thread" class="comments article-comment-link">Comments</a>
            
            
                <span class="category">
                    <a href="/categories/GIT/">GIT</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="GIT对象模型"><a href="#GIT对象模型" class="headerlink" title="GIT对象模型"></a>GIT对象模型</h2><h3 id="SHA"><a href="#SHA" class="headerlink" title="SHA"></a>SHA</h3><p>所有用来表示项目历史信息的文件,是通过一个40个字符的（40-digit）“对象名”来索引的，对象名看起来像这样:</p>
<blockquote>
<p>6ff87c4664981e4397625791c8ea3bbb5f2279a3</p>
</blockquote>
<p>在后边使用对象名时，只使用前面几个字符即可，但是最少需要4个。</p>
<p>你会在Git里到处看到这种“40个字符”字符串。每一个“对象名”都是对“对象”内容做SHA1哈希计算得来的，（SHA1是一种密码学的哈希算法）。这样就意味着两个不同内容的对象不可能有相同的“对象名”。</p>
<p>这样做会有几个好处：</p>
<p>Git只要比较对象名，就可以很快的判断两个对象是否相同。<br>因为在每个仓库（repository）的“对象名”的计算方法都完全一样，如果同样的内容存在两个不同的仓库中，就会存在相同的“对象名”下。<br>Git还可以通过检查对象内容的SHA1的哈希值和“对象名”是否相同，来判断对象内容是否正确。</p>
<h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><p>每个对象(object) 包括三个部分：类型，大小和内容。大小就是指内容的大小，内容取决于对象的类型，有四种类型的对象：”blob”、”tree”、 “commit” 和”tag”。</p>
<p>几乎所有的Git功能都是使用这四个简单的对象类型来完成的。它就像是在你本机的文件系统之上构建一个小的文件系统。</p>
<h4 id="blob-文件-对象"><a href="#blob-文件-对象" class="headerlink" title="blob (文件) 对象"></a>blob (文件) 对象</h4><p>“blob”用来存储文件数据，通常是一个文件。</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/vcs/gitimages/object-blob.png" alt="blob"></p>
<h4 id="tree-树-对象"><a href="#tree-树-对象" class="headerlink" title="tree (树) 对象"></a>tree (树) 对象</h4><p>“tree”有点像一个目录，它管理一些“tree”或是 “blob”（就像文件和子目录）</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/vcs/gitimages/object-tree.png" alt="tree"></p>
<h4 id="commit-提交-对象"><a href="#commit-提交-对象" class="headerlink" title="commit (提交) 对象"></a>commit (提交) 对象</h4><p>一个“commit”只指向一个”tree”，它用来标记项目某一个特定时间点的状态。它包括一些关于时间点的元数据，如时间戳、最近一次提交的作者、指向上次提交（commits）的指针等等。</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/vcs/gitimages/object-commit.png" alt="tree"></p>
<h4 id="tag-标签-对象"><a href="#tag-标签-对象" class="headerlink" title="tag (标签) 对象"></a>tag (标签) 对象</h4><p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/vcs/gitimages/object-tag.png" alt="tag"></p>
<p>一个“tag”是来标记某一个提交(commit)的方法。</p>
<h4 id="commit-gt-tree-gt-blob"><a href="#commit-gt-tree-gt-blob" class="headerlink" title="commit -&gt; tree -&gt; blob"></a>commit -&gt; tree -&gt; blob</h4><p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/vcs/gitimages/object-c-t-b.png" alt="object-c-t-b"></p>
<h3 id="与SVN的区别"><a href="#与SVN的区别" class="headerlink" title="与SVN的区别"></a>与SVN的区别</h3><p>Git与你熟悉的大部分版本控制系统的差别是很大的。</p>
<p>也许你熟悉Subversion、CVS、Perforce、Mercurial 等等，他们使用 “增量文件系统” （Delta Storage systems）, 就是说它们存储每次提交(commit)之间的差异。</p>
<p>Git正好与之相反，它会把你的每次提交的文件的全部内容（snapshot）都会记录下来。</p>
<p>这会是在使用Git时的一个很重要的理念。</p>
<h2 id="一步一步了解Git在做什么"><a href="#一步一步了解Git在做什么" class="headerlink" title="一步一步了解Git在做什么"></a>一步一步了解Git在做什么</h2><h3 id="初始化仓库"><a href="#初始化仓库" class="headerlink" title="初始化仓库"></a>初始化仓库</h3><p>初始化目录并创建一个Git仓库</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ mkdir git-obj-model</span><br><span class="line">➜  ~ <span class="built_in">cd</span> git-obj-model</span><br><span class="line">➜  git-obj-model git init</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /home/liuyanjie/git-obj-model/.git/</span><br></pre></td></tr></table></figure>
<p>看一下初始化的git仓库中到底有些什么内容。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ls .git/*/*</span><br><span class="line">.git/hooks/applypatch-msg.sample  .git/hooks/post-update.sample     .git/hooks/pre-commit.sample          .git/hooks/pre-push.sample    .git/hooks/update.sample</span><br><span class="line">.git/hooks/commit-msg.sample      .git/hooks/pre-applypatch.sample  .git/hooks/prepare-commit-msg.sample  .git/hooks/pre-rebase.sample  .git/info/exclude</span><br><span class="line"></span><br><span class="line">.git/objects/info:</span><br><span class="line"></span><br><span class="line">.git/objects/pack:</span><br><span class="line"></span><br><span class="line">.git/refs/heads:</span><br><span class="line"></span><br><span class="line">.git/refs/tags:</span><br></pre></td></tr></table></figure>
<p>查看仓库状态</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">Initial commit</span><br><span class="line"></span><br><span class="line">nothing to commit (create/copy files and use <span class="string">"git add"</span> to track)</span><br></pre></td></tr></table></figure>
<p>后面忽略<code>.git/hooks/</code>下的文件。</p>
<h3 id="增加一个文件README-md"><a href="#增加一个文件README-md" class="headerlink" title="增加一个文件README.md"></a>增加一个文件README.md</h3><p>现在创建一个<code>README.md</code>，看下一<code>.git</code>目录，发现依然没有什么变化。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) <span class="built_in">echo</span> <span class="string">"# Readme"</span> &gt; README.md</span><br><span class="line">➜  git-obj-model git:(master) ✗ ls .git/*/*</span><br><span class="line">.git/objects/info:</span><br><span class="line"></span><br><span class="line">.git/objects/pack:</span><br><span class="line"></span><br><span class="line">.git/refs/heads:</span><br><span class="line"></span><br><span class="line">.git/refs/tags:</span><br></pre></td></tr></table></figure>
<p>查看当前状态</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜  git-test git:(master) ✗ git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">Initial commit</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line"></span><br><span class="line">  README.md</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use <span class="string">"git add"</span> to track)</span><br></pre></td></tr></table></figure>
<p>执行<code>git add</code>命令，继续观察，发现增加了<code>.git/objects/f3/954314c1026028e77ea3a765aadefa67b45195</code>文件。</p>
<p>通过猜测，应该知道，这应该是一个<code>blob</code>类型的文件，里面存储文件内容。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ✗ git add README.md</span><br><span class="line">➜  git-obj-model git:(master) ✗ ls .git/*/*</span><br><span class="line">.git/objects/f3:</span><br><span class="line">954314c1026028e77ea3a765aadefa67b45195</span><br><span class="line"></span><br><span class="line">.git/objects/info:</span><br><span class="line"></span><br><span class="line">.git/objects/pack:</span><br><span class="line"></span><br><span class="line">.git/refs/heads:</span><br><span class="line"></span><br><span class="line">.git/refs/tags:</span><br></pre></td></tr></table></figure>
<p>查看当前状态</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  git-test git:(master) ✗ git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">Initial commit</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git rm --cached &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">  new file:   README.md</span><br></pre></td></tr></table></figure>
<p>查看暂存区</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat .git/index</span><br><span class="line"><span class="comment"># On branch master</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Initial commit</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Changes to be committed:</span></span><br><span class="line"><span class="comment">#   (use "git rm --cached &lt;file&gt;..." to unstage)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#       new file:   README.md</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>执行<code>git commit</code>命令，发现路径下又增加了两个文件：</p>
<ul>
<li>.git/objects/9d/978d59f2f22062c0382c859f4c3ef929026303</li>
<li>.git/objects/c1/067ba0a7ba51f937518c9bc051ea744ca748fe</li>
</ul>
<p>从上面的结构图，可以想到：</p>
<p>提交可定会产生一个提交对象，提交对象指向一个树对象，树对象包含上一步添加的<code>blob</code>对象。</p>
<p>下面将通过查看文件内容验证这一点。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ✗ git commit -m <span class="string">'First commit!'</span> README.md</span><br><span class="line">[master (root-commit) 9d978d5] First commit!</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 README.md</span><br><span class="line">➜  git-obj-model git:(master) ls .git/*/*</span><br><span class="line">.git/logs/refs:</span><br><span class="line">heads</span><br><span class="line"></span><br><span class="line">.git/objects/2f:</span><br><span class="line">99fbf7472b248f4301fbf6383979c92c474245</span><br><span class="line"></span><br><span class="line">.git/objects/c1:</span><br><span class="line">067ba0a7ba51f937518c9bc051ea744ca748fe</span><br><span class="line"></span><br><span class="line">.git/objects/f3:</span><br><span class="line">954314c1026028e77ea3a765aadefa67b45195</span><br><span class="line"></span><br><span class="line">.git/objects/info:</span><br><span class="line"></span><br><span class="line">.git/objects/pack:</span><br><span class="line"></span><br><span class="line">.git/refs/heads:</span><br><span class="line">master</span><br><span class="line"></span><br><span class="line">.git/refs/tags:</span><br></pre></td></tr></table></figure>
<p>通过<code>git cat-file</code>查看文件内容。</p>
<p>发现<code>9d978d5</code>是一个提交对象，里面包含提交相关的信息，并指向一个树对象。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) git cat-file commit 9d978d5</span><br><span class="line">tree c1067ba0a7ba51f937518c9bc051ea744ca748fe</span><br><span class="line">author liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476109684 +0800</span><br><span class="line">committer liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476109684 +0800</span><br><span class="line"></span><br><span class="line">First commit!</span><br></pre></td></tr></table></figure>
<p>再看<code>.git/refs/heads/master</code>文件内容，发现只有一行，写着提交对象的文件名。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) cat .git/refs/heads/master</span><br><span class="line">2f99fbf7472b248f4301fbf6383979c92c474245</span><br></pre></td></tr></table></figure>
<p>再看<code>c1067b</code>文件内容，是一个树对象，同样只有一行，记录刚添加的<code>README.md</code>的文件信息。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) git cat-file -p c1067b</span><br><span class="line">100644 blob f3954314c1026028e77ea3a765aadefa67b45195  README.md</span><br></pre></td></tr></table></figure>
<p>再看<code>f39543</code>文件内容，发现是<code>README.md</code>的文件内容。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) git cat-file -p f39543</span><br><span class="line"><span class="comment"># Readme</span></span><br><span class="line">➜  git-obj-model git:(master) ls</span><br><span class="line">README.md</span><br></pre></td></tr></table></figure>
<p>再看下一下.git目录中新增加的<code>.git/logs/refs/heads/master</code>，发现是刚刚提交的文件记录，包含两个提交对象作者及注释等。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ✗ cat .git/logs/refs/heads/master</span><br><span class="line">0000000000000000000000000000000000000000 2f99fbf7472b248f4301fbf6383979c92c474245 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476109684 +0800	commit (initial): First commit!</span><br></pre></td></tr></table></figure>
<p>通过以上查看<code>.git</code>目录的变化过程，可以大致分析出Git是如何存储这些文件内容的。</p>
<p>上面只执行了<code>git add</code>和<code>git commit</code>两条操作。</p>
<h3 id="继续添加文件"><a href="#继续添加文件" class="headerlink" title="继续添加文件"></a>继续添加文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) <span class="built_in">echo</span> <span class="string">"# CHANGELOG"</span> &gt; CHANGELOG.md</span><br><span class="line">➜  git-obj-model git:(master) ✗ <span class="built_in">echo</span> <span class="string">"# CONTRIBUTING"</span> &gt; CONTRIBUTING.md</span><br><span class="line">➜  git-obj-model git:(master) ✗ git status</span><br><span class="line">On branch master</span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line"></span><br><span class="line">  CHANGELOG.md</span><br><span class="line">  CONTRIBUTING.md</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use <span class="string">"git add"</span> to track)</span><br><span class="line">➜  git-obj-model git:(master) ✗ ls</span><br><span class="line">CHANGELOG.md  CONTRIBUTING.md  README.md</span><br><span class="line">➜  git-obj-model git:(master) ✗ git add CHANGELOG.md CONTRIBUTING.md</span><br><span class="line">➜  git-obj-model git:(master) ✗ git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">  new file:   CHANGELOG.md</span><br><span class="line">  new file:   CONTRIBUTING.md</span><br></pre></td></tr></table></figure>
<p>可以看到又增加了，两个文件。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ✗ ls .git/*/*</span><br><span class="line">.git/logs/refs:</span><br><span class="line">heads</span><br><span class="line"></span><br><span class="line">.git/objects/2f:</span><br><span class="line">99fbf7472b248f4301fbf6383979c92c474245</span><br><span class="line"></span><br><span class="line">.git/objects/a0:</span><br><span class="line">cf709bc0991b5340080f944d02894dc1596d46</span><br><span class="line"></span><br><span class="line">.git/objects/c1:</span><br><span class="line">067ba0a7ba51f937518c9bc051ea744ca748fe</span><br><span class="line"></span><br><span class="line">.git/objects/c6:</span><br><span class="line">b9e95b39b8cd8ead8bbf4b118104741017de1b</span><br><span class="line"></span><br><span class="line">.git/objects/f3:</span><br><span class="line">954314c1026028e77ea3a765aadefa67b45195</span><br><span class="line"></span><br><span class="line">.git/objects/info:</span><br><span class="line"></span><br><span class="line">.git/objects/pack:</span><br><span class="line"></span><br><span class="line">.git/refs/heads:</span><br><span class="line">master</span><br><span class="line"></span><br><span class="line">.git/refs/tags:</span><br></pre></td></tr></table></figure>
<p>分别查看一下各个文件的内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ✗ git cat-file -p a0cf70</span><br><span class="line"><span class="comment"># CHANGELOG</span></span><br><span class="line">➜  git-obj-model git:(master) ✗ git cat-file -p c6b9e9</span><br><span class="line"><span class="comment"># CONTRIBUTING</span></span><br><span class="line">➜  git-obj-model git:(master) ✗ git cat-file -p f39543</span><br><span class="line"><span class="comment"># Readme</span></span><br></pre></td></tr></table></figure>
<p>再查看一下树对象的内容，然而并没有任何变化</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ✗ git cat-file -p c1067b</span><br><span class="line">100644 blob f3954314c1026028e77ea3a765aadefa67b45195  README.md</span><br></pre></td></tr></table></figure>
<p>下面提交这两个文件，可以通过日志方便的查看信息。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ✗ git commit --all -m <span class="string">"add CHANGELOG.md and CONTRIBUTING.md files"</span></span><br><span class="line">[master 4576ab4] add CHANGELOG.md and CONTRIBUTING.md files</span><br><span class="line"> 2 files changed, 2 insertions(+)</span><br><span class="line"> create mode 100644 CHANGELOG.md</span><br><span class="line"> create mode 100644 CONTRIBUTING.md</span><br></pre></td></tr></table></figure>
<p>同样再看一下<code>.git</code>目录下的内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ls .git/*/*</span><br><span class="line">.git/logs/refs:</span><br><span class="line">heads</span><br><span class="line"></span><br><span class="line">.git/objects/2c:</span><br><span class="line">affd90cd736e58f516e3988e3af84f5fa42b4f</span><br><span class="line"></span><br><span class="line">.git/objects/9d:</span><br><span class="line">978d59f2f22062c0382c859f4c3ef929026303</span><br><span class="line"></span><br><span class="line">.git/objects/a0:</span><br><span class="line">cf709bc0991b5340080f944d02894dc1596d46</span><br><span class="line"></span><br><span class="line">.git/objects/b5:</span><br><span class="line">b1d930975db2ccee60faa0dfe9150edf5cbdde</span><br><span class="line"></span><br><span class="line">.git/objects/c1:</span><br><span class="line">067ba0a7ba51f937518c9bc051ea744ca748fe</span><br><span class="line"></span><br><span class="line">.git/objects/c6:</span><br><span class="line">b9e95b39b8cd8ead8bbf4b118104741017de1b</span><br><span class="line"></span><br><span class="line">.git/objects/f3:</span><br><span class="line">954314c1026028e77ea3a765aadefa67b45195</span><br><span class="line"></span><br><span class="line">.git/objects/info:</span><br><span class="line"></span><br><span class="line">.git/objects/pack:</span><br><span class="line"></span><br><span class="line">.git/refs/heads:</span><br><span class="line">master</span><br><span class="line"></span><br><span class="line">.git/refs/tags:</span><br></pre></td></tr></table></figure>
<p>查看一下master上的提交日志，刚刚提交内容在新的一行，与首次提交稍微有点差别，首次提交是commit (initial)。</p>
<p>还可以发现第二次提交的第一列和第一次提交的第二列一样，可以猜到，第一列指向上一次的提交对象。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) cat .git/logs/refs/heads/master</span><br><span class="line">0000000000000000000000000000000000000000 2f99fbf7472b248f4301fbf6383979c92c474245 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476109684 +0800	commit (initial): First commit!</span><br><span class="line">2f99fbf7472b248f4301fbf6383979c92c474245 4576ab487b26945323a4db41c601f912d6f50808 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476110257 +0800	commit: add CHANGELOG.md and CONTRIBUTING.md files</span><br></pre></td></tr></table></figure>
<p>查看log</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) git <span class="built_in">log</span></span><br><span class="line">commit 4576ab487b26945323a4db41c601f912d6f50808</span><br><span class="line">Author: liuyanjie &lt;lyj88888888888@gmail.com&gt;</span><br><span class="line">Date:   Mon Oct 10 22:37:37 2016 +0800</span><br><span class="line"></span><br><span class="line">    add CHANGELOG.md and CONTRIBUTING.md files</span><br><span class="line"></span><br><span class="line">commit 2f99fbf7472b248f4301fbf6383979c92c474245</span><br><span class="line">Author: liuyanjie &lt;lyj88888888888@gmail.com&gt;</span><br><span class="line">Date:   Mon Oct 10 22:28:04 2016 +0800</span><br><span class="line"></span><br><span class="line">    First commit!</span><br></pre></td></tr></table></figure>
<p>master也指向了新的提交对象，和提交日志一致。</p>
<p>第一次产生的提交对象同样存在于目录当中。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) cat .git/refs/heads/master</span><br><span class="line">4576ab487b26945323a4db41c601f912d6f50808</span><br></pre></td></tr></table></figure>
<p>看一下提交对象<code>4576ab</code>的内容，可以看到指向树对象<code>2caffd</code>。</p>
<p>此外，还发现一个parent，显然，这个指向上一次的提交对线，与提交日志保持一致，可以通过parent找到上一次提交。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) git cat-file -p 4576ab</span><br><span class="line">tree 2caffd90cd736e58f516e3988e3af84f5fa42b4f</span><br><span class="line">parent 2f99fbf7472b248f4301fbf6383979c92c474245</span><br><span class="line">author liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476003224 -0700</span><br><span class="line">committer liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476003224 -0700</span><br><span class="line"></span><br><span class="line">add CHANGELOG.md and CONTRIBUTING.md files</span><br></pre></td></tr></table></figure>
<p>在看树对象<code>2caffd</code>，发现相比之前，多了两行，分别指向新增加的文件。</p>
<p>但是，这个对象和上一个树对象并不是同一个树对象。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) git cat-file -p 2caffd</span><br><span class="line">100644 blob a0cf709bc0991b5340080f944d02894dc1596d46  CHANGELOG.md</span><br><span class="line">100644 blob c6b9e95b39b8cd8ead8bbf4b118104741017de1b  CONTRIBUTING.md</span><br><span class="line">100644 blob f3954314c1026028e77ea3a765aadefa67b45195  README.md</span><br></pre></td></tr></table></figure>
<p>到现在为止，整个目录下有3个文件，而.git目录下已经有多个文件，为了跟踪记录版本。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ls</span><br><span class="line">CHANGELOG.md  CONTRIBUTING.md  README.md</span><br></pre></td></tr></table></figure>
<p>通过以上.git目录变化，可以发现（猜）：</p>
<p>commit对象指向一个根树，根树下面再指向文件和目录，类似Linux文件系统结构，和上面的图一致。</p>
<p>每次提交都会产出一commmit对象，这些commit通过parent，形成一个由高版本到低版本的链表，追溯这个链表，可以回到任意版本。</p>
<p>每一个commit都指向一个完整的树，由根树开始，可以遍历到某一般版本下的所有文件。</p>
<p>在每一颗树下，因为都是使用类似指针的结构，所以每次修改都是将变化的文件，重新创建一个blob文件，并修改相应指针。与SVN不同的是，SVN将每个文件都复制了一份。</p>
<p>与实际的目录相比，（看起来）不同的是文件名和文件内容是分开的，但是和Linux系统是类型的，inode这种方式。可以看出来作者安装文件系统的思路实现的。</p>
<p>目录中的<code>.git/refs/heads/master</code>指向某一次提交，当由另外一个分支的时候，会有<code>.git/refs/heads/branch-xxx</code>文件指向另外一次提交，而初始时与父分支指向相同。</p>
<h3 id="再添加一个带有目录文件"><a href="#再添加一个带有目录文件" class="headerlink" title="再添加一个带有目录文件"></a>再添加一个带有目录文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) mkdir lib</span><br><span class="line">➜  git-obj-model git:(master) <span class="built_in">echo</span> <span class="string">"// Author: liuyanjie"</span> &gt; ./lib/index.js</span><br><span class="line">➜  git-obj-model git:(master) ✗ git add lib/index.js</span><br><span class="line">➜  git-obj-model git:(master) ✗ git commit -m <span class="string">"add lib/index.js"</span> lib/index.js</span><br><span class="line">[master 1ad0e58] add lib/index.js</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 lib/index.js</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> ➜  git-obj-model git:(master) git cat-file -p 1ad0e58</span><br><span class="line">tree 9609811e44367d44f2915435f4454716e1e535fd</span><br><span class="line">parent 4576ab487b26945323a4db41c601f912d6f50808</span><br><span class="line">author liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476003520 -0700</span><br><span class="line">committer liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476003520 -0700</span><br><span class="line"></span><br><span class="line">add lib/index.js</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) git cat-file -p 960981</span><br><span class="line">100644 blob a0cf709bc0991b5340080f944d02894dc1596d46  CHANGELOG.md</span><br><span class="line">100644 blob c6b9e95b39b8cd8ead8bbf4b118104741017de1b  CONTRIBUTING.md</span><br><span class="line">100644 blob f3954314c1026028e77ea3a765aadefa67b45195  README.md</span><br><span class="line">040000 tree 2fb9045bb558889ea2bd8cc5d8fe45e7247706da  lib</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) git cat-file -p 2fb904</span><br><span class="line">100644 blob 39a204af28de9b4f0411735e597e0da7416ca35a  index.js</span><br></pre></td></tr></table></figure>
<p>上面连续几步和之前的效果一样，但是可以看到，在树对象<code>960981</code>中，包含了另一个树对象<code>2fb904</code>，这个对象的内容指向<code>index.js</code>文件。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) cat .git/logs/refs/heads/master</span><br><span class="line">0000000000000000000000000000000000000000 2f99fbf7472b248f4301fbf6383979c92c474245 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476109684 +0800	commit (initial): First commit!</span><br><span class="line">2f99fbf7472b248f4301fbf6383979c92c474245 4576ab487b26945323a4db41c601f912d6f50808 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476110257 +0800	commit: add CHANGELOG.md and CONTRIBUTING.md files</span><br><span class="line">4576ab487b26945323a4db41c601f912d6f50808 1ad0e58722bef17c2fb47f64e37d68e9990dd938 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476110760 +0800	commit: add lib/index.js</span><br></pre></td></tr></table></figure>
<p>log</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) git <span class="built_in">log</span></span><br><span class="line">commit 1ad0e58722bef17c2fb47f64e37d68e9990dd938</span><br><span class="line">Author: liuyanjie &lt;lyj88888888888@gmail.com&gt;</span><br><span class="line">Date:   Mon Oct 10 22:46:00 2016 +0800</span><br><span class="line"></span><br><span class="line">    add lib/index.js</span><br><span class="line"></span><br><span class="line">commit 4576ab487b26945323a4db41c601f912d6f50808</span><br><span class="line">Author: liuyanjie &lt;lyj88888888888@gmail.com&gt;</span><br><span class="line">Date:   Mon Oct 10 22:37:37 2016 +0800</span><br><span class="line"></span><br><span class="line">    add CHANGELOG.md and CONTRIBUTING.md files</span><br><span class="line"></span><br><span class="line">commit 2f99fbf7472b248f4301fbf6383979c92c474245</span><br><span class="line">Author: liuyanjie &lt;lyj88888888888@gmail.com&gt;</span><br><span class="line">Date:   Mon Oct 10 22:28:04 2016 +0800</span><br><span class="line"></span><br><span class="line">    First commit!</span><br></pre></td></tr></table></figure>
<h3 id="开始创建分支"><a href="#开始创建分支" class="headerlink" title="开始创建分支"></a>开始创建分支</h3><p>创建并切换到分支<code>feature-a</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) git branch</span><br><span class="line">* master</span><br><span class="line">➜  git-obj-model git:(master) git checkout -b feature<span class="_">-a</span></span><br><span class="line">Switched to a new branch <span class="string">'feature-a'</span></span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) git branch</span><br><span class="line">* feature<span class="_">-a</span></span><br><span class="line">  master</span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ls</span><br><span class="line">CHANGELOG.md  CONTRIBUTING.md  lib  README.md</span><br></pre></td></tr></table></figure>
<p>看一下<code>.git</code>文件内容，可以看到<code>.git/refs/heads</code>目录下多了个<code>feature-a</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">.git/logs/refs:</span><br><span class="line">heads</span><br><span class="line"></span><br><span class="line">.git/objects/1a:</span><br><span class="line">d0e58722bef17c2fb47f64e37d68e9990dd938</span><br><span class="line"></span><br><span class="line">.git/objects/2c:</span><br><span class="line">affd90cd736e58f516e3988e3af84f5fa42b4f</span><br><span class="line"></span><br><span class="line">.git/objects/2f:</span><br><span class="line">99fbf7472b248f4301fbf6383979c92c474245  b9045bb558889ea2bd8cc5d8fe45e7247706da</span><br><span class="line"></span><br><span class="line">.git/objects/39:</span><br><span class="line">a204af28de9b4f0411735e597e0da7416ca35a</span><br><span class="line"></span><br><span class="line">.git/objects/45:</span><br><span class="line">76ab487b26945323a4db41c601f912d6f50808</span><br><span class="line"></span><br><span class="line">.git/objects/96:</span><br><span class="line">09811e44367d44f2915435f4454716e1e535fd</span><br><span class="line"></span><br><span class="line">.git/objects/a0:</span><br><span class="line">cf709bc0991b5340080f944d02894dc1596d46</span><br><span class="line"></span><br><span class="line">.git/objects/c1:</span><br><span class="line">067ba0a7ba51f937518c9bc051ea744ca748fe</span><br><span class="line"></span><br><span class="line">.git/objects/c6:</span><br><span class="line">b9e95b39b8cd8ead8bbf4b118104741017de1b</span><br><span class="line"></span><br><span class="line">.git/objects/f3:</span><br><span class="line">954314c1026028e77ea3a765aadefa67b45195</span><br><span class="line"></span><br><span class="line">.git/objects/info:</span><br><span class="line"></span><br><span class="line">.git/objects/pack:</span><br><span class="line"></span><br><span class="line">.git/refs/heads:</span><br><span class="line">feature<span class="_">-a</span>  master</span><br><span class="line"></span><br><span class="line">.git/refs/tags:</span><br></pre></td></tr></table></figure>
<p>查看一下<code>feature-a</code>的相关内容，指向的提交对象和<code>master</code>一样，并指明<code>Created from HEAD</code>。</p>
<p>从内容中可以看出，两个分支指向同一个提交对象<code>1ad0e5</code>，但是两个分支的日志不同。</p>
<p>日志记录了分之的历史，而提交对象记录了分支的数据内容和所有分支的历史。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) cat .git/logs/refs/heads/feature<span class="_">-a</span></span><br><span class="line">0000000000000000000000000000000000000000 1ad0e58722bef17c2fb47f64e37d68e9990dd938 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476111038 +0800	branch: Created from HEAD</span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) cat .git/logs/refs/heads/master</span><br><span class="line">0000000000000000000000000000000000000000 2f99fbf7472b248f4301fbf6383979c92c474245 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476109684 +0800	commit (initial): First commit!</span><br><span class="line">2f99fbf7472b248f4301fbf6383979c92c474245 4576ab487b26945323a4db41c601f912d6f50808 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476110257 +0800	commit: add CHANGELOG.md and CONTRIBUTING.md files</span><br><span class="line">4576ab487b26945323a4db41c601f912d6f50808 1ad0e58722bef17c2fb47f64e37d68e9990dd938 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476110760 +0800	commit: add lib/index.js</span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) cat .git/refs/heads/feature<span class="_">-a</span></span><br><span class="line">1ad0e58722bef17c2fb47f64e37d68e9990dd938</span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) cat .git/refs/heads/master</span><br><span class="line">1ad0e58722bef17c2fb47f64e37d68e9990dd938</span><br></pre></td></tr></table></figure>
<p>初始化<code>package.json</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) npm init</span><br><span class="line"><span class="comment"># This utility will walk you through creating a package.json file.</span></span><br><span class="line"><span class="comment"># It only covers the most common items, and tries to guess sensible defaults.</span></span><br><span class="line"><span class="comment"># See `npm help json` for definitive documentation on these fields</span></span><br><span class="line"><span class="comment"># and exactly what they do.</span></span><br><span class="line"><span class="comment"># Use `npm install &lt;pkg&gt; --save` afterwards to install a package and</span></span><br><span class="line"><span class="comment"># save it as a dependency in the package.json file.</span></span><br><span class="line"><span class="comment"># Press ^C at any time to quit.</span></span><br><span class="line"><span class="comment"># name: (git-obj-model)</span></span><br><span class="line"><span class="comment"># version: (1.0.0) 0.0.1</span></span><br><span class="line"><span class="comment"># description: git-obj-model</span></span><br><span class="line"><span class="comment"># entry point: (index.js)</span></span><br><span class="line"><span class="comment"># test command: test</span></span><br><span class="line"><span class="comment"># git repository:</span></span><br><span class="line"><span class="comment"># keywords: git object-model</span></span><br><span class="line"><span class="comment"># author: liuyanjie</span></span><br><span class="line"><span class="comment"># license: (ISC) MIT</span></span><br><span class="line"><span class="comment"># About to write to /home/liuyanjie/git-obj-model/package.json:</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#   "name": "git-obj-model",</span></span><br><span class="line"><span class="comment">#   "version": "0.0.1",</span></span><br><span class="line"><span class="comment">#   "description": "git-obj-model",</span></span><br><span class="line"><span class="comment">#   "main": "index.js",</span></span><br><span class="line"><span class="comment">#   "scripts": &#123;</span></span><br><span class="line"><span class="comment">#     "test": "test"</span></span><br><span class="line"><span class="comment">#   &#125;,</span></span><br><span class="line"><span class="comment">#   "keywords": [</span></span><br><span class="line"><span class="comment">#     "git",</span></span><br><span class="line"><span class="comment">#     "object-model"</span></span><br><span class="line"><span class="comment">#   ],</span></span><br><span class="line"><span class="comment">#   "author": "liuyanjie",</span></span><br><span class="line"><span class="comment">#   "license": "MIT"</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># Is this ok? (yes) yes</span></span><br></pre></td></tr></table></figure>
<p>安装<code>bluebird</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ ls</span><br><span class="line">CHANGELOG.md  CONTRIBUTING.md  lib  package.json  README.md</span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ npm install bluebird --save</span><br><span class="line">git-obj-model@0.0.1 /home/liuyanjie/workspace/git-obj-model</span><br><span class="line">└── bluebird@3.4.6</span><br></pre></td></tr></table></figure>
<p>添加文件到版本库，并查看变化。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ git add package.json</span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ cat .git/refs/heads/feature<span class="_">-a</span></span><br><span class="line">1ad0e58722bef17c2fb47f64e37d68e9990dd938</span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ cat .git/refs/heads/master</span><br><span class="line">1ad0e58722bef17c2fb47f64e37d68e9990dd938</span><br></pre></td></tr></table></figure>
<p>提交文件到版本库，并查看变化，提交指针已经指向新的提交对象，分支的版本超前于master，因为parent指向<code>1ad0e5</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ git commit package.json -m <span class="string">'add package.js'</span></span><br><span class="line">[feature<span class="_">-a</span> 0cb2147] add package.js</span><br><span class="line"> 1 file changed, 18 insertions(+)</span><br><span class="line"> create mode 100644 package.json</span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ cat .git/refs/heads/master</span><br><span class="line">1ad0e58722bef17c2fb47f64e37d68e9990dd938</span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ cat .git/refs/heads/feature<span class="_">-a</span></span><br><span class="line">0cb214741c044af3fb4677fe72e3ae175f3e0358</span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ git cat-file -p 0cb214</span><br><span class="line">tree f0cc543f39be5f635bea5bf8420d1cf5669999a9</span><br><span class="line">parent 1ad0e58722bef17c2fb47f64e37d68e9990dd938</span><br><span class="line">author liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476111582 +0800</span><br><span class="line">committer liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476111582 +0800</span><br><span class="line"></span><br><span class="line">add package.js</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ git cat-file -p f0cc54</span><br><span class="line">100644 blob a0cf709bc0991b5340080f944d02894dc1596d46  CHANGELOG.md</span><br><span class="line">100644 blob c6b9e95b39b8cd8ead8bbf4b118104741017de1b  CONTRIBUTING.md</span><br><span class="line">100644 blob f3954314c1026028e77ea3a765aadefa67b45195  README.md</span><br><span class="line">040000 tree 2fb9045bb558889ea2bd8cc5d8fe45e7247706da  lib</span><br><span class="line">100644 blob 25ce01b36287fc8a43ac3eac6e526b4c1c6935d6  package.json</span><br></pre></td></tr></table></figure>
<p>合并分支<code>feature-a</code>到<code>master</code>分支，可以看到<code>master</code>分支跟上了<code>feature-a</code>，只改指针既可，非常快。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) git checkout master</span><br><span class="line">➜  git-obj-model git:(master) ✗ git merge feature<span class="_">-a</span></span><br><span class="line">Updating 1ad0e58..0cb2147</span><br><span class="line">Fast-forward</span><br><span class="line"> package.json | 18 ++++++++++++++++++</span><br><span class="line"> 1 file changed, 18 insertions(+)</span><br><span class="line"> create mode 100644 package.json</span><br><span class="line">➜  git-obj-model git:(master) ✗ cat .git/refs/heads/master</span><br><span class="line">0cb214741c044af3fb4677fe72e3ae175f3e0358</span><br><span class="line">➜  git-obj-model git:(master) ✗ cat .git/refs/heads/feature<span class="_">-a</span></span><br><span class="line">0cb214741c044af3fb4677fe72e3ae175f3e0358</span><br></pre></td></tr></table></figure>
<p>修改<code>master</code>分支</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑文件并提交</span></span><br><span class="line">➜  git-obj-model git:(master) ✗ git checkout master</span><br><span class="line">Already on <span class="string">'master'</span></span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) git checkout master</span><br><span class="line">➜  git-obj-model git:(master) ✗ <span class="built_in">echo</span> -e <span class="string">"\n\n## About"</span> &gt;&gt; README.md</span><br><span class="line">➜  git-obj-model git:(master) ✗ cat README.md</span><br><span class="line"><span class="comment"># Readme</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## About</span></span><br><span class="line">➜  git-obj-model git:(master) ✗ git commit README.md -m <span class="string">"add About"</span></span><br><span class="line">[master ef6834c] add About</span><br><span class="line"> 1 file changed, 3 insertions(+)</span><br></pre></td></tr></table></figure>
<p>修改<code>feature-a</code>分支</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ✗ git checkout feature<span class="_">-a</span></span><br><span class="line">Switched to branch <span class="string">'feature-a'</span></span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ git commit README.md -m <span class="string">"add About Me"</span></span><br><span class="line">[feature<span class="_">-a</span> da24911] add About Me</span><br><span class="line"> 1 file changed, 3 insertions(+)</span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ cat README.md</span><br><span class="line"><span class="comment"># Readme</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## About Me</span></span><br><span class="line"><span class="comment"># 编辑文件，使之产生冲突，然后提交</span></span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) git commit package.json -m <span class="string">'add keyword'</span></span><br></pre></td></tr></table></figure>
<p>查看分支头和历史记录，可以看到分支头指向不同的提交对象，而提交对象，又来源于同一个提交对象<code>0cb214741c044af3fb4677fe72e3ae175f3e0358</code>，两个分支之间存在交叉。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ cat .git/refs/heads/feature<span class="_">-a</span></span><br><span class="line">da2491150e0d66928e485ff1289abf6055069f54</span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ cat .git/refs/heads/master</span><br><span class="line">ef6834c89de31b3d553082392853da00f3d6b452</span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ cat .git/logs/refs/heads/master</span><br><span class="line">0000000000000000000000000000000000000000 2f99fbf7472b248f4301fbf6383979c92c474245 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476109684 +0800	commit (initial): First commit!</span><br><span class="line">2f99fbf7472b248f4301fbf6383979c92c474245 4576ab487b26945323a4db41c601f912d6f50808 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476110257 +0800	commit: add CHANGELOG.md and CONTRIBUTING.md files</span><br><span class="line">4576ab487b26945323a4db41c601f912d6f50808 1ad0e58722bef17c2fb47f64e37d68e9990dd938 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476110760 +0800	commit: add lib/index.js</span><br><span class="line">1ad0e58722bef17c2fb47f64e37d68e9990dd938 0cb214741c044af3fb4677fe72e3ae175f3e0358 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476111812 +0800	merge feature<span class="_">-a</span>: Fast-forward</span><br><span class="line">0cb214741c044af3fb4677fe72e3ae175f3e0358 ef6834c89de31b3d553082392853da00f3d6b452 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476112210 +0800	commit: add About</span><br><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ cat .git/logs/refs/heads/feature<span class="_">-a</span></span><br><span class="line">0000000000000000000000000000000000000000 1ad0e58722bef17c2fb47f64e37d68e9990dd938 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476111038 +0800	branch: Created from HEAD</span><br><span class="line">1ad0e58722bef17c2fb47f64e37d68e9990dd938 0cb214741c044af3fb4677fe72e3ae175f3e0358 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476111582 +0800	commit: add package.js</span><br><span class="line">0cb214741c044af3fb4677fe72e3ae175f3e0358 da2491150e0d66928e485ff1289abf6055069f54 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476112277 +0800	commit: add About Me</span><br></pre></td></tr></table></figure>
<p>切换到<code>master</code>分支，再次合并<code>feature-a</code>到<code>master</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(feature<span class="_">-a</span>) ✗ git checkout master</span><br><span class="line">Switched to branch <span class="string">'master'</span></span><br><span class="line">➜  git-obj-model git:(master) ✗ git merge feature<span class="_">-a</span></span><br><span class="line">Auto-merging README.md</span><br><span class="line">CONFLICT (content): Merge conflict <span class="keyword">in</span> README.md</span><br><span class="line">Automatic merge failed; fix conflicts and <span class="keyword">then</span> commit the result.</span><br><span class="line">➜  git-obj-model git:(master) ✗ cat README.md</span><br><span class="line"><span class="comment"># Readme</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line"><span class="comment">## About</span></span><br><span class="line">=======</span><br><span class="line"><span class="comment">## About Me</span></span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; feature<span class="_">-a</span></span><br></pre></td></tr></table></figure>
<p>解决冲突之后的文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ✗ cat README.md</span><br><span class="line"><span class="comment"># Readme</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## About</span></span><br><span class="line"></span><br><span class="line">➜  git-obj-model git:(master) ✗</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ✗ git commit README.md -m <span class="string">'fix conflict'</span></span><br><span class="line">fatal: cannot <span class="keyword">do</span> a partial commit during a merge.</span><br><span class="line">➜  git-obj-model git:(master) ✗ git commit -a</span><br><span class="line">[master 69d1d1d] Merge branch <span class="string">'feature-a'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ✗ git status</span><br><span class="line">On branch master</span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line"></span><br><span class="line">  node_modules/</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use <span class="string">"git add"</span> to track)</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ✗ cat .git/refs/heads/feature<span class="_">-a</span></span><br><span class="line">fa521b1842700be40c3d7f4aef388435b86cdcb6</span><br><span class="line">➜  git-obj-model git:(master) ✗ cat .git/refs/heads/master</span><br><span class="line">34d8c2fc6b06a8aae7967a8f25f0a4cdd84876a8</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ✗ cat .git/logs/refs/heads/master</span><br><span class="line">0000000000000000000000000000000000000000 2f99fbf7472b248f4301fbf6383979c92c474245 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476109684 +0800	commit (initial): First commit!</span><br><span class="line">2f99fbf7472b248f4301fbf6383979c92c474245 4576ab487b26945323a4db41c601f912d6f50808 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476110257 +0800	commit: add CHANGELOG.md and CONTRIBUTING.md files</span><br><span class="line">4576ab487b26945323a4db41c601f912d6f50808 1ad0e58722bef17c2fb47f64e37d68e9990dd938 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476110760 +0800	commit: add lib/index.js</span><br><span class="line">1ad0e58722bef17c2fb47f64e37d68e9990dd938 0cb214741c044af3fb4677fe72e3ae175f3e0358 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476111812 +0800	merge feature<span class="_">-a</span>: Fast-forward</span><br><span class="line">0cb214741c044af3fb4677fe72e3ae175f3e0358 ef6834c89de31b3d553082392853da00f3d6b452 liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476112210 +0800	commit: add About</span><br><span class="line">ef6834c89de31b3d553082392853da00f3d6b452 69d1d1d381ebbe27585079bf3deaf4ca13ba2fde liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476112974 +0800	commit (merge): Merge branch <span class="string">'feature-a'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ✗ git merge --<span class="built_in">stat</span> feature<span class="_">-a</span></span><br><span class="line">Already up-to-date.</span><br><span class="line">➜  git-obj-model git:(master) ✗ git branch -d feature<span class="_">-a</span></span><br><span class="line">Deleted branch feature<span class="_">-a</span> (was da24911).</span><br><span class="line">➜  git-obj-model git:(master) ✗ git cat-file -p da24911</span><br><span class="line">tree 33ab49e5d62dac2e273f2dc25a8d3d1c08164fd8</span><br><span class="line">parent 0cb214741c044af3fb4677fe72e3ae175f3e0358</span><br><span class="line">author liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476112277 +0800</span><br><span class="line">committer liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476112277 +0800</span><br><span class="line"></span><br><span class="line">add About Me</span><br><span class="line">➜  git-obj-model git:(master) ✗ git cat-file -p 69d1d1</span><br><span class="line">tree 75779b8d5612e7e92d21e24eb93c98a78bef9880</span><br><span class="line">parent ef6834c89de31b3d553082392853da00f3d6b452</span><br><span class="line">parent da2491150e0d66928e485ff1289abf6055069f54</span><br><span class="line">author liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476112974 +0800</span><br><span class="line">committer liuyanjie &lt;lyj88888888888@gmail.com&gt; 1476112974 +0800</span><br><span class="line"></span><br><span class="line">Merge branch <span class="string">'feature-a'</span></span><br><span class="line">➜  git-obj-model git:(master) ✗ git branch</span><br><span class="line">* master</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --graph --all --pretty=format:<span class="string">'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset'</span> --abbrev-commit --date=relative</span><br><span class="line">*   69d1d1d - (HEAD -&gt; master) Merge branch <span class="string">'feature-a'</span> (13 minutes ago) &lt;liuyanjie&gt;</span><br><span class="line">|\</span><br><span class="line">| * da24911 - add About Me (25 minutes ago) &lt;liuyanjie&gt;</span><br><span class="line">* | ef6834c - add About (26 minutes ago) &lt;liuyanjie&gt;</span><br><span class="line">|/</span><br><span class="line">* 0cb2147 - add package.js (36 minutes ago) &lt;liuyanjie&gt;</span><br><span class="line">* 1ad0e58 - add lib/index.js (50 minutes ago) &lt;liuyanjie&gt;</span><br><span class="line">* 4576ab4 - add CHANGELOG.md and CONTRIBUTING.md files (58 minutes ago) &lt;liuyanjie&gt;</span><br><span class="line">* 2f99fbf - First commit! (68 minutes ago) &lt;liuyanjie&gt;</span><br></pre></td></tr></table></figure>
<p>配置命令别名</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global alias.lg <span class="string">"log --graph --all --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit --date=relative"</span></span><br><span class="line">git lg</span><br></pre></td></tr></table></figure>
<h3 id="打标签"><a href="#打标签" class="headerlink" title="打标签"></a>打标签</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">➜  git-obj-model git:(master) ✗ git tag</span><br><span class="line">➜  git-obj-model git:(master) ✗ git tag -a v0.0.1 -m <span class="string">"version 0.0.1"</span></span><br><span class="line">➜  git-obj-model git:(master) ✗ git tag</span><br><span class="line">v0.0.1</span><br><span class="line">➜  git-obj-model git:(master) ✗ cat .git/refs/tags/v0.0.1</span><br><span class="line">3cb5a0d0b86e5d80005d7df9acdfbd0e81e73680</span><br><span class="line">➜  git-obj-model git:(master) ✗ git cat-file -p 3cb5a0</span><br><span class="line">object 34d8c2fc6b06a8aae7967a8f25f0a4cdd84876a8</span><br><span class="line"><span class="built_in">type</span> commit</span><br><span class="line">tag v0.0.1</span><br><span class="line">tagger ubuntu-16.04-64 &lt;liuyanjie&gt; 1476157130 -0700</span><br><span class="line"></span><br><span class="line">version 0.0.1</span><br><span class="line">➜  git-obj-model git:(master) ✗ cat .git/logs/refs/heads/master</span><br><span class="line">0000000000000000000000000000000000000000 9d978d59f2f22062c0382c859f4c3ef929026303 ubuntu-16.04-64 &lt;liuyanjie&gt; 1476002050 -0700  commit (initial): First commit!</span><br><span class="line">9d978d59f2f22062c0382c859f4c3ef929026303 b5b1d930975db2ccee60faa0dfe9150edf5cbdde ubuntu-16.04-64 &lt;liuyanjie&gt; 1476003224 -0700  commit: add CHANGELOG.md and CONTRIBUTING.md files</span><br><span class="line">b5b1d930975db2ccee60faa0dfe9150edf5cbdde 3bf6d4e4f4f8d7f8892b2a33623a65511f34d35a ubuntu-16.04-64 &lt;liuyanjie&gt; 1476003520 -0700  commit: add lib/index.js</span><br><span class="line">3bf6d4e4f4f8d7f8892b2a33623a65511f34d35a 67e9ab4ffbdde212fdf3f640674c742028585c10 ubuntu-16.04-64 &lt;liuyanjie&gt; 1476006305 -0700  merge feature<span class="_">-a</span>: Fast-forward</span><br><span class="line">67e9ab4ffbdde212fdf3f640674c742028585c10 496e60e1943637c66adf87b13e09b04920d97b98 ubuntu-16.04-64 &lt;liuyanjie&gt; 1476006843 -0700  commit: add keyword</span><br><span class="line">496e60e1943637c66adf87b13e09b04920d97b98 34d8c2fc6b06a8aae7967a8f25f0a4cdd84876a8 ubuntu-16.04-64 &lt;liuyanjie&gt; 1476009515 -0700  commit (merge): Merge branch <span class="string">'feature-a'</span></span><br><span class="line">➜  git-obj-model git:(master) ✗ git cat-file -p 34d8c2</span><br><span class="line">tree 950ba459cbd53d9741165b849f6dcb2d799c8841</span><br><span class="line">parent 496e60e1943637c66adf87b13e09b04920d97b98</span><br><span class="line">parent fa521b1842700be40c3d7f4aef388435b86cdcb6</span><br><span class="line">author ubuntu-16.04-64 &lt;liuyanjie&gt; 1476009515 -0700</span><br><span class="line">committer ubuntu-16.04-64 &lt;liuyanjie&gt; 1476009515 -0700</span><br><span class="line"></span><br><span class="line">Merge branch <span class="string">'feature-a'</span></span><br></pre></td></tr></table></figure>
<p><a href="images/git-obj-model.svg">svg版</a></p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/vcs/gitimages/git-obj-model.png" alt="git-obj-model"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/posts/Git命令/">
                Git命令
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-05-07</span>
            
            
                <a href="/posts/Git命令/#disqus_thread" class="comments article-comment-link">Comments</a>
            
            
                <span class="category">
                    <a href="/categories/GIT/">GIT</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="Git命令"><a href="#Git命令" class="headerlink" title="Git命令"></a>Git命令</h1><p>本文件包含常用命令</p>
<h2 id="查看帮助"><a href="#查看帮助" class="headerlink" title="查看帮助"></a>查看帮助</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">help</span></span><br></pre></td></tr></table></figure>
<h2 id="配置管理"><a href="#配置管理" class="headerlink" title="配置管理"></a>配置管理</h2><ul>
<li>配置文件</li>
</ul>
<p>Git 提供了一个叫做 git config 的工具，专门用来配置或读取相应的工作环境变量。而正是由这些环境变量，决定了 Git 在各个环节的具体工作方式和行为。</p>
<p>这些变量可以存放在以下三个不同的地方：</p>
<ul>
<li>/etc/gitconfig ：系统中对所有用户都普遍适用的配置。若使用 git config 时用 –system 选项，读写的就是这个文件。</li>
<li>~/.gitconfig   ：用户目录下的配置文件只适用该用户。若使用 git config 时用 –global 选项，读写的就是这个文件。</li>
<li>.git/config    ：当前项目的 Git 目录中的配置文件，这里的配置仅仅针对当前项目有效。</li>
</ul>
<p>每一个级别的配置都会覆盖上层的相同配置，所以 .git/config 里的配置会覆盖 /etc/gitconfig 中的同名变量。</p>
<ul>
<li>配置用户信息（必须配置）</li>
</ul>
<p>修改全局用户信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">"John Doe"</span></span><br><span class="line">git config --global user.email johndoe@example.com</span><br></pre></td></tr></table></figure>
<ul>
<li>配置文本编辑器</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.editor vim</span><br></pre></td></tr></table></figure>
<ul>
<li>配置差异分析工具</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global merge.tool vimdiff</span><br></pre></td></tr></table></figure>
<p>Git 可以理解 kdiff3，tkdiff，meld，xxdiff，emerge，vimdiff，gvimdiff，ecmerge，和 opendiff 等合并工具的输出信息。</p>
<ul>
<li>查看配置信息</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git config --list</span><br><span class="line">user.name=Scott Chacon</span><br><span class="line">user.email=schacon@gmail.com</span><br><span class="line">color.status=auto</span><br><span class="line">color.branch=auto</span><br><span class="line">color.interactive=auto</span><br><span class="line">color.diff=auto</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<ul>
<li>常用配置</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">"xxx"</span>                       <span class="comment"># 配置用户名</span></span><br><span class="line">git config --global user.email <span class="string">"xxx@xxx.com"</span>              <span class="comment"># 配置邮件</span></span><br><span class="line">git config --global color.ui <span class="literal">true</span></span><br><span class="line">git config --global color.status auto</span><br><span class="line">git config --global color.diff auto</span><br><span class="line">git config --global color.branch auto</span><br><span class="line">git config --global color.interactive auto</span><br></pre></td></tr></table></figure>
<h2 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h2><h3 id="Refspec"><a href="#Refspec" class="headerlink" title="Refspec"></a><a href="https://git-scm.com/book/zh/v1/Git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86-The-Refspec" target="_blank" rel="noopener">Refspec</a></h3><p>refspec主要用来表示本地版本库和远程版本库之间的分支标签等数据的对应关系。</p>
<p>指定获取哪些<code>远程refs</code>更新<code>本地refs</code>，当没有在命令行显示指明<code>refspec</code>，会按照下面的默认策略执行。</p>
<p>Refspec 的格式是一个可选的 + 号，接着是 <src>:<dst> 的格式，这里 <src> 是远端上的引用格式， <dst> 是将要记录在本地的引用格式。可选的 + 号告诉 Git 在即使不能快速演进的情况下，也去强制更新它。</dst></src></dst></src></p>
<p>从远程获取指定数据到本地，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">branch master 	&lt;==&gt; +refs/heads/master:+refs/heads/master</span><br><span class="line">branch A:a 		&lt;==&gt; +refs/heads/A:+refs/heads/a</span><br><span class="line">tag &lt;tag&gt; 		&lt;==&gt; +refs/tags/&lt;tag&gt;:refs/tags/&lt;tag&gt;</span><br></pre></td></tr></table></figure>
<p><code>refspec</code>一般不会出现在命令行中，而是由命令自动写在配置文件中，但是可以在命令行中直接使用。</p>
<h3 id="GIT-URLS"><a href="#GIT-URLS" class="headerlink" title="GIT-URLS"></a>GIT-URLS</h3><p>一般来说，URL中含有<strong>协议、远程主机名、版本库路径</strong>等信息。依赖于不同协议，有些信息可以省略。GIT支持<strong>HTTP、HTTPS、SSH、GIT</strong>协议。</p>
<p>以下是相关协议的语法:</p>
<ul>
<li>ssh://[user@]host.xz[:port]/path/to/repo.git/</li>
<li>git://host.xz[:port]/path/to/repo.git/</li>
<li>http[s]://host.xz[:port]/path/to/repo.git/</li>
<li>ftp[s]://host.xz[:port]/path/to/repo.git/</li>
</ul>
<p>扩展了用户名之后的:</p>
<ul>
<li>ssh://[user@]host.xz[:port]/~[user]/path/to/repo.git/</li>
<li>git://host.xz[:port]/~[user]/path/to/repo.git/</li>
<li>[user@]host.xz:/~[user]/path/to/repo.git/</li>
</ul>
<p>GIT同时也支持本地版本库，URL如下：</p>
<ul>
<li>/path/to/repo.git/</li>
<li>file:///path/to/repo.git/</li>
</ul>
<h3 id="远程仓库REMOTES"><a href="#远程仓库REMOTES" class="headerlink" title="远程仓库REMOTES"></a>远程仓库REMOTES</h3><p>远程仓库配置主要包含的就是一系列<code>GIT-URLS</code>及<code>refspec</code>等数据，并赋予一个名字<code>&lt;repository&gt;</code>。</p>
<p>可以使用以下当中的任意一个来替代<code>&lt;repository&gt;</code>参数，<code>&lt;repository&gt;</code>即表示一个仓库。</p>
<p>以下内容指明了Git如何确定 <code>&lt;repository&gt;:&lt;branch&gt;</code>。</p>
<h4 id="Named-remote-in-configuration-file-GIT-DIR-config"><a href="#Named-remote-in-configuration-file-GIT-DIR-config" class="headerlink" title="Named remote in configuration file $GIT_DIR/config"></a>Named remote in configuration file <code>$GIT_DIR/config</code></h4><p>在之前使用<code>git-remote</code>、<code>git-config</code>时可以选择为远程版本库提供一个名字，也可以手动编辑<code>$GIT_DIR/config</code>文件。这个名字可以用来访问版本库。<br>在命令行上，会默认使用这个名字下的远程路径<code>refspec</code>。</p>
<p>查看<code>config</code>文件应该会看到这样一个结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[remote &quot;&lt;name&gt;&quot;]</span><br><span class="line">	url = &lt;url&gt;</span><br><span class="line">	pushurl = &lt;pushurl&gt;</span><br><span class="line">	push = &lt;refspec&gt;</span><br><span class="line">	fetch = &lt;refspec&gt;</span><br></pre></td></tr></table></figure>
<p><code>pushurl</code>只能用于push，默认使用<code>url</code></p>
<p>这个结构记录了REMOTES信息。</p>
<h4 id="Named-file-in-GIT-DIR-remotes"><a href="#Named-file-in-GIT-DIR-remotes" class="headerlink" title="Named file in　$GIT_DIR/remotes"></a>Named file in　<code>$GIT_DIR/remotes</code></h4><p>也可以选择提供一个特定名称的文件放到<code>$GIT_DIR/remotes</code>目录下，文件中URL将被用于访问版本库。</p>
<p>在命令行没有提供<code>refspec</code>时文件中<code>refspec</code>将会被使用。</p>
<p>文件会是如下格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">URL: one of the above URL format</span><br><span class="line">Push: &lt;refspec&gt;</span><br><span class="line">Pull: &lt;refspec&gt;</span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line">* Push:用于`git push`</span><br><span class="line">* Pull:用于`git pull`</span><br><span class="line"></span><br><span class="line">#### Named file in `$GIT_DIR/branches`</span><br><span class="line"></span><br><span class="line">也可以选择提供一个特定名称的文件放到`$GIT_DIR/branches`目录下，文件中URL将被用于访问版本库。</span><br><span class="line"></span><br><span class="line">文件会是如下格式：</span><br></pre></td></tr></table></figure>
<p><url>#<head><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;url&gt; 必须的; #&lt;head&gt; 可选的.</span><br><span class="line"></span><br><span class="line">配置文件中并没有指明`refspecs`，所以Git需要按照某种策略执行。</span><br><span class="line"></span><br><span class="line">根据不同操作，如果你没有在命令行提供，Git将会使用以下`refspecs`中的一种：</span><br><span class="line"></span><br><span class="line">`&lt;branch&gt;` 是 `$GIT_DIR/branches` 目录下的文件名，`&lt;head&gt;` 默认值是 `master`.</span><br><span class="line"></span><br><span class="line">git fetch uses:</span><br></pre></td></tr></table></figure></head></url></p>
<p>refs/heads/<head>:refs/heads/<branch><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">git push uses:</span><br></pre></td></tr></table></figure></branch></head></p>
<p>HEAD:refs/heads/<head><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### CONFIGURED REMOTE-TRACKING BRANCHES</span><br><span class="line"></span><br><span class="line">你经常定期的重复的获取和远程版本库往来，为了保持跟踪远程版本库进展，`git fetch`允许你配置`remote.&lt;repository&gt;.fetch`变量。</span><br><span class="line"></span><br><span class="line">变量形式如下：</span><br></pre></td></tr></table></figure></head></p>
<p>[remote “origin”]<br>    fetch = +refs/heads/<em>:refs/remotes/origin/</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">This configuration is used in two ways:</span><br><span class="line"></span><br><span class="line">When git fetch is run without specifying what branches and/or tags to fetch on the command line, e.g. git fetch origin or git fetch, remote.&lt;repository&gt;.fetch values are used as the refspecs—​they specify which refs to fetch and which local refs to update. The example above will fetch all branches that exist in the origin (i.e. any ref that matches the left-hand side of the value, refs/heads/*) and update the corresponding remote-tracking branches in the refs/remotes/origin/* hierarchy.</span><br><span class="line"></span><br><span class="line">When git fetch is run with explicit branches and/or tags to fetch on the command line, e.g. git fetch origin master, the &lt;refspec&gt;s given on the command line determine what are to be fetched (e.g. master in the example, which is a short-hand for master:, which in turn means &quot;fetch the master branch but I do not explicitly say what remote-tracking branch to update with it from the command line&quot;), and the example command will fetch only the master branch. The remote.&lt;repository&gt;.fetch values determine which remote-tracking branch, if any, is updated. When used in this way, the remote.&lt;repository&gt;.fetch values do not have any effect in deciding what gets fetched (i.e. the values are not used as refspecs when the command-line lists refspecs); they are only used to decide where the refs that are fetched are stored by acting as a mapping.</span><br><span class="line"></span><br><span class="line">The latter use of the remote.&lt;repository&gt;.fetch values can be overridden by giving the --refmap=&lt;refspec&gt; parameter(s) on the command line.</span><br><span class="line"></span><br><span class="line">#### 输出</span><br></pre></td></tr></table></figure></p>
<p> <flag> <summary> <from> -&gt; <to> [<reason>]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">flags A single character indicating the status of the ref:</span><br><span class="line"></span><br><span class="line">* `(space)` for a successfully fetched fast-forward;</span><br><span class="line">* `+`       for a successful forced update;</span><br><span class="line">* `-`       for a successfully pruned ref;</span><br><span class="line">* `t`       for a successful tag update;</span><br><span class="line">* `*`       for a successfully fetched new ref;</span><br><span class="line">* `!`       for a ref that was rejected or failed to update; and</span><br><span class="line">* `=`       for a ref that was up to date and did not need fetching.</span><br><span class="line"></span><br><span class="line">summary</span><br><span class="line"></span><br><span class="line">For a successfully fetched ref, the summary shows the old and new values of the ref in a form suitable for using as an argument to git log </span><br><span class="line"></span><br><span class="line">(this is &lt;old&gt;..&lt;new&gt; in most cases, and &lt;old&gt;...&lt;new&gt; for forced non-fast-forward updates).</span><br><span class="line"></span><br><span class="line">from</span><br><span class="line">The name of the remote ref being fetched from, minus its refs/&lt;type&gt;/ prefix. In the case of deletion, the name of the remote ref is &quot;(none)&quot;.</span><br><span class="line"></span><br><span class="line">to</span><br><span class="line">The name of the local ref being updated, minus its refs/&lt;type&gt;/ prefix.</span><br><span class="line"></span><br><span class="line">reason</span><br><span class="line">A human-readable explanation. In the case of successfully fetched refs, no explanation is needed. For a failed ref, the reason for failure is described.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 版本库管理</span><br><span class="line"></span><br><span class="line">Git是一个分布式的版本控制系统，这意味着在Git中版本库有**本地版本库**和**远程版本库**之分。</span><br><span class="line">每个远程仓库可以有多个本地仓库，同时一个本地版本库可以同时对应多个远程版本库，多个远程版本库是从一个最原始的版本库Fork产生的，本质上就是以一个版本库为基础，创建了另外一个新的版本库，这些版本库直接可以通过`PullRequest`操作进行仓库的交互。</span><br><span class="line">本地仓库对应的远程仓库记录在`.git/config`文件中。本地仓库可以于多个的远程仓库`pull/push`代码。</span><br><span class="line"></span><br><span class="line">### 初始化仓库</span><br><span class="line"></span><br><span class="line">```sh</span><br><span class="line">mkdir repo</span><br><span class="line">cd repo</span><br><span class="line">git init                                                  # 初始化本地git仓库</span><br></pre></td></tr></table></figure></reason></to></from></summary></flag></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git+ssh://git@192.168.53.168/VT.git             <span class="comment"># clone远程仓库</span></span><br></pre></td></tr></table></figure>
<h3 id="仓库维护"><a href="#仓库维护" class="headerlink" title="仓库维护"></a>仓库维护</h3><h4 id="git-remote"><a href="#git-remote" class="headerlink" title="git remote"></a>git remote</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git remote [-v | --verbose]</span><br><span class="line">git remote [-v | --verbose] show [-n] &lt;name&gt;…​</span><br><span class="line">git remote [-v | --verbose] update [-p | --prune] [(&lt;group&gt; | &lt;remote&gt;)…​]</span><br><span class="line">git remote add [-t &lt;branch&gt;] [-m &lt;master&gt;] [-f] [--[no-]tags] [--mirror=&lt;fetch|push&gt;] &lt;name&gt; &lt;url&gt;</span><br><span class="line">git remote rename &lt;old&gt; &lt;new&gt;</span><br><span class="line">git remote remove &lt;name&gt;</span><br><span class="line">git remote set-head &lt;name&gt; (-a | --auto | -d | --delete | &lt;branch&gt;)</span><br><span class="line">git remote set-branches [--add] &lt;name&gt; &lt;branch&gt;…​</span><br><span class="line">git remote get-url 			[--push] [--all] &lt;name&gt;</span><br><span class="line">git remote set-url 			[--push] &lt;name&gt; &lt;newurl&gt; [&lt;oldurl&gt;]</span><br><span class="line">git remote set-url --add 	[--push] &lt;name&gt; &lt;newurl&gt;</span><br><span class="line">git remote set-url --delete [--push] &lt;name&gt; &lt;url&gt;</span><br><span class="line">git remote prune [-n | --dry-run] &lt;name&gt;…​</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">git remote                                          		<span class="comment"># 列出已经存在的远程分支</span></span><br><span class="line">git remote -v                                       		<span class="comment"># 查看远程主机的地址</span></span><br><span class="line">git remote show   remote_name                       		<span class="comment"># 查看该远程主机的详细信息</span></span><br><span class="line">git remote add    remote_name remote_url            		<span class="comment"># 添加远程主机</span></span><br><span class="line">git remote remove remote_name                       		<span class="comment"># 删除远程主机</span></span><br><span class="line">git remote rename remote_name new_remote_name       		<span class="comment"># 重命名远程主机</span></span><br><span class="line"></span><br><span class="line">git remote get-url remote_name                      		<span class="comment"># 查看远程主机地址</span></span><br><span class="line">git remote <span class="built_in">set</span>-url remote_name git://new.url.here   		<span class="comment"># 修改远程主机地址</span></span><br><span class="line">git remote <span class="built_in">set</span>-url remote_name --add 	git://new.url.here  <span class="comment"># 修改远程主机地址</span></span><br><span class="line">git remote <span class="built_in">set</span>-url remote_name --delete git://new.url.here  <span class="comment"># 删除远程主机地址</span></span><br><span class="line"></span><br><span class="line">git remote prune [-n | --dry-run] &lt;name&gt;…​           <span class="comment"># 删除某个远程名下过期的分支，即在远程删除本地存在的分支</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># see http://stackoverflow.com/questions/1856499/differences-between-git-remote-update-and-fetch</span></span><br><span class="line">git remote [-v | --verbose] update [-p | --prune] [(&lt;group&gt; | &lt;remote&gt;)…​]</span><br><span class="line"></span><br><span class="line">git remote <span class="built_in">set</span>-head 		<span class="comment"># 可以 设置（增加、修改、删除） 默认分支</span></span><br><span class="line">git remote <span class="built_in">set</span>-branches</span><br></pre></td></tr></table></figure>
<p>添加一个远程仓库的时候，除了指定仓库地址，可以对与仓库交互时的一些行为等进行设置，具体参见<a href="https://git-scm.com/docs/git-remote" target="_blank" rel="noopener">官方文档</a>。</p>
<h4 id="git-fetch"><a href="#git-fetch" class="headerlink" title="git fetch"></a>git fetch</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git fetch [&lt;options&gt;] [&lt;repository&gt; [&lt;refspec&gt;…​]]</span><br><span class="line">git fetch [&lt;options&gt;] &lt;group&gt;</span><br><span class="line">git fetch --multiple [&lt;options&gt;] [(&lt;repository&gt; | &lt;group&gt;)…​]</span><br><span class="line">git fetch --all [&lt;options&gt;]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git fetch                                                  	<span class="comment"># 更新git remote中所有的远程repo 所包含分支的最新commit-id，将其记录到.git/FETCH_HEAD文件中（不更新本地分支，另需merge）</span></span><br><span class="line">git fetch -all                  							<span class="comment"># 获取所有远程分支</span></span><br><span class="line">git fetch remote-repo                                      	<span class="comment"># 更新名称为 remote-repo 的远程repo上的所有分支的最新commit-id，将其记录。</span></span><br><span class="line">git fetch remote-repo remote-branch-name                   	<span class="comment"># 更新名称为 remote-repo 的远程repo上的分支：remote-branch-name，可以用来测试远程主机的远程分支是否存在，如果存在，返回0，如果不存在，返回128，抛出一个异常.</span></span><br><span class="line">git fetch remote-repo remote-branch-name:<span class="built_in">local</span>-branch-name 	<span class="comment"># 更新名称为 remote-repo 的远程repo上的分支：remote-branch-name，并在本地创建 local-branch-name 本地分支保存远端分支的所有数据。</span></span><br><span class="line">git fetch --dry-run 										<span class="comment"># Show what would be done, without making any changes.</span></span><br><span class="line">git fetch -f | --force 										<span class="comment"># 当使用refspec(&lt;rbranch&gt;:&lt;lbranch&gt;)时，跳过亲子关系检查，强制更新本地分支。</span></span><br><span class="line">git fetch -p | --prune                                    	<span class="comment"># 获取所有原创分支并清除服务器上已删掉的分支</span></span><br><span class="line">git fetch -t | --tags 										<span class="comment"># 从远程获取数据时获取tags，默认</span></span><br><span class="line">git fetch -n | --no-tags 									<span class="comment"># 从远程获取数据时去除tags</span></span><br><span class="line">git fetch --progress --verbose 								<span class="comment"># 显示进度及冗长日志</span></span><br></pre></td></tr></table></figure>
<p>FETCH_HEAD：是一个版本链接，记录在本地的一个文件中，指向着目前已经从远程仓库取下来的分支的末端版本。</p>
<p>执行过fetch操作的项目都会存在一个<code>FETCH_HEAD</code>列表，这个列表保存在，其中每一行对应于远程服务器的一个分支.</p>
<p>当前分支指向的<code>FETCH_HEAD</code>，就是这个文件第一行对应的那个分支。</p>
<p>一般来说，存在两种情况:</p>
<ul>
<li>如果没指定远程分支，<code>FETCH_HEAD</code> 为 <code>master</code></li>
<li>如果指定了远程分支，<code>FETCH_HEAD</code> 为 指定的 <code>远程分支</code>，在这种情况下，不会在本地创建本地远程分支，因为:这个操作是<code>git pull origin branch-name</code>的第一步，而对应的pull操作，并不会在本地创建新的branch.</li>
</ul>
<p>例如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git fetch origin :branch-local 等价于: git fetch origin master:branch-local</span></span><br><span class="line">git fetch origin branch-remote:branch-local</span><br></pre></td></tr></table></figure>
<ul>
<li>首先执行上面的fetch操作</li>
<li>使用远程branch-remote分支在本地创建branch-local(但不会切换到该分支)</li>
<li>如果本地不存在branch-local分支，则会自动创建一个新的branch-local分支</li>
<li>如果本地已存在branch-local分支，并且是`fast forward’模式，则自动合并两个分支，否则，会阻止以上操作</li>
</ul>
<p>fetch 用法与三处分支关系图</p>
<p>三处分支关系图 </p>
<p>git fetch 用于取回更新<br>取回远程所有分支的更新</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch [originName]：参数是远程源名</span><br></pre></td></tr></table></figure>
<p>用于取回该远程源所有的更新<br>注意：取回的更新是是放在.git\refs\remotes\origin目录下，打开该目录可看到远程源的所有分支 </p>
<p>—dev<br>—master<br>—…</p>
<p>取回远程特定分支的更新</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch [originName] [branchName]</span><br></pre></td></tr></table></figure>
<p>注意：虽然我们取回了更新，fetch取回的之后的更新的保存位置保存在<code>.git\refs\remotes\origin</code>目录下，那么如何恢复这些更新到工作区呢？</p>
<p>同步工作区与<code>.git</code>仓库</p>
<p>工作区为空，以fetch回来的某分支的更新在工作区新建分支，并自动与该远程分支建立追踪关系</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b [newBranch] [originName]/[remoteBranchName]</span><br></pre></td></tr></table></figure>
<p>上面命令表示，在originName/remoteBranchName的基础上，创建一个新分支，并建立追踪关系。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge [originName]/[branchName]</span><br></pre></td></tr></table></figure>
<p>合并远程分支的更新到当前工作分支（但不建立追踪关系） </p>
<h4 id="git-pull"><a href="#git-pull" class="headerlink" title="git pull"></a>git pull</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull [options] [&lt;repository&gt; [&lt;refspec&gt;…​]]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master  <span class="comment"># 获取远程分支master并merge到当前分支</span></span><br></pre></td></tr></table></figure>
<p>在默认模式下，<code>git pull</code>等价于以下两步:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git fetch ...</span><br><span class="line">git merge FETCH_HEAD</span><br></pre></td></tr></table></figure>
<p>所以<code>git pull</code>的参数主要由<code>git fetch</code>和<code>git merge</code>的参数组成。</p>
<p>git pull 的运行过程：</p>
<ul>
<li>首先，基于本地的<code>FETCH_HEAD</code>记录，比对本地的<code>FETCH_HEAD</code>记录与远程仓库的版本号，</li>
<li>然后<code>git fetch</code>获得当前指向的远程分支的后续版本的数据，</li>
<li>然后再利用<code>git merge</code>将其与本地的当前分支合并。</li>
</ul>
<p>若有多个 remote，git pull [remote name] 所做的事情是：</p>
<ul>
<li>fetch [remote name] 的所有分支</li>
<li>寻找本地分支有没有 tracking 这些分支的，若有则 merge 这些分支，若没有则 merge 当前分支</li>
</ul>
<p>另外，若只有一个 remote，假设叫 origin，那么 git pull 等价于 git pull origin；平时养成好习惯，没谱的时候都把 【来源】带上。</p>
<p>怎么知道 tracking 了没有？</p>
<ul>
<li>如果你曾经这么推过：<code>git push -u origin master</code>，那么你执行这条命令时所在的分支就已经 <code>tracking to origin/master</code> 了，-u 的用处就在这里</li>
<li>如果你记不清了：<code>cat .git/config</code>，由此可见，tracking 的本质就是指明 pull 的 merge 动作来源。别忘了：pull = fetch + merge。</li>
</ul>
<p>总结:</p>
<ul>
<li><code>git pull = git fetch + merge</code></li>
<li><code>git fetch</code> 拿到了远程所有分支的更新，<code>cat .git/FETCH_HEAD</code> 可以看到其状态，若是 not-for-merge 则不会有接下来的 merge 动作</li>
<li>merge 动作的默认目标是当前分支，若要切换目标，可以直接切换分支</li>
<li>merge 动作的来源则取决于你是否有 tracking，若有则读取配置自动完成，若无则请指明【来源】</li>
</ul>
<p>需要提及的一点是:</p>
<p>pull操作, 不应该涉及三方合并 或 衍合操作<br>换个说法: pull 应该总是 fast forward 的。 为了达到这样一个效果, 在真正push操作之前, 我倾向于使用衍合, 在本地对代码执行合并操作。</p>
<h4 id="git-push"><a href="#git-push" class="headerlink" title="git push"></a>git push</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">git push </span><br><span class="line">	   [--all | --mirror | --tags] </span><br><span class="line">	   [--follow-tags] </span><br><span class="line">	   [--atomic] </span><br><span class="line">	   [-n | --dry-run] </span><br><span class="line">	   [--receive-pack=&lt;git-receive-pack&gt;]</span><br><span class="line">	   [--repo=&lt;repository&gt;] </span><br><span class="line">	   [-f | --force] </span><br><span class="line">	   [-d | --delete] </span><br><span class="line">	   [--prune] </span><br><span class="line">	   [-v | --verbose]</span><br><span class="line">	   [-u | --<span class="built_in">set</span>-upstream] </span><br><span class="line">	   [--push-option=&lt;string&gt;]</span><br><span class="line">	   [--[no-]signed|--sign=(<span class="literal">true</span>|<span class="literal">false</span>|<span class="keyword">if</span>-asked)]</span><br><span class="line">	   [--force-with-lease[=&lt;refname&gt;[:&lt;expect&gt;]]]</span><br><span class="line">	   [--no-verify] </span><br><span class="line">	   [&lt;repository&gt; [&lt;refspec&gt;…​]]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git push 													<span class="comment"># 如果当前分支只有一个追踪分支，那么主机名都可以省略</span></span><br><span class="line">git push origin HEAD 										<span class="comment"># 将当前分支push到远程master分支</span></span><br><span class="line">git push origin master                                      <span class="comment"># 将master分支push到远程master分支</span></span><br><span class="line">git push -u origin master 									<span class="comment"># 如果当前分支与多个主机存在追踪关系，则可以使用-u选项指定一个默认主机，这样后面就可以不加任何参数使用git push</span></span><br><span class="line">git push --<span class="built_in">set</span>-upstream origin master 						<span class="comment"># 同上</span></span><br><span class="line">git push --all origin  										<span class="comment"># 将所有本地分支都推送到origin主机。</span></span><br><span class="line">git push --force origin 									<span class="comment"># 如果远程主机的版本比本地版本更新，推送时Git会报错，如果你一定要推送，可以使用–force选项。</span></span><br><span class="line"></span><br><span class="line">git push --prune 											<span class="comment"># 删除在本地没有对应分支的远程分支</span></span><br><span class="line">git push origin :hotfixes/BJVEP933                          <span class="comment"># 删除远程仓库的hotfixes/BJVEP933分支</span></span><br><span class="line">git push origin :master 									<span class="comment"># 删除origin主机的master分支，相当于推送空分支到远程</span></span><br><span class="line">git push origin --delete master 							<span class="comment"># 删除origin主机的master分支</span></span><br><span class="line">git push --tags                                             <span class="comment"># 把所有tag推送到远程仓库</span></span><br></pre></td></tr></table></figure>
<ul>
<li>simple  模式: 不带任何参数的git push，默认只推送当前分支。2.0以上版本，默认此方式。</li>
<li>matching模式: 会推送所有有对应的远程分支的本地分支。</li>
</ul>
<p>配置模式<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global push.default matching</span><br><span class="line">$ git config --global push.default simple</span><br></pre></td></tr></table></figure></p>
<h4 id="submodule"><a href="#submodule" class="headerlink" title="submodule"></a>submodule</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">git submodule [--quiet] add [-b &lt;branch&gt;] [-f|--force] [--name &lt;name&gt;]</span><br><span class="line">	      [--reference &lt;repository&gt;] [--depth &lt;depth&gt;] [--] &lt;repository&gt; [&lt;path&gt;]</span><br><span class="line">git submodule [--quiet] status [--cached] [--recursive] [--] [&lt;path&gt;…​]</span><br><span class="line">git submodule [--quiet] init [--] [&lt;path&gt;…​]</span><br><span class="line">git submodule [--quiet] deinit [-f|--force] (--all|[--] &lt;path&gt;…​)</span><br><span class="line">git submodule [--quiet] update [--init] [--remote] [-N|--no-fetch]</span><br><span class="line">	      [--[no-]recommend-shallow] [-f|--force] [--rebase|--merge]</span><br><span class="line">	      [--reference &lt;repository&gt;] [--depth &lt;depth&gt;] [--recursive]</span><br><span class="line">	      [--<span class="built_in">jobs</span> &lt;n&gt;] [--] [&lt;path&gt;…​]</span><br><span class="line">git submodule [--quiet] summary [--cached|--files] [(-n|--summary-limit) &lt;n&gt;]</span><br><span class="line">	      [commit] [--] [&lt;path&gt;…​]</span><br><span class="line">git submodule [--quiet] foreach [--recursive] &lt;<span class="built_in">command</span>&gt;</span><br><span class="line">git submodule [--quiet] sync [--recursive] [--] [&lt;path&gt;…​]</span><br></pre></td></tr></table></figure>
<h2 id="文件管理"><a href="#文件管理" class="headerlink" title="文件管理"></a>文件管理</h2><p>Git作为一个版本控制系统，主要就是对文件的修改历史进行追踪，自然而然对应一系列文件管理操作。</p>
<p>文件管理可以当作是文件状态管理，一般仓库中的文件可能存在于这三种状态：</p>
<ol>
<li>Untracked files → 文件未被跟踪；</li>
<li>Changes to be committed → 文件已暂存，这是下次提交的内容；</li>
<li>Changes bu not updated → 文件被修改，但并没有添加到暂存区。如果 commit 时没有带 -a 选项，这个状态下的文件不会被提交。</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br><span class="line"><span class="comment"># On branch master</span></span><br><span class="line"><span class="comment"># Changes to be committed:</span></span><br><span class="line"><span class="comment">#   (use "git reset HEAD &lt;file&gt;..." to unstage)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    new file:   file2</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Changed but not updated:</span></span><br><span class="line"><span class="comment">#   (use "git add &lt;file&gt;..." to update what will be committed)</span></span><br><span class="line"><span class="comment">#   (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    modified:   file</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Untracked files:</span></span><br><span class="line"><span class="comment">#   (use "git add &lt;file&gt;..." to include in what will be committed)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    file3</span></span><br></pre></td></tr></table></figure>
<ul>
<li>status</li>
<li>diff</li>
<li>reset</li>
</ul>
<h3 id="git-add"><a href="#git-add" class="headerlink" title="git add"></a>git add</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">git add </span><br><span class="line">	  [--verbose | -v]</span><br><span class="line">	  [--dry-run | -n]</span><br><span class="line">	  [--force | -f]</span><br><span class="line">	  [--interactive | -i]</span><br><span class="line">	  [--patch | -p]</span><br><span class="line">	  [--edit | -e]</span><br><span class="line">	  [--[no-]all | --[no-]ignore-removal | [--update | -u]]</span><br><span class="line">	  [--intent-to-add | -N]</span><br><span class="line">	  [--refresh]</span><br><span class="line">	  [--ignore-errors]</span><br><span class="line">	  [--ignore-missing]</span><br><span class="line">	  [--chmod=(+|-)x]</span><br><span class="line">	  [--]</span><br><span class="line">	  [&lt;pathspec&gt;…​]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add Documentation/\*.txt   		<span class="comment"># 添加文件</span></span><br><span class="line">git add -f node_modules/bluebird 	<span class="comment"># 强制添加文件，跳过忽略列表</span></span><br></pre></td></tr></table></figure>
<h3 id="git-commit"><a href="#git-commit" class="headerlink" title="git commit"></a>git commit</h3><p><a href="http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html" target="_blank" rel="noopener">Commit message 和 Change log 编写指南</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">git commit </span><br><span class="line">       [-a | --interactive | --patch]</span><br><span class="line">	   [-s]</span><br><span class="line">	   [-v]</span><br><span class="line">	   [-u&lt;mode&gt;]</span><br><span class="line">	   [--amend]</span><br><span class="line">	   [--dry-run]</span><br><span class="line">	   [(-c | -C | --fixup | --squash) &lt;commit&gt;]</span><br><span class="line">	   [-F &lt;file&gt; | -m &lt;msg&gt;]</span><br><span class="line">	   [--reset-author]</span><br><span class="line">	   [--allow-empty]</span><br><span class="line">	   [--allow-empty-message]</span><br><span class="line">	   [--no-verify]</span><br><span class="line">	   [-e]</span><br><span class="line">	   [--author=&lt;author&gt;]</span><br><span class="line">	   [--date=&lt;date&gt;]</span><br><span class="line">	   [--cleanup=&lt;mode&gt;]</span><br><span class="line">	   [--[no-]status]</span><br><span class="line">	   [-i | -o] [-S[&lt;keyid&gt;]]</span><br><span class="line">	   [--]</span><br><span class="line">	   [&lt;file&gt;…​]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git commit 							<span class="comment"># 提交的是暂存区里面的内容，也就是 Changes to be committed 中的文件。</span></span><br><span class="line">git commit -a  						<span class="comment"># 除了将暂存区里的文件提交外，还提交 Changes bu not updated 中的文件。</span></span><br><span class="line">git commit -a -m <span class="string">'commit info'</span> 		<span class="comment"># 注释，如果没有 -m，会默认会使用vi编辑注释。</span></span><br><span class="line">git commit -am <span class="string">"This is a commit"</span>   <span class="comment"># 同上，合并提交，将add和commit合为一步</span></span><br><span class="line">git commit --amend                  <span class="comment"># 对上一次提交进行修改，合并上一次提交（用于反复修改）</span></span><br><span class="line">git commit --amend -a               <span class="comment"># 提交时忘记使用 -a 选项，导致 Changes bu not updated 中的内容没有被提交</span></span><br></pre></td></tr></table></figure>
<h3 id="git-rm"><a href="#git-rm" class="headerlink" title="git rm"></a>git rm</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm [-f | --force] [-n] [-r] [--cached] [--ignore-unmatch] [--quiet] [--] &lt;file&gt;…​</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git rm Documentation/\*.txt</span><br><span class="line">git rm -f git-*.sh</span><br></pre></td></tr></table></figure>
<h3 id="git-mv"><a href="#git-mv" class="headerlink" title="git mv"></a>git mv</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git mv &lt;options&gt;…​ &lt;args&gt;…​</span><br><span class="line">git mv [-v] [-f] [-n] [-k] &lt;<span class="built_in">source</span>&gt; &lt;destination&gt;</span><br><span class="line">git mv [-v] [-f] [-n] [-k] &lt;<span class="built_in">source</span>&gt; ... &lt;destination directory&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git mv old_name new_name            <span class="comment"># 重命名</span></span><br><span class="line">git mv -f old_name new_name         <span class="comment"># 强制重命名，即时目标名称已经存在</span></span><br><span class="line">git mv -k old_name new_name         <span class="comment"># 跳过会导致错误的动作</span></span><br><span class="line">git mv -v old_name new_name         <span class="comment"># 报告被移动文件</span></span><br><span class="line">git mv --dry-run old_name new_name  <span class="comment"># 只显示将会发生什么</span></span><br></pre></td></tr></table></figure>
<h3 id="git-status"><a href="#git-status" class="headerlink" title="git status"></a>git status</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status [&lt;options&gt;…​] [--] [&lt;pathspec&gt;…​]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git status     <span class="comment"># 显示状态</span></span><br><span class="line">git status -s  <span class="comment"># 显示简短信息</span></span><br><span class="line">git status -b  <span class="comment"># 显示分支状态</span></span><br></pre></td></tr></table></figure>
<h3 id="git-diff"><a href="#git-diff" class="headerlink" title="git diff"></a>git diff</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git diff [options] [&lt;commit&gt;] [--] [&lt;path&gt;…​]</span><br><span class="line">git diff [options] --cached [&lt;commit&gt;] [--] [&lt;path&gt;…​]</span><br><span class="line">git diff [options] &lt;commit&gt; &lt;commit&gt; [--] [&lt;path&gt;…​]</span><br><span class="line">git diff [options] &lt;blob&gt; &lt;blob&gt;</span><br><span class="line">git diff [options] [--no-index] [--] &lt;path&gt; &lt;path&gt;</span><br></pre></td></tr></table></figure>
<p><a href="https://en.wikipedia.org/wiki/Diff_utility" target="_blank" rel="noopener">Diff_utility</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git diff 				<span class="comment"># 查看尚未暂存的文件更新了哪些部分，不加参数直接输入。此命令比较的是工作目录(Working tree)和暂存区域快照(index)之间的差异，也就是修改之后还没有暂存起来的变化内容。</span></span><br><span class="line">git diff --cached 		<span class="comment"># 查看已经暂存起来的文件(staged)和上次提交时的快照之间(HEAD)的差异</span></span><br><span class="line">git diff --staged 		<span class="comment"># 显示的是下一次commit时会提交到HEAD的内容(不带-a情况下)</span></span><br><span class="line">git diff HEAD 			<span class="comment"># 显示工作版本(Working tree)和HEAD的差别</span></span><br><span class="line">git diff topic master 	<span class="comment"># 直接将两个分支上最新的提交做diff</span></span><br><span class="line">git diff topic...master <span class="comment"># 输出自topic和master分别开发以来，master分支上的changed。</span></span><br><span class="line">git diff --<span class="built_in">stat</span> 		<span class="comment"># 查看简单的diff结果，可以加上--stat参数</span></span><br><span class="line">git diff <span class="built_in">test</span> 			<span class="comment"># 查看当前目录和另外一个分支的差别 显示当前目录和另一个叫'test'分支的差别</span></span><br><span class="line">git diff HEAD -- ./lib 	<span class="comment"># 显示当前目录下的lib目录和上次提交之间的差别（更准确的说是在当前分支下）</span></span><br><span class="line">git diff HEAD^ HEAD 	<span class="comment"># 比较上次提交commit和上上次提交</span></span><br><span class="line">git diff SHA1 SHA2 		<span class="comment"># 比较两个历史版本之间的差异</span></span><br></pre></td></tr></table></figure>
<h3 id="git-reset"><a href="#git-reset" class="headerlink" title="git reset"></a>git reset</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git reset [-q] [&lt;tree-ish&gt;] [--] &lt;paths&gt;…​</span><br><span class="line">git reset (--patch | -p) [&lt;tree-ish&gt;] [--] [&lt;paths&gt;…​]</span><br><span class="line">git reset [--soft | --mixed [-N] | --hard | --merge | --keep] [-q] [&lt;commit&gt;]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git reset --mixed id   <span class="comment"># (默认)是将git的HEAD变了(也就是提交记录变了),但文件并没有改变，(也就是working tree并没有改变). 取消了commit和add的内容.</span></span><br><span class="line">git reset --soft  id   <span class="comment"># 实际上，是git reset –mixed id 后,又做了一次git add.即取消了commit的内容.</span></span><br><span class="line">git reset --hard  id   <span class="comment"># 是将git的HEAD变了,文件也变了.</span></span><br></pre></td></tr></table></figure>
<p>按改动影响范围排序如下: soft (commit) &lt; mixed (commit + add) &lt; hard (commit + add + local working)</p>
<h3 id="暂存区"><a href="#暂存区" class="headerlink" title="暂存区"></a>暂存区</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git stash                       <span class="comment"># 暂存当前修改，将所有至为HEAD状态</span></span><br><span class="line">git stash list                  <span class="comment"># 查看所有暂存</span></span><br><span class="line">git stash show -p stash@&#123;0&#125;     <span class="comment"># 参考第一次暂存</span></span><br><span class="line">git stash apply stash@&#123;0&#125;       <span class="comment"># 应用第一次暂存</span></span><br></pre></td></tr></table></figure>
<h2 id="历史管理"><a href="#历史管理" class="headerlink" title="历史管理"></a>历史管理</h2><p>特殊符号:<br>     ^ 代表父提交,当一个提交有多个父提交时,可以通过在^后面跟上一个数字,表示第几个父提交: ^相当于^1.<br>     ~ <n>相当于连续的<n>个^.</n></n></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard HEAD                                     <span class="comment"># 将当前版本重置为HEAD（通常用于merge失败回退）</span></span><br><span class="line">git revert dfb02e6e4f2f7b573337763e5c0013802e392818       <span class="comment"># 撤销提交dfb02e6e4f2f7b573337763e5c0013802e392818</span></span><br></pre></td></tr></table></figure>
<h2 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h2><p>GIT是一个分布式的结构，有本地版本库和远程版本库，便有了本地分支和远程分支的区别了。</p>
<p>本地分支和远程分支在<code>git push</code>的时候可以随意指定，交错对应，只要不出现版本从图即可。</p>
<p>分支关系：</p>
<ul>
<li>上游分支，upstream，即指父分支。</li>
<li>追踪分支，本地分支和远程分支绑定，在<code>pull/push</code>时可以自动关联分支。</li>
</ul>
<p>在git进行本地和远程交互时，git需要知道本地分支和对应的远程分支，但是通常不需要指定，因为git自动推断出对应关系并进行分支追踪，这也是为什么书写命令时可以省略很多参数。</p>
<p>如果你从这里克隆，Git 的 clone 命令会为你自动将其命名为 origin，拉取它的所有数据，创建一个指向它的 master 分支的指针，并且在本地将其命名为 origin/master。<br>Git 也会给你一个与 origin 的 master 分支在指向同一个地方的本地 master 分支，这样你就有工作的基础。</p>
<ul>
<li>追踪分支</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git branch --track local_branch_name remote_branch_name</span></span><br><span class="line">git branch --track expermental origin/expermental</span><br></pre></td></tr></table></figure>
<p>远程跟踪分支是远程分支状态的引用。它们是你不能移动的本地引用，当你做任何网络通信操作时，它们会自动移动。远程跟踪分支像是你上次连接到远程仓库时，那些分支所处状态的书签。</p>
<p>它们以 (remote)/(branch) 形式命名。</p>
<p>从一个远程跟踪分支检出一个本地分支会自动创建一个叫做 “跟踪分支”（有时候也叫做 “上游分支”）。 跟踪分支是与远程分支有直接关系的本地分支。 如果在一个跟踪分支上输入 git pull，Git 能自动地识别去哪个服务器上抓取、合并到哪个分支。</p>
<p>当克隆一个仓库时，它通常会自动地创建一个跟踪 origin/master 的 master 分支。</p>
<p>上游快捷方式:当设置好跟踪分支后，可以通过 @{upstream} 或 @{u} 快捷方式来引用它。 所以在 master 分支时并且它正在跟踪 origin/master 时，如果愿意的话可以使用 git merge @{u} 来取代 git merge origin/master。</p>
<ul>
<li>查看分支</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git branch                  <span class="comment"># 显示本地分支</span></span><br><span class="line">git branch -a               <span class="comment"># 显示所有分支</span></span><br><span class="line">git branch -r               <span class="comment"># 显示所有原创分支</span></span><br><span class="line">git branch --contains 50089 <span class="comment"># 显示包含提交50089的分支</span></span><br><span class="line">git branch --merged         <span class="comment"># 显示所有已合并到当前分支的分支</span></span><br><span class="line">git branch --no-merged      <span class="comment"># 显示所有未合并到当前分支的分支</span></span><br><span class="line">git branch -vv 				<span class="comment"># 将所有的本地分支列出来并且包含更多的信息</span></span><br></pre></td></tr></table></figure>
<ul>
<li>创建分支</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch <span class="built_in">test</span>             <span class="comment"># 创建test分支</span></span><br></pre></td></tr></table></figure>
<ul>
<li>检出/切换/创建分支</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b `master_copy`            <span class="comment"># 从当前分支创建新分支`master_copy`并检出</span></span><br><span class="line">git checkout -b master master_copy       <span class="comment"># 从当前分支创建新分支`master_copy`并检出</span></span><br><span class="line">git checkout -b devel origin/develop     <span class="comment"># 从远程分支develop创建新本地分支devel并检出，但是不建立对应的追踪关系</span></span><br><span class="line">git checkout features/performance        <span class="comment"># 检出已存在的features/performance分支</span></span><br><span class="line">git checkout --track hotfixes/BJVEP933   <span class="comment"># 检出远程分支hotfixes/BJVEP933并创建本地跟踪分支</span></span><br><span class="line">git checkout -- README                   <span class="comment"># 检出head版本的README文件（可用于修改错误回退）</span></span><br><span class="line">git checkout v2.0                        <span class="comment"># 检出版本v2.0</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout --orphan gh-pages</span><br></pre></td></tr></table></figure>
<ul>
<li>合并分支</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge origin/master                 <span class="comment"># 合并远程master分支至当前分支</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase</span><br></pre></td></tr></table></figure>
<ul>
<li>删除分支</li>
</ul>
<p>删除一个分支的前提是：该分支完全合并到其上游分支，或者无上游分支。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git branch -d hotfixes/BJVEP933     <span class="comment"># 删除分支（本分支修改已合并到其他分支）</span></span><br><span class="line">git branch -D hotfixes/BJVEP933     <span class="comment"># 强制删除分支  ===&gt;  git branch --delete --force hotfixes/BJVEP933</span></span><br><span class="line">git branch -d -r branchname         <span class="comment"># 删除远程branchname分支</span></span><br></pre></td></tr></table></figure>
<ul>
<li>删除远程分支</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin --delete serverfix</span><br></pre></td></tr></table></figure>
<ul>
<li>重命名分支</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -m master master_copy        <span class="comment"># 本地分支改名</span></span><br><span class="line">git branch -M oldbranch newbranch       <span class="comment"># 重命名分支，使用-M强制重命名。</span></span><br></pre></td></tr></table></figure>
<ul>
<li>分支追踪</li>
</ul>
<p>git clone时只在本地创建与远程同名的默认分支，并建立追踪关系</p>
<p>工作区新建的分支需要与远程分支建立关系时：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch --<span class="built_in">set</span>-upstream [branchName] [originName]/[remoteBranchName] <span class="comment"># 将本地分支与远程某分支建立追踪关系（并没有要求名字必须相同）</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch --track [originName]/[remoteBranchName] <span class="comment"># 将自己当前工作分支与某远程分支建立联系 </span></span><br><span class="line">git branch --<span class="built_in">set</span>-upstream-to [originName]/[remoteBranchName]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u [originName] [branchName]:[remoteBranchName] 是先建立[branchName]:[remoteBranchName] <span class="comment"># 追踪对应关系，再把本地更新推上去 省略[branchName]则代表是当前工作分支 -u参数是upstream的意思</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull -u [originName] [branchName]:[remoteBranchName] <span class="comment"># 只负责拉下某个远程分支的更新到本地某分支，但是 无法建立追踪关系</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push、git pull、git push --all <span class="comment"># 这些缺省指定分支和参数的命令最好在已经指定了追踪关系后使用</span></span><br></pre></td></tr></table></figure>
<p>查看追踪分支<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git branch -vv</span><br><span class="line">cat .git/config</span><br><span class="line">git config --list</span><br></pre></td></tr></table></figure></p>
<p>情景1：本地有分支，把分支更新推送到远程版本库（远程版本库还没有对应的分支）<br>git push -u origin newbranch<br>-u参数的作用：本地新建分支，远程仓库并没有该新分支，-u代表的意思：1.在远程仓库创建新版本库：newbranch；2.将本地新分支与新建的远程分支建立联系；3.push新分支上的文件上远程新分支去</p>
<p>情景2：远程有分支，本地还没有创建对应的分支</p>
<p>方案一：</p>
<p>本地新建分支<br>在现有分支的基础上新建分支：见上方创建分支<br>创建一个新的空分支<br>git symbolic-ref HEAD refs/heads/newbranch<br>rm .git/index<br>git clean -fdx </p>
<p>取回远程分支的代码<br>git pull [originName] [remoteBranchNaem] </p>
<p>这样就能在本地创建一个全新的分支且与远程同步并不发生冲突了<br>情景3：本地和远程都没分支 ===&gt; 划归到情景 1 或 2</p>
<p>情景4：本地和远程有相同数量的分支 ===&gt; 建立分支追踪即可</p>
<p>删除本地分支和远程分支</p>
<p>删除本地分支：<br>$ git branch -D mybranch1 </p>
<p>删除远程分支：<br>git push [originName] –delete [branchName] </p>
<ul>
<li>分支同步</li>
</ul>
<p>如何在本地删除分支后，使远程的该分支也得到删除？</p>
<p>再使用下面的命令删除远程分支，相当于把一个空的分支推送到远程分支上，达到删除的目的，注意：不能删除设置的默认分值，删除时会报错<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin :mybranch1</span><br></pre></td></tr></table></figure></p>
<p>如何在删除远程分支后，使本地分支也得到删除？</p>
<p>远程主机删除了某个分支，默认情况下，git pull 不会在拉取远程分支的时候，删除对应的本地分支。这是为了防止，由于其他人操作了远程主机，导致git pull不知不觉删除了本地分支。 </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull -p [origin]</span><br></pre></td></tr></table></figure>
<h2 id="标签管理"><a href="#标签管理" class="headerlink" title="标签管理"></a>标签管理</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git tag                                 <span class="comment"># 显示已存在的tag</span></span><br><span class="line">git tag -r 								<span class="comment"># 查看远程版本</span></span><br><span class="line">git tag v2.0   							<span class="comment"># 创建标签</span></span><br><span class="line">git tag -a v2.0 -m <span class="string">'xxx'</span>                <span class="comment"># 增加v2.0的tag，带有注释</span></span><br><span class="line">git tag -d v2.0                         <span class="comment"># 删除标签</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git pull origin --tags 					<span class="comment"># 合并远程仓库的tag到本地</span></span><br><span class="line">git push origin --tags 					<span class="comment"># 上传本地tag到远程仓库</span></span><br></pre></td></tr></table></figure>
<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git log --pretty=short | git shortlog [&lt;options&gt;]</span><br><span class="line">git shortlog [&lt;options&gt;] [&lt;revision range&gt;] [[\--] &lt;path&gt;…​]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span>                                                   <span class="comment"># 显示提交日志</span></span><br><span class="line">git <span class="built_in">log</span> -3                                                <span class="comment"># 显示3行日志 -n为n行</span></span><br><span class="line">git <span class="built_in">log</span> --<span class="built_in">stat</span>                                            <span class="comment"># 显示提交日志及相关变动文件</span></span><br><span class="line">git <span class="built_in">log</span> -p -m</span><br><span class="line">git <span class="built_in">log</span> v2.0                                              <span class="comment"># 显示v2.0的日志</span></span><br><span class="line">git <span class="built_in">log</span> --pretty=format:<span class="string">'%h %s'</span> --graph                   <span class="comment"># 图示提交日志</span></span><br><span class="line">git <span class="built_in">log</span> --oneline --number 							      <span class="comment"># : 每条log只显示一行,显示number条.</span></span><br><span class="line">git <span class="built_in">log</span> --oneline --graph                                 <span class="comment"># :可以图形化地表示出分支合并历史.</span></span><br><span class="line">git <span class="built_in">log</span> branchname                                        <span class="comment"># 可以显示特定分支的log.</span></span><br><span class="line">git <span class="built_in">log</span> --oneline branch1 ^branch2                        <span class="comment"># 可以查看在分支1,却不在分支2中的提交.^表示排除这个分支(Window下可能要给^branch2加上引号).</span></span><br><span class="line">git <span class="built_in">log</span> --decorate                                        <span class="comment"># 会显示出tag信息.</span></span><br><span class="line">git <span class="built_in">log</span> --author=[author name]                            <span class="comment"># 可以指定作者的提交历史.</span></span><br><span class="line">git <span class="built_in">log</span> --since --before --until --after                  <span class="comment"># 根据提交时间筛选log.</span></span><br><span class="line">git <span class="built_in">log</span> --no-merges                                       <span class="comment"># 可以将merge的commits排除在外.</span></span><br><span class="line">git <span class="built_in">log</span> --grep=keywords                                   <span class="comment"># 根据commit信息过滤log</span></span><br><span class="line">git <span class="built_in">log</span> -p:                                               <span class="comment"># 每一个提交都是一个快照(snapshot),Git会把每次提交的diff计算出来,作为一个patch显示给你看.另一种方法是git show [SHA].</span></span><br><span class="line">git <span class="built_in">log</span> --<span class="built_in">stat</span>:                                           <span class="comment"># 同样是用来看改动的相对信息的,--stat比-p的输出更简单一些.</span></span><br><span class="line">git <span class="built_in">log</span> -SmethodName                                      <span class="comment"># (注意S和后面的词之间没有等号分隔).</span></span><br><span class="line">git <span class="built_in">log</span> --grep --author                                   <span class="comment"># 是OR的关系,即满足一条即被返回,如果你想让它们是AND的关系,可以加上--all-match的option.</span></span><br><span class="line">git reflog                                                <span class="comment"># 显示所有提交，包括孤立节点</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git reflog [show] [<span class="built_in">log</span>-options] [&lt;ref&gt;]</span><br><span class="line">git reflog expire [--expire=&lt;time&gt;] [--expire-unreachable=&lt;time&gt;]</span><br><span class="line">	[--rewrite] [--updateref] [--stale-fix]</span><br><span class="line">	[--dry-run] [--verbose] [--all | &lt;refs&gt;…​]</span><br><span class="line">git reflog delete [--rewrite] [--updateref]</span><br><span class="line">	[--dry-run] [--verbose] ref@&#123;specifier&#125;…​</span><br><span class="line">git reflog exists &lt;ref&gt;</span><br></pre></td></tr></table></figure>
<h2 id="show"><a href="#show" class="headerlink" title="show"></a>show</h2><p>Shows one or more objects (blobs, trees, tags and commits).</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git show [options] &lt;object&gt;…​</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git show dfb02e6e4f2f7b573337763e5c0013802e392818         <span class="comment"># 显示某个提交的详细内容</span></span><br><span class="line">git show dfb02                                            <span class="comment"># 可只用commitid的前几位</span></span><br><span class="line">git show HEAD                                             <span class="comment"># 显示HEAD提交日志</span></span><br><span class="line">git show HEAD^                                            <span class="comment"># 显示HEAD的父（上一个版本）的提交日志 ^^为上两个版本 ^5为上5个版本</span></span><br><span class="line">git show HEAD@&#123;5&#125;</span><br><span class="line">git show HEAD~3</span><br><span class="line">git show v2.0                                             <span class="comment"># 显示v2.0的日志及详细内容</span></span><br><span class="line">git show master@&#123;yesterday&#125;                               <span class="comment"># 显示master分支昨天的状态</span></span><br><span class="line">git show -s --pretty=raw 2be7fcb476</span><br><span class="line">git show-branch                                           <span class="comment"># 图示当前分支历史</span></span><br><span class="line">git show-branch --all                                     <span class="comment"># 图示所有分支历史</span></span><br></pre></td></tr></table></figure>
<h2 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git grep <span class="string">"delete from"</span>                                    <span class="comment"># 文件中搜索文本“delete from”</span></span><br><span class="line">git grep -e <span class="string">'#define'</span> --and -e SORT_DIRENT</span><br></pre></td></tr></table></figure>
<h2 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h2><ul>
<li>git gc</li>
<li>git fsck</li>
<li>git cherry-pick ff44785404a8e                             # 合并提交ff44785404a8e的修改</li>
<li>git whatchanged                                           # 显示提交历史对应的文件修改</li>
</ul>
<h2 id="内部命令"><a href="#内部命令" class="headerlink" title="内部命令"></a>内部命令</h2><ul>
<li>cat-file</li>
<li>commit-tree</li>
<li>count-objects</li>
<li>diff-index</li>
<li>for-each-ref</li>
<li>hash-object</li>
<li>ls-files</li>
<li>merge-base</li>
<li>read-tree</li>
<li>rev-list</li>
<li>rev-parse</li>
<li>show-ref</li>
<li>symbolic-ref</li>
<li>update-index</li>
<li>update-ref</li>
<li>verify-pack</li>
<li><p>write-tree</p>
</li>
<li><p>git ls-files                                              # 列出git index包含的文件</p>
</li>
<li>git ls-tree HEAD                                          # 内部命令：显示某个git对象</li>
<li>git rev-parse v2.0                                        # 内部命令：显示某个ref对于的SHA1 HASH</li>
</ul>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/posts/JavaScript深度/">
                JavaScript深度
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-05-02</span>
            
            
                <a href="/posts/JavaScript深度/#disqus_thread" class="comments article-comment-link">Comments</a>
            
            
                <span class="category">
                    <a href="/categories/Syntax/">Syntax</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="JavaScript-Deep"><a href="#JavaScript-Deep" class="headerlink" title="JavaScript Deep"></a>JavaScript Deep</h1><p>Focus on concepts，not syntax.</p>
<p>关注概念的理解，而不是语法。</p>
<h2 id="执行上下文堆栈"><a href="#执行上下文堆栈" class="headerlink" title="执行上下文堆栈"></a>执行上下文堆栈</h2><ul>
<li>EC(执行环境或者执行上下文，Execution Context)</li>
<li>ECS(执行环境堆栈或者执行上下文堆栈，Execution Context Stack)</li>
<li>VO(变量对象，Variable Object)</li>
<li>AO(活动对象，Active Object)</li>
<li>ScopeChain(作用域链)和 <code>[[scope]]</code> 属性</li>
</ul>
<p>有三种类型的ECMAScript代码：</p>
<p><code>全局代码</code>、<code>函数代码</code>、<code>eval代码</code></p>
<ul>
<li>每个代码是在其执行上下文（EC）中被求值的。</li>
<li>全局上下文只有一个，可能有多个函数执行上下文以及 <code>eval</code> 执行上下文。</li>
<li>对一个函数的每次调用，会进入到函数执行上下文中，并对函数代码类型进行求值。</li>
<li>每次对 <code>eval</code> 函数进行调用，会进入 <code>eval</code> 执行上下文并对其代码进行求值。</li>
</ul>
<blockquote>
<p>注意，一个函数可能会创建无数的上下文，因为对函数的每次调用（即使这个函数递归的调用自己）都会生成一个具有新状态的上下文：</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">bar</span>) </span>&#123;&#125;</span><br><span class="line"><span class="comment">// call the same function,</span></span><br><span class="line"><span class="comment">// generate three different contexts in each call,</span></span><br><span class="line"><span class="comment">// with different context state (e.g. value of the "bar" argument)</span></span><br><span class="line">foo(<span class="number">10</span>);</span><br><span class="line">foo(<span class="number">20</span>);</span><br><span class="line">foo(<span class="number">30</span>);</span><br></pre></td></tr></table></figure>
<p>一个 <code>执行上下文(EC)</code> 可能会触发另一个 <code>执行上下文(EC)</code>，如，一个函数调用另一个函数。从逻辑上来说，这是以栈的形式实现的，它叫作 <code>执行上下文栈(ECS)</code>。</p>
<p>一个触发其他上下文的上下文叫作 <code>caller</code>，被触发的上下文叫作 <code>callee</code>，<code>callee</code> 在同一时间可能是一些其他 <code>callee</code> 的 <code>caller</code>。</p>
<p>当一个 <code>caller</code> 触发（调用）了一个 <code>callee</code> ，这个 <code>caller</code> 会暂缓自身的执行，然后把控制权传递给 <code>callee</code>，控制权转移。</p>
<p>这个 <code>callee</code> 被push到 <code>执行上下文栈(ECS)</code> 中，并成为一个 <code>活动的</code> <code>执行上下文</code>，在 <code>callee</code> 的上下文结束后（<code>callee</code> 可能简单的返回或者由于异常而退出，一个抛出的但没有被捕获的异常可能退出一个或者多个上下文），它会把控制权返回给 <code>caller</code>，然后 <code>caller</code> 的上下文继续执行直到它结束，以此类推。</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/caller" target="_blank" rel="noopener">Caller</a></p>
<blockquote>
<p>function.caller[Non-standard]<br>The function.caller property returns the function that invoked the specified function.<br>If the function f was invoked by the top level code, the value of f.caller is null, otherwise it’s the function that called f.<br>This property replaces the obsolete arguments.caller property of the arguments object.<br>The special property <code>__caller__</code>, which returned the activation object of the caller thus allowing to reconstruct the stack, was removed for security reasons.</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">n</span>) </span>&#123; g(n - <span class="number">1</span>); &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params">n</span>) </span>&#123; <span class="keyword">if</span> (n &gt; <span class="number">0</span>) &#123; f(n); &#125; <span class="keyword">else</span> &#123; stop(); &#125; &#125;</span><br><span class="line">f(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// f(2) -&gt; g(1) -&gt; f(1) -&gt; g(0) -&gt; stop()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// stop.caller === g &amp;&amp; f.caller === g &amp;&amp; g.caller === f</span></span><br></pre></td></tr></table></figure>
<p>Example:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trace</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> f = trace, stack = <span class="string">'Stack trace:'</span>;</span><br><span class="line">  <span class="keyword">while</span> (f) &#123;</span><br><span class="line">    stack += <span class="string">'\n'</span> + f.name;</span><br><span class="line">    f = f.caller;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> stack;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> trace(); &#125;</span><br><span class="line"><span class="keyword">var</span> stacks = myFunc();</span><br><span class="line"><span class="built_in">console</span>.log(stacks);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> myFunc(); &#125;</span><br><span class="line"><span class="keyword">var</span> stacks = f();</span><br><span class="line"><span class="built_in">console</span>.log(stacks);</span><br></pre></td></tr></table></figure>
<p>下图是上面代码的函数调用链，对应于 <code>执行上下文(EC)</code>，在引擎层面，函数只是 <code>执行上下文</code> 的一个属性。</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/caller-chain.png" alt="caller-chain"></p>
<p>所有ECMAScript程序的运行时可以用 <code>执行上下文栈（ECS）</code> 来表示，栈顶是当前 <code>活动的执行上下文</code>：</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/ec-stack.png" alt="ec-stack"></p>
<p>当程序开始的时候它会进入 <code>全局执行上下文</code>，此上下文位于栈顶并且是栈中的第一个元素。然后全局代码进行一些 <code>初始化</code>。</p>
<p>当初始化完成之后，运行时系统就会等待一些事件，这些事件将会触发一些函数，从而进入新的执行上下文中。</p>
<p>在下个图中，拥有一个 <code>函数上下文 EC1</code> 和 <code>全局上下文 GlobalEC</code>，当 <code>EC1</code> 进入和退出全局上下文的时候下面的栈将会发生变化：</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/ec-stack-changes.png" alt="ec-stack-changes"></p>
<p>这就是 ECMAScript 的运行时系统如何真正地管理代码执行的。</p>
<p>栈中的每个 <code>执行上下文</code> 都可以用一个对象来表示。</p>
<p>让我们来看看它的结构以及一个上下文到底需要什么状态（属性）来执行它的代码。</p>
<h3 id="执行上下文"><a href="#执行上下文" class="headerlink" title="执行上下文"></a>执行上下文</h3><p>一个执行上下文可以抽象的表示为一个简单的对象。每一个执行上下文拥有一些属性（可以叫作上下文状态）用来跟踪或表示和它相关的代码的执行过程。</p>
<p>在下图中展示了一个上下文的结构：</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/execution-context.png" alt="execution-context"></p>
<p>除了这三个必需的属性 <code>变量/活动对象</code>、<code>作用域链</code>、<code>this</code> 之外，<code>执行上下文</code> 可以拥有其他状态，这取决于实现。</p>
<p>让我们详细看看上下文中的这些重要的属性。</p>
<h3 id="变量对象（variable-object）"><a href="#变量对象（variable-object）" class="headerlink" title="变量对象（variable object）"></a>变量对象（variable object）</h3><p><code>变量对象</code> 是与 <code>执行上下文</code> 相关的 <code>数据作用域</code>，所以也可以叫做 <code>作用域对象</code>。</p>
<p>它是一个与上下文相关的特殊对象，其中存储了在上下文中定义的 <code>变量</code> 和 <code>函数</code>。</p>
<blockquote>
<p>函数表达式（与函数声明相对）不包含在变量对象之中。</p>
</blockquote>
<p>变量对象是一个抽象概念。对于不同的上下文类型，在物理上，是使用不同的对象。</p>
<p>在全局上下文中变量对象就是全局对象本身，这就是为什么我们可以通过 <code>全局对象的属性名</code> 来关联 <code>“全局变量”</code>。</p>
<p>全局变量：</p>
<p>JavaScript中并不存在 <code>全局变量</code>，所谓的全局变量，不过是 <code>Global对象的一个属性</code>，叫 <code>全局属性</code> 还差不多，或者叫 <code>全局变量对象</code>，变量和属性虽然都是数据的引用方式，但是却有很大差别。</p>
<p>Example:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> global = global || <span class="built_in">window</span>;</span><br><span class="line">global.env = <span class="string">'production'</span>;</span><br><span class="line">NODE_ENV = <span class="string">'production'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(env);</span><br><span class="line"><span class="built_in">console</span>.log(global.NODE_ENV);</span><br><span class="line"><span class="comment">// 访问 全局属性 直接通过属性名就可以了。</span></span><br><span class="line"><span class="comment">// 这也是为什么被误称为 全局对象 的原因之一。</span></span><br></pre></td></tr></table></figure>
<p>让我们在全局执行上下文中考虑下面这个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;&#125;       <span class="comment">// function declaration, FD</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>) </span>&#123;&#125;);    <span class="comment">// function expression, FE</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span>.foo == foo, <span class="built_in">window</span>.bar == bar);  <span class="comment">// true // true</span></span><br><span class="line"><span class="built_in">console</span>.log(baz);       <span class="comment">// ReferenceError, "baz" is not defined</span></span><br></pre></td></tr></table></figure>
<p>之后，全局上下文的 <code>变量对象</code> 将会拥有如下属性：</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/variable-object.png" alt="variable-object"></p>
<p>函数 <code>baz</code> 是一个函数表达式，没有被包含在变量对象之中。这就是为什么当我们想要在函数自身之外访问它的时候会出现 <code>ReferenceError</code>。</p>
<p>注意，与其他语言（比如C/C++）相比，在ECMAScript中只有函数可以创建一个新的作用域。在函数作用域中所定义的变量和内部函数在函数外边是不能直接访问到的，而且并不会污染全局变量对象。</p>
<p>使用 <code>eval</code> 我们也会进入一个新的执行上下文。无论如何，<code>eval</code> 使用全局的变量对象或者使用 <code>caller</code>（比如eval被调用时所在的函数）的变量对象。</p>
<p>那么函数和它的变量对象是怎么样的？</p>
<p>在函数上下文中，<code>变量对象</code> 是以 <code>活动对象</code> 来表示的。</p>
<p>为什么全局上下文中不需要 <code>活动对象</code>，而 <code>变量对象</code> 就是 <code>全局对象本身</code>？</p>
<p>因为 <code>全局上下文</code> 只有一个，用 <code>全局对象</code> 即可作为 <code>变量对象</code> 提供名字查找，而同一函数可能 会同时存在多个 <code>函数上下文</code>，每个上下文各不相同，且 <code>函数上下文</code> 与 <code>全局上下文</code> 又有不同，所以引入了 <code>活动对象</code> 来表示 <code>变量对象</code>。</p>
<h3 id="活动对象（activation-object）"><a href="#活动对象（activation-object）" class="headerlink" title="活动对象（activation object）"></a>活动对象（activation object）</h3><p>当一个函数被 <code>caller</code> 调用，一个特殊的对象，叫作 <code>活动对象</code>（activation object）将会被创建。</p>
<p>这个对象中包含 <code>形参</code> 和 <code>arguments</code> 对象（是对形参的一个映射，但是值是通过索引来获取）。</p>
<p><code>活动对象</code> 之后会做为函数上下文的 <code>变量对象</code> 来使用。</p>
<p>换句话说，函数的 <code>活动对象</code> 就是一个同样简单的 <code>变量对象</code>，但是除了 <code>变量</code> 和 <code>函数声明</code> 之外，它还存储了 <code>形参</code> 和 <code>arguments</code> 对象，并叫作 <code>活动对象</code>。</p>
<p>即：<code>活动对象</code> &lt;=&gt; <code>变量对象</code> + <code>形参</code> + <code>arguments</code> + <code>变量声明</code> + <code>函数声明</code></p>
<p>全局上下文中并没有 <code>形参</code>，更没有 <code>arguments</code>，所以和函数上下文不同，这是全局上下文和函数上下文的不同之一。</p>
<p>考虑如下例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> z = <span class="number">30</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;&#125;     <span class="comment">// FD</span></span><br><span class="line">  (<span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>) </span>&#123;&#125;);  <span class="comment">// FE</span></span><br><span class="line">&#125;</span><br><span class="line">foo(<span class="number">10</span>, <span class="number">20</span>);</span><br></pre></td></tr></table></figure>
<p>我们看下函数foo的上下文中的活动对象：</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/activation-object.png" alt="activation-object"></p>
<p>函数表达式baz还是没有被包含在 <code>变量/活动对象</code> 中。</p>
<p>在ES5中 <code>变量对象</code> 和 <code>活动对象</code> 被并入了 <code>词法环境模型</code>（lexical environments model）。</p>
<p>众所周知，在 ECMAScript 中我们可以使用内部函数，然后在这些内部函数中可以引用父函数的变量或者全局上下文中的变量。</p>
<p>当我们把 <code>变量对象</code> 命名为 执行上下文的 <code>作用域对象</code>，与上面讨论的原型链相似，作用域对象 可以 形成一条链，叫作 <code>作用域链</code>。</p>
<h3 id="作用域链-scope-chain"><a href="#作用域链-scope-chain" class="headerlink" title="作用域链(scope chain)"></a>作用域链(scope chain)</h3><p><code>作用域链</code> 是一个 <code>作用域对象</code>（即：<code>变量/活动对象</code>） 列表，代码中出现的标识符在这个列表中进行查找。</p>
<p>这个规则还是与原型链同样简单：</p>
<p>如果一个变量在函数自身的 <code>作用域对象</code>中没有找到，那么将会查找它父函数（外层函数）的 <code>作用域对象</code>，以此类推。</p>
<p>就上下文而言，标识符指的是：<code>变量名称、函数声明、形参</code> 等。</p>
<p>自由变量(free variables)：</p>
<p>当一个函数在其代码中引用一个不是 <code>局部变量</code>（或者局部函数或者一个形参）的标识符，那么这个标识符就叫作 <code>自由变量</code>，搜索这些 <code>自由变量</code> 正好就要用到 <code>作用域链</code>。</p>
<p>在通常情况下，<code>作用域链</code> 是一个包含所有 <code>caller的变量/活动对象</code> 加上（在作用域链头部的）<code>callee（自身）变量/活动对象</code> 的一个列表。</p>
<p>这个 <code>作用域链</code> 也可以包含任何其他对象，比如，在上下文执行过程中动态加入到作用域链中的对象－像 <code>with对象</code> 或者特殊的 <code>catch从句（catch-clauses）对象</code>。</p>
<p>当解析一个标识符的时候，会从作用域链中的 <code>变量对象</code> 开始查找，然后（如果这个标识符在函数自身的活动对象中没有被查找到）向作用域链的上一层查找－重复这个过程，就和原型链查找一样。</p>
<p>综上：<code>作用域链</code> 可以看作是 <code>变量对象链</code>。</p>
<p>我们可以假设通过隐式的 <code>__parent__</code> 属性 来和 <code>作用域链对象</code> 进行交互，这个属性指向作用域链中的下一个对象。</p>
<p>这个方案可能在真实的 Rhino 代码中经过了测试，并且这个技术很明确得被用于ES5的词法环境中（在那里被叫作outer连接）。</p>
<p>作用域链的另一个表现方式可以是一个简单的数组。利用 <code>__parent__</code> 概念，我们可以用下面的图来表现上面的例子（并且父变量对象存储在函数的 <code>[[Scope]]</code> 属性中）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">10</span>;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> y = <span class="number">20</span>;</span><br><span class="line">  (<span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> z = <span class="number">30</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(x + y + z);</span><br><span class="line">  &#125;)();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/scope-chain.png" alt="scope-chain"></p>
<p>在代码执行过程中，作用域链可以通过使用 <code>with语句</code> 和 <code>catch从句对象</code> 来增强。并且由于这些对象是简单的对象，它们可以拥有原型（和原型链）。</p>
<p>这个事实导致作用域链查找变为两个维度：</p>
<ol>
<li>首先是作用域链连接，然后</li>
<li>在每个作用域链连接上－深入作用域链连接的原型链（如果此连接拥有原型）。</li>
</ol>
<p>对于这个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.x = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> w = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">var</span> y = <span class="number">30</span>;</span><br><span class="line"><span class="comment">// in SpiderMonkey global object i.e. variable object of the global context inherits from "Object.prototype",</span></span><br><span class="line"><span class="comment">// 全局对象(global|window) 依然是 Object 对象的实例，所以会从 Object.prototype 继承 属性和方法</span></span><br><span class="line"><span class="comment">// so we may refer "not defined global variable x", which is found in the prototype chain</span></span><br><span class="line"><span class="built_in">console</span>.log(x); <span class="comment">// 10</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// "foo" local variables</span></span><br><span class="line">  <span class="keyword">var</span> w = <span class="number">40</span>;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">100</span>;</span><br><span class="line">  <span class="comment">// "x" is found in the "Object.prototype", because &#123;z: 50&#125; inherits from it</span></span><br><span class="line">  <span class="keyword">with</span> (&#123;<span class="attr">z</span>: <span class="number">50</span>&#125;) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(w, x, y, z); <span class="comment">// 40, 10, 30, 50 // 关键在这里</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// after "with" object is removed from the scope chain,</span></span><br><span class="line">  <span class="comment">// "x" is again found in the AO of "foo" context;</span></span><br><span class="line">  <span class="comment">// variable "w" is also local</span></span><br><span class="line">  <span class="built_in">console</span>.log(x, w); <span class="comment">// 100, 40</span></span><br><span class="line">  <span class="comment">// and that's how we may refer shadowed global "w" variable in the browser host environment</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">window</span>.w); <span class="comment">// 20</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>我们可以给出如下的结构：</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/scope-chain-with.png" alt="scope-chain-with"></p>
<blockquote>
<p>在 <code>GlobalVO</code> 向上查找时，会同时存在 <code>__parent__</code> 和 <code>__proto__</code>，即 <code>作用域链</code> 和 <code>原型链</code> 在引擎内部的表示对象上有了交点，在查找 <code>__parent__</code> 之前，首先查找 <code>__proto__</code> 链，此时，<code>作用域链</code> 已到达终点，也不需要继续查找。只在 <code>GlobalVO</code> <code>作用域链</code> 和 <code>原型链</code> 才会有交点。</p>
</blockquote>
<blockquote>
<p>注意，不是在所有的实现中 <code>全局对象</code> 都是继承自 <code>Object.prototype</code>，但是通常 是这样的。</p>
</blockquote>
<p>由于所有 <code>父变量对象</code> 都存在，所以在内部函数中获取父函数中的数据没有什么特别－就是遍历作用域链去搜寻需要的变量。</p>
<p>就像上边提及的，在一个上下文结束之后，它所有的状态和它自身都会被销毁，这个上下文（函数）可能会返回另一个函数，这个返回的函数之后可能在另一个上下文中被调用。<br>如果 <code>自由变量</code> 的上下文已经「消失」了，将会出现问题，有一个方式可以帮助我们解决这个问题，叫作 <code>闭包</code>，其在ECMAScript 中就是和 <code>作用域链</code> 的概念紧密相关的。</p>
<p>父函数上下文被销毁之后，为了满足子函数查找 <code>自由变量</code> 的需求，子函数在创建的时候，需要保存父函数的 <code>执行上下文</code>，保存的字段 叫 <code>[[Scope]]</code>，这一方式被称为 <code>闭包</code>。</p>
<h4 id="闭包（closure）"><a href="#闭包（closure）" class="headerlink" title="闭包（closure）"></a>闭包（closure）</h4><p>在 ECMAScript 中，函数是一级（<code>first-class</code>）对象。这意味着函数可以做为参数传递给其他函数 <code>「函数类型参数」（funargs）</code>。</p>
<p>接收 <code>「函数类型参数」</code> 的函数叫作 <code>高阶函数</code>。或者，贴近数学一些，叫作 <code>高阶操作符</code>。同样函数也可以返回一个函数，<code>「函数类型值」（funvals）</code>。</p>
<p>这有两个在概念上与 <code>「函数类型参数」</code> 和 <code>「函数类型值」</code> 相关的问题。</p>
<p>并且这两个子问题在 <code>Funarg problem</code> 中很普遍。为了解决整个 <code>Funarg problem</code>，<code>闭包</code> 的概念被创造了出来。</p>
<p><code>Funarg problem</code> 的第一个子问题是 <code>「向上funarg问题」</code>。它会在当一个函数从另一个函数中返回并且使用上面所提到的 <code>自由变量</code> 的时候出现。</p>
<p>为了在即使 <code>父函数上下文销毁</code> 的情况下也能访问其中的变量，内部函数在被创建的时候会在它的 <code>[[Scope]]</code> 属性中保存 <code>父函数的作用域链</code>。</p>
<p>所以当函数被调用的时候，它上下文的作用域链会被格式化成 <code>活动对象</code> 与 <code>[[Scope]]</code> 属性的和：</p>
<p><code>Scope chain = AO + [[Scope]]</code>。</p>
<p>函数在创建时会保存父函数的 <code>作用域链</code>，这个保存下来的 <code>作用域链</code> 将会在未来的函数调用时用来 <code>查找变量</code>。</p>
<p>如果从对象引用层面来理解，<code>[[Scope]]</code> 被另外一个对象（函数）引用，引擎不会回收这些资源，所以闭包容易带来内存泄漏的隐患。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// "foo" returns a function and this returned function uses free variable "x"</span></span><br><span class="line"><span class="keyword">var</span> returnedFunction = foo();</span><br><span class="line"><span class="comment">// global variable "x"</span></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">20</span>;</span><br><span class="line"><span class="comment">// execution of the returned function</span></span><br><span class="line">returnedFunction(); <span class="comment">// 10, but not 20</span></span><br></pre></td></tr></table></figure>
<p>这个类型的作用域叫作 <code>静态（或者词法）作用域</code>。我们看到 <code>变量x</code> 在返回的bar函数的 <code>[[Scope]]</code> 属性中被找到。</p>
<p>通常来说，也存在动态作用域，那么上面例子中的 <code>变量x</code> 将会被解析成 <code>20</code>，而不是 <code>10</code>。但是，动态作用域在 ECMAScript 中没有被使用。</p>
<p><code>Funarg problem</code> 的第二个子问题是 <code>「向下funarg问题」</code>。它会在当一个函数作为另一个函数的参数并且使用上面所提到的 <code>自由变量</code> 的时候出现。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// global "x"</span></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">10</span>;</span><br><span class="line"><span class="comment">// global function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">funArg</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// local "x"</span></span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">20</span>;</span><br><span class="line">  <span class="comment">// there is no ambiguity, because we use global "x", </span></span><br><span class="line">  <span class="comment">// which was statically saved in [[Scope]] of the "foo" function,</span></span><br><span class="line">  <span class="comment">// but not the "x" of the caller's scope, which activates the "funArg"</span></span><br><span class="line">  funArg(); <span class="comment">// 10, but not 20</span></span><br><span class="line">&#125;)(foo); <span class="comment">// pass "down" foo as a "funarg"</span></span><br></pre></td></tr></table></figure>
<p><code>词法作用域/静态作用域</code>：变量的作用域是在 <code>定义时</code> 决定而不是 <code>运行时</code> 决定，也就是说 <code>词法作用域</code> 取决于源码，通过静态分析就能确定，因此词法作用域也叫做静态作用域。<code>with</code> 和 <code>eval</code> 除外，所以只能说JS的作用域机制非常接近 <code>词法作用域（Lexical scope）</code>。</p>
<p>我们可以断定 <code>静态作用域</code> 是一门语言拥有 <code>闭包</code> 的必需条件。但是，一些语言可能会同时提供动态和静态作用域，允许程序员做选择－什么应该 <code>包含</code> 在内和什么不应包含在内。</p>
<p>由于在 ECMAScript 中只使用了 <code>静态作用域</code>，所以：ECMAScript 完全支持闭包，技术上是通过函数的 <code>[[Scope]]</code> 属性实现的。</p>
<p>现在我们可以给闭包下一个准确的定义：<a href="https://zh.wikipedia.org/wiki/闭包_(计算机科学" target="_blank" rel="noopener">闭包</a> )</p>
<p>在计算机科学中，闭包（英语：Closure），又称词法闭包（Lexical Closure）或函数闭包（function closures），是引用了自由变量的函数。<br>这个被引用的自由变量将和这个函数一同存在，即使已经离开了创造它的环境也不例外。<br>所以，有另一种说法认为闭包是由函数和与其相关的引用环境组合而成的实体。<br>闭包在运行时可以有多个实例，不同的引用环境和相同的函数组合可以产生不同的实例。</p>
<p>闭包是一个代码块（在ECMAScript是一个函数）和以 <code>静态方式</code>/<code>词法方式</code> 进行存储的所有父作用域的一个集合体。所以，通过这些存储的作用域，函数可以很容易的找到 <code>自由变量</code>。</p>
<p>闭包使得一个函数能够通过作用域链查找到另一个函数作用域中的变量。</p>
<p>闭包影响了作用域链，尤其是那些被销毁的上下文。</p>
<p>注意，由于每个（标准的）函数都在创建的时候保存了 <code>[[Scope]]</code>，所以理论上来讲，ECMAScript 中的所有函数都是闭包。</p>
<p>另一个需要注意的重要事情是，多个函数可能拥有相同的父作用域，比如当我们拥有两个内部/全局函数的时候。</p>
<p>在这种情况下，<code>[[Scope]]</code> 属性中存储的变量是在拥有相同父作用域链的所有函数之间共享的。</p>
<p>一个闭包对变量进行的修改会体现在另一个闭包对这些变量的读取上：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    foo: <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> ++x; &#125;,</span><br><span class="line">    bar: <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> --x; &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> closures = baz();</span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  closures.foo(), <span class="comment">// 2</span></span><br><span class="line">  closures.bar()  <span class="comment">// 1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/shared-scope.png" alt="shared-scope"></p>
<p>确切来说这个特性在循环中创建多个函数的时候会使人非常困惑。在创建的函数中使用循环计数器的时候，一些程序员经常会得到非预期的结果，所有函数中的计数器都是同样的值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; <span class="number">3</span>; k++) &#123;</span><br><span class="line">  data[k] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(k);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">data[<span class="number">0</span>](); <span class="comment">// 3, but not 0</span></span><br><span class="line">data[<span class="number">1</span>](); <span class="comment">// 3, but not 1</span></span><br><span class="line">data[<span class="number">2</span>](); <span class="comment">// 3, but not 2</span></span><br><span class="line"><span class="comment">// 这里有几种技术可以解决这个问题。</span></span><br><span class="line"><span class="comment">// 其中一种是在作用域链中提供一个额外的对象－比如，使用额外函数：</span></span><br><span class="line"><span class="keyword">var</span> data = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; <span class="number">3</span>; k++) &#123;</span><br><span class="line">  data[k] = (<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(x);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;)(k); <span class="comment">// pass "k" value</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// now it is correct</span></span><br><span class="line">data[<span class="number">0</span>](); <span class="comment">// 0</span></span><br><span class="line">data[<span class="number">1</span>](); <span class="comment">// 1</span></span><br><span class="line">data[<span class="number">2</span>](); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>因为所有这些函数拥有同一个 <code>[[Scope]]</code>，这个属性中的循环计数器的值是最后一次所赋的值。</p>
<p>建议了解一下其他语言闭包的支持情况。</p>
<p>然后我们移动到下个部分，考虑一下执行上下文的最后一个属性，关于 this 值的概念。</p>
<h3 id="This"><a href="#This" class="headerlink" title="This"></a>This</h3><p><code>this</code> 是一个与执行上下文相关的特殊对象。因此，它可以叫作 <code>上下文对象</code>，也就是用来指明执行上下文是在对象上触发的。</p>
<p>任何对象都可以做为上下文中的 <code>this</code> 的值。在一些对 ECMAScript 执行上下文和部分 <code>this</code> 的描述中的所产生误解，<code>this</code> 经常被错误的描述成是变量对象的一个属性。</p>
<p>正确的是：<code>this是执行上下文的一个属性，而不是变量对象的一个属性</code>。这个特性非常重要，因为如果 <code>this</code> 是变量对象的属性，<code>this</code> 会参与标识符解析过程，然而，<code>this</code> 从不会参与到标识符解析过程。</p>
<p>换句话说，在代码中当访问 <code>this</code> 的时候，它的值是直接从 <code>执行上下文</code> 中获取的，并不需要任何作用域链查找。<code>this</code> 的值只在进入上下文的时候进行一次确定。</p>
<p>顺便说一下，与 ECMAScript 相反，Python 的方法都会拥有一个被当作简单变量的 <code>self</code> 参数，这个变量的值在各个方法中是相同的的并且在执行过程中可以被更改成其他值。<br>在 ECMAScript 中，给 <code>this</code> 赋一个新值是不可能的，因为，它不是一个变量并且不存在于变量对象中。</p>
<p>在全局上下文中，<code>this</code> 就等于 <code>全局对象</code> 本身，这也意味着 <code>this</code> 就是 <code>全局变量对象</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(x, <span class="keyword">this</span>.x, <span class="built_in">window</span>.x);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line">f(); <span class="comment">// 输出了全局对象</span></span><br></pre></td></tr></table></figure>
<p>在函数上下文的情况下，对函数的每次调用，其中的 <code>this</code> 值可能是不同的。这个 <code>this</code> 值是通过函数调用表达式（也就是函数被调用的方式）的形式由 <code>caller</code> 所提供的。</p>
<p>让我们通过例子看一下，对于一个代码相同的函数，<code>this</code> 值是如何在不同的调用中（函数触发的不同方式），由 <code>caller</code> 给出不同的结果的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="keyword">this</span>); &#125;</span><br><span class="line"></span><br><span class="line">foo(); <span class="comment">// global object</span></span><br><span class="line">foo.prototype.constructor(); <span class="comment">// foo.prototype</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = &#123; <span class="attr">baz</span>: foo &#125;;</span><br><span class="line">bar.baz(); <span class="comment">// bar</span></span><br><span class="line"></span><br><span class="line">(bar.baz)();            <span class="comment">// also bar</span></span><br><span class="line">(bar.baz = bar.baz)();  <span class="comment">// but here is global object</span></span><br><span class="line">(bar.baz, bar.baz)();   <span class="comment">// also global object</span></span><br><span class="line">(<span class="literal">false</span> || bar.baz)();   <span class="comment">// also global object</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> otherFoo = bar.baz;</span><br><span class="line">otherFoo();             <span class="comment">// again global object</span></span><br></pre></td></tr></table></figure>
<h4 id="bind、call、apply"><a href="#bind、call、apply" class="headerlink" title="bind、call、apply"></a><code>bind</code>、<code>call</code>、<code>apply</code></h4><p><code>call apply</code> 给了代码在控制 <code>this</code> 的能力。</p>
<p><code>bind</code> 是基于 <code>call apply</code> 实现的高阶函数。</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" target="_blank" rel="noopener">bind Polyfill</a>：fun.bind(thisArg[, arg1[, arg2[, …]]])<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// console.log(Function.prototype.apply.bind.call === Function.prototype.call);</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">Function</span>.prototype.bind) &#123;</span><br><span class="line">  <span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span>(<span class="params">oThis</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span> !== <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="comment">// closest thing possible to the ECMAScript 5</span></span><br><span class="line">      <span class="comment">// internal IsCallable function</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Function.prototype.bind - what is trying to be bound is not callable'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> aArgs   = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>),</span><br><span class="line">        fToBind = <span class="keyword">this</span>,</span><br><span class="line">        fNOP    = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">        fBound  = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> fToBind.apply(<span class="keyword">this</span> <span class="keyword">instanceof</span> fNOP ? <span class="keyword">this</span> : oThis, aArgs.concat(<span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>)));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造函数拥有 prototype</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.prototype) &#123;</span><br><span class="line">      <span class="comment">// native functions don't have a prototype</span></span><br><span class="line">      fNOP.prototype = <span class="keyword">this</span>.prototype;</span><br><span class="line">    &#125;</span><br><span class="line">    fBound.prototype = <span class="keyword">new</span> fNOP();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果 this 是构造函数，fBound 继承相关属性</span></span><br><span class="line">    <span class="keyword">return</span> fBound;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>关于 <code>this</code> 绑定</p>
<p>在 JavaScript 中，<code>this</code> 和 <code>函数</code> 之间的绑定时松散的，体现在我们可以轻易的通过 <code>call</code>、<code>apply</code> <code>指定</code> 或 <code>修改</code> <code>this</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#id'</span>).foreach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  $(<span class="keyword">this</span>).click();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="执行上下文总结"><a href="#执行上下文总结" class="headerlink" title="执行上下文总结"></a>执行上下文总结</h3><ul>
<li><code>变量/活动对象</code>：记录运行时所需要的数据，变量、函数、形参、实参等。</li>
<li><code>作用域链</code>：即 <code>变量/活动对象链</code>，为引擎进行变量查找提供基础。</li>
<li><code>this</code>：指明了当前执行的函数作用在哪个对象身上，方法的作用对象是谁。</li>
</ul>
<p>全局上下文 和 函数上下文比较：</p>
<p>在全局上下文中，<code>this=全局对象本身=变量对象</code>。</p>
<p>在函数上下文中，<code>this</code> 是 <code>执行上下文</code> 的一个属性。</p>
<p>所以这也解释了一些现象，<code>全局作用域</code> 下的 <code>变量或函数</code> 成为了 <code>全局对象的属性</code>了，如上面示例的代码。</p>
<h2 id="执行过程"><a href="#执行过程" class="headerlink" title="执行过程"></a>执行过程</h2><p><a href="https://www.nosuchfield.com/2017/07/16/Talk-about-compilation-principles-1/" target="_blank" rel="noopener">聊聊编译原理（一） - 词法分析</a><br><a href="https://www.nosuchfield.com/2017/07/30/Talk-about-compilation-principles-2/" target="_blank" rel="noopener">聊聊编译原理（二） - 语法分析</a></p>
<h3 id="执行顺序"><a href="#执行顺序" class="headerlink" title="执行顺序"></a>执行顺序</h3><ul>
<li>编译型语言，编译步骤分为：<code>词法分析</code>、<code>语法分析</code>、<code>语义检查</code>、<code>代码优化</code> 和 <code>字节生成</code>。</li>
<li>解释型语言，通过 <code>词法分析</code> 和 <code>语法分析</code> 得到 <code>语法分析树</code> 后，就可以开始 <code>解释执行</code> 了。</li>
</ul>
<p>这里是一个简单原始的关于解析过程的原理，仅作为参考，详细的解析过程还需要更深一步的研究。</p>
<p>JavaScript 执行过程，如果一个 <code>文档流</code> 中包含多个 <code>script代码段</code>（用script标签分隔的js代码或引入的js文件），它们的运行顺序是：</p>
<ul>
<li>阶段一：解析<ul>
<li>步骤1. 载入第一个代码段（js执行引擎并非一行一行地执行程序，而是一段一段地分析执行的）。</li>
<li>步骤2. 做 <code>词法分析</code> -&gt; <code>[词法作用域]</code> 和 <code>语法分析</code> -&gt; <code>[语法分析树]</code>，如果有错则报语法错误(<code>Syntax Error</code>)（<code>解析时错误</code>，比如括号不匹配等），并跳转到步骤5。</li>
<li>步骤3. 对 <code>var</code> 变量 和 <code>function</code> 定义 做 <code>预解析</code>（永远不会报错的，因为只解析正确的声明）。</li>
</ul>
</li>
<li>阶段二：执行<ul>
<li>步骤4. 执行代码段，有错则报错（<code>运行时错误</code>，比如变量未定义）。</li>
<li>步骤5. 如果还有下一个代码段，则读入下一个代码段，重复步骤2。</li>
<li>步骤6. 结束</li>
</ul>
</li>
</ul>
<h3 id="关键步骤"><a href="#关键步骤" class="headerlink" title="关键步骤"></a>关键步骤</h3><ul>
<li>解析(2,3)：通过 <code>词法分析</code>、<code>语法分析</code> 和 <code>预解析</code> 构造的 <code>语法分析树</code>。</li>
<li>执行( 4 )：执行具体的某个函数，JS引擎在执行每个函数实例时，会创建一个 <code>执行上下文</code>。</li>
</ul>
<h3 id="关键概念"><a href="#关键概念" class="headerlink" title="关键概念"></a>关键概念</h3><ul>
<li>词法分析 -&gt; 词法作用域<ul>
<li>变量的作用域是在定义时决定而不是执行时决定，也就是说词法作用域取决于源码，通过静态分析就能确定，因此词法作用域也叫做静态作用域。</li>
<li><code>with</code> 和 <code>eval</code> 除外，所以只能说JS的作用域机制非常接近 <code>词法作用域</code>（Lexical scope）。</li>
<li><code>词法分析</code>（英语：lexical analysis）是计算机科学中将 <code>字符序列</code> 转换为 <code>标记（token）序列</code> 的过程。</li>
<li><code>词法分析器（扫描器）</code> 的功能输入源程序，按照构词规则分解成一系列单词符号。如：<code>关键字</code>、<code>标识符</code>、<code>常数</code>、<code>运算符</code>、<code>分界符</code> 等。</li>
</ul>
</li>
</ul>
<p>实际上，<code>运行时的作用域链</code> 并不是 <code>词法分析</code> 阶段 得到的，而是运行时得到的，但是在 <code>词法分析阶段</code> 能够确定作用域是一定，要不然写代码的人无法确定作用域，代码无法编写和理解。<br>在相同规则下，人和解释器对代码的理解是一致的。<br>某些情况下，静态分析也无法分析出完整的作用域链，比如递归的情况，这个阶段根本无法预知递归深度，无法得出实际的作用域链。</p>
<ul>
<li>语法分析树（SyntaxTree）<ul>
<li>可以直观地表示出这段代码的相关信息，具体的实现就是JS引擎创建了一些表。</li>
<li>用来记录每个方法的 <em>内部变量集（variables）</em>、<em>内嵌函数集（functions）</em> 和 <em>作用域（scope）</em> 等。</li>
</ul>
</li>
</ul>
<ul>
<li>执行环境/执行上下文（ExecutionContext）<ul>
<li>可理解为记录当前执行的方法 <em>外部描述信息</em> 的对象。</li>
<li>记录所执行函数的 <em>活动对象（activeObject）</em>、<em>作用域链（scope-chain）</em>、<em>this</em>。</li>
</ul>
</li>
</ul>
<ul>
<li>活动对象（activeObject）<ul>
<li>可理解为记录当前执行的方法 <em>内部执行信息</em> 的对象。</li>
<li>记录 <em>内部变量集（variables）</em>、<em>内嵌函数集（functions）</em>、<em>实参（arguments）</em>、<em>作用域链（scopeChain）</em> 等执行所需信息。</li>
<li>直接 <em>内部变量集（variables）</em>、<em>内嵌函数集（functions）</em> 是直接 <em>语法分析树</em> 复制过来的。</li>
<li>执行时，活动对象里的内部变量集全部被设置为 <code>undefined</code>, 创建<em>形参（parameters</em>）和<em>实参（arguments）</em>对象, 执行方法内的赋值语句，这才会对变量集中的变量进行赋值。</li>
<li>作用域链 闭包。</li>
</ul>
</li>
</ul>
<ul>
<li>作用域链<ul>
<li>简单的理解为 <em>变量对象链</em>，解释器可见的。</li>
<li>词法作用域 的实现机制就是 作用域链（scopeChain），作用域链 是一套按名称查找（Name Lookup）的机制。</li>
</ul>
</li>
</ul>
<ul>
<li>闭包<ul>
<li>闭包 是一个拥有许多变量和绑定了这些变量的环境的表达式（通常是一个函数），因而这些变量也是该表达式的一部分。</li>
<li>保护函数内的变量安全，实现 <em>私有属性</em> 和 <em>私有方法</em>（不能被外部访问）。</li>
<li>闭包就是将 <em>函数内部和函数外部</em> 连接起来的一座桥梁，让外部环境有途径访问内部变量。</li>
<li>闭包函数可以访问所保持的作用域链上的外部环境。</li>
</ul>
</li>
</ul>
<h3 id="词法分析"><a href="#词法分析" class="headerlink" title="词法分析"></a>词法分析</h3><p>lexical-analyzer Lexer Tokenizer</p>
<p>词法分析主要分为3步：</p>
<ul>
<li>第1步：分析 <code>形参</code></li>
<li>第2步：分析 <code>变量声明</code></li>
<li>第3步：分析 <code>函数声明</code></li>
</ul>
<p>在词法分析阶段，<code>变量声明</code> 和 <code>函数声明</code> 被提升</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'global'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(str);   <span class="comment">// undefined</span></span><br><span class="line">  <span class="keyword">var</span> str = <span class="string">'local'</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(str);   <span class="comment">// local</span></span><br><span class="line">  <span class="keyword">var</span> str;</span><br><span class="line">  <span class="built_in">console</span>.log(str);   <span class="comment">// local</span></span><br><span class="line">  str = <span class="string">'local'</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo();</span><br></pre></td></tr></table></figure>
<p><code>var str = &#39;local&#39;; &lt;==&gt; var str; str = &#39;local&#39;;</code></p>
<p>函数表达式中，变量声明部分被提升，但是知道执行到这一句时，变量才被赋值为一个函数，所以函数表达式需要在使用之前赋值，而函数声明这不需要。</p>
<h3 id="模拟解析"><a href="#模拟解析" class="headerlink" title="模拟解析"></a>模拟解析</h3><p>模拟代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> escope = <span class="built_in">require</span>(<span class="string">'escope'</span>);</span><br><span class="line"><span class="keyword">var</span> esprima = <span class="built_in">require</span>(<span class="string">'esprima'</span>);</span><br><span class="line"><span class="keyword">var</span> estraverse = <span class="built_in">require</span>(<span class="string">'estraverse'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">var i = 1, j = 2, k = 3;</span></span><br><span class="line"><span class="string">function a(o, p, x, q) &#123;</span></span><br><span class="line"><span class="string">  var x = 4;</span></span><br><span class="line"><span class="string">  console.log(i);</span></span><br><span class="line"><span class="string">  function b(r, s) &#123;</span></span><br><span class="line"><span class="string">    var i = 11, y = 5;</span></span><br><span class="line"><span class="string">    console.log(i);</span></span><br><span class="line"><span class="string">    function c(t) &#123;</span></span><br><span class="line"><span class="string">      var z = 6;</span></span><br><span class="line"><span class="string">      console.log(i);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    //函数表达式</span></span><br><span class="line"><span class="string">    var d = function () &#123;</span></span><br><span class="line"><span class="string">      console.log(y);</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">    c(60);</span></span><br><span class="line"><span class="string">    d();</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  b(40, 50);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">a(10, 20, 30);</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ast = esprima.parse(code);</span><br><span class="line"><span class="keyword">var</span> scopeManager = escope.analyze(ast);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> currentScope = scopeManager.acquire(ast);   <span class="comment">// global scope</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// console.dir(ast, &#123;depth: null&#125;);</span></span><br><span class="line"><span class="built_in">console</span>.dir(scopeManager, &#123;<span class="attr">depth</span>: <span class="literal">null</span>&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/estree.png" alt="ESTree"></p>
<p>上面的模拟代码生成了JS解析过程所产生的用于在执行阶段使用的信息，但是并不代表解释器和这个一样的。</p>
<p>这些分析工具有很多，他们大都用于 <code>代码压缩</code>、<code>代码混淆</code>、<code>代码转换（ES6-&gt;ES5，babel，ts-&gt;js）</code>、<code>代码优化</code>、<code>学习研究</code> 等。</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/posts/JavaScript基础/">
                JavaScript基础
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-04-12</span>
            
            
                <a href="/posts/JavaScript基础/#disqus_thread" class="comments article-comment-link">Comments</a>
            
            
                <span class="category">
                    <a href="/categories/Syntax/">Syntax</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="JavaScript-Base"><a href="#JavaScript-Base" class="headerlink" title="JavaScript Base"></a>JavaScript Base</h1><p>JavaScript 基础知识整理</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="基本类型-Primitive"><a href="#基本类型-Primitive" class="headerlink" title="基本类型 Primitive"></a>基本类型 <a href="https://developer.mozilla.org/en-US/docs/Glossary/Primitive" target="_blank" rel="noopener">Primitive</a></h3><p><code>Undefined、Null、Boolean、Number、String、Symbol(ES2015)</code></p>
<p>原始类型 和 原始值</p>
<p>基本类型的值 是不可变的，我们无法给它们添加属性。</p>
<p>基本类型的值 不是一个对象，也没有方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'~~~~~'</span>;</span><br><span class="line">str.prop = <span class="string">'!!!!!'</span>;</span><br><span class="line">str.prop; <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">10</span>;</span><br><span class="line">num.prop = <span class="number">11</span>;</span><br><span class="line">num.prop; <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bool = <span class="literal">true</span>;</span><br><span class="line">bool.prop = <span class="string">''</span>;</span><br><span class="line">bool.prop <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="string">'---'</span>.charAt === <span class="built_in">String</span>.prototype.charAt</span><br><span class="line">(<span class="number">12345</span>).toString(); <span class="comment">// 使用数字调用方法时需要用用括号括起来</span></span><br></pre></td></tr></table></figure>
<h4 id="Boolean、Number、String、Symbol"><a href="#Boolean、Number、String、Symbol" class="headerlink" title="Boolean、Number、String、Symbol"></a><code>Boolean</code>、<code>Number</code>、<code>String</code>、<code>Symbol</code></h4><ul>
<li>这三种基本类型分别存在 <code>Boolean()</code>、<code>Number()</code>、<code>String()</code> 内建函数</li>
<li>平时使用的时候大都使用的是字面量形式，字面量并不是对象</li>
<li><p>当需要的时候，它们也会被转换成对象，也就是会被转换成 <strong>基本类型的包装类型</strong></p>
<p><code>valueOf()</code> 方法返回 原始值</p>
</li>
</ul>
<h4 id="Undefined、Null"><a href="#Undefined、Null" class="headerlink" title="Undefined、Null"></a><code>Undefined</code>、<code>Null</code></h4><ul>
<li>并不存在 <code>Undefined()</code> 和 <code>Null()</code> 内建函数，只存在 <code>Undefined</code> 和 <code>Null</code> 类型的内建对象 <code>undefined</code> 和 <code>null</code></li>
<li>ECMAScript 认为 <code>undefined</code> 是从 <code>null</code> 派生出来的，所以把它们定义为 <strong>值</strong> 相等的，但是类型不等，相同的地方是都可以视为布尔值的 <code>false</code></li>
<li>这两个类型无 <strong>包装类型</strong></li>
</ul>
<p><code>undefined</code> 与 <code>null</code> 的区别：</p>
<ol>
<li><p><code>null</code> 表示 <strong>没有对象</strong>，即该处不应该有值</p>
<ul>
<li>作为函数的参数，表示该函数的参数不是对象</li>
<li>作为对象原型链的终点</li>
</ul>
</li>
<li><p><code>undefined</code> 表示 <strong>缺少值</strong>，即应该有一个值但是 <strong>未定义/未赋值</strong></p>
<ul>
<li>变量被声明了，但没有赋值时，该变量 <code>undefined</code></li>
<li>调用函数时，参数没有提供，该参数 <code>undefined</code></li>
<li>对象没有赋值的属性，该属性 <code>undefined</code></li>
<li>函数没有返回值时，返回 <code>undefined</code></li>
</ul>
</li>
</ol>
<h3 id="引用类型"><a href="#引用类型" class="headerlink" title="引用类型"></a>引用类型</h3><p><code>Object、Function、String、Number、Error、Regexp、Map、Set</code> …</p>
<p>JavaScript 中一切都可以被当做对象！但是只有引用类型才是真正的对象，基本类型除了 <code>null</code> 和 <code>undefined</code> 之外，都可以像对象一样使用，因为他们有包装类型。</p>
<h4 id="Object-对象"><a href="#Object-对象" class="headerlink" title="Object{} - 对象"></a>Object{} - 对象</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> boolObj = <span class="keyword">new</span> <span class="built_in">Object</span>(&#123;&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(obj <span class="keyword">instanceof</span> <span class="built_in">Object</span>);         <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(boolObj <span class="keyword">instanceof</span> <span class="built_in">Object</span>);     <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(obj === boolObj);               <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> obj);                    <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> boolObj);                <span class="comment">// object</span></span><br></pre></td></tr></table></figure>
<h4 id="Function-函数对象"><a href="#Function-函数对象" class="headerlink" title="Function - 函数对象"></a>Function - 函数对象</h4><p>Function 是一个构造函数，用于创建一个函数对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="keyword">new</span> <span class="built_in">Function</span> ([arg1[, arg2[, ...argN]],] functionBody)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="keyword">new</span> <span class="built_in">Function</span> () &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>function 是一个关键字可以声明一个函数对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数表达式</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每一个函数对象都继承 Function 构造函数的原型对象。</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.foo = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">bar.foo <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<h4 id="Array-复合类型-（引用，指针）"><a href="#Array-复合类型-（引用，指针）" class="headerlink" title="Array[] - 复合类型 （引用，指针）"></a>Array[] - 复合类型 （引用，指针）</h4><p>数组是对象，能够添加属性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">arr.i = <span class="number">4</span>;</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">// [1, 2, 3, i: 4]</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> a <span class="keyword">in</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a, arr[a]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 0 1</span></span><br><span class="line"><span class="comment">// 1 2</span></span><br><span class="line"><span class="comment">// 2 3</span></span><br><span class="line"><span class="comment">// i 4</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line">foo.length = <span class="number">3</span>;</span><br><span class="line">foo; <span class="comment">// [1, 2, 3]</span></span><br><span class="line"></span><br><span class="line">foo.length = <span class="number">6</span>;</span><br><span class="line">foo.push(<span class="number">4</span>);</span><br><span class="line">foo; <span class="comment">// [1, 2, 3, undefined, undefined, undefined, 4]</span></span><br></pre></td></tr></table></figure>
<h4 id="类数组对象"><a href="#类数组对象" class="headerlink" title="类数组对象"></a>类数组对象</h4><p>一个JS数组是特殊的, 因为：</p>
<ol>
<li>它的 <code>length</code> 属性有些特殊行为：<ol>
<li>当新的元素添加到列表中，其值自动更新；</li>
<li>设置这一属性可以扩展或截断数组。</li>
</ol>
</li>
<li>数组是 <code>Array</code> 的实例，可以调用不同的 <code>Array</code> 方法。</li>
</ol>
<p>以上都是JS数组的独特特性，但它们不是一个数组的最基本的特性。</p>
<p>把任何具有一个 <code>length属性</code> 及相应的 <code>非负整数属性</code> 的 <code>对象</code> 作为一种数组, 称之为 <code>&quot;类数组&quot;</code>。</p>
<p>这种 <code>类数组</code> 的对象出现频率不高，而且也不能在它们之上 调用数组方法 或者通过 <code>length</code> 属性期待特殊的行为1)2), 但仍然可以用遍历一个真正数组的代码来遍历它们。</p>
<p>事实上很多数组算法对于类似数组的对象和真正的数组对象都是适用的, 只要不尝试对数组添加元素或者改变 <code>length属性</code>, 就可以把类似数组的对象当作真正的数组来对待。</p>
<p>特别地，函数中的 <code>Arguments</code> 对象就是一个 <code>类数组</code> 的对象; 而 <code>getElementsByTagName()</code> 返回的DOM结点列表也是类似数组的对象。</p>
<p>如下创建一个类似数组，然后遍历该类似数组:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 不小心就引进了一个小bug</span></span><br><span class="line"><span class="keyword">while</span>(i++ &lt; 10) &#123; a[i] = i * i; &#125;</span><br><span class="line">while(i &lt; 10) &#123; a[i] = i * i; i++; &#125;</span><br><span class="line"></span><br><span class="line">a.length = i;</span><br><span class="line"></span><br><span class="line">var total = 0;</span><br><span class="line">for(var j = 0, len = a.length; j &lt; len; j++) &#123;</span><br><span class="line">  total += a[j];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="类型识别"><a href="#类型识别" class="headerlink" title="类型识别"></a>类型识别</h3><h4 id="识别方法"><a href="#识别方法" class="headerlink" title="识别方法"></a>识别方法</h4><ul>
<li><p><code>typeof</code> (typeof x)</p>
<ul>
<li>返回值：首字母小写的字符串形式</li>
<li>可以识别 <code>基本类型</code>，<code>null</code> 除外</li>
<li>不能识别 <code>内置对象类型</code> (<code>Function</code> 除外)</li>
<li>不能识别 <code>自定义类型</code></li>
<li>可以识别 <code>undefined</code></li>
<li>不能识别 <code>null</code>，因为 <code>null</code> 被识别为 <code>object</code></li>
</ul>
</li>
</ul>
<ul>
<li><p><code>instanceof</code> (x instanceof X)</p>
<ul>
<li>返回值：<code>true</code> 或 <code>false</code></li>
<li>不能识别 <code>基本类型</code>，会返回 <code>false</code>。 <code>(true instanceof Boolean) -&gt; false</code></li>
<li>可以识别 <code>内置对象类型</code></li>
<li>可以识别 <code>自定义类型</code> 及其 <code>父类型</code></li>
<li>不能识别 <code>undefined</code>、<code>null</code>，因为无 <code>Undefined</code>、<code>Null</code> 包装类型</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>Object.prototype.toString</code></p>
<p>eq.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">type</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj).slice(<span class="number">8</span>, <span class="number">-1</span>).toLowerCase();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>返回值：<code>[object TypeX]</code> 的字符串形式</li>
<li>可以识别 <code>基本类型</code></li>
<li>可以识别 <code>内置对象类型</code></li>
<li>可以识别 <code>自定义类型</code>，但是需要重载 <code>toString</code> 方法</li>
<li>可以识别 <code>undefined</code>、<code>null</code></li>
</ul>
</li>
</ul>
<ul>
<li><p><code>.prototype.constructor</code></p>
<p>eq.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.prototype.constructor.name</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">type</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> obj.constructor.toString().replace(<span class="regexp">/^function (\w+)\(\).+$/</span>, <span class="string">'$1'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>返回值：<code>function TypeX(){[native code]}</code> 或者 <code>function TypeX(){}</code></li>
<li>可以识别 <code>基本类型</code></li>
<li>可以识别 <code>内置对象类型</code></li>
<li>可以识别 <code>自定义类型</code></li>
<li>不能识别 <code>undefined</code>、<code>null</code>，会报错，因为 不存在方法</li>
</ul>
</li>
</ul>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><ul>
<li>Number</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> numObj = <span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> num);                    <span class="comment">// number</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> numObj);                 <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(num <span class="keyword">instanceof</span> <span class="built_in">Object</span>);         <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(num <span class="keyword">instanceof</span> <span class="built_in">Number</span>);         <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(numObj <span class="keyword">instanceof</span> <span class="built_in">Object</span>);      <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(numObj <span class="keyword">instanceof</span> <span class="built_in">Number</span>);      <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(num === numObj);                <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<ul>
<li>String</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">var</span> strObj = <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">''</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> str);                    <span class="comment">// string</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> strObj);                 <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(str <span class="keyword">instanceof</span> <span class="built_in">Object</span>);         <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(str <span class="keyword">instanceof</span> <span class="built_in">String</span>);         <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(strObj <span class="keyword">instanceof</span> <span class="built_in">Object</span>);      <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(strObj <span class="keyword">instanceof</span> <span class="built_in">String</span>);      <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(str === strObj);                <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Boolean</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bool = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">var</span> boolObj = <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> bool);                   <span class="comment">// boolean</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> boolObj);                <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(bool <span class="keyword">instanceof</span> <span class="built_in">Object</span>);        <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(bool <span class="keyword">instanceof</span> <span class="built_in">Boolean</span>);       <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(boolObj <span class="keyword">instanceof</span> <span class="built_in">Object</span>);     <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(boolObj <span class="keyword">instanceof</span> <span class="built_in">Boolean</span>);    <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(bool === boolObj);              <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Undefined Null</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="literal">undefined</span>);              <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">undefined</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>);   <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="literal">null</span>);                   <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">null</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>);        <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">undefined</span> === <span class="literal">null</span>);            <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">undefined</span> == <span class="literal">null</span>);             <span class="comment">// true</span></span><br><span class="line"><span class="keyword">var</span> <span class="literal">undefined</span> = <span class="string">'foo'</span>;                      <span class="comment">// 可以重新赋值</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">undefined</span>, <span class="keyword">typeof</span> <span class="literal">undefined</span>);   <span class="comment">// foo 'string'</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">void</span>(<span class="number">0</span>) === <span class="literal">undefined</span>);         <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Function</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> objPrototype = <span class="built_in">Object</span>.prototype;</span><br><span class="line"><span class="built_in">console</span>.log(objPrototype);                          <span class="comment">// &#123;&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(objPrototype.__proto__);                <span class="comment">// null</span></span><br><span class="line"><span class="built_in">console</span>.log(objPrototype.toString());               <span class="comment">// [object Object]</span></span><br><span class="line"><span class="built_in">console</span>.log(objPrototype.valueOf());                <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> objPrototype);                   <span class="comment">// object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype <span class="keyword">instanceof</span> <span class="built_in">Object</span>);    <span class="comment">// false !</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="built_in">Object</span>);                         <span class="comment">// function</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>);                                <span class="comment">// [Function: Object]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>);              <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span> <span class="keyword">instanceof</span> <span class="built_in">Function</span>);            <span class="comment">// true !</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="built_in">Function</span>);                       <span class="comment">// function</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span>);                              <span class="comment">// [Function: Function]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>);            <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span> <span class="keyword">instanceof</span> <span class="built_in">Function</span>);          <span class="comment">// true ！</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.__proto__ === <span class="built_in">Function</span>.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span>.__proto__ === <span class="built_in">Function</span>.prototype);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span>.prototype.__proto__ === <span class="built_in">Object</span>.prototype);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.__proto__.__proto__ === <span class="built_in">Object</span>.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span>.__proto__.__proto__ === <span class="built_in">Object</span>.prototype);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.__proto__);</span><br></pre></td></tr></table></figure>
<h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><h4 id="显式转换"><a href="#显式转换" class="headerlink" title="显式转换"></a>显式转换</h4><p>JavaScript 提供了以下转型函数：</p>
<ul>
<li>转为数值类型：<code>Number(mix)、parseInt(string,radix)、parseFloat(string)</code></li>
<li>转为字符串类型：<code>toString(radix)、String(mix)</code></li>
<li>转为布尔类型：<code>Boolean(mix)</code></li>
</ul>
<ul>
<li><code>Number(mix)</code> 函数，可以将任意类型的参数mix转换为数值类型。其规则为：</li>
</ul>
<table>
<thead>
<tr>
<th>Type</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Boolean</td>
<td>Number(true)-&gt;1 Number(false)-&gt;0</td>
</tr>
<tr>
<td>Number</td>
<td>Number(num)-&gt;num</td>
</tr>
<tr>
<td>Null</td>
<td>Number(null)-&gt;0</td>
</tr>
<tr>
<td>Undefined</td>
<td>Number(undefined)-&gt;NaN</td>
</tr>
<tr>
<td>String</td>
<td>Number(‘012345’)-&gt;12345 Number(‘012345.6789’)-&gt;12345.6789 Number(‘’)-&gt;0 Number(‘A-Z’)-&gt;NaN</td>
</tr>
<tr>
<td>Object</td>
<td>调用对象的valueOf()方法，依据前面的规则转换返回的值。如果转换的结果是NaN，则调用对象的toString()方法，再依据前面的规则转换返回的值。</td>
</tr>
</tbody>
</table>
<p>下表列出了对象的 <code>valueOf()</code> 的返回值：</p>
<table>
<thead>
<tr>
<th>Type</th>
<th><code>valueOf()</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Array</code></td>
<td>数组的元素被转换为字符串，这些字符串由逗号分隔，连接在一起，其操作与 Array.toString 和 Array.join 方法相同。</td>
</tr>
<tr>
<td><code>Boolean</code></td>
<td>Boolean 值是</td>
</tr>
<tr>
<td><code>Date</code></td>
<td>存储的时间是从 1970 年 1 月 1 日午夜开始计的毫秒数 UTC</td>
</tr>
<tr>
<td><code>Function</code></td>
<td>函数本身</td>
</tr>
<tr>
<td><code>Object</code></td>
<td>对象本身</td>
</tr>
<tr>
<td><code>String</code></td>
<td>字符串值</td>
</tr>
<tr>
<td><code>Number</code></td>
<td>数字值</td>
</tr>
</tbody>
</table>
<p>Example：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Array</span>().valueOf());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Array</span>().toString());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Array</span>());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]).valueOf());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]).toString());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]));</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>).valueOf());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>).toString());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>));</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Date</span>().valueOf());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Date</span>().toString());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Date</span>());</span><br><span class="line"><span class="built_in">Number</span>(<span class="keyword">new</span> <span class="built_in">Function</span>());</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>parseInt(string, radix)</code> 将字符串转换为整数类型。</p>
<p>它也有一定的规则：</p>
<ul>
<li>忽略字符串前面的空格，直至找到第一个非空字符。</li>
<li>如果第一个字符不是数字符号或者负号，返回 <code>NaN</code>。</li>
<li>如果第一个字符是数字，则继续解析直至字符串解析完毕或者遇到一个非数字符号为止。</li>
<li>如果上步解析的结果以 <code>0</code> 开头，则将其当作八进制来解析；如果以 <code>0x</code> 开头，则将其当作十六进制来解析。</li>
<li>如果指定 <code>radix</code> 参数，则以 <code>radix</code> 为基数进行解析。</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>parseFloat(string)</code> 将字符串转换为浮点数类型。</p>
<p>它的规则与 <code>parseInt</code> 基本相同，但也有点区别：字符串中第一个小数点符号是有效的，另外 <code>parseFloat</code> 会忽略所有前导 <code>0</code>，如果字符串包含一个可解析为整数的数，则返回整数值而不是浮点数值。</p>
</li>
</ul>
<ul>
<li><p><code>toString(radix)</code> 方法。</p>
<p>除 <code>undefined</code> 和 <code>null</code> 之外的所有类型的值都具有 <code>toString()</code> 方法，转换成字符串表示。</p>
</li>
</ul>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].toString())       <span class="comment">// 1, 2, 3</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="literal">true</span>.toString())            <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>().toString(<span class="number">10</span>))    <span class="comment">// Wed Aug 17 2016 13:52:21 GMT+0800 (中国标准时间)</span></span><br><span class="line"><span class="built_in">console</span>.log(&#123;&#125;.toString())              <span class="comment">// [object Object]</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>String(mix)</code> 将任何类型的值转换为字符串：</p>
<ul>
<li><code>null</code> -&gt; “null”</li>
<li><code>undefined</code> -&gt; “undefined”</li>
<li>调用 <code>toString()</code> 方法，返回结果，如果没有 <code>toString()</code>，则报异常，无法转换。</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>Boolean(mix)</code> 函数，将任何类型的值转换为布尔值。</p>
<ul>
<li><code>false</code>：<code>false、&#39;&#39;、0、NaN、null、undefined</code></li>
<li><code>true</code> : 除了以上转换问 <code>false</code> 的</li>
</ul>
</li>
</ul>
<h4 id="隐式转换"><a href="#隐式转换" class="headerlink" title="隐式转换"></a>隐式转换</h4><p>在某些情况下，即使我们不提供显示转换，JavaScript 也会进行自动类型转换，主要情况有：</p>
<ul>
<li><p>用于检测是否为非数值的函数：<code>isNaN(mix)</code></p>
<p><code>isNaN()</code> 函数，经测试发现，该函数会尝试将参数值用 <code>Number()</code> 进行转换，如果结果为 <code>“非数值”</code> 则返回 <code>true</code>，否则返回 <code>false</code>。</p>
</li>
</ul>
<ul>
<li><p>递增递减操作符（包括前置和后置）、一元正负符号操作符，其规则与 <code>Number()</code> 规则基本相同</p>
<ul>
<li>如果是包含有效数字字符的字符串，先将其转换为数字值（转换规则同 <code>Number()</code>），在执行加减1的操作，字符串变量变为数值变量。</li>
<li>如果是不包含有效数字字符的字符串，将变量的值设置为 <code>NaN</code>，字符串变量变成数值变量。</li>
<li>如果是布尔值 <code>false</code>，先将其转换为 <code>0</code> 再执行加减 <code>1</code> 的操作，布尔值变量编程数值变量。</li>
<li>如果是布尔值 <code>true</code>，先将其转换为 <code>1</code> 再执行加减 <code>1</code> 的操作，布尔值变量变成数值变量。</li>
<li>如果是浮点数值，执行加减 <code>1</code> 的操作。</li>
<li>如果是对象，先调用对象的 <code>valueOf()</code> 方法，然后对该返回值应用前面的规则。如果结果是 <code>NaN</code>，则调用 <code>toString()</code> 方法后再应用前面的规则。对象变量变成数值变量。</li>
</ul>
</li>
</ul>
<ul>
<li><p>加减乘除运算符、取模运算符</p>
<ul>
<li>如果一个操作数为 <code>NaN</code>，则结果为 <code>NaN</code></li>
<li><code>Infinity+Infinity -&gt; Infinity</code></li>
<li><code>-Infinity+(-Infinity) -&gt; -Infinity</code></li>
<li><code>Infinity+(-Infinity) -&gt; NaN</code></li>
<li><code>+0+(+0) -&gt; +0</code></li>
<li><code>(-0)+(-0) -&gt; -0</code></li>
<li><code>(+0)+(-0) -&gt; +0</code></li>
</ul>
<p>加号运算操作符在 JavaScript 也用于字符串连接符，所以加号操作符处理字符串是有所不同：</p>
<ul>
<li>如果两个操作值都是字符串，则将它们拼接起来</li>
<li>如果只有一个操作值为字符串，则将另外操作值转换为字符串，然后拼接起来</li>
<li>如果一个操作数是对象、数值或者布尔值，则调用 <code>toString()</code> 方法取得字符串值，然后再应用前面的字符串规则。对于 <code>undefined</code> 和 <code>null</code>，分别调用 <code>String()</code> 显式转换为字符串。</li>
<li>可以看出，加法运算中，如果有一个操作值为字符串类型，则将另一个操作值转换为字符串，最后连接起来。</li>
</ul>
</li>
</ul>
<ul>
<li><p>逻辑操作符（!、&amp;&amp;、||）</p>
<ul>
<li>逻辑非 <code>!</code> 操作符首先通过 <code>Boolean()</code> 函数将它的操作值转换为布尔值，然后求反。</li>
<li>逻辑与 <code>&amp;&amp;</code> 操作符，如果一个操作值不是布尔值时，遵循以下规则进行转换：<ul>
<li>如果第一个操作数经 <code>Boolean()</code> 转换后为 <code>true</code>，则返回第二个操作值，否则返回第一个值（不是Boolean()转换后的值）</li>
<li>如果有一个操作值为 <code>null</code>，返回 <code>null</code></li>
<li>如果有一个操作值为 <code>NaN</code>，返回 <code>NaN</code></li>
<li>如果有一个操作值为 <code>undefined</code>，返回 <code>undefined</code></li>
</ul>
</li>
<li>逻辑或（||）操作符，如果一个操作值不是布尔值，遵循以下规则：<ul>
<li>如果第一个操作值经 <code>Boolean()</code> 转换后为 <code>false</code>，则返回第二个操作值，否则返回第一个操作值（不是 <code>Boolean()</code> 转换后的值）</li>
<li>对于 <code>undefined</code>、<code>null</code> 和 <code>NaN</code> 的处理规则与逻辑与（&amp;&amp;）相同</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>关系操作符（&lt;, &gt;, &lt;=, &gt;=）</p>
<ul>
<li>如果两个操作值都是数值，则进行数值比较</li>
<li>如果两个操作值都是字符串，则比较字符串对应的字符编码值</li>
<li>如果只有一个操作值是数值，则将另一个操作值转换为数值，进行数值比较</li>
<li>如果一个操作数是对象，则调用 <code>valueOf()</code> 方法（如果对象没有 <code>valueOf()</code> 方法则调用 <code>toString()</code> 方法），得到的结果按照前面的规则执行比较</li>
<li>如果一个操作值是布尔值，则将其转换为数值，再进行比较</li>
<li>注：<code>NaN</code> 是非常特殊的值，它不和任何类型的值相等，包括它自己，同时它与任何类型的值比较大小时都返回 <code>false</code>。</li>
</ul>
</li>
</ul>
<ul>
<li><p>相等操作符（==）</p>
<ul>
<li>如果一个操作值为布尔值，则在比较之前先将其转换为数值</li>
<li>如果一个操作值为字符串，另一个操作值为数值，则通过 <code>Number()</code> 函数将字符串转换为数值</li>
<li>如果一个操作值是对象，另一个不是，则调用对象的 <code>valueOf()</code> 方法，得到的结果按照前面的规则进行比较</li>
<li><code>null</code> 与 <code>undefined</code> 是相等的</li>
<li>如果一个操作值为 <code>NaN</code>，则相等比较返回 <code>false</code></li>
<li>如果两个操作值都是对象，则比较它们是不是指向同一个对象</li>
</ul>
</li>
</ul>
<h2 id="void"><a href="#void" class="headerlink" title="void"></a>void</h2><ul>
<li><p><code>void UnaryExpression</code> 按如下流程解释:</p>
<ul>
<li>令 <code>expr</code> 为解释执行 <code>UnaryExpression</code> 的结果</li>
<li>调用 <code>GetValue(expr)</code></li>
<li>返回 <code>undefined</code></li>
</ul>
</li>
<li><p>注意：<code>GetValue</code> 一定会被调用，即使它的值不会被用到，但是这个表达式可能会有副作用(side-effects)。</p>
</li>
<li><p>为什么要用 <code>void</code>？<code>undefined</code> 不是保留字，可以重新赋值。采用 <code>void</code> 方式获取 <code>undefined</code> 便成了通用准则。</p>
</li>
</ul>
<p><a href="https://segmentfault.com/a/1190000000474941" target="_blank" rel="noopener">谈谈JavaScript中的void操作符</a></p>
<h2 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h2><p>运算符优先级</p>
<h2 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h2><p>ECMAScript 做为一个高度抽象的面向对象语言，是通过对象来交互的。<br>一个对象就是属性集合，并拥有一个独立的 <code>原型对象</code>，这个 <code>原型对象</code> 可以是一个 <code>对象</code> 或者 <code>null</code>。<br>一个对象的 <code>原型对象</code> 是以对象内部的 <code>[[Prototype]]</code> 属性来引用的。</p>
<p>在示意图里边我们将会使用 <code>__&lt;internal-property&gt;__</code> 下划线标记来替代两个括号，对于 <code>prototype</code> 对象来说是：<code>__proto__</code>。</p>
<p>让我们看一个关于对象的基本例子。</p>
<p>对于以下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">  x: <span class="number">10</span>,</span><br><span class="line">  y: <span class="number">20</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>我们拥有一个这样的结构，两个显式的属性和一个隐藏的 <code>__proto__</code> 属性，这个属性是对 <code>Object.prototype</code> 的引用。</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/basic-object.png" alt="basic-object"></p>
<p>这些 <code>prototype</code> 有什么用？</p>
<p>让我们以 <code>原型链</code> 的概念来回答这个问题。</p>
<h2 id="原型链（prototype-chain）"><a href="#原型链（prototype-chain）" class="headerlink" title="原型链（prototype-chain）"></a>原型链（prototype-chain）</h2><ul>
<li><code>原型对象</code> 也是简单的对象，所以他可以拥有自己的原型，如果一个原型对象的 <code>原型</code> 是一个非 <code>null</code> 的引用，延续下去，原型对象连成的链，就形成了 <code>原型链</code>。</li>
<li><code>原型链</code> 是一个用来实现 <code>继承</code> 和 <code>共享</code> 属性的有限长度的 <code>对象链</code>。</li>
<li><code>原型链</code> 是为了实现代码重用而设计的，在基于类的系统中，这个代码重用风格叫作 <code>继承</code>。</li>
</ul>
<p>ECMAScript 中没有类的概念，但是代码重用的风格并没有太多不同，ECMAScript 通过原型链来实现，即 <strong>原型继承(prototype based inheritance)</strong>，这种继承方式叫作 <strong>委托继承(delegation based inheritance)</strong>。</p>
<p>ES5标准化了一个实现原型继承的新的可选方法，使用 <code>Object.create</code> 函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;<span class="attr">k</span>: <span class="string">'v'</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> b = <span class="built_in">Object</span>.create(a, &#123;<span class="attr">y</span>: &#123;<span class="attr">value</span>: <span class="number">20</span>&#125;&#125;);</span><br><span class="line"><span class="keyword">var</span> c = <span class="built_in">Object</span>.create(a, &#123;<span class="attr">y</span>: &#123;<span class="attr">value</span>: <span class="number">30</span>&#125;&#125;);</span><br></pre></td></tr></table></figure>
<p>ES6标准化了 <code>__proto__</code> 属性，并且可以在对象初始化的时候使用它，如下面的用法。<br><code>b</code> 和 <code>c</code> 可以访问到 <code>a</code> 对象中定义的 <code>calculate()</code> 方法，是通过原型链 <code>lookup</code> 实现的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  x: <span class="number">10</span>,</span><br><span class="line">  calculate: <span class="function"><span class="keyword">function</span> (<span class="params">z</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.x + <span class="keyword">this</span>.y + z</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> b = &#123;<span class="attr">y</span>: <span class="number">20</span>, <span class="attr">__proto__</span>: a&#125;;</span><br><span class="line"><span class="comment">// 等价于 var b = Object.create(a, &#123;y: &#123;value: 20&#125;&#125;);</span></span><br><span class="line"><span class="keyword">var</span> c = &#123;<span class="attr">y</span>: <span class="number">30</span>, <span class="attr">__proto__</span>: a&#125;;</span><br><span class="line"><span class="comment">// 等价于 var c = Object.create(a, &#123;y: &#123;value: 30&#125;&#125;);</span></span><br><span class="line">b.calculate(<span class="number">30</span>); <span class="comment">// 60</span></span><br><span class="line">c.calculate(<span class="number">40</span>); <span class="comment">// 80</span></span><br></pre></td></tr></table></figure>
<h3 id="原型链-lookup-规则："><a href="#原型链-lookup-规则：" class="headerlink" title="原型链 lookup 规则："></a>原型链 <code>lookup</code> 规则：</h3><p>如果一个 <code>属性</code>/<code>方法</code> 在对象自身中无法找到，JS引擎会尝试遍历整个原型链，寻找这个 <code>属性</code>/<code>方法</code>，第一个被查找到的同名 <code>属性</code>/<code>方法</code> 会被使用。如果在遍历了整个原型链之后还是没有查找到这个属性的话，返回 <code>undefined</code> 值。</p>
<p>下一张图展示了对象 <code>a</code>，<code>b</code>，<code>c</code> 之间的继承关系：</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/prototype-chain.png" alt="prototype-chain"></p>
<p>所以 <code>__proto__</code> 主要是给JS引擎用的，但是暴露给了我们，并且可以对其修改。</p>
<p>与此类似的还有 <code>作用域链</code> 及其 <code>lookup规则</code>，<code>原型链</code> 和 <code>作用域链</code> 的用途都是用来名字查找，给JS引擎用的。</p>
<p>区别是：原型链是属性上的名字查找，对象自身上查找，这条链可以运行时被修改，作用域链是上下文中的名字查找，这条链由代码决定。</p>
<h3 id="proto"><a href="#proto" class="headerlink" title="__proto__"></a><code>__proto__</code></h3><ul>
<li>如果没有明确为一个对象指定原型，那么它将会使用 <code>__proto__</code> 的默认值 <code>Object.prototype</code>。</li>
<li><code>Object.prototype</code> 对象自身也有一个 <code>__proto__</code> 属性，值为 <code>null</code>，这是原型链的终点。 即：<code>Object.prototype.__proto__ === null</code></li>
<li>The <code>__proto__</code> property of <code>Object.prototype</code> is an <code>accessor property</code> (a getter function and a setter function) that exposes the internal <code>[[Prototype]]</code> (either an object or null) of the object through which it is accessed.</li>
</ul>
<p>项目中建议不要直接使用 <code>__proto__</code> 读写原型，而是使用 <code>Object.getPrototypeOf()、Object.create()</code> 读写原型。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Shape = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;;</span><br><span class="line"><span class="keyword">var</span> proto = &#123;</span><br><span class="line">  say: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">'hello world!'</span>); &#125;</span><br><span class="line">&#125;;</span><br><span class="line">Shape.prototype = proto;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.prototype.getPrototype = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.getPrototypeOf(<span class="keyword">this</span>) </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> circle = <span class="keyword">new</span> Shape();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'circle:'</span>, circle.__proto__ === Shape.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'circle:'</span>, <span class="built_in">Object</span>.getPrototypeOf(circle) === Shape.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'circle:'</span>, <span class="keyword">typeof</span> circle);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'circle:'</span>, circle <span class="keyword">instanceof</span> Shape);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'circle:'</span>, circle <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rectangle = <span class="built_in">Object</span>.create(proto);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'ractangle:'</span>, rectangle.__proto__ === Shape.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'ractangle:'</span>, <span class="built_in">Object</span>.getPrototypeOf(rectangle) === Shape.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'ractangle:'</span>, <span class="keyword">typeof</span> rectangle);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'ractangle:'</span>, rectangle <span class="keyword">instanceof</span> Shape);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'ractangle:'</span>, rectangle <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> objPrototype = <span class="built_in">Object</span>.prototype;</span><br><span class="line"><span class="built_in">console</span>.log(objPrototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> objPrototype);</span><br><span class="line"><span class="built_in">console</span>.log(objPrototype.__proto__);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'__proto__:'</span>, <span class="string">'xxx'</span>.__proto__);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">String</span>.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">console</span>.log([] <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">console</span>.log(&#123;&#125; <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br></pre></td></tr></table></figure>
<p><code>typeof</code> 和 <code>instanceof</code> 都是检测变量的类型，区别在于:</p>
<ul>
<li><code>typeof</code>: 可以用来区分原始值和对象。<code>typeof</code> 还可以让检查一个变量是否已声明，而不会抛出异常，没有任何一个函数可以实现此功能。</li>
<li><code>instanceof</code>: 可以用来区分对象，<code>instanceof</code> 对于所有的原始值都返回 false。</li>
</ul>
<p>typeof 在操作 <code>null</code> 时会返回 <code>&quot;object&quot;</code>，这是 JavaScript 语言本身的 bug。<br>不幸的是，这个 bug 永远不可能被修复了，因为太多已有的代码已经依赖了这样的表现。<br>这并不意味着，<code>null</code> 实际上是一个对象。</p>
<h3 id="属性类型"><a href="#属性类型" class="headerlink" title="属性类型"></a>属性类型</h3><h4 id="数据属性"><a href="#数据属性" class="headerlink" title="数据属性"></a>数据属性</h4><table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>[[Configurable]]</code></td>
<td>表示能否通过 <code>delete</code> 删除属性从而重新定义属性，能否改变属性的特性，或者能否改变把属性改为访问器属性。<code>true</code></td>
<td></td>
</tr>
<tr>
<td><code>[[Enumerable]]</code></td>
<td>表示能否通过 <code>for-in</code> 循环返回属性。<code>true</code></td>
<td></td>
</tr>
<tr>
<td><code>[[Writable]]</code></td>
<td>表示能否修改属性值。<code>ture</code></td>
<td></td>
</tr>
<tr>
<td><code>[[Value]]</code></td>
<td>包含实际值。<code>undefined</code></td>
<td></td>
</tr>
</tbody>
</table>
<p>严格模式下不合法的操作会抛出异常，非严格模式会忽略相关操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, <span class="string">'name'</span>, &#123;</span><br><span class="line">  configurable: <span class="literal">false</span>,</span><br><span class="line">  enumerable: <span class="literal">true</span>,</span><br><span class="line">  writable: <span class="literal">false</span>,</span><br><span class="line">  value: <span class="string">'liuyanjie'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, <span class="string">'sax'</span>, &#123;</span><br><span class="line">  configurable: <span class="literal">false</span>,</span><br><span class="line">  enumerable: <span class="literal">false</span>,</span><br><span class="line">  writable: <span class="literal">false</span>,</span><br><span class="line">  value: <span class="string">'M'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(person);            <span class="comment">// &#123; name: 'liuyanjie' &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(person.sax);        <span class="comment">// M</span></span><br></pre></td></tr></table></figure>
<h4 id="访问器属性-getter-setter"><a href="#访问器属性-getter-setter" class="headerlink" title="访问器属性: getter setter"></a>访问器属性: <code>getter</code> <code>setter</code></h4><table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>[[Configurable]]</code></td>
<td>表示能否通过 <code>delete</code> 删除属性从而重新定义属性，能否改变属性的特性，或者能否改变把属性改为访问器属性。<code>true</code></td>
</tr>
<tr>
<td><code>[[Enumerable]]</code></td>
<td>表示能否通过 <code>for-in</code> 循环返回属性。<code>true</code></td>
</tr>
<tr>
<td><code>[[Getter]]</code></td>
<td>取值函数。<code>undefined</code></td>
</tr>
<tr>
<td><code>[[Setter]]</code></td>
<td>赋值函数。<code>undefined</code></td>
</tr>
</tbody>
</table>
<ul>
<li><code>getter</code> 和 <code>setter</code> 不一定要成对出现</li>
<li>只有 <code>getter</code> 函数证明该属性只读，尝试写入在非严格模式下会被忽略，严格模式会抛出错误</li>
<li>只有 <code>setter</code> 函数证明该属性只写，尝试读取在非严格模式下返回 <code>undefined</code>，严格模式则抛出错误</li>
<li>对象的 <code>数据属性</code>、<code>访问器属性</code> 都包含 <code>[[configurable]]</code> 和 <code>[[enumerable]]</code>，但不能同时有 <code>[[writeable]]</code>/<code>[[value]]</code> 和 <code>[[get]]</code>/<code>[[set]]</code>，数据属性也可以函数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> book1 = &#123; <span class="attr">_year</span>: <span class="number">2014</span>, <span class="attr">edition</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(book1, <span class="string">'year'</span>, &#123;</span><br><span class="line">  configurable: <span class="literal">false</span>,</span><br><span class="line">  enumerable: <span class="literal">true</span>,</span><br><span class="line">  get: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._year;</span><br><span class="line">  &#125;,</span><br><span class="line">  set: <span class="function"><span class="keyword">function</span> (<span class="params">year</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (year &gt; <span class="number">2014</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>._year = year;</span><br><span class="line">      <span class="keyword">this</span>.edition += year - <span class="number">2014</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(book1);      <span class="comment">// &#123; _year: 2014, edition: 1, year: [Getter/Setter] &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(book1.year);  <span class="comment">// 2014</span></span><br><span class="line">book.year = <span class="number">2016</span>;</span><br><span class="line"><span class="built_in">console</span>.log(book1);      <span class="comment">// &#123; _year: 2016, edition: 3, year: [Getter/Setter] &#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给 对象 设置 多个 `数据属性` 和 `访问器属性`</span></span><br><span class="line"><span class="keyword">var</span> book2 = &#123; <span class="attr">_year</span>: <span class="number">2014</span>, <span class="attr">edition</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperties(book2, &#123;</span><br><span class="line">  _year: &#123;</span><br><span class="line">    value: <span class="number">2014</span></span><br><span class="line">  &#125;,</span><br><span class="line">  edition: &#123;</span><br><span class="line">    value: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  year: &#123;</span><br><span class="line">    configurable: <span class="literal">false</span>,</span><br><span class="line">    enumerable: <span class="literal">false</span>,</span><br><span class="line">    get: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;,</span><br><span class="line">    set: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getContents: &#123;</span><br><span class="line">    value: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'contents'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 属性 信息</span></span><br><span class="line"><span class="keyword">var</span> desc1 = <span class="built_in">Object</span>.getOwnPropertyDescriptor(book2, <span class="string">'year'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(desc1);</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   get: [Function],</span></span><br><span class="line"><span class="comment">//   set: [Function],</span></span><br><span class="line"><span class="comment">//   enumerable: false,</span></span><br><span class="line"><span class="comment">//   configurable: false</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="keyword">var</span> desc2 = <span class="built_in">Object</span>.getOwnPropertyDescriptor(book2, <span class="string">'getContents'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(desc2);</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   value: [Function],</span></span><br><span class="line"><span class="comment">//   writable: false,</span></span><br><span class="line"><span class="comment">//   enumerable: false,</span></span><br><span class="line"><span class="comment">//   configurable: false</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="应用："><a href="#应用：" class="headerlink" title="应用："></a>应用：</h4><ul>
<li>[观察者模式]例子<a href="http://hcysun.me/2016/04/28/JavaScript%E5%AE%9E%E7%8E%B0MVVM%E4%B9%8B%E6%88%91%E5%B0%B1%E6%98%AF%E6%83%B3%E7%9B%91%E6%B5%8B%E4%B8%80%E4%B8%AA%E6%99%AE%E9%80%9A%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%8F%98%E5%8C%96/" target="_blank" rel="noopener">JavaScript实现MVVM监测一个普通对象的变化</a></li>
</ul>
<h3 id="ECMAScript5-对象保护功能"><a href="#ECMAScript5-对象保护功能" class="headerlink" title="ECMAScript5 对象保护功能"></a>ECMAScript5 对象保护功能</h3><p>在 JavaScript 里，默认情况下，你可修改任何你可以访问到的对象，你可以自由的删除对象的属性或覆盖对象的方法。<br>这在多人协作开发的项目中，会造成很大问题，因为你不知道你的修改会对别人造成什么样的影响。<br>如果你是一个模块或代码库的作者，你可能想锁定一些核心库的某些部分，保证任何人不能有意或无意的修改它们。<br>严格模式下抛出异常，普通模式下安静的失败；</p>
<ul>
<li>禁止添加属性：禁止扩展。即：禁止为对象添加属性和方法，但已存在的属性和方法是可以被修改和删除的。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person1 = &#123; <span class="attr">name</span>: <span class="string">'liuht'</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.preventExtensions(person1);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isFrozen:'</span>, <span class="built_in">Object</span>.isFrozen(person1));             <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isSealed:'</span>, <span class="built_in">Object</span>.isSealed(person1));             <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isExtensible:'</span>, <span class="built_in">Object</span>.isExtensible(person1));     <span class="comment">// -&gt; false</span></span><br><span class="line">person1.sex = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(person1);</span><br><span class="line"><span class="built_in">console</span>.log(person1.sex);</span><br></pre></td></tr></table></figure>
<ul>
<li>禁止删除属性：密封。即：禁止删除对象已存在的属性和方法。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person2 = &#123; <span class="attr">name</span>: <span class="string">'liuht'</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.seal(person2);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isFrozen:'</span>, <span class="built_in">Object</span>.isFrozen(person2));             <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isSealed:'</span>, <span class="built_in">Object</span>.isSealed(person2));             <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isExtensible:'</span>, <span class="built_in">Object</span>.isExtensible(person2));     <span class="comment">// -&gt; false</span></span><br><span class="line"><span class="keyword">delete</span> person2.name;</span><br><span class="line">person2.age = <span class="number">10</span>;</span><br><span class="line"><span class="built_in">console</span>.log(person2);</span><br></pre></td></tr></table></figure>
<ul>
<li>禁止添加或删除属性：冻结。即：禁止修改对象已存在的属性和方法，所有字段都是只读的。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> persion3 = &#123; <span class="attr">name</span>: <span class="string">'liuht'</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.freeze(persion3);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isFrozen:'</span>, <span class="built_in">Object</span>.isFrozen(persion3));            <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isSealed:'</span>, <span class="built_in">Object</span>.isSealed(persion3));            <span class="comment">// -&gt; true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'isExtensible:'</span>, <span class="built_in">Object</span>.isExtensible(persion3));    <span class="comment">// -&gt; false</span></span><br><span class="line"><span class="keyword">delete</span> persion3.name;</span><br><span class="line">persion3.age = <span class="number">10</span>;</span><br><span class="line">persion3.name = <span class="string">'new name'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(persion3);</span><br></pre></td></tr></table></figure>
<p><strong>访问器属性</strong> 和 <strong>对象保护功能</strong> 都是针对 <strong>对象属性</strong> ，而不是 <strong>变量</strong></p>
<p>通常情况下对象拥有相同或者相似的状态结构（也就是相同的属性集合），赋以不同的状态值，在这个情况下我们可能需要使用 <code>构造函数</code>，其以指定的模式来创造对象。</p>
<h2 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h2><ul>
<li>以指定的模式来创造对象</li>
<li>自动地为新创建的对象设置一个原型对象，这个原型对象存储在 <code>ConstructorFunction.prototype</code> 属性中。</li>
</ul>
<p>我们可以使用构造函数来重写上一个拥有对象 <code>b</code> 和对象 <code>c</code> 的例子。因此，对象 <code>a</code> 的角色由 <code>Foo.prototype</code> 来扮演：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params">y</span>) </span>&#123; <span class="keyword">this</span>.y = y; &#125;</span><br><span class="line">Foo.prototype.x = <span class="number">10</span>;</span><br><span class="line">Foo.prototype.calculate = <span class="function"><span class="keyword">function</span> (<span class="params">z</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.x + <span class="keyword">this</span>.y + z;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> Foo(<span class="number">20</span>);</span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> Foo(<span class="number">30</span>);</span><br><span class="line">b.calculate(<span class="number">30</span>);</span><br><span class="line">c.calculate(<span class="number">40</span>);</span><br><span class="line"><span class="built_in">console</span>.log(b.__proto__ === Foo.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(c.__proto__ === Foo.prototype);</span><br><span class="line"><span class="built_in">console</span>.log(b.constructor === Foo);</span><br><span class="line"><span class="built_in">console</span>.log(c.constructor === Foo);</span><br><span class="line"><span class="built_in">console</span>.log(Foo.prototype.constructor === Foo);</span><br><span class="line"><span class="built_in">console</span>.log(b.calculate === b.__proto__.calculate);</span><br><span class="line"><span class="built_in">console</span>.log(b.__proto__.calculate === Foo.prototype.calculate);</span><br></pre></td></tr></table></figure>
<p>这个代码可以表示为如下关系：</p>
<p>可以看到，构造函数 <code>Foo</code> 也有自己的 <code>__proto__</code>，即 <code>Function.prototype</code>，<code>Function.prototype</code> 通过其 <code>__proto__</code> 属性关联到 <code>Object.prototype</code>。</p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/constructor-proto-chain.png" alt="constructor-proto-chain"></p>
<p>想一下类的概念，构造函数和原型对象合在一起可以当作一个「类」了。</p>
<p>例如：Python的 <code>First-Class、Dynamic-Classes</code> 显然是以同样的 <code>属性/方法</code> 处理方案来实现的。从这个角度来说，Python 中的类可以看作 ECMAScript 使用的委托继承的一个语法糖。</p>
<p>在ES6中「类」的概念被标准化了，并且实际上以一种构建在构造函数上面的语法糖来实现，就像上面描述的一样。</p>
<p>用类的方式实现如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">this</span>._name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  getName() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span> <span class="keyword">extends</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">  getName() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.getName() + <span class="string">' Doe'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bar = <span class="keyword">new</span> Bar(<span class="string">'John'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(bar.getName()); <span class="comment">// John Doe</span></span><br></pre></td></tr></table></figure>
<p><code>new</code> 操作符 都做了什么？</p>
<ol>
<li>创建一个新对象</li>
<li>将构造函数作用域赋给新对象，即 <code>this</code> 指向了新对象</li>
<li>执行构造函数中的代码，初始化新对象（即 <code>this</code>）</li>
<li>返回新对象的引用 <code>this</code>，没显示返回或返回 <code>this</code>，也可返回其他对象。</li>
</ol>
<p>只要用 <code>new</code> 操作符来调用函数就是构造函数，否则，就是普通函数。</p>
<p>Example：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NewDate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> NewDate();</span><br><span class="line"><span class="built_in">console</span>.log(date <span class="keyword">instanceof</span> NewDate); <span class="comment">// ?</span></span><br><span class="line"><span class="built_in">console</span>.log(date <span class="keyword">instanceof</span> <span class="built_in">Date</span>);    <span class="comment">// ?</span></span><br></pre></td></tr></table></figure>
<h2 id="对象构造"><a href="#对象构造" class="headerlink" title="对象构造"></a>对象构造</h2><h3 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h3><ul>
<li>按指定模式创建对象的，但是对象类型无法标识，且每个方法在每个对象上都要重新创建一次。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createObject</span>(<span class="params">arg1, arg2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">  o.property1 = arg1;</span><br><span class="line">  o.property2 = arg2;</span><br><span class="line">  o.func = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.property1);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.property2);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o1 = createObject(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> o2 = createObject(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="built_in">console</span>.log(o1.property1);</span><br></pre></td></tr></table></figure>
<h3 id="构造函数模式"><a href="#构造函数模式" class="headerlink" title="构造函数模式"></a>构造函数模式</h3><ul>
<li>构造函数名字用来标志一个 <code>特定类型</code>，同样每个方法在每个对象上都要重新创建一次。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NewObject</span>(<span class="params">arg1, arg2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.property1 = arg1;</span><br><span class="line">  <span class="keyword">this</span>.property2 = arg2;</span><br><span class="line">  <span class="keyword">this</span>.func = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.property1);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> no1 = <span class="keyword">new</span> NewObject(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> no2 = <span class="keyword">new</span> NewObject(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="comment">// 构造函数属性 constructor 标志对象类型</span></span><br><span class="line"><span class="built_in">console</span>.log(no1.constructor == NewObject);</span><br><span class="line"><span class="built_in">console</span>.log(no1.constructor == <span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">console</span>.log(no2.constructor == NewObject);</span><br><span class="line"><span class="built_in">console</span>.log(no2.constructor == <span class="built_in">Object</span>);</span><br><span class="line"><span class="comment">// 检测对象　更可靠</span></span><br><span class="line"><span class="built_in">console</span>.log(no1 <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">console</span>.log(no1 <span class="keyword">instanceof</span> NewObject);</span><br><span class="line"><span class="built_in">console</span>.log(no2 <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br><span class="line"><span class="built_in">console</span>.log(no2 <span class="keyword">instanceof</span> NewObject);</span><br></pre></td></tr></table></figure>
<h3 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h3><ul>
<li>每个函数都有一个 <code>prototype</code> 属性，引用另一个对象，这个对象可以实现属性的共享。</li>
<li><code>prototype</code> 是构造函数的一个属性，<code>prototype</code> 指向的 <code>原型对象</code> 拥有一个<code>constructor</code> 属性指向构造函数。</li>
<li>通过构造函数创建的 <code>对象实例</code> 可以通过 <code>__proto__</code> 访问 <code>原型对象</code>，但是不能重写，重名的属性将屏蔽原型中的同名属性。</li>
<li>在原型中修改属性，会立刻在 <code>对象实例</code> 中反映出来。但是如果重写整个原型对象，那么实例对象将找不到原型中定义的属性。</li>
<li><code>prototype</code> 和 <code>constructor</code> 构成了双向链表。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PrototypeObject</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">PrototypeObject.prototype.name = <span class="string">'PrototypeObject'</span>; <span class="comment">// name 是多实例共享的</span></span><br><span class="line">PrototypeObject.prototype.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> po1 = <span class="keyword">new</span> PrototypeObject();</span><br><span class="line">po1.sayName();</span><br><span class="line"><span class="keyword">var</span> po2 = <span class="keyword">new</span> PrototypeObject();</span><br><span class="line">po2.sayName();</span><br><span class="line"><span class="built_in">console</span>.log(po1.sayName === po2.sayName);       <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(po1.sayName() === po2.sayName());   <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(PrototypeObject.prototype.constructor === PrototypeObject); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 每个实例　拥有一个[[Prototype]]属性指向原型对象，但是JS代码无法访问此属性。</span></span><br><span class="line"><span class="built_in">console</span>.log(PrototypeObject.prototype.isPrototypeOf(po1));              <span class="comment">// true  // 判断po1.[[Prototype]] ===</span></span><br><span class="line"><span class="built_in">console</span>.log(PrototypeObject.prototype.isPrototypeOf(po2));              <span class="comment">// true  // 判断po2.[[Prototype]] ===</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getPrototypeOf(po1) === PrototypeObject.prototype);  <span class="comment">// 返回原型对象</span></span><br><span class="line"><span class="built_in">console</span>.log(po1.hasOwnProperty(<span class="string">'sayName'</span>));                             <span class="comment">// 判断是否是对象属性  检测属性存在于对象中还是原型对象中</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hasPrototypeProperty</span>(<span class="params">object, name</span>) </span>&#123;               <span class="comment">// 判断是否是原型属性</span></span><br><span class="line">  <span class="keyword">return</span> !object.hasOwnProperty(name) &amp;&amp; (name <span class="keyword">in</span> object);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Object.keys();                    // 返回所有可枚举的实例属性</span></span><br><span class="line"><span class="comment">// Object.getOwnPropertyNames();     // 返回所有实例属性</span></span><br><span class="line"><span class="comment">// 原型同样可以这样定义：原型对象 = 字面量，prototype的constructor不再等于PrototypeObject，但是instanceof()仍能继续工作。</span></span><br><span class="line">PrototypeObject.prototype = &#123; <span class="comment">// 这样把整个原型改了</span></span><br><span class="line">    <span class="keyword">constructor</span>: Person // 默认的<span class="keyword">constructor</span>被覆盖掉了 [[Enumerable]]会变成true</span><br><span class="line">&#125;</span><br><span class="line">Object.defineProperty(PrototypeObject.prototype, '<span class="keyword">constructor</span>', &#123;</span><br><span class="line">  enumerable: <span class="literal">false</span>,</span><br><span class="line">  value: Persion</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="组合构造函数和原型模式-默认模式"><a href="#组合构造函数和原型模式-默认模式" class="headerlink" title="组合构造函数和原型模式 - [默认模式]"></a>组合构造函数和原型模式 - [默认模式]</h3><ul>
<li>实例属性在构造函数中定义 共享属性在原型中定义</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ConstructPrototypeObject</span>(<span class="params">name, desc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.desc = desc;</span><br><span class="line">&#125;</span><br><span class="line">ConstructPrototypeObject.prototype.display = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.desc);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="动态原型模式"><a href="#动态原型模式" class="headerlink" title="动态原型模式"></a>动态原型模式</h3><ul>
<li>只在第一次调用构造函数时 实例化原型，好像没这个问题。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ConstructPrototypeObject</span>(<span class="params">name, desc</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.desc = desc;</span><br><span class="line">  <span class="keyword">if</span> (!ConstructPrototypeObject.prototypeInstantiated) &#123;</span><br><span class="line">      <span class="comment">//只在第一次调用构造函数时 实例化原型</span></span><br><span class="line">    ConstructPrototypeObject.prototype.prototypeInstantiated = <span class="literal">true</span>;</span><br><span class="line">    ConstructPrototypeObject.prototype.display = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.desc);</span><br><span class="line">    &#125;;</span><br><span class="line">    ConstructPrototypeObject.prototype.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// ... ...</span></span><br><span class="line">    ConstructPrototypeObject.prototypeInstantiated = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="扩展模式-（寄生模式）"><a href="#扩展模式-（寄生模式）" class="headerlink" title="扩展模式 （寄生模式）"></a>扩展模式 （寄生模式）</h3><ul>
<li>这种方式，可以用来扩展原生对象，在不修改原生对象的前提下，扩展方法，并不影响类型识别。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SpecialArray</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> values = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">  values.push.apply(values, <span class="built_in">arguments</span>);</span><br><span class="line">  values.toPipedString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.join(<span class="string">'|'</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> values;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> colors = <span class="keyword">new</span> SpecialArray(<span class="string">'red'</span>, <span class="string">'blue'</span>, <span class="string">'green'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(colors.toPipedString());</span><br><span class="line"><span class="built_in">console</span>.log(colors <span class="keyword">instanceof</span> SpecialArray);  <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(colors <span class="keyword">instanceof</span> <span class="built_in">Array</span>);         <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="稳妥构造函数模式"><a href="#稳妥构造函数模式" class="headerlink" title="稳妥构造函数模式"></a>稳妥构造函数模式</h3><ul>
<li>数据成员位于 <code>作用域链</code> 中，不存在 <code>原型链</code> 或 <code>对象的属性</code>，可实现 <code>私有属性</code>，防止数据被其他程序改动时使用，适合用于一些安全环境，这些环境禁止使用 <code>this</code> 和 <code>new</code>。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, job</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">  <span class="keyword">var</span> name = name;</span><br><span class="line">  o.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> friend = Person(<span class="string">'liuyanjie'</span>, <span class="number">22</span>, <span class="string">'Software Engineer'</span>);</span><br><span class="line">friend.sayName();</span><br><span class="line"><span class="built_in">console</span>.log(friend.name); <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, job</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = name;</span><br><span class="line">  <span class="keyword">this</span>.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> friend = <span class="keyword">new</span> Person(<span class="string">'liuyanjie'</span>, <span class="number">22</span>, <span class="string">'Software Engineer'</span>);</span><br><span class="line">friend.sayName();</span><br><span class="line"><span class="built_in">console</span>.log(friend.name); <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 这里可以定义闭包变量</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, job</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name = name;</span><br><span class="line">    <span class="keyword">this</span>.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> friend = <span class="keyword">new</span> Person(<span class="string">'liuyanjie'</span>, <span class="number">22</span>, <span class="string">'Software Engineer'</span>);</span><br><span class="line">friend.sayName();</span><br><span class="line"><span class="built_in">console</span>.log(friend.name); <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
<h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><h3 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h3><ul>
<li>原型属性会被所有实例共享</li>
<li>无法向超类传递参数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.supProperty = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">SuperType.prototype.getSuperValue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.supProperty;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.subProperty = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">SubType.prototype = <span class="keyword">new</span> SuperType();</span><br><span class="line">SubType.prototype.getSubValue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.subProperty;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> SubType();</span><br><span class="line"><span class="built_in">console</span>.log(instance.getSuperValue());</span><br><span class="line"><span class="comment">// 借用构造函数    在子类型的内部调用父类型的构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SupType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.colors = [<span class="string">'red'</span>, <span class="string">'blue'</span>, <span class="string">'green'</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// this 指 SubType 普通函数调用 把函数当作一个模板 同时可以传递参数</span></span><br><span class="line">  SupType.call(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> SubType();</span><br><span class="line">instance.colors.push(<span class="string">'black'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(instance);</span><br></pre></td></tr></table></figure>
<h3 id="组合继承"><a href="#组合继承" class="headerlink" title="组合继承"></a>组合继承</h3><ul>
<li>原型链继承原型</li>
<li>借用构造函数继承实例属性</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.colors = [<span class="string">'red'</span>, <span class="string">'blue'</span>, <span class="string">'green'</span>];</span><br><span class="line">&#125;</span><br><span class="line">SuperType.prototype.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">  SuperType.call(<span class="keyword">this</span>, name);           <span class="comment">// 普通函数</span></span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line">SubType.prototype = <span class="keyword">new</span> SuperType();    <span class="comment">// 构造函数</span></span><br><span class="line">SubType.prototype.constructor = SubType;</span><br><span class="line">SubType.prototype.sayAge = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.age);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> SubType(<span class="string">'liuyanjie'</span>, <span class="number">22</span>);</span><br><span class="line">instance.colors.push(<span class="string">'black'</span>);</span><br><span class="line">instance.sayName();</span><br><span class="line">instance.sayAge();</span><br></pre></td></tr></table></figure>
<h3 id="原型式继承"><a href="#原型式继承" class="headerlink" title="原型式继承"></a>原型式继承</h3><ul>
<li>此方式必须有一个对象作为基础，作为原型。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">object</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123; &#125; <span class="comment">// 临时性构造函数</span></span><br><span class="line">  F.prototype = o;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Object</span>.create();    <span class="comment">//此方法即为原型式继承</span></span><br></pre></td></tr></table></figure>
<h3 id="寄生式继承"><a href="#寄生式继承" class="headerlink" title="寄生式继承"></a>寄生式继承</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createAnother</span>(<span class="params">original</span>) </span>&#123;          <span class="comment">// 工厂</span></span><br><span class="line">  <span class="keyword">var</span> clone = <span class="built_in">Object</span>.create(original);      <span class="comment">// 封装了原型式继承</span></span><br><span class="line">  clone.sayHi = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hi'</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> clone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="寄生组合式继承"><a href="#寄生组合式继承" class="headerlink" title="寄生组合式继承"></a>寄生组合式继承</h3><ul>
<li>借用构造函数继承属性</li>
<li>原型链的混成形式继承方法</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inheritPrototype</span>(<span class="params">subType, supType</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> prototype = <span class="built_in">Object</span>.create(supType.prototype);</span><br><span class="line">  prototype.constructor = subType;</span><br><span class="line">  subType.prototype = prototype;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Node.js原生实现的继承函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">exports.inherits = <span class="function"><span class="keyword">function</span>(<span class="params">ctor, superCtor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (ctor === <span class="literal">undefined</span> || ctor === <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'The constructor to `inherits` must not be '</span> +</span><br><span class="line">                        <span class="string">'null or undefined.'</span>);</span><br><span class="line">  <span class="keyword">if</span> (superCtor === <span class="literal">undefined</span> || superCtor === <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'The super constructor to `inherits` must not '</span> +</span><br><span class="line">                        <span class="string">'be null or undefined.'</span>);</span><br><span class="line">  <span class="keyword">if</span> (superCtor.prototype === <span class="literal">undefined</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'The super constructor to `inherits` must '</span> +</span><br><span class="line">                        <span class="string">'have a prototype.'</span>);</span><br><span class="line">  ctor.super_ = superCtor;</span><br><span class="line">  ctor.prototype = <span class="built_in">Object</span>.create(superCtor.prototype, &#123;</span><br><span class="line">    <span class="keyword">constructor</span>: &#123;value: ctor, <span class="attr">enumerable</span>: <span class="literal">false</span>, <span class="attr">writable</span>: <span class="literal">true</span>, <span class="attr">configurable</span>: <span class="literal">true</span>&#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="对象构造和原型链总结"><a href="#对象构造和原型链总结" class="headerlink" title="对象构造和原型链总结"></a>对象构造和原型链总结</h2><p>上面不论是有多少对象构造模式和原型继承模式，只要理解其本质，就容易根据自己的需要实现想要的效果，上面的各种方式都是别人用惯的套路。</p>
<p>构造函数为了构造对象，实现不同功能，第一要先有一个对象（不论怎么来的），然后控制 <code>原型链</code> 和 <code>作用域链</code>。</p>
<p>下图是一个JavaScript Prototype Chain关系图：<a href="images/javascript-prototype.png">查看原图</a></p>
<p><img src="https://raw.githubusercontent.com/liuyanjie/knowledge/master/langs/ecmascript/images/javascript-prototype.png" alt="JavaScript Prototype Chain"></p>
<p>上面的内容都是静态的内容，主要是想把 原型链 讲清楚。</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="函数声明和函数表达式"><a href="#函数声明和函数表达式" class="headerlink" title="函数声明和函数表达式"></a>函数声明和函数表达式</h3><p>函数声明： <code>function 函数名称 (参数){ 函数体 }</code>。</p>
<p>函数表达式： <code>[var f = ] function [函数名称](参数){ 函数体 }</code>，如果有函数名，就是命名函数表达式。</p>
<p>所以，可以看出，如果不声明函数名称，它肯定是表达式，可如果声明了函数名称的话，如何判断是函数声明还是函数表达式呢？</p>
<p>ECMAScript 是通过上下文来区分的，如果 <code>function foo(){}</code> 是作为赋值表达式的一部分的话，那它就是一个函数表达式，如果 <code>function foo(){}</code> 被包含在一个函数体内，或者位于程序的最顶部的话，那它就是一个函数声明。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;&#125;              <span class="comment">// 声明，因为它是程序的一部分</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;&#125;;   <span class="comment">// 表达式，因为它是赋值表达式的一部分</span></span><br><span class="line"><span class="keyword">new</span> <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;&#125;;         <span class="comment">// 表达式，因为它是new表达式</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;&#125;            <span class="comment">// 声明，因为它是函数体的一部分</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>还有一种函数表达式不太常见，就是被括号括住的 <code>(function foo(){})</code>，他是表达式的原因是因为括号， <code>()</code> 是一个分组操作符，它的内部只能包含表达式，我们来看几个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;&#125;      <span class="comment">// 函数声明</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;&#125;);   <span class="comment">// 函数表达式：包含在分组操作符内</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  (<span class="keyword">var</span> x = <span class="number">5</span>);        <span class="comment">// 分组操作符，只能包含表达式而不能包含语句：这里的var就是语句</span></span><br><span class="line">&#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">  <span class="comment">// SyntaxError</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在使用 <code>eval</code> 对JSON进行执行的时候，JSON字符串通常被包含在一个圆括号里： <code>eval(&#39;(&#39; + json + &#39;)&#39;)</code>，这样做的原因就是因为分组操作符，也就是这对括号，会让解析器强制将JSON的花括号解析成表达式而不是代码块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  &#123; <span class="string">"x"</span>: <span class="number">5</span> &#125;; <span class="comment">// "&#123;" 和 "&#125;" 做解析成代码块</span></span><br><span class="line">&#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">  <span class="comment">// SyntaxError</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(&#123; <span class="string">"x"</span>: <span class="number">5</span> &#125;); <span class="comment">// 分组操作符强制将"&#123;" 和 "&#125;"作为对象字面量来解析</span></span><br></pre></td></tr></table></figure>
<p>匿名函数的好几种写法，一般情况下写匿名函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;)();</span><br></pre></td></tr></table></figure>
<p>但下面几种写法也是可以的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">!<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;();</span><br><span class="line">+<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;();</span><br><span class="line">-<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;();</span><br><span class="line">~<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;();</span><br><span class="line">~(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;)();</span><br><span class="line"><span class="keyword">void</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;();</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;());</span><br></pre></td></tr></table></figure>
<p>现在，在我们知道了对象的基础之后，让我们看看运行时程序的执行 <code>runtime program execution</code> 在ECMAScript中是如何实现的。</p>

        </div>
    

</div>
            
        </section>
    </div>
</div>






</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This theme was developed by <a href="https://github.com/klugjo">Jonathan Klughertz</a>. The source code is available on Github. Create Websites. Make Magic.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/posts/GIT对象模型/">GIT对象模型</a>
            </li>
            
            <li>
                <a class="footer-post" href="/posts/Git命令/">Git命令</a>
            </li>
            
            <li>
                <a class="footer-post" href="/posts/JavaScript深度/">JavaScript深度</a>
            </li>
            
            <li>
                <a class="footer-post" href="/posts/JavaScript基础/">JavaScript基础</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>Categories</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/GIT/">GIT</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/Syntax/">Syntax</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/GIT/VCS/">VCS</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/Syntax/JavaScript/">JavaScript</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/liuyanjie">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:liuyj619@gmail.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->

<script type="text/javascript">
    var disqus_shortname = 'liuyanjie';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>

</html>